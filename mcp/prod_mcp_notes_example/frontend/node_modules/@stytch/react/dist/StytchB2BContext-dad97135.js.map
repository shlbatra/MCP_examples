{"version":3,"file":"StytchB2BContext-dad97135.js","sources":["../../../internal/react-shared/src/b2b/StytchB2BContext.tsx"],"sourcesContent":["import React, {\n  ComponentType,\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n} from 'react';\n\nimport { PermissionsMap } from '@stytch/core/public';\nimport { mergeWithStableProps } from '@stytch/js-utils';\nimport type { Member, MemberSession, Organization, StytchB2BUIClient } from '@stytch/vanilla-js/b2b';\nimport type { StytchB2BHeadlessClient, StytchProjectConfigurationInput } from '@stytch/vanilla-js/b2b/headless';\nimport { isStytchSSRProxy } from '../StytchSSRProxy';\nimport { useAsyncState } from '../utils/async';\nimport { noProviderError } from '../utils/errors';\nimport { invariant } from '../utils/invariant';\n\n/**\n * The Stytch Client object passed in to <StytchB2BProvider /> in your application root.\n * Either a StytchB2BUIClient or StytchB2BHeadlessClient.\n */\ntype StytchB2BClient<TProjectConfiguration extends StytchProjectConfigurationInput> =\n  | StytchB2BHeadlessClient<TProjectConfiguration>\n  | StytchB2BUIClient<TProjectConfiguration>;\n\ntype StytchB2BContext<TProjectConfiguration extends StytchProjectConfigurationInput> =\n  | {\n      isMounted: false;\n    }\n  | {\n      isMounted: true;\n      client: StytchB2BClient<TProjectConfiguration>;\n    };\n\ntype SWRMemberUninitialized = {\n  /**\n   * Either the active {@link Member} object, or null if the member is not logged in.\n   */\n  member: null;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: false;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: false;\n};\n\ntype SWRMemberInitialized = {\n  /**\n   * Either the active {@link Member} object, or null if the member is not logged in.\n   */\n  member: Member | null;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: boolean;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: true;\n};\n\ntype SWRMember<TAlwaysInitialized extends boolean = boolean> = TAlwaysInitialized extends true\n  ? SWRMemberInitialized\n  : SWRMemberInitialized | SWRMemberUninitialized;\n\nconst initialMember: SWRMember = {\n  member: null,\n  fromCache: false,\n  isInitialized: false,\n};\n\ntype SWRMemberSessionUninitialized = {\n  /**\n   * Either the active {@link MemberSession} object, or null if the member is not logged in.\n   */\n  session: null;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: false;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: false;\n};\n\ntype SWRMemberSessionInitialized = {\n  /**\n   * Either the active {@link MemberSession} object, or null if the member is not logged in.\n   */\n  session: MemberSession | null;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: boolean;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: true;\n};\n\ntype SWRMemberSession<TAlwaysInitialized extends boolean = boolean> = TAlwaysInitialized extends true\n  ? SWRMemberSessionInitialized\n  : SWRMemberSessionInitialized | SWRMemberSessionUninitialized;\n\nconst initialMemberSession: SWRMemberSession = {\n  session: null,\n  fromCache: false,\n  isInitialized: false,\n};\n\ntype SWROrganizationUninitialized = {\n  /**\n   * Either the active {@link Organization} object, or null if the member is not logged in.\n   */\n  organization: null;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: false;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: false;\n};\n\ntype SWROrganizationInitialized = {\n  /**\n   * Either the active {@link Organization} object, or null if the member is not logged in.\n   */\n  organization: Organization | null;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: boolean;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: true;\n};\n\ntype SWROrganization<TAlwaysInitialized extends boolean = boolean> = TAlwaysInitialized extends true\n  ? SWROrganizationInitialized\n  : SWROrganizationInitialized | SWROrganizationUninitialized;\n\nconst initialOrganization: SWROrganization = {\n  organization: null,\n  fromCache: false,\n  isInitialized: false,\n};\n\nconst StytchB2BContext = createContext<StytchB2BContext<StytchProjectConfigurationInput>>({ isMounted: false });\nconst StytchMemberContext = createContext<SWRMember>(initialMember);\nconst StytchMemberSessionContext = createContext<SWRMemberSession>(initialMemberSession);\nconst StytchOrganizationContext = createContext<SWROrganization>(initialOrganization);\n\nexport const useIsMounted__INTERNAL = (): boolean => useContext(StytchB2BContext).isMounted;\n\nexport const isUIClient = <TProjectConfiguration extends StytchProjectConfigurationInput>(\n  client: StytchB2BClient<TProjectConfiguration>,\n): client is StytchB2BUIClient<TProjectConfiguration> => {\n  return (client as StytchB2BUIClient<TProjectConfiguration>).mount !== undefined;\n};\n\n/**\n * Returns the active Member.\n * The Stytch SDKs are used for client-side authentication and session management.\n * Check the isInitialized property to determine if the SDK has completed initialization.\n * Check the fromCache property to determine if the member data is from persistent storage.\n * @example\n * const {member, isInitialized, fromCache} = useStytchMember();\n * if (!isInitialized) {\n *     return <p>Loading...</p>;\n * }\n * return (<h1>Welcome, {member.name}</h1>);\n */\nexport const useStytchMember = <TAssumeHydrated extends boolean = false>(): SWRMember<TAssumeHydrated> => {\n  invariant(useIsMounted__INTERNAL(), noProviderError('useStytchMember', 'StytchB2BProvider'));\n  return useContext(StytchMemberContext) as SWRMember<TAssumeHydrated>;\n};\n\n/**\n * Returns the active member's Stytch member session.\n * The Stytch SDKs are used for client-side authentication and session management.\n * Check the isInitialized property to determine if the SDK has completed initialization.\n * Check the fromCache property to determine if the session data is from persistent storage.\n * @example\n * const {session, isInitialized, fromCache} = useStytchMemberSession();\n * useEffect(() => {\n *   if (!isInitialized) {\n *     return;\n *   }\n *   if (!session) {\n *     router.replace('/login')\n *   }\n * }, [session, isInitialized]);\n */\nexport const useStytchMemberSession = <\n  TAssumeHydrated extends boolean = false,\n>(): SWRMemberSession<TAssumeHydrated> => {\n  invariant(useIsMounted__INTERNAL(), noProviderError('useStytchMemberSession', 'StytchB2BProvider'));\n  return useContext(StytchMemberSessionContext) as SWRMemberSession<TAssumeHydrated>;\n};\n\n/**\n * Returns the active Stytch organization.\n * The Stytch SDKs are used for client-side authentication and session management.\n * Check the isInitialized property to determine if the SDK has completed initialization.\n * Check the fromCache property to determine if the organization data is from persistent storage.\n * @example\n * const {organization, isInitialized, fromCache} = useStytchOrganization();\n * if (!isInitialized) {\n *     return <p>Loading...</p>;\n * }\n * return (<p>Welcome to {organization.organization_name}</p>);\n */\nexport const useStytchOrganization = <TAssumeHydrated extends boolean = false>(): SWROrganization<TAssumeHydrated> => {\n  invariant(useIsMounted__INTERNAL(), noProviderError('useStytchOrganization', 'StytchB2BProvider'));\n  return useContext(StytchOrganizationContext) as SWROrganization<TAssumeHydrated>;\n};\n\ntype SWRIsAuthorizedUninitialized = {\n  /**\n   * Whether the logged-in member is allowed to perform the specified action on the specified resource.\n   */\n  isAuthorized: false;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: false;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: false;\n};\n\ntype SWRIsAuthorizedInitialized = {\n  /**\n   * Whether the logged-in member is allowed to perform the specified action on the specified resource.\n   */\n  isAuthorized: boolean;\n  /**\n   * If true, indicates that the value returned is from the application cache and a state refresh is in progress.\n   */\n  fromCache: boolean;\n  /**\n   * If true, indicates that the SDK has completed initialization.\n   */\n  isInitialized: boolean;\n};\n\ntype SWRIsAuthorized<TAlwaysInitialized extends boolean> = TAlwaysInitialized extends true\n  ? SWRIsAuthorizedInitialized\n  : SWRIsAuthorizedInitialized | SWRIsAuthorizedUninitialized;\n\n/**\n * Determines whether the logged-in member is allowed to perform the specified action on the specified resource.\n * Returns `true` if the member can perform the action, `false` otherwise.\n *\n * If the member is not logged in, this method will always return false.\n * If the resource or action provided are not valid for the configured RBAC policy, this method will return false.\n *\n * Remember - authorization checks for sensitive actions should always occur on the backend as well.\n * @example\n * const { isAuthorized } = useStytchIsAuthorized<Permissions>('documents', 'edit');\n * return <button disabled={!isAuthorized}>Edit</button>\n */\nexport const useStytchIsAuthorized = <TAssumeHydrated extends boolean = false>(\n  resourceId: string,\n  action: string,\n): SWRIsAuthorized<TAssumeHydrated> => {\n  invariant(useIsMounted__INTERNAL(), noProviderError('useStytchIsAuthorized', 'StytchB2BProvider'));\n  const client = useStytchB2BClient();\n  const { session } = useStytchMemberSession();\n  const [isAuthorized, setIsAuthorized] = useAsyncState<SWRIsAuthorized<boolean>>({\n    isInitialized: false,\n    fromCache: false,\n    isAuthorized: false,\n  });\n\n  useEffect(() => {\n    if (isStytchSSRProxy(client)) {\n      return;\n    }\n\n    setIsAuthorized({\n      isInitialized: true,\n      fromCache: true,\n      isAuthorized: client.rbac.isAuthorizedSync(resourceId, action),\n    });\n  }, [action, client, resourceId, setIsAuthorized]);\n\n  useEffect(() => {\n    if (isStytchSSRProxy(client)) {\n      return;\n    }\n\n    client.rbac.isAuthorized(resourceId, action).then((isAuthorized) => {\n      setIsAuthorized({ isAuthorized, fromCache: false, isInitialized: true });\n    });\n  }, [client, session?.roles, resourceId, action, setIsAuthorized]);\n\n  return isAuthorized;\n};\n\n/**\n * Returns the Stytch B2B client stored in the Stytch context.\n *\n * @example\n * const stytch = useStytchB2BClient();\n * useEffect(() => {\n *   stytch.magicLinks.authenticate('...')\n * }, [stytch]);\n */\nexport const useStytchB2BClient = <\n  TProjectConfiguration extends StytchProjectConfigurationInput = Stytch.DefaultProjectConfiguration,\n>(): StytchB2BHeadlessClient<TProjectConfiguration> => {\n  const ctx = useContext(StytchB2BContext);\n  invariant(ctx.isMounted, noProviderError('useStytchB2BClient', 'StytchB2BProvider'));\n  return ctx.client as StytchB2BHeadlessClient<TProjectConfiguration>;\n};\n\nexport const withStytchB2BClient = <T extends object, TProjectConfiguration extends StytchProjectConfigurationInput>(\n  Component: ComponentType<T & { stytch: StytchB2BHeadlessClient<TProjectConfiguration> }>,\n): ComponentType<T> => {\n  const WithStytch: ComponentType<T> = (props) => {\n    invariant(useIsMounted__INTERNAL(), noProviderError('withStytchB2BClient', 'StytchB2BProvider'));\n    return <Component {...props} stytch={useStytchB2BClient()} />;\n  };\n  WithStytch.displayName = `withStytch(${Component.displayName || Component.name || 'Component'})`;\n  return WithStytch;\n};\n\nexport const withStytchMember = <T extends object, TAssumeHydrated extends boolean = false>(\n  Component: ComponentType<\n    T & { stytchMember: Member | null; stytchMemberIsInitialized: boolean; stytchMemberIsFromCache: boolean }\n  >,\n): ComponentType<T> => {\n  const WithStytchUser: ComponentType<T> = (props) => {\n    invariant(useIsMounted__INTERNAL(), noProviderError('withStytchMember', 'StytchB2BProvider'));\n    const { member, isInitialized, fromCache } = useStytchMember<TAssumeHydrated>();\n    return (\n      <Component\n        {...props}\n        stytchMember={member}\n        stytchMemberIsInitialized={isInitialized}\n        stytchMemberIsFromCache={fromCache}\n      />\n    );\n  };\n  WithStytchUser.displayName = `withStytchMember(${Component.displayName || Component.name || 'Component'})`;\n  return WithStytchUser;\n};\n\nexport const withStytchMemberSession = <T extends object, TAssumeHydrated extends boolean = false>(\n  Component: ComponentType<\n    T & {\n      stytchMemberSession: MemberSession | null;\n      stytchMemberSessionIsInitialized: boolean;\n      stytchMemberSessionIsFromCache: boolean;\n    }\n  >,\n): ComponentType<T> => {\n  const WithStytchSession: ComponentType<T> = (props) => {\n    invariant(useIsMounted__INTERNAL(), noProviderError('withStytchMemberSession', 'StytchB2BProvider'));\n    const { session, isInitialized, fromCache } = useStytchMemberSession<TAssumeHydrated>();\n    return (\n      <Component\n        {...props}\n        stytchMemberSession={session}\n        stytchMemberSessionIsInitialized={isInitialized}\n        stytchMemberSessionIsFromCache={fromCache}\n      />\n    );\n  };\n  WithStytchSession.displayName = `withStytchMemberSession(${Component.displayName || Component.name || 'Component'})`;\n  return WithStytchSession;\n};\n\nexport const withStytchOrganization = <T extends object, TAssumeHydrated extends boolean = false>(\n  Component: ComponentType<\n    T & {\n      stytchOrganization: Organization | null;\n      stytchOrganizationIsInitialized: boolean;\n      stytchOrganizationIsFromCache: boolean;\n    }\n  >,\n): ComponentType<T> => {\n  const WithStytchOrganization: ComponentType<T> = (props) => {\n    invariant(useIsMounted__INTERNAL(), noProviderError('withStytchOrganization', 'StytchB2BProvider'));\n    const { organization, isInitialized, fromCache } = useStytchOrganization<TAssumeHydrated>();\n    return (\n      <Component\n        {...props}\n        stytchOrganization={organization}\n        stytchOrganizationIsInitialized={isInitialized}\n        stytchOrganizationIsFromCache={fromCache}\n      />\n    );\n  };\n  WithStytchOrganization.displayName = `withStytchOrganization(${\n    Component.displayName || Component.name || 'Component'\n  })`;\n  return WithStytchOrganization;\n};\n\ntype permissionsLoaded<Permissions extends Record<string, string>> =\n  | {\n      loaded: false;\n      value: null;\n    }\n  | {\n      loaded: true;\n      value: PermissionsMap<Permissions>;\n    };\n\n/**\n * Wrap your component with this HOC in order to receive the permissions for the logged-in member.\n * Evaluates all permissions granted to the logged-in member.\n * Returns a Record<RoleId, Record<Action, boolean>> response indicating the member's permissions.\n * Each boolean will be `true` if the member can perform the action, `false` otherwise.\n *\n * If the member is not logged in, all values will be false.\n *\n * Remember - authorization checks for sensitive actions should always occur on the backend as well.\n * @example\n * type Permissions = {\n *   document: 'create' | 'read' | 'write\n *   image: 'create' | 'read'\n * }\n *\n * const MyComponent = (props) => {\n *   const canEditDocuments = props.stytchPermissions.document.edit;\n *   const canReadImages = props.stytchPermissions.image.read;\n * }\n * return withStytchPermissions<Permissions>(MyComponent)\n */\nexport const withStytchPermissions = <Permissions extends Record<string, string>, T extends object>(\n  Component: ComponentType<T & { stytchPermissions: PermissionsMap<Permissions> }>,\n): ComponentType<T> => {\n  const WithStytchPermissions: ComponentType<T> = (props) => {\n    invariant(useIsMounted__INTERNAL(), noProviderError('useRBACPermissions', 'StytchB2BProvider'));\n    const client = useStytchB2BClient();\n    const { session } = useStytchMemberSession();\n    const [permissions, setPermissions] = useAsyncState<permissionsLoaded<Permissions>>({ loaded: false, value: null });\n    useEffect(() => {\n      client.rbac\n        .allPermissions<Permissions>()\n        .then((permissions) => setPermissions({ loaded: true, value: permissions }));\n    }, [client, session?.roles, setPermissions]);\n\n    if (!permissions.loaded) {\n      return null;\n    }\n    return <Component {...props} stytchPermissions={permissions.value} />;\n  };\n  WithStytchPermissions.displayName = `withStytchPermissions(${\n    Component.displayName || Component.name || 'Component'\n  })`;\n  return WithStytchPermissions;\n};\n\nexport interface StytchB2BProviderProps<\n  TProjectConfiguration extends StytchProjectConfigurationInput = Stytch.DefaultProjectConfiguration,\n> {\n  /**\n   * A Stytch client instance, created using either {@link createStytchHeadlessClient} or {@link createStytchUIClient}\n   */\n  stytch: StytchB2BClient<TProjectConfiguration>;\n  /**\n   * When true, the provider will assume that the component will only be\n   * rendered in a browser environment, either in a single-page application or\n   * after completing hydration of a server-rendered application. This allows\n   * cached values to be retrieved from the browser on the first render, meaning\n   * that the `isInitialized` value returned from Stytch hooks will be `true`\n   * starting from the first render.\n   *\n   * When `false`, the provider will defer initialization until after the first\n   * render, and `isInitialized` will initially be `false`.\n   *\n   * This value defaults to `false` in `@stytch/nextjs`.\n   */\n  assumeHydrated?: boolean;\n  children?: ReactNode;\n}\n\n/**\n * The Stytch Context Provider.\n * Wrap your application with this component in order to use Stytch everywhere in your app.\n * @example\n * const stytch = createStytchB2BHeadlessClient('public-token-<find yours in the stytch dashboard>')\n *\n * return (\n *   <StytchB2BProvider stytch={stytch}>\n *     <App />\n *   </StytchB2BProvider>\n * )\n */\nexport const StytchB2BProvider = <\n  TProjectConfiguration extends StytchProjectConfigurationInput = Stytch.DefaultProjectConfiguration,\n>({\n  stytch,\n  children,\n  assumeHydrated = false,\n}: StytchB2BProviderProps<TProjectConfiguration>): JSX.Element => {\n  invariant(!useIsMounted__INTERNAL(), 'You cannot render a <StytchB2BProvider> inside another <StytchB2BProvider>.');\n  invariant(\n    !assumeHydrated || typeof window !== 'undefined',\n    'The `assumeHydrated` prop must be set to `false` when using StytchB2BProvider in a server environment.',\n  );\n\n  const ctx = useMemo(() => ({ client: stytch, isMounted: true }), [stytch]);\n\n  type ClientState<TAlwaysInitialized extends boolean> = {\n    member: SWRMember<TAlwaysInitialized>;\n    session: SWRMemberSession<TAlwaysInitialized>;\n    organization: SWROrganization<TAlwaysInitialized>;\n  };\n\n  const getHydratedState = useCallback(() => {\n    return {\n      member: { ...stytch.self.getInfo(), isInitialized: true },\n      session: { ...stytch.session.getInfo(), isInitialized: true },\n      organization: { ...stytch.organization.getInfo(), isInitialized: true },\n    } satisfies ClientState<true>;\n  }, [stytch]);\n\n  const getInitialState = () => {\n    return {\n      member: initialMember,\n      session: initialMemberSession,\n      organization: initialOrganization,\n    } satisfies ClientState<false>;\n  };\n\n  const [{ member, session, organization }, setClientState] = useAsyncState<ClientState<boolean>>(() =>\n    assumeHydrated ? getHydratedState() : (getInitialState() as ClientState<boolean>),\n  );\n\n  // Store the initial value of `assumeHydrated` in a ref, because it is\n  // logically only relevant for the first render\n  const assumeHydratedRef = useRef(assumeHydrated);\n  useEffect(() => {\n    if (isStytchSSRProxy(stytch)) {\n      return;\n    }\n\n    const updateState = () => {\n      setClientState((oldState) => mergeWithStableProps(oldState, getHydratedState()));\n    };\n\n    if (!assumeHydratedRef.current) {\n      updateState();\n    }\n\n    return stytch.onStateChange(updateState);\n  }, [getHydratedState, setClientState, stytch]);\n\n  return (\n    <StytchB2BContext.Provider value={ctx}>\n      <StytchOrganizationContext.Provider value={organization}>\n        <StytchMemberContext.Provider value={member}>\n          <StytchMemberSessionContext.Provider value={session}>{children}</StytchMemberSessionContext.Provider>\n        </StytchMemberContext.Provider>\n      </StytchOrganizationContext.Provider>\n    </StytchB2BContext.Provider>\n  );\n};\n"],"names":["createContext","useContext","invariant","noProviderError","useAsyncState","useEffect","isStytchSSRProxy","React","useMemo","useCallback","useRef","mergeWithStableProps"],"mappings":"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"}