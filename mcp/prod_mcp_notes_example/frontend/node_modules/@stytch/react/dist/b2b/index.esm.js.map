{"version":3,"file":"index.esm.js","sources":["../../../../internal/react-shared/src/b2b/Stytch.tsx","../../src/b2b/StytchB2BContext.tsx"],"sourcesContent":["import React, { useRef } from 'react';\nimport type {\n  Callbacks,\n  StringsOptions,\n  StyleConfig,\n  StytchB2BUIConfig,\n  StytchProjectConfigurationInput,\n} from '@stytch/vanilla-js';\n\nimport type { IDPConsentScreenManifest } from '@stytch/vanilla-js/b2b';\n\nimport { useStytchB2BClient, isUIClient, useIsMounted__INTERNAL, useStytchMember } from './StytchB2BContext';\nimport { invariant } from '../utils/invariant';\nimport { noHeadlessClientError, noProviderError } from '../utils/errors';\nimport useIsomorphicLayoutEffect from '../utils/useIsomorphicLayoutEffect';\n\nexport interface StytchB2BProps<\n  TProjectConfiguration extends StytchProjectConfigurationInput = Stytch.DefaultProjectConfiguration,\n> extends StringsOptions {\n  /**\n   * An optional {@link StyleConfig} to customize the look and feel of the screen.\n   *\n   * @example\n   * {\n   *    fontFamily: 'Arial, Helvetica, sans-serif',\n   *    width: '360px',\n   *    primaryColor: '#19303D',\n   * }\n   */\n  styles?: StyleConfig;\n  /**\n   * An optional {@link Callbacks} object.\n   *\n   * @example\n   * {\n   *   onError: ({message}) => {\n   *      console.error('Stytch error', message)\n   *   }\n   * }\n   *\n   * @example\n   * {\n   *   onEvent: ({type, data}) => {\n   *     if(type === StytchEventType.B2BMagicLinkAuthenticate) {\n   *       console.log('Logged in with', data);\n   *     }\n   *   }\n   * }\n   */\n  callbacks?: Callbacks<TProjectConfiguration>;\n  /**\n   * A {@link StytchB2BUIConfig} object. Add products and product-specific config to this object to change the login methods shown.\n   *\n   *\n   * @example\n   * {\n   *   products: ['emailMagicLinks'],\n   *   authFlowType: \"Discovery\",\n   *   emailMagicLinksOptions: {\n   *     discoveryRedirectURL: 'https://example.com/authenticate',\n   *   },\n   *   sessionOptions: {\n   *     sessionDurationMinutes: 60,\n   *   },\n   * }\n   *\n   * @example\n   * {\n   *   products: ['emailMagicLinks', 'sso'],\n   *   authFlowType: \"Organization\",\n   *   emailMagicLinksOptions: {\n   *     loginRedirectURL: 'https://example.com/authenticate',\n   *     signupRedirectURL: 'https://example.com/authenticate',\n   *   },\n   *   ssoOptions: {\n   *     loginRedirectURL: 'https://example.com/authenticate',\n   *     signupRedirectURL: 'https://example.com/authenticate',\n   *   },\n   *   sessionOptions: {\n   *     sessionDurationMinutes: 60,\n   *   },\n   * }\n   */\n  config: StytchB2BUIConfig;\n}\n\nexport type B2BIDPConsentManifestGenerator = (input: {\n  scopes: string[];\n  clientName: string;\n}) => IDPConsentScreenManifest;\n\ntype B2BAuthTokenParams = { trustedAuthToken: string; tokenProfileID: string };\n\nexport type B2BIdentityProviderProps = Omit<StytchB2BProps, 'config'> & {\n  /**\n   * Optional {@link B2BIDPConsentManifestGenerator} to customize the consent screen.\n   */\n  getIDPConsentManifest?: B2BIDPConsentManifestGenerator;\n  /**\n   * Optional trusted auth token parameters to attest before the OAuth flow.\n   */\n  trustedAuthTokenParams?: B2BAuthTokenParams;\n};\n\n/**\n * The Stytch B2B UI component.\n * This component can only be used with a Stytch B2B UI Client\n * passed into the StytchB2BProvider.\n *\n * See the {@link https://stytch.com/docs/b2b/sdks online reference}\n *\n * @example\n * <StytchB2B\n *   config={{\n *     authFlowType: \"Organization\",\n *     emailMagicLinksOptions: {\n *       loginRedirectURL: 'https://example.com/authenticate',\n *       signupRedirectURL: 'https://example.com/authenticate',\n *     },\n *     ssoOptions: {\n *       loginRedirectURL: 'https://example.com/authenticate',\n *       signupRedirectURL: 'https://example.com/authenticate',\n *     },\n *     sessionOptions: {\n *       sessionDurationMinutes: 60,\n *     }\n *   }}\n *   styles={{\n *     fontFamily: '\"Helvetica New\", Helvetica, sans-serif',\n *     primaryColor: '#0577CA',\n *     width: '321px',\n *   }}\n *   callbacks={{\n *     onEvent: (event) => console.log(event)\n *   }}\n * />\n */\nexport const StytchB2B = <\n  TProjectConfiguration extends StytchProjectConfigurationInput = Stytch.DefaultProjectConfiguration,\n>({\n  styles,\n  callbacks,\n  config,\n  strings,\n}: StytchB2BProps<TProjectConfiguration>) => {\n  invariant(useIsMounted__INTERNAL(), noProviderError('<StytchB2B />', 'StytchB2BProvider'));\n  const stytchClient = useStytchB2BClient<TProjectConfiguration>();\n  const containerEl = useRef<HTMLDivElement>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!isUIClient(stytchClient)) {\n      throw Error(noHeadlessClientError);\n    }\n\n    if (!containerEl.current) {\n      return;\n    }\n\n    if (!containerEl.current.id) {\n      const randId = Math.floor(Math.random() * 1e6);\n      containerEl.current.id = `stytch-b2b-ui-${randId}`;\n    }\n\n    stytchClient.mount({\n      callbacks,\n      config,\n      elementId: `#${containerEl.current.id}`,\n      styles,\n      strings,\n    });\n  }, [stytchClient, styles, callbacks, strings]);\n\n  return <div ref={containerEl} />;\n};\n\n/**\n * The Stytch B2B IDP component.\n * Parses OAuth Authorization params (client_id, scope, nonce, etc.) out of the page URL.\n * Requires the user to be logged in.\n * This component can only be used with a Stytch B2B UI Client\n * passed into the StytchB2BProvider.\n *\n * See the {@link https://stytch.com/docs/b2b/sdks online reference}\n *\n * @example\n * const styles = {\n *   container: {\n *     backgroundColor: '#e11e1e',\n *   },\n *   colors: {\n *     primary: '#ff00f7',\n *     secondary: '#5C727D',\n *   },\n * }\n *\n * <B2BIdentityProvider\n *   styles={styles}\n *   callbacks={{\n *     onEvent: (event) => console.log(event)\n *   }}\n * />\n */\nexport const B2BIdentityProvider = ({\n  styles,\n  callbacks,\n  getIDPConsentManifest,\n  trustedAuthTokenParams,\n}: B2BIdentityProviderProps) => {\n  invariant(useIsMounted__INTERNAL(), noProviderError('<IdentityProvider />'));\n  const stytchClient = useStytchB2BClient();\n  const { member } = useStytchMember();\n  const containerEl = useRef<HTMLDivElement>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!isUIClient(stytchClient)) {\n      throw Error(noHeadlessClientError);\n    }\n\n    if (!containerEl.current) {\n      return;\n    }\n\n    if (!containerEl.current.id) {\n      const randId = Math.floor(Math.random() * 1e6);\n      containerEl.current.id = `stytch-b2b-idp-${randId}`;\n    }\n\n    stytchClient.mountIdentityProvider({\n      callbacks,\n      elementId: `#${containerEl.current.id}`,\n      styles,\n      getIDPConsentManifest,\n      trustedAuthTokenParams,\n    });\n  }, [stytchClient, styles, callbacks, member, getIDPConsentManifest, trustedAuthTokenParams]);\n\n  return <div ref={containerEl} />;\n};\n","import React, { ComponentType, ReactNode } from 'react';\n\nimport type { Member, MemberSession, Organization, StytchB2BUIClient } from '@stytch/vanilla-js/b2b';\nimport type { StytchB2BHeadlessClient, StytchProjectConfigurationInput } from '@stytch/vanilla-js/b2b/headless';\n\n// We need a direct import to the original source file here (StytchB2BContext,\n// not just a barrel file) or the built type declarations will re-export these\n// values without ever importing them. This is evidently a bug that will\n// hopefully be resolved when we upgrade our build tooling.\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nexport {\n  useStytchB2BClient,\n  withStytchB2BClient,\n  withStytchPermissions,\n} from '@stytch/internal-react-shared/src/b2b/StytchB2BContext';\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nimport {\n  StytchB2BProvider as StytchB2BProviderShared,\n  useStytchIsAuthorized as useStytchIsAuthorizedShared,\n  useStytchMemberSession as useStytchMemberSessionShared,\n  useStytchMember as useStytchMemberShared,\n  useStytchOrganization as useStytchOrganizationShared,\n  withStytchMemberSession as withStytchMemberSessionShared,\n  withStytchMember as withStytchMemberShared,\n  withStytchOrganization as withStytchOrganizationShared,\n} from '@stytch/internal-react-shared/src/b2b';\n\n/**\n * The Stytch Client object passed in to <StytchB2BProvider /> in your application root.\n * Either a StytchB2BUIClient or StytchB2BHeadlessClient.\n */\ntype StytchB2BClient<TProjectConfiguration extends StytchProjectConfigurationInput> =\n  | StytchB2BHeadlessClient<TProjectConfiguration>\n  | StytchB2BUIClient<TProjectConfiguration>;\n\n/**\n * Returns the active Member.\n * The Stytch SDKs are used for client-side authentication and session management.\n * Check the isInitialized property to determine if the SDK has completed initialization.\n * Check the fromCache property to determine if the member data is from persistent storage.\n * @example\n * const {member, isInitialized, fromCache} = useStytchMember();\n * if (!isInitialized) {\n *     return <p>Loading...</p>;\n * }\n * return (<h1>Welcome, {member.name}</h1>);\n */\nexport const useStytchMember = useStytchMemberShared as <TAssumeHydrated extends boolean = true>() => ReturnType<\n  typeof useStytchMemberShared<TAssumeHydrated>\n>;\n\n/**\n * Returns the active member's Stytch member session.\n * The Stytch SDKs are used for client-side authentication and session management.\n * Check the isInitialized property to determine if the SDK has completed initialization.\n * Check the fromCache property to determine if the session data is from persistent storage.\n * @example\n * const {session, isInitialized, fromCache} = useStytchMemberSession();\n * useEffect(() => {\n *   if (!isInitialized) {\n *     return;\n *   }\n *   if (!session) {\n *     router.replace('/login')\n *   }\n * }, [session, isInitialized]);\n */\nexport const useStytchMemberSession = useStytchMemberSessionShared as <\n  TAssumeHydrated extends boolean = true,\n>() => ReturnType<typeof useStytchMemberSessionShared<TAssumeHydrated>>;\n\n/**\n * Returns the active Stytch organization.\n * The Stytch SDKs are used for client-side authentication and session management.\n * Check the isInitialized property to determine if the SDK has completed initialization.\n * Check the fromCache property to determine if the organization data is from persistent storage.\n * @example\n * const {organization, isInitialized, fromCache} = useStytchOrganization();\n * if (!isInitialized) {\n *     return <p>Loading...</p>;\n * }\n * return (<p>Welcome to {organization.organization_name}</p>);\n */\nexport const useStytchOrganization = useStytchOrganizationShared as <\n  TAssumeHydrated extends boolean = true,\n>() => ReturnType<typeof useStytchOrganizationShared<TAssumeHydrated>>;\n\n/**\n * Determines whether the logged-in member is allowed to perform the specified action on the specified resource.\n * Returns `true` if the member can perform the action, `false` otherwise.\n *\n * If the member is not logged in, this method will always return false.\n * If the resource or action provided are not valid for the configured RBAC policy, this method will return false.\n *\n * Remember - authorization checks for sensitive actions should always occur on the backend as well.\n * @example\n * const { isAuthorized } = useStytchIsAuthorized<Permissions>('documents', 'edit');\n * return <button disabled={!isAuthorized}>Edit</button>\n */\nexport const useStytchIsAuthorized = useStytchIsAuthorizedShared as <TAssumeHydrated extends boolean = false>(\n  resourceId: string,\n  action: string,\n) => ReturnType<typeof useStytchIsAuthorizedShared<TAssumeHydrated>>;\n\nexport const withStytchMember = withStytchMemberShared as <T extends object, TAssumeHydrated extends boolean = false>(\n  Component: ComponentType<\n    T & { stytchMember: Member | null; stytchMemberIsInitialized: boolean; stytchMemberIsFromCache: boolean }\n  >,\n) => ReturnType<typeof withStytchMemberShared<T, TAssumeHydrated>>;\n\nexport const withStytchMemberSession = withStytchMemberSessionShared as <\n  T extends object,\n  TAssumeHydrated extends boolean = false,\n>(\n  Component: ComponentType<\n    T & {\n      stytchMemberSession: MemberSession | null;\n      stytchMemberSessionIsInitialized: boolean;\n      stytchMemberSessionIsFromCache: boolean;\n    }\n  >,\n) => ReturnType<typeof withStytchMemberSessionShared<T, TAssumeHydrated>>;\n\nexport const withStytchOrganization = withStytchOrganizationShared as <\n  T extends object,\n  TAssumeHydrated extends boolean = false,\n>(\n  Component: ComponentType<\n    T & {\n      stytchOrganization: Organization | null;\n      stytchOrganizationIsInitialized: boolean;\n      stytchOrganizationIsFromCache: boolean;\n    }\n  >,\n) => ReturnType<typeof withStytchOrganizationShared<T, TAssumeHydrated>>;\n\nexport interface StytchB2BProviderProps<\n  TProjectConfiguration extends StytchProjectConfigurationInput = Stytch.DefaultProjectConfiguration,\n> {\n  /**\n   * A Stytch client instance, either a {@link StytchB2BUIClient} or {@link StytchB2BHeadlessClient}\n   */\n  stytch: StytchB2BClient<TProjectConfiguration>;\n  /**\n   * When true, the provider will assume that the component will only be\n   * rendered in a browser environment, either in a single-page application or\n   * after completing hydration of a server-rendered application. This allows\n   * cached values to be retrieved from the browser on the first render, meaning\n   * that the `isInitialized` value returned from Stytch hooks will be `true`\n   * starting from the first render.\n   *\n   * When `false`, the provider will defer initialization until after the first\n   * render, and `isInitialized` will initially be `false`.\n   *\n   * If you encounter hydration errors relating to the use of this component,\n   * set this to `false`.\n   *\n   * This value defaults to `true` in `@stytch/react`.\n   */\n  assumeHydrated?: boolean;\n  children?: ReactNode;\n}\n\n/**\n * The Stytch Context Provider.\n * Wrap your application with this component in order to use Stytch everywhere in your app.\n * @example\n * const stytch = createStytchB2BHeadlessClient('public-token-<find yours in the stytch dashboard>')\n *\n * ReactDOM.render(\n *   <StytchB2BProvider stytch={stytch}>\n *     <App />\n *   </StytchProvider>,\n *   document.getElementById('root'),\n * )\n */\nexport const StytchB2BProvider = <\n  TProjectConfiguration extends StytchProjectConfigurationInput = Stytch.DefaultProjectConfiguration,\n>({\n  stytch,\n  children,\n  assumeHydrated = true,\n}: StytchB2BProviderProps<TProjectConfiguration>): JSX.Element => {\n  return (\n    <StytchB2BProviderShared stytch={stytch} assumeHydrated={assumeHydrated}>\n      {children}\n    </StytchB2BProviderShared>\n  );\n};\n"],"names":["useStytchMember","useStytchMemberShared","useStytchMemberSessionShared","useStytchOrganizationShared","useStytchIsAuthorizedShared","withStytchMemberShared","withStytchMemberSessionShared","withStytchOrganizationShared","StytchB2BProviderShared"],"mappings":"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"}