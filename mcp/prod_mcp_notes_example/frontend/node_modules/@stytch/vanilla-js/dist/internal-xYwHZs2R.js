function _typeof2(o) { "@babel/helpers - typeof"; return _typeof2 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof2(o); }
function _defineProperty(e, r, t) { return (r = _toPropertyKey2(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey2(t) { var i = _toPrimitive2(t, "string"); return "symbol" == _typeof2(i) ? i : i + ""; }
function _toPrimitive2(t, r) { if ("object" != _typeof2(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof2(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function _slicedToArray2(r, e) { return _arrayWithHoles2(r) || _iterableToArrayLimit2(r, e) || _unsupportedIterableToArray2(r, e) || _nonIterableRest2(); }
function _nonIterableRest2() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray2(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray2(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray2(r, a) : void 0; } }
function _arrayLikeToArray2(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _iterableToArrayLimit2(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles2(r) { if (Array.isArray(r)) return r; }
function __rest$1(s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}
function __awaiter$1(thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, [])).next());
  });
}
typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
  var e = new Error(message);
  return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};
function _typeof$1(o) {
  "@babel/helpers - typeof";

  return _typeof$1 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
    return typeof o;
  } : function (o) {
    return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
  }, _typeof$1(o);
}
function _defineProperties$1(e, r) {
  for (var t = 0; t < r.length; t++) {
    var o = r[t];
    o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey$1(o.key), o);
  }
}
function _createClass$1(e, r, t) {
  return r && _defineProperties$1(e.prototype, r), t && _defineProperties$1(e, t), Object.defineProperty(e, "prototype", {
    writable: !1
  }), e;
}
function _toPropertyKey$1(t) {
  var i = _toPrimitive$1(t, "string");
  return "symbol" == _typeof$1(i) ? i : i + "";
}
function _toPrimitive$1(t, r) {
  if ("object" != _typeof$1(t) || !t) return t;
  var e = t[Symbol.toPrimitive];
  if (void 0 !== e) {
    var i = e.call(t, r);
    if ("object" != _typeof$1(i)) return i;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return String(t);
}
function _classCallCheck$1(a, n) {
  if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function");
}
function _callSuper$1(t, o, e) {
  return o = _getPrototypeOf$1(o), _possibleConstructorReturn$1(t, _isNativeReflectConstruct$1() ? Reflect.construct(o, e || [], _getPrototypeOf$1(t).constructor) : o.apply(t, e));
}
function _possibleConstructorReturn$1(t, e) {
  if (e && ("object" == _typeof$1(e) || "function" == typeof e)) return e;
  if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined");
  return _assertThisInitialized$1(t);
}
function _assertThisInitialized$1(e) {
  if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  return e;
}
function _inherits$1(t, e) {
  if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function");
  t.prototype = Object.create(e && e.prototype, {
    constructor: {
      value: t,
      writable: !0,
      configurable: !0
    }
  }), Object.defineProperty(t, "prototype", {
    writable: !1
  }), e && _setPrototypeOf$1(t, e);
}
function _wrapNativeSuper$1(t) {
  var r = "function" == typeof Map ? new Map() : void 0;
  return _wrapNativeSuper$1 = function _wrapNativeSuper(t) {
    if (null === t || !_isNativeFunction$1(t)) return t;
    if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function");
    if (void 0 !== r) {
      if (r.has(t)) return r.get(t);
      r.set(t, Wrapper);
    }
    function Wrapper() {
      return _construct$1(t, arguments, _getPrototypeOf$1(this).constructor);
    }
    return Wrapper.prototype = Object.create(t.prototype, {
      constructor: {
        value: Wrapper,
        enumerable: !1,
        writable: !0,
        configurable: !0
      }
    }), _setPrototypeOf$1(Wrapper, t);
  }, _wrapNativeSuper$1(t);
}
function _construct$1(t, e, r) {
  if (_isNativeReflectConstruct$1()) return Reflect.construct.apply(null, arguments);
  var o = [null];
  o.push.apply(o, e);
  var p = new (t.bind.apply(t, o))();
  return r && _setPrototypeOf$1(p, r.prototype), p;
}
function _isNativeReflectConstruct$1() {
  try {
    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
  } catch (t) {}
  return (_isNativeReflectConstruct$1 = function _isNativeReflectConstruct() {
    return !!t;
  })();
}
function _isNativeFunction$1(t) {
  try {
    return -1 !== Function.toString.call(t).indexOf("[native code]");
  } catch (n) {
    return "function" == typeof t;
  }
}
function _setPrototypeOf$1(t, e) {
  return _setPrototypeOf$1 = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {
    return t.__proto__ = e, t;
  }, _setPrototypeOf$1(t, e);
}
function _getPrototypeOf$1(t) {
  return _getPrototypeOf$1 = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {
    return t.__proto__ || Object.getPrototypeOf(t);
  }, _getPrototypeOf$1(t);
}
var Products;
(function (Products) {
  Products["emailMagicLinks"] = "emailMagicLinks";
  Products["oauth"] = "oauth";
  Products["otp"] = "otp";
  Products["crypto"] = "crypto";
  Products["passwords"] = "passwords";
  Products["passkeys"] = "passkeys";
})(Products || (Products = {}));
var OAuthProviders;
(function (OAuthProviders) {
  OAuthProviders["Google"] = "google";
  OAuthProviders["Microsoft"] = "microsoft";
  OAuthProviders["Apple"] = "apple";
  OAuthProviders["Github"] = "github";
  OAuthProviders["GitLab"] = "gitlab";
  OAuthProviders["Facebook"] = "facebook";
  OAuthProviders["Discord"] = "discord";
  OAuthProviders["Salesforce"] = "salesforce";
  OAuthProviders["Slack"] = "slack";
  OAuthProviders["Amazon"] = "amazon";
  OAuthProviders["Bitbucket"] = "bitbucket";
  OAuthProviders["LinkedIn"] = "linkedin";
  OAuthProviders["Coinbase"] = "coinbase";
  OAuthProviders["Twitch"] = "twitch";
  OAuthProviders["Twitter"] = "twitter";
  OAuthProviders["TikTok"] = "tiktok";
  OAuthProviders["Snapchat"] = "snapchat";
  OAuthProviders["Figma"] = "figma";
  OAuthProviders["Yahoo"] = "yahoo";
})(OAuthProviders || (OAuthProviders = {}));
var Wallets;
(function (Wallets) {
  Wallets["Vessel"] = "Vessel";
  Wallets["Phantom"] = "Phantom";
  Wallets["Metamask"] = "Metamask";
  Wallets["Coinbase"] = "Coinbase";
  Wallets["Binance"] = "Binance";
  Wallets["GenericEthereumWallet"] = "Other Ethereum Wallet";
  Wallets["GenericSolanaWallet"] = "Other Solana Wallet";
})(Wallets || (Wallets = {}));
var OneTapPositions;
(function (OneTapPositions) {
  OneTapPositions["embedded"] = "embedded";
  OneTapPositions["floating"] = "floating";
  OneTapPositions["embeddedOnly"] = "embeddedOnly";
  OneTapPositions["floatingOrEmbedded"] = "floatingOrEmbedded";
  OneTapPositions["forceLegacyEmbedded"] = "forceLegacyEmbedded";
})(OneTapPositions || (OneTapPositions = {}));
var OTPMethods;
(function (OTPMethods) {
  OTPMethods["SMS"] = "sms";
  OTPMethods["WhatsApp"] = "whatsapp";
  OTPMethods["Email"] = "email";
})(OTPMethods || (OTPMethods = {}));
var StytchEventType;
(function (StytchEventType) {
  StytchEventType["MagicLinkLoginOrCreateEvent"] = "MAGIC_LINK_LOGIN_OR_CREATE";
  StytchEventType["OTPsLoginOrCreateEvent"] = "OTP_LOGIN_OR_CREATE";
  StytchEventType["OTPsAuthenticate"] = "OTP_AUTHENTICATE";
  StytchEventType["CryptoWalletAuthenticateStart"] = "CRYPTO_WALLET_AUTHENTICATE_START";
  StytchEventType["CryptoWalletAuthenticate"] = "CRYPTO_WALLET_AUTHENTICATE";
  StytchEventType["PasswordCreate"] = "PASSWORD_CREATE";
  StytchEventType["PasswordAuthenticate"] = "PASSWORD_AUTHENTICATE";
  StytchEventType["PasswordResetByEmailStart"] = "PASSWORD_RESET_BY_EMAIL_START";
  StytchEventType["PasswordResetByEmail"] = "PASSWORD_RESET_BY_EMAIL";
  StytchEventType["PasskeyRegister"] = "PASSKEY_REGISTER";
  StytchEventType["PasskeyAuthenticate"] = "PASSKEY_AUTHENTICATE";
  StytchEventType["PasskeySkip"] = "PASSKEY_SKIP";
  StytchEventType["PasskeyDone"] = "PASSKEY_DONE";
  StytchEventType["AuthenticateFlowComplete"] = "AUTHENTICATE_FLOW_COMPLETE";
  StytchEventType["OAuthAuthorizeFlowStart"] = "OAUTH_AUTHORIZE_FLOW_START";
  StytchEventType["OAuthAuthorizeFlowComplete"] = "OAUTH_AUTHORIZE_FLOW_COMPLETE";
  StytchEventType["OAuthAuthorizeFlowConsentDenied"] = "OAUTH_AUTHORIZE_FLOW_CONSENT_DENIED";
  StytchEventType["B2BMagicLinkEmailLoginOrSignup"] = "B2B_MAGIC_LINK_EMAIL_LOGIN_OR_SIGNUP";
  StytchEventType["B2BMagicLinkAuthenticate"] = "B2B_MAGIC_LINK_AUTHENTICATE";
  StytchEventType["B2BMagicLinkEmailDiscoverySend"] = "B2B_MAGIC_LINK_EMAIL_DISCOVERY_SEND";
  StytchEventType["B2BMagicLinkDiscoveryAuthenticate"] = "B2B_MAGIC_LINK_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BSSOStart"] = "B2B_SSO_START";
  StytchEventType["B2BSSOAuthenticate"] = "B2B_SSO_AUTHENTICATE";
  StytchEventType["B2BSSODiscoverConnections"] = "B2B_SSO_DISCOVER_CONNECTIONS";
  StytchEventType["B2BOAuthAuthenticate"] = "B2B_OAUTH_AUTHENTICATE";
  StytchEventType["B2BOAuthDiscoveryAuthenticate"] = "B2B_OAUTH_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BDiscoveryOrganizationsCreate"] = "B2B_DISCOVERY_ORGANIZATIONS_CREATE";
  StytchEventType["B2BDiscoveryIntermediateSessionExchange"] = "B2B_DISCOVERY_INTERMEDIATE_SESSION_EXCHANGE";
  StytchEventType["B2BPasswordAuthenticate"] = "B2B_PASSWORD_AUTHENTICATE";
  StytchEventType["B2BPasswordDiscoveryAuthenticate"] = "B2B_PASSWORD_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BPasswordResetByEmailStart"] = "B2B_PASSWORD_RESET_BY_EMAIL_START";
  StytchEventType["B2BPasswordResetByEmail"] = "B2B_PASSWORD_RESET_BY_EMAIL";
  StytchEventType["B2BPasswordResetBySession"] = "B2B_PASSWORD_RESET_BY_SESSION";
  StytchEventType["B2BSMSOTPSend"] = "B2B_SMS_OTP_SEND";
  StytchEventType["B2BSMSOTPAuthenticate"] = "B2B_SMS_OTP_AUTHENTICATE";
  StytchEventType["B2BTOTPCreate"] = "B2B_TOTP_CREATE";
  StytchEventType["B2BTOTPAuthenticate"] = "B2B_TOTP_AUTHENTICATE";
  StytchEventType["B2BRecoveryCodesRecover"] = "B2B_RECOVERY_CODES_RECOVER";
  StytchEventType["B2BPasswordDiscoveryResetStart"] = "B2B_PASSWORD_DISCOVERY_RESET_BY_EMAIL_START";
  StytchEventType["B2BDiscoveryPasswordReset"] = "B2B_PASSWORD_DISCOVERY_RESET_BY_EMAIL";
  StytchEventType["B2BImpersonationAuthenticate"] = "B2B_IMPERSONATION_AUTHENTICATE";
  StytchEventType["B2BOTPsEmailAuthenticate"] = "B2B_OTPS_EMAIL_AUTHENTICATE";
  StytchEventType["B2BOTPsEmailDiscoveryAuthenticate"] = "B2B_OTPS_EMAIL_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BOTPsEmailDiscoverySend"] = "B2B_OTPS_EMAIL_DISCOVERY_SEND";
  StytchEventType["B2BOTPsEmailLoginOrSignup"] = "B2B_OTPS_EMAIL_LOGIN_OR_SIGNUP";
  StytchEventType["B2BOrganizationsGetBySlug"] = "B2B_ORGANIZATIONS_GET_BY_SLUG";
})(StytchEventType || (StytchEventType = {}));
var RNUIProducts;
(function (RNUIProducts) {
  RNUIProducts[RNUIProducts["emailMagicLinks"] = 0] = "emailMagicLinks";
  RNUIProducts[RNUIProducts["oauth"] = 1] = "oauth";
  RNUIProducts[RNUIProducts["otp"] = 2] = "otp";
  RNUIProducts[RNUIProducts["passwords"] = 3] = "passwords";
})(RNUIProducts || (RNUIProducts = {}));
var SDKAPIUnreachableError = /*#__PURE__*/function (_Error) {
  function SDKAPIUnreachableError(message, details) {
    var _this;
    _classCallCheck$1(this, SDKAPIUnreachableError);
    _this = _callSuper$1(this, SDKAPIUnreachableError, [message + '\n' + details]);
    _this.message = message + '\n' + details;
    _this.name = 'SDKAPIUnreachableError';
    _this.details = details;
    Object.setPrototypeOf(_this, SDKAPIUnreachableError.prototype);
    return _this;
  }
  _inherits$1(SDKAPIUnreachableError, _Error);
  return _createClass$1(SDKAPIUnreachableError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchSDKUsageError = /*#__PURE__*/function (_Error2) {
  function StytchSDKUsageError(methodName, message) {
    var _this2;
    _classCallCheck$1(this, StytchSDKUsageError);
    _this2 = _callSuper$1(this, StytchSDKUsageError);
    _this2.name = 'StytchSDKUsageError';
    _this2.message = "Invalid call to ".concat(methodName, "\n") + message;
    return _this2;
  }
  _inherits$1(StytchSDKUsageError, _Error2);
  return _createClass$1(StytchSDKUsageError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchSDKSchemaError = /*#__PURE__*/function (_Error3) {
  function StytchSDKSchemaError(schemaError) {
    var _this3;
    _classCallCheck$1(this, StytchSDKSchemaError);
    var _a;
    _this3 = _callSuper$1(this, StytchSDKSchemaError);
    _this3.name = 'StytchSDKSchemaError';
    var messages = (_a = schemaError.body) === null || _a === void 0 ? void 0 : _a.map(function (err) {
      return "".concat(err.dataPath, ": ").concat(err.message);
    }).join('\n');
    _this3.message = "[400] Request does not match expected schema\n".concat(messages);
    return _this3;
  }
  _inherits$1(StytchSDKSchemaError, _Error3);
  return _createClass$1(StytchSDKSchemaError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchSDKAPIError = /*#__PURE__*/function (_Error4) {
  function StytchSDKAPIError(details) {
    var _this4;
    _classCallCheck$1(this, StytchSDKAPIError);
    _this4 = _callSuper$1(this, StytchSDKAPIError);
    _this4.name = 'StytchSDKAPIError';
    var status_code = details.status_code,
      error_type = details.error_type,
      error_message = details.error_message,
      error_url = details.error_url,
      request_id = details.request_id,
      error_details = details.error_details;
    _this4.error_type = error_type;
    _this4.error_message = error_message;
    _this4.error_url = error_url;
    _this4.request_id = request_id;
    _this4.status_code = status_code;
    _this4.error_details = error_details;
    _this4.message = "[".concat(status_code, "] ").concat(error_type, "\n") + "".concat(error_message, "\n") + "See ".concat(error_url, " for more information.\n") + (request_id ? "request_id: ".concat(request_id, "\n") : '') + (_this4.error_details ? "Details: \n" + JSON.stringify(_this4.error_details) + '\n' : '');
    return _this4;
  }
  _inherits$1(StytchSDKAPIError, _Error4);
  return _createClass$1(StytchSDKAPIError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var UNRECOVERABLE_ERROR_TYPES = ['unauthorized_credentials', 'user_unauthenticated', 'invalid_secret_authentication', 'session_not_found'];
var StytchError = /*#__PURE__*/function (_Error5) {
  function StytchError(name, message) {
    var _this5;
    _classCallCheck$1(this, StytchError);
    _this5 = _callSuper$1(this, StytchError, [message]);
    _this5.name = name;
    return _this5;
  }
  _inherits$1(StytchError, _Error5);
  return _createClass$1(StytchError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchAPIUnreachableError = /*#__PURE__*/function (_StytchError) {
  function StytchAPIUnreachableError(details) {
    var _this6;
    _classCallCheck$1(this, StytchAPIUnreachableError);
    _this6 = _callSuper$1(this, StytchAPIUnreachableError, ['StytchAPIUnreachableError', details]);
    Object.setPrototypeOf(_this6, StytchAPIUnreachableError.prototype);
    return _this6;
  }
  _inherits$1(StytchAPIUnreachableError, _StytchError);
  return _createClass$1(StytchAPIUnreachableError);
}(StytchError);
var StytchAPISchemaError = /*#__PURE__*/function (_StytchError2) {
  function StytchAPISchemaError(schemaError) {
    _classCallCheck$1(this, StytchAPISchemaError);
    var _a;
    var messages = (_a = schemaError.body) === null || _a === void 0 ? void 0 : _a.map(function (err) {
      return "".concat(err.dataPath, ": ").concat(err.message);
    }).join('\n');
    return _callSuper$1(this, StytchAPISchemaError, ['StytchAPISchemaError', "Request does not match expected schema\n".concat(messages)]);
  }
  _inherits$1(StytchAPISchemaError, _StytchError2);
  return _createClass$1(StytchAPISchemaError);
}(StytchError);
var StytchAPIError = /*#__PURE__*/function (_StytchError3) {
  function StytchAPIError(details) {
    var _this7;
    _classCallCheck$1(this, StytchAPIError);
    var status_code = details.status_code,
      error_type = details.error_type,
      error_message = details.error_message,
      error_url = details.error_url,
      request_id = details.request_id,
      error_details = details.error_details;
    _this7 = _callSuper$1(this, StytchAPIError, ['StytchAPIError', "[".concat(status_code, "] ").concat(error_type, "\n") + "".concat(error_message, "\n") + "See ".concat(error_url, " for more information.\n") + (request_id ? "request_id: ".concat(request_id, "\n") : '') + (error_details ? "Details: \n" + JSON.stringify(error_details) + '\n' : '')]);
    _this7.error_type = error_type;
    _this7.error_message = error_message;
    _this7.error_url = error_url;
    _this7.request_id = request_id;
    _this7.status_code = status_code;
    _this7.error_details = error_details;
    return _this7;
  }
  _inherits$1(StytchAPIError, _StytchError3);
  return _createClass$1(StytchAPIError, null, [{
    key: "from",
    value: function from(err) {
      if (err instanceof StytchAPIError) {
        return err;
      }
      if (err && _typeof$1(err) === 'object') {
        var maybe = err;
        if (typeof maybe.status_code === 'number' && typeof maybe.error_type === 'string' && typeof maybe.error_message === 'string' && typeof maybe.error_url === 'string') {
          return new StytchAPIError({
            status_code: maybe.status_code,
            error_type: maybe.error_type,
            error_message: maybe.error_message,
            error_url: maybe.error_url,
            request_id: typeof maybe.request_id === 'string' ? maybe.request_id : undefined,
            error_details: _typeof$1(maybe.error_details) === 'object' ? maybe.error_details : undefined
          });
        }
      }
      var message = err instanceof Error ? err.message : 'Unknown error: ' + String(err);
      return new StytchAPIError({
        status_code: 400,
        error_type: 'unknown_error',
        error_message: message,
        error_url: '',
        request_id: undefined,
        error_details: undefined
      });
    }
  }]);
}(StytchError);
var StytchSDKError = /*#__PURE__*/function (_StytchError4) {
  function StytchSDKError(name, description, options) {
    var _this8;
    _classCallCheck$1(this, StytchSDKError);
    _this8 = _callSuper$1(this, StytchSDKError, [name, description]);
    _this8.options = options;
    return _this8;
  }
  _inherits$1(StytchSDKError, _StytchError4);
  return _createClass$1(StytchSDKError);
}(StytchError);
var NoCurrentSessionError = /*#__PURE__*/function (_StytchSDKError) {
  function NoCurrentSessionError() {
    _classCallCheck$1(this, NoCurrentSessionError);
    return _callSuper$1(this, NoCurrentSessionError, ['NoCurrentSessionError', 'There is no session currently available. Make sure the user is authenticated with a valid session.']);
  }
  _inherits$1(NoCurrentSessionError, _StytchSDKError);
  return _createClass$1(NoCurrentSessionError);
}(StytchSDKError);
var InternalError = /*#__PURE__*/function (_StytchSDKError2) {
  function InternalError(error) {
    var _this9;
    _classCallCheck$1(this, InternalError);
    _this9 = _callSuper$1(this, InternalError, [error.name ? error.name : 'Internal Error', error.message ? error.message : 'An internal error has occurred. Please contact Stytch if this occurs.']);
    _this9.nativeStack = error.nativeStackAndroid || error.nativeStackIOS;
    return _this9;
  }
  _inherits$1(InternalError, _StytchSDKError2);
  return _createClass$1(InternalError);
}(StytchSDKError);
var NoBiometricsRegistrationError = /*#__PURE__*/function (_StytchSDKError3) {
  function NoBiometricsRegistrationError() {
    _classCallCheck$1(this, NoBiometricsRegistrationError);
    return _callSuper$1(this, NoBiometricsRegistrationError, ['NoBiometricsRegistrationError', 'There is no biometric registration available. Authenticate with another method and add a new biometric registration first.']);
  }
  _inherits$1(NoBiometricsRegistrationError, _StytchSDKError3);
  return _createClass$1(NoBiometricsRegistrationError);
}(StytchSDKError);
var BiometricsUnavailableError = /*#__PURE__*/function (_StytchSDKError4) {
  function BiometricsUnavailableError() {
    _classCallCheck$1(this, BiometricsUnavailableError);
    return _callSuper$1(this, BiometricsUnavailableError, ['BiometricsUnavailableError', 'Biometrics is not available on the device.']);
  }
  _inherits$1(BiometricsUnavailableError, _StytchSDKError4);
  return _createClass$1(BiometricsUnavailableError);
}(StytchSDKError);
var KeyInvalidatedError = /*#__PURE__*/function (_StytchSDKError5) {
  function KeyInvalidatedError() {
    _classCallCheck$1(this, KeyInvalidatedError);
    return _callSuper$1(this, KeyInvalidatedError, ['KeyInvalidatedError', 'The biometrics enrollment on the device has changed.']);
  }
  _inherits$1(KeyInvalidatedError, _StytchSDKError5);
  return _createClass$1(KeyInvalidatedError);
}(StytchSDKError);
var KeystoreUnavailableError = /*#__PURE__*/function (_StytchSDKError6) {
  function KeystoreUnavailableError() {
    _classCallCheck$1(this, KeystoreUnavailableError);
    return _callSuper$1(this, KeystoreUnavailableError, ['KeystoreUnavailableError', 'The Android keystore is unavailable on the device. Consider setting allowFallbackToCleartext to true.']);
  }
  _inherits$1(KeystoreUnavailableError, _StytchSDKError6);
  return _createClass$1(KeystoreUnavailableError);
}(StytchSDKError);
var NoBiometricsEnrolledError = /*#__PURE__*/function (_StytchSDKError7) {
  function NoBiometricsEnrolledError() {
    _classCallCheck$1(this, NoBiometricsEnrolledError);
    return _callSuper$1(this, NoBiometricsEnrolledError, ['NoBiometricsEnrolledError', 'There is no biometric factor enrolled on the device. Add a biometric factor in the device settings.']);
  }
  _inherits$1(NoBiometricsEnrolledError, _StytchSDKError7);
  return _createClass$1(NoBiometricsEnrolledError);
}(StytchSDKError);
var BiometricsAlreadyEnrolledError = /*#__PURE__*/function (_StytchSDKError8) {
  function BiometricsAlreadyEnrolledError() {
    _classCallCheck$1(this, BiometricsAlreadyEnrolledError);
    return _callSuper$1(this, BiometricsAlreadyEnrolledError, ['BiometricsAlreadyEnrolledError', 'There is already a biometric factor enrolled on this device. Fully authenticate with all factors and remove the existing registration before attempting to register again.']);
  }
  _inherits$1(BiometricsAlreadyEnrolledError, _StytchSDKError8);
  return _createClass$1(BiometricsAlreadyEnrolledError);
}(StytchSDKError);
var UserCancellationError = /*#__PURE__*/function (_StytchSDKError9) {
  function UserCancellationError() {
    _classCallCheck$1(this, UserCancellationError);
    return _callSuper$1(this, UserCancellationError, ['UserCancellationError', 'The user canceled the prompt. Ask the user to try again.']);
  }
  _inherits$1(UserCancellationError, _StytchSDKError9);
  return _createClass$1(UserCancellationError);
}(StytchSDKError);
var UserLockedOutError = /*#__PURE__*/function (_StytchSDKError0) {
  function UserLockedOutError() {
    _classCallCheck$1(this, UserLockedOutError);
    return _callSuper$1(this, UserLockedOutError, ['UserLockedOutError', 'The user has been locked out due to too many failed attempts. Ask the user to try again later.']);
  }
  _inherits$1(UserLockedOutError, _StytchSDKError0);
  return _createClass$1(UserLockedOutError);
}(StytchSDKError);
var DeviceCredentialsNotAllowedError = /*#__PURE__*/function (_StytchSDKError1) {
  function DeviceCredentialsNotAllowedError() {
    _classCallCheck$1(this, DeviceCredentialsNotAllowedError);
    return _callSuper$1(this, DeviceCredentialsNotAllowedError, ['DeviceCredentialsNotAllowedError', 'The device credentials allowment is mismatched. Change the allowDeviceCredentials parameter to be the same in both the register and authenticate methods.']);
  }
  _inherits$1(DeviceCredentialsNotAllowedError, _StytchSDKError1);
  return _createClass$1(DeviceCredentialsNotAllowedError);
}(StytchSDKError);
var MissingGoogleClientIDError = /*#__PURE__*/function (_StytchSDKError10) {
  function MissingGoogleClientIDError() {
    _classCallCheck$1(this, MissingGoogleClientIDError);
    return _callSuper$1(this, MissingGoogleClientIDError, ['MissingGoogleClientIDError', 'No Google client ID was found in the project.']);
  }
  _inherits$1(MissingGoogleClientIDError, _StytchSDKError10);
  return _createClass$1(MissingGoogleClientIDError);
}(StytchSDKError);
var MissingPKCEError = /*#__PURE__*/function (_StytchSDKError11) {
  function MissingPKCEError() {
    _classCallCheck$1(this, MissingPKCEError);
    return _callSuper$1(this, MissingPKCEError, ['MissingPKCEError', 'Make sure this flow is completed on the same device on which it was started.']);
  }
  _inherits$1(MissingPKCEError, _StytchSDKError11);
  return _createClass$1(MissingPKCEError);
}(StytchSDKError);
var MissingAuthorizationCredentialIDTokenError = /*#__PURE__*/function (_StytchSDKError12) {
  function MissingAuthorizationCredentialIDTokenError() {
    _classCallCheck$1(this, MissingAuthorizationCredentialIDTokenError);
    return _callSuper$1(this, MissingAuthorizationCredentialIDTokenError, ['MissingAuthorizationCredentialIDTokenError', 'The authorization credential is missing an ID token.']);
  }
  _inherits$1(MissingAuthorizationCredentialIDTokenError, _StytchSDKError12);
  return _createClass$1(MissingAuthorizationCredentialIDTokenError);
}(StytchSDKError);
var InvalidAuthorizationCredentialError = /*#__PURE__*/function (_StytchSDKError13) {
  function InvalidAuthorizationCredentialError() {
    _classCallCheck$1(this, InvalidAuthorizationCredentialError);
    return _callSuper$1(this, InvalidAuthorizationCredentialError, ['InvalidAuthorizationCredentialError', 'The authorization credential is invalid. Verify that OAuth is set up correctly in the developer console, and call the start flow method.']);
  }
  _inherits$1(InvalidAuthorizationCredentialError, _StytchSDKError13);
  return _createClass$1(InvalidAuthorizationCredentialError);
}(StytchSDKError);
var NoCredentialsPresentError = /*#__PURE__*/function (_StytchSDKError14) {
  function NoCredentialsPresentError() {
    _classCallCheck$1(this, NoCredentialsPresentError);
    return _callSuper$1(this, NoCredentialsPresentError, ['NoCredentialsPresentError', 'The user did not provide credentials for a Google OneTap attempt']);
  }
  _inherits$1(NoCredentialsPresentError, _StytchSDKError14);
  return _createClass$1(NoCredentialsPresentError);
}(StytchSDKError);
var MissingPublicKeyError = /*#__PURE__*/function (_StytchSDKError15) {
  function MissingPublicKeyError() {
    _classCallCheck$1(this, MissingPublicKeyError);
    return _callSuper$1(this, MissingPublicKeyError, ['MissingPublicKeyError', 'Failed to retrieve the public key. Add a new biometric registration.']);
  }
  _inherits$1(MissingPublicKeyError, _StytchSDKError15);
  return _createClass$1(MissingPublicKeyError);
}(StytchSDKError);
var ChallengeSigningFailedError = /*#__PURE__*/function (_StytchSDKError16) {
  function ChallengeSigningFailedError() {
    _classCallCheck$1(this, ChallengeSigningFailedError);
    return _callSuper$1(this, ChallengeSigningFailedError, ['ChallengeSigningFailedError', 'Failed to sign the challenge with the key.']);
  }
  _inherits$1(ChallengeSigningFailedError, _StytchSDKError16);
  return _createClass$1(ChallengeSigningFailedError);
}(StytchSDKError);
var SDKNotConfiguredError = /*#__PURE__*/function (_StytchSDKError17) {
  function SDKNotConfiguredError() {
    _classCallCheck$1(this, SDKNotConfiguredError);
    return _callSuper$1(this, SDKNotConfiguredError, ['SDKNotConfiguredError', 'Stytch client is not confiured. You must call the configure method before using the SDK']);
  }
  _inherits$1(SDKNotConfiguredError, _StytchSDKError17);
  return _createClass$1(SDKNotConfiguredError);
}(StytchSDKError);
var FailedCodeChallengeError = /*#__PURE__*/function (_StytchSDKError18) {
  function FailedCodeChallengeError() {
    _classCallCheck$1(this, FailedCodeChallengeError);
    return _callSuper$1(this, FailedCodeChallengeError, ['FailedCodeChallengeError', 'Failed to create a code challenge']);
  }
  _inherits$1(FailedCodeChallengeError, _StytchSDKError18);
  return _createClass$1(FailedCodeChallengeError);
}(StytchSDKError);
var PasskeysUnsupportedError = /*#__PURE__*/function (_StytchSDKError19) {
  function PasskeysUnsupportedError() {
    _classCallCheck$1(this, PasskeysUnsupportedError);
    return _callSuper$1(this, PasskeysUnsupportedError, ['PasskeysUnsupportedError', 'Passkeys are not supported on this device']);
  }
  _inherits$1(PasskeysUnsupportedError, _StytchSDKError19);
  return _createClass$1(PasskeysUnsupportedError);
}(StytchSDKError);
var FailedToDecryptDataError = /*#__PURE__*/function (_StytchSDKError20) {
  function FailedToDecryptDataError() {
    _classCallCheck$1(this, FailedToDecryptDataError);
    return _callSuper$1(this, FailedToDecryptDataError, ['FailedToDecryptDataError', 'Failed to decrypt user data']);
  }
  _inherits$1(FailedToDecryptDataError, _StytchSDKError20);
  return _createClass$1(FailedToDecryptDataError);
}(StytchSDKError);
var BiometricsFailedError = /*#__PURE__*/function (_StytchSDKError21) {
  function BiometricsFailedError() {
    _classCallCheck$1(this, BiometricsFailedError);
    return _callSuper$1(this, BiometricsFailedError, ['BiometricsFailedError', 'Biometric authentication failed']);
  }
  _inherits$1(BiometricsFailedError, _StytchSDKError21);
  return _createClass$1(BiometricsFailedError);
}(StytchSDKError);
var InvalidStartUrlError = /*#__PURE__*/function (_StytchSDKError22) {
  function InvalidStartUrlError() {
    _classCallCheck$1(this, InvalidStartUrlError);
    return _callSuper$1(this, InvalidStartUrlError, ['InvalidStartUrlError', 'The start URL was invalid or improperly formatted.']);
  }
  _inherits$1(InvalidStartUrlError, _StytchSDKError22);
  return _createClass$1(InvalidStartUrlError);
}(StytchSDKError);
var InvalidRedirectSchemeError = /*#__PURE__*/function (_StytchSDKError23) {
  function InvalidRedirectSchemeError() {
    _classCallCheck$1(this, InvalidRedirectSchemeError);
    return _callSuper$1(this, InvalidRedirectSchemeError, ['InvalidRedirectSchemeError', 'The scheme from the given redirect urls was invalid. Possible reasons include: nil scheme, non-custom scheme (using http or https), or differing schemes for login/signup urls.']);
  }
  _inherits$1(InvalidRedirectSchemeError, _StytchSDKError23);
  return _createClass$1(InvalidRedirectSchemeError);
}(StytchSDKError);
var MissingUrlError = /*#__PURE__*/function (_StytchSDKError24) {
  function MissingUrlError() {
    _classCallCheck$1(this, MissingUrlError);
    return _callSuper$1(this, MissingUrlError, ['MissingUrlError', 'The underlying web authentication service failed to return a URL.']);
  }
  _inherits$1(MissingUrlError, _StytchSDKError24);
  return _createClass$1(MissingUrlError);
}(StytchSDKError);
var InvalidCredentialTypeError = /*#__PURE__*/function (_StytchSDKError25) {
  function InvalidCredentialTypeError() {
    _classCallCheck$1(this, InvalidCredentialTypeError);
    return _callSuper$1(this, InvalidCredentialTypeError, ['InvalidCredentialTypeError', 'The public key credential type was not of the expected type.']);
  }
  _inherits$1(InvalidCredentialTypeError, _StytchSDKError25);
  return _createClass$1(InvalidCredentialTypeError);
}(StytchSDKError);
var MissingAttestationObjectError = /*#__PURE__*/function (_StytchSDKError26) {
  function MissingAttestationObjectError() {
    _classCallCheck$1(this, MissingAttestationObjectError);
    return _callSuper$1(this, MissingAttestationObjectError, ['MissingAttestationObjectError', 'The public key credential is missing the attestation object.']);
  }
  _inherits$1(MissingAttestationObjectError, _StytchSDKError26);
  return _createClass$1(MissingAttestationObjectError);
}(StytchSDKError);
var JSONDataNotConvertibleToStringError = /*#__PURE__*/function (_StytchSDKError27) {
  function JSONDataNotConvertibleToStringError() {
    _classCallCheck$1(this, JSONDataNotConvertibleToStringError);
    return _callSuper$1(this, JSONDataNotConvertibleToStringError, ['JSONDataNotConvertibleToStringError', 'JSON data unable to be converted to String type.']);
  }
  _inherits$1(JSONDataNotConvertibleToStringError, _StytchSDKError27);
  return _createClass$1(JSONDataNotConvertibleToStringError);
}(StytchSDKError);
var RandomNumberGenerationFailed = /*#__PURE__*/function (_StytchSDKError28) {
  function RandomNumberGenerationFailed() {
    _classCallCheck$1(this, RandomNumberGenerationFailed);
    return _callSuper$1(this, RandomNumberGenerationFailed, ['RandomNumberGenerationFailed', 'Random number generation failed']);
  }
  _inherits$1(RandomNumberGenerationFailed, _StytchSDKError28);
  return _createClass$1(RandomNumberGenerationFailed);
}(StytchSDKError);
var PasskeysInvalidEncoding = /*#__PURE__*/function (_StytchSDKError29) {
  function PasskeysInvalidEncoding() {
    _classCallCheck$1(this, PasskeysInvalidEncoding);
    return _callSuper$1(this, PasskeysInvalidEncoding, ['PasskeysInvalidEncoding', 'Invalid passkey encoding']);
  }
  _inherits$1(PasskeysInvalidEncoding, _StytchSDKError29);
  return _createClass$1(PasskeysInvalidEncoding);
}(StytchSDKError);
var PasskeysMisconfigured = /*#__PURE__*/function (_StytchSDKError30) {
  function PasskeysMisconfigured() {
    _classCallCheck$1(this, PasskeysMisconfigured);
    return _callSuper$1(this, PasskeysMisconfigured, ['PasskeysMisconfigured', 'Passkeys are misconfigured. Verify that you have added the correct associated domain for your application, and that the signing information is correct.']);
  }
  _inherits$1(PasskeysMisconfigured, _StytchSDKError30);
  return _createClass$1(PasskeysMisconfigured);
}(StytchSDKError);
var SignInWithAppleMisconfigured = /*#__PURE__*/function (_StytchSDKError31) {
  function SignInWithAppleMisconfigured() {
    _classCallCheck$1(this, SignInWithAppleMisconfigured);
    return _callSuper$1(this, SignInWithAppleMisconfigured, ['SignInWithAppleMisconfigured', 'Sign In With Apple is misconfigured. Verify that you have correctly configured Apple OAuth in the Stytch Dashboard and added the Sign In With Apple capability to your project.']);
  }
  _inherits$1(SignInWithAppleMisconfigured, _StytchSDKError31);
  return _createClass$1(SignInWithAppleMisconfigured);
}(StytchSDKError);
var MissingCipherIv = /*#__PURE__*/function (_StytchSDKError32) {
  function MissingCipherIv() {
    _classCallCheck$1(this, MissingCipherIv);
    return _callSuper$1(this, MissingCipherIv, ['MissingCipherIv', 'The expected cipher Iv was not found when attempting to decrypt an existing biometric key.']);
  }
  _inherits$1(MissingCipherIv, _StytchSDKError32);
  return _createClass$1(MissingCipherIv);
}(StytchSDKError);
var InvalidPrivateKeyLength = /*#__PURE__*/function (_StytchSDKError33) {
  function InvalidPrivateKeyLength() {
    _classCallCheck$1(this, InvalidPrivateKeyLength);
    return _callSuper$1(this, InvalidPrivateKeyLength, ['InvalidPrivateKeyLength', "The private key was of an incorrect length."]);
  }
  _inherits$1(InvalidPrivateKeyLength, _StytchSDKError33);
  return _createClass$1(InvalidPrivateKeyLength);
}(StytchSDKError);
var BiometricRegistrationIdIsNullOrBlank = /*#__PURE__*/function (_StytchSDKError34) {
  function BiometricRegistrationIdIsNullOrBlank() {
    _classCallCheck$1(this, BiometricRegistrationIdIsNullOrBlank);
    return _callSuper$1(this, BiometricRegistrationIdIsNullOrBlank, ['BiometricRegistrationIdIsNullOrBlank', 'Attempted to set a blank or null biometric registration ID. This is not allowed, and indicates no registration was created on the server. Consider deleting any local keys that may have been generated.']);
  }
  _inherits$1(BiometricRegistrationIdIsNullOrBlank, _StytchSDKError34);
  return _createClass$1(BiometricRegistrationIdIsNullOrBlank);
}(StytchSDKError);
var DFPNotConfigured = /*#__PURE__*/function (_StytchSDKError35) {
  function DFPNotConfigured() {
    _classCallCheck$1(this, DFPNotConfigured);
    return _callSuper$1(this, DFPNotConfigured, ['DFPNotConfigured', 'You have attempted to retrieve a telemetry ID before the DFP client has been configured.']);
  }
  _inherits$1(DFPNotConfigured, _StytchSDKError35);
  return _createClass$1(DFPNotConfigured);
}(StytchSDKError);
var IDPOAuthFlowMissingParamError = /*#__PURE__*/function (_StytchSDKError36) {
  function IDPOAuthFlowMissingParamError(details) {
    _classCallCheck$1(this, IDPOAuthFlowMissingParamError);
    return _callSuper$1(this, IDPOAuthFlowMissingParamError, ['IDPOAuthFlowMissingParamError', details]);
  }
  _inherits$1(IDPOAuthFlowMissingParamError, _StytchSDKError36);
  return _createClass$1(IDPOAuthFlowMissingParamError);
}(StytchSDKError);
function errorToStytchError(error) {
  switch (error.message) {
    case 'no_current_session':
      return new NoCurrentSessionError();
    case 'no_biometrics_registration':
      return new NoBiometricsRegistrationError();
    case 'biometrics_unavailable':
      return new BiometricsUnavailableError();
    case 'key_invalidated':
      return new KeyInvalidatedError();
    case 'device_hardware_error':
      return new BiometricsUnavailableError();
    case 'biometrics_not_available':
      return new BiometricsUnavailableError();
    case 'no_biometrics_enrolled':
      return new NoBiometricsEnrolledError();
    case 'keystore_unavailable':
      return new KeystoreUnavailableError();
    case 'no_biometric_key':
      return new KeyInvalidatedError();
    case 'device_credentials_not_allowed':
      return new DeviceCredentialsNotAllowedError();
    case 'user_cancellation':
      return new UserCancellationError();
    case 'user_locked_out':
      return new UserLockedOutError();
    case 'google_onetap_missing_id_token':
      return new MissingAuthorizationCredentialIDTokenError();
    case 'google_onetap_missing_member':
      return new InvalidAuthorizationCredentialError();
    case 'oauth_apple_missing_id_token':
      return new MissingAuthorizationCredentialIDTokenError();
    case 'oauth_apple_credential_invalid':
      return new InvalidAuthorizationCredentialError();
    case 'missing_public_key':
      return new MissingPublicKeyError();
    case 'challenge_signing_failed':
      return new ChallengeSigningFailedError();
    case 'missing_authorization_credential_id_token':
      return new MissingAuthorizationCredentialIDTokenError();
    case 'invalid_authorization_credential':
      return new InvalidAuthorizationCredentialError();
    case 'no_credentials_present':
      return new NoCredentialsPresentError();
    case 'sdk_not_configured':
      return new SDKNotConfiguredError();
    case 'failed_code_challenge':
      return new FailedCodeChallengeError();
    case 'passkeys_unsupported':
      return new PasskeysUnsupportedError();
    case 'failed_to_decrypt_data':
      return new FailedToDecryptDataError();
    case 'biometrics_failed':
      return new BiometricsFailedError();
    case 'invalid_start_url':
      return new InvalidStartUrlError();
    case 'invalid_redirect_scheme':
      return new InvalidRedirectSchemeError();
    case 'missing_url':
      return new MissingUrlError();
    case 'invalid_credential_type':
      return new InvalidCredentialTypeError();
    case 'missing_attestation_object':
      return new MissingAttestationObjectError();
    case 'json_data_not_convertible_to_string':
      return new JSONDataNotConvertibleToStringError();
    case 'random_number_generation_failed':
      return new RandomNumberGenerationFailed();
    case 'passkeys_invalid_encoding':
      return new PasskeysInvalidEncoding();
    case 'passkeys_misconfigured':
      return new PasskeysMisconfigured();
    case 'signinwithapple_misconfigured':
      return new SignInWithAppleMisconfigured();
    case 'missing_cipher_iv':
      return new MissingCipherIv();
    case 'invalid_private_key_length':
      return new InvalidPrivateKeyLength();
    case 'biometric_registration_id_is_null_or_blank':
      return new BiometricRegistrationIdIsNullOrBlank();
    case 'dfp_not_configured':
      return new DFPNotConfigured();
    default:
      return new InternalError(error);
  }
}
var B2BProducts;
(function (B2BProducts) {
  B2BProducts["emailMagicLinks"] = "emailMagicLinks";
  B2BProducts["emailOtp"] = "emailOtp";
  B2BProducts["sso"] = "sso";
  B2BProducts["passwords"] = "passwords";
  B2BProducts["oauth"] = "oauth";
})(B2BProducts || (B2BProducts = {}));
var AuthFlowType;
(function (AuthFlowType) {
  AuthFlowType["Discovery"] = "Discovery";
  AuthFlowType["Organization"] = "Organization";
  AuthFlowType["PasswordReset"] = "PasswordReset";
})(AuthFlowType || (AuthFlowType = {}));
var RedirectURLType;
(function (RedirectURLType) {
  RedirectURLType["ResetPassword"] = "reset_password";
})(RedirectURLType || (RedirectURLType = {}));
var B2BMFAProducts;
(function (B2BMFAProducts) {
  B2BMFAProducts["smsOtp"] = "smsOtp";
  B2BMFAProducts["totp"] = "totp";
})(B2BMFAProducts || (B2BMFAProducts = {}));
var B2BOAuthProviders;
(function (B2BOAuthProviders) {
  B2BOAuthProviders["Google"] = "google";
  B2BOAuthProviders["Microsoft"] = "microsoft";
  B2BOAuthProviders["HubSpot"] = "hubspot";
  B2BOAuthProviders["Slack"] = "slack";
  B2BOAuthProviders["GitHub"] = "github";
})(B2BOAuthProviders || (B2BOAuthProviders = {}));
function _createForOfIteratorHelper(r, e) {
  var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"];
  if (!t) {
    if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e) {
      t && (r = t);
      var _n = 0,
        F = function F() {};
      return {
        s: F,
        n: function n() {
          return _n >= r.length ? {
            done: !0
          } : {
            done: !1,
            value: r[_n++]
          };
        },
        e: function e(r) {
          throw r;
        },
        f: F
      };
    }
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  var o,
    a = !0,
    u = !1;
  return {
    s: function s() {
      t = t.call(r);
    },
    n: function n() {
      var r = t.next();
      return a = r.done, r;
    },
    e: function e(r) {
      u = !0, o = r;
    },
    f: function f() {
      try {
        a || null == t["return"] || t["return"]();
      } finally {
        if (u) throw o;
      }
    }
  };
}
function _typeof(o) {
  "@babel/helpers - typeof";

  return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
    return typeof o;
  } : function (o) {
    return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
  }, _typeof(o);
}
function _toConsumableArray(r) {
  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();
}
function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _iterableToArray(r) {
  if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r);
}
function _arrayWithoutHoles(r) {
  if (Array.isArray(r)) return _arrayLikeToArray(r);
}
function _slicedToArray(r, e) {
  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();
}
function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _unsupportedIterableToArray(r, a) {
  if (r) {
    if ("string" == typeof r) return _arrayLikeToArray(r, a);
    var t = {}.toString.call(r).slice(8, -1);
    return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;
  }
}
function _arrayLikeToArray(r, a) {
  (null == a || a > r.length) && (a = r.length);
  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];
  return n;
}
function _iterableToArrayLimit(r, l) {
  var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"];
  if (null != t) {
    var e,
      n,
      i,
      u,
      a = [],
      f = !0,
      o = !1;
    try {
      if (i = (t = t.call(r)).next, 0 === l) {
        if (Object(t) !== t) return;
        f = !1;
      } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);
    } catch (r) {
      o = !0, n = r;
    } finally {
      try {
        if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return;
      } finally {
        if (o) throw n;
      }
    }
    return a;
  }
}
function _arrayWithHoles(r) {
  if (Array.isArray(r)) return r;
}
function _regenerator() {
  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,
    t,
    r = "function" == typeof Symbol ? Symbol : {},
    n = r.iterator || "@@iterator",
    o = r.toStringTag || "@@toStringTag";
  function i(r, n, o, i) {
    var c = n && n.prototype instanceof Generator ? n : Generator,
      u = Object.create(c.prototype);
    return _regeneratorDefine2(u, "_invoke", function (r, n, o) {
      var i,
        c,
        u,
        f = 0,
        p = o || [],
        y = !1,
        G = {
          p: 0,
          n: 0,
          v: e,
          a: d,
          f: d.bind(e, 4),
          d: function d(t, r) {
            return i = t, c = 0, u = e, G.n = r, a;
          }
        };
      function d(r, n) {
        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {
          var o,
            i = p[t],
            d = G.p,
            l = i[2];
          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));
        }
        if (o || r > 1) return a;
        throw y = !0, n;
      }
      return function (o, p, l) {
        if (f > 1) throw TypeError("Generator is already running");
        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {
          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);
          try {
            if (f = 2, i) {
              if (c || (o = "next"), t = i[o]) {
                if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object");
                if (!t.done) return t;
                u = t.value, c < 2 && (c = 0);
              } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1);
              i = e;
            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;
          } catch (t) {
            i = e, c = 1, u = t;
          } finally {
            f = 1;
          }
        }
        return {
          value: t,
          done: y
        };
      };
    }(r, o, i), !0), u;
  }
  var a = {};
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}
  t = Object.getPrototypeOf;
  var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () {
      return this;
    }), t),
    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);
  function f(e) {
    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e;
  }
  return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () {
    return this;
  }), _regeneratorDefine2(u, "toString", function () {
    return "[object Generator]";
  }), (_regenerator = function _regenerator() {
    return {
      w: i,
      m: f
    };
  })();
}
function _regeneratorDefine2(e, r, n, t) {
  var i = Object.defineProperty;
  try {
    i({}, "", {});
  } catch (e) {
    i = 0;
  }
  _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) {
    function o(r, n) {
      _regeneratorDefine2(e, r, function (e) {
        return this._invoke(r, n, e);
      });
    }
    r ? i ? i(e, r, {
      value: n,
      enumerable: !t,
      configurable: !t,
      writable: !t
    }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2));
  }, _regeneratorDefine2(e, r, n, t);
}
function _defineProperties(e, r) {
  for (var t = 0; t < r.length; t++) {
    var o = r[t];
    o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);
  }
}
function _createClass(e, r, t) {
  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", {
    writable: !1
  }), e;
}
function _toPropertyKey(t) {
  var i = _toPrimitive(t, "string");
  return "symbol" == _typeof(i) ? i : i + "";
}
function _toPrimitive(t, r) {
  if ("object" != _typeof(t) || !t) return t;
  var e = t[Symbol.toPrimitive];
  if (void 0 !== e) {
    var i = e.call(t, r);
    if ("object" != _typeof(i)) return i;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return String(t);
}
function _classCallCheck(a, n) {
  if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function");
}
function _callSuper(t, o, e) {
  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));
}
function _possibleConstructorReturn(t, e) {
  if (e && ("object" == _typeof(e) || "function" == typeof e)) return e;
  if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined");
  return _assertThisInitialized(t);
}
function _assertThisInitialized(e) {
  if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  return e;
}
function _inherits(t, e) {
  if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function");
  t.prototype = Object.create(e && e.prototype, {
    constructor: {
      value: t,
      writable: !0,
      configurable: !0
    }
  }), Object.defineProperty(t, "prototype", {
    writable: !1
  }), e && _setPrototypeOf(t, e);
}
function _wrapNativeSuper(t) {
  var r = "function" == typeof Map ? new Map() : void 0;
  return _wrapNativeSuper = function _wrapNativeSuper(t) {
    if (null === t || !_isNativeFunction(t)) return t;
    if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function");
    if (void 0 !== r) {
      if (r.has(t)) return r.get(t);
      r.set(t, Wrapper);
    }
    function Wrapper() {
      return _construct(t, arguments, _getPrototypeOf(this).constructor);
    }
    return Wrapper.prototype = Object.create(t.prototype, {
      constructor: {
        value: Wrapper,
        enumerable: !1,
        writable: !0,
        configurable: !0
      }
    }), _setPrototypeOf(Wrapper, t);
  }, _wrapNativeSuper(t);
}
function _construct(t, e, r) {
  if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments);
  var o = [null];
  o.push.apply(o, e);
  var p = new (t.bind.apply(t, o))();
  return r && _setPrototypeOf(p, r.prototype), p;
}
function _isNativeReflectConstruct() {
  try {
    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
  } catch (t) {}
  return (_isNativeReflectConstruct = function _isNativeReflectConstruct() {
    return !!t;
  })();
}
function _isNativeFunction(t) {
  try {
    return -1 !== Function.toString.call(t).indexOf("[native code]");
  } catch (n) {
    return "function" == typeof t;
  }
}
function _setPrototypeOf(t, e) {
  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {
    return t.__proto__ = e, t;
  }, _setPrototypeOf(t, e);
}
function _getPrototypeOf(t) {
  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {
    return t.__proto__ || Object.getPrototypeOf(t);
  }, _getPrototypeOf(t);
}
var TEST_API_URL = 'https://test.stytch.com';
var LIVE_API_URL = 'https://api.stytch.com';
var CLIENTSIDE_SERVICES_IFRAME_URL = 'https://js.stytch.com/clientside-services/index.html';
var STYTCH_DFP_BACKEND_URL = "https://telemetry.stytch.com";
var STYTCH_DFP_CDN_URL = "https://elements.stytch.com";
var GOOGLE_ONE_TAP_HOST = 'https://accounts.google.com/gsi';
var GOOGLE_ONE_TAP_SCRIPT_URL = "".concat(GOOGLE_ONE_TAP_HOST, "/client");
var DEFAULT_SESSION_DURATION_MINUTES = 30;
var MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING = "It looks like you're creating multiple copies of the Stytch client." + ' This behavior is unsupported, and unintended side effects may occur. ' + "Make sure you are creating the Stytch client at the global level, and not inside a component's render function.";
var RetriableErrorType;
(function (RetriableErrorType) {
  RetriableErrorType["RequiredCaptcha"] = "CAPTCHA required";
})(RetriableErrorType || (RetriableErrorType = {}));
var RetriableError = /*#__PURE__*/function (_Error) {
  function RetriableError(type) {
    var _this;
    _classCallCheck(this, RetriableError);
    _this = _callSuper(this, RetriableError, [type]);
    _this.type = type;
    return _this;
  }
  _inherits(RetriableError, _Error);
  return _createClass(RetriableError);
}(/*#__PURE__*/_wrapNativeSuper(Error));
function retriableFetchSDK(_ref) {
  var method = _ref.method,
    finalURL = _ref.finalURL,
    basicAuthHeader = _ref.basicAuthHeader,
    xSDKClientHeader = _ref.xSDKClientHeader,
    xSDKParentHostHeader = _ref.xSDKParentHostHeader,
    body = _ref.body,
    retryCallback = _ref.retryCallback;
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee() {
    var req, _t;
    return _regenerator().w(function (_context) {
      while (1) switch (_context.p = _context.n) {
        case 0:
          req = {
            method: method,
            finalURL: finalURL,
            basicAuthHeader: basicAuthHeader,
            xSDKClientHeader: xSDKClientHeader,
            xSDKParentHostHeader: xSDKParentHostHeader,
            body: body
          };
          _context.p = 1;
          _context.n = 2;
          return baseFetchSDK(req);
        case 2:
          return _context.a(2, _context.v);
        case 3:
          _context.p = 3;
          _t = _context.v;
          if (!(_t instanceof RetriableError)) {
            _context.n = 6;
            break;
          }
          _context.n = 4;
          return retryCallback(_t, req);
        case 4:
          req = _context.v;
          _context.n = 5;
          return baseFetchSDK(req);
        case 5:
          return _context.a(2, _context.v);
        case 6:
          throw _t;
        case 7:
          return _context.a(2);
      }
    }, _callee, null, [[1, 3]]);
  }));
}
function baseFetchSDK(_ref2) {
  var method = _ref2.method,
    finalURL = _ref2.finalURL,
    basicAuthHeader = _ref2.basicAuthHeader,
    xSDKClientHeader = _ref2.xSDKClientHeader,
    xSDKParentHostHeader = _ref2.xSDKParentHostHeader,
    body = _ref2.body;
  var _a;
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee2() {
    var headers, fetchOpts, resp, _respData, respError, respData, _t2;
    return _regenerator().w(function (_context2) {
      while (1) switch (_context2.p = _context2.n) {
        case 0:
          headers = {
            Authorization: basicAuthHeader,
            'Content-Type': 'application/json',
            'X-SDK-Client': xSDKClientHeader
          };
          if (xSDKParentHostHeader) {
            headers['X-SDK-Parent-Host'] = xSDKParentHostHeader;
          }
          fetchOpts = {
            method: method,
            headers: headers,
            body: body && JSON.stringify(body),
            credentials: 'include'
          };
          _context2.p = 1;
          _context2.n = 2;
          return fetch(finalURL, fetchOpts);
        case 2:
          resp = _context2.v;
          _context2.n = 5;
          break;
        case 3:
          _context2.p = 3;
          _t2 = _context2.v;
          if (!(_t2.message === 'Failed to fetch')) {
            _context2.n = 4;
            break;
          }
          throw new StytchAPIUnreachableError('Unable to contact our servers.');
        case 4:
          throw _t2;
        case 5:
          if (!(resp.status <= 299)) {
            _context2.n = 9;
            break;
          }
          _context2.p = 6;
          _context2.n = 7;
          return resp.json();
        case 7:
          _respData = _context2.v;
          return _context2.a(2, _respData.data);
        case 8:
          _context2.p = 8;
          _context2.v;
          throw new StytchAPIUnreachableError('Invalid JSON response from our servers.');
        case 9:
          if (!(resp.status !== 200 && ((_a = resp.headers.get('content-type')) === null || _a === void 0 ? void 0 : _a.includes('application/json')))) {
            _context2.n = 15;
            break;
          }
          _context2.p = 10;
          _context2.n = 11;
          return resp.json();
        case 11:
          respError = _context2.v;
          _context2.n = 13;
          break;
        case 12:
          _context2.p = 12;
          _context2.v;
          throw new StytchAPIUnreachableError('Invalid or no response from server');
        case 13:
          if (!('body' in respError || 'params' in respError || 'query' in respError)) {
            _context2.n = 14;
            break;
          }
          throw new StytchAPISchemaError(respError);
        case 14:
          throw new StytchAPIError(respError);
        case 15:
          _context2.p = 15;
          _context2.n = 16;
          return resp.text();
        case 16:
          respData = _context2.v;
          _context2.n = 18;
          break;
        case 17:
          _context2.p = 17;
          _context2.v;
          throw new StytchAPIUnreachableError('Invalid response from our servers.');
        case 18:
          if (!respData.includes('Captcha required')) {
            _context2.n = 19;
            break;
          }
          throw new RetriableError(RetriableErrorType.RequiredCaptcha);
        case 19:
          throw new StytchAPIUnreachableError('Invalid response from our servers.');
        case 20:
          return _context2.a(2);
      }
    }, _callee2, null, [[15, 17], [10, 12], [6, 8], [1, 3]]);
  }));
}
function baseSubmitFormSDK(_ref3) {
  var method = _ref3.method,
    finalURL = _ref3.finalURL,
    basicAuthHeader = _ref3.basicAuthHeader,
    xSDKClientHeader = _ref3.xSDKClientHeader,
    xSDKParentHostHeader = _ref3.xSDKParentHostHeader,
    body = _ref3.body;
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee3() {
    var bodyParams, finalBody, children, form;
    return _regenerator().w(function (_context3) {
      while (1) switch (_context3.n) {
        case 0:
          bodyParams = body || {};
          finalBody = Object.assign(Object.assign({}, bodyParams), {
            __Authorization: basicAuthHeader,
            '__X-SDK-Client': xSDKClientHeader
          });
          if (xSDKParentHostHeader) {
            finalBody['__X-SDK-Parent-Host'] = xSDKParentHostHeader;
          }
          children = Object.entries(finalBody).map(function (_ref4) {
            var _ref5 = _slicedToArray(_ref4, 2),
              key = _ref5[0],
              value = _ref5[1];
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = value;
            return input;
          });
          form = document.createElement('form');
          form.method = method;
          form.action = finalURL;
          form.append.apply(form, _toConsumableArray(children));
          document.body.appendChild(form);
          form.submit();
        case 1:
          return _context3.a(2);
      }
    }, _callee3);
  }));
}
var getRandomValues;
var rnds8 = new Uint8Array(16);
function rng() {
  if (!getRandomValues) {
    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);
    if (!getRandomValues) {
      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');
    }
  }
  return getRandomValues(rnds8);
}
var REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;
function validate$1(uuid) {
  return typeof uuid === 'string' && REGEX.test(uuid);
}
var byteToHex = [];
for (var i = 0; i < 256; ++i) {
  byteToHex.push((i + 0x100).toString(16).substr(1));
}
function stringify(arr) {
  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase();
  if (!validate$1(uuid)) {
    throw TypeError('Stringified UUID is invalid');
  }
  return uuid;
}
function v4(options, buf, offset) {
  options = options || {};
  var rnds = options.random || (options.rng || rng)();
  rnds[6] = rnds[6] & 0x0f | 0x40;
  rnds[8] = rnds[8] & 0x3f | 0x80;
  return stringify(rnds);
}
var ModulePromiseCache = {};
function loadESModule(url, moduleFromGlobalScope) {
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee4() {
    return _regenerator().w(function (_context4) {
      while (1) switch (_context4.n) {
        case 0:
          if (!(ModulePromiseCache[url] !== undefined)) {
            _context4.n = 1;
            break;
          }
          return _context4.a(2, ModulePromiseCache[url]);
        case 1:
          ModulePromiseCache[url] = loadESModuleFromNetwork(url, moduleFromGlobalScope);
          return _context4.a(2, ModulePromiseCache[url]);
      }
    }, _callee4);
  }));
}
function loadESModuleFromNetwork(url, moduleFromGlobalScope) {
  return new Promise(function (resolve, reject) {
    var maybeScript = findScript(url);
    if (maybeScript && maybeScript.dataset.loaded === 'true') {
      try {
        resolve(moduleFromGlobalScope());
      } catch (err) {
        return reject(new Error("".concat(url, " already loaded, but module was not found in global scope: ").concat(err)));
      }
    }
    var script = createScript(url);
    script.addEventListener('load', function () {
      script.dataset.loaded = 'true';
      try {
        resolve(moduleFromGlobalScope());
      } catch (err) {
        reject(new Error("".concat(url, " was loaded, but module was not found in global scope: ").concat(err)));
      }
    });
    script.addEventListener('error', function (err) {
      reject(new Error("".concat(url, " could not be loaded: ").concat(err)));
    });
  });
}
var findScriptsInDom = function findScriptsInDom(url) {
  return document.querySelectorAll("script[src=\"".concat(url, "\"]"));
};
function findScript(url) {
  var scripts = findScriptsInDom(url);
  if (scripts[0]) {
    return scripts[0];
  }
}
function createScript(url) {
  var script = document.createElement('script');
  script.setAttribute('src', url);
  script.setAttribute('async', 'true');
  script.setAttribute('defer', 'true');
  document.head.appendChild(script);
  return script;
}
var getHttpsUrl = function getHttpsUrl(urlOrDomain) {
  try {
    var url = new URL(urlOrDomain);
    return "https://".concat(url.hostname);
  } catch (_a) {}
  try {
    var _url = new URL("https://".concat(urlOrDomain));
    return "https://".concat(_url.hostname);
  } catch (_b) {}
  return undefined;
};
var STYTCH_BADGE = ['[Stytch]'];
var DEBUG = false;
var logger = {
  debug: function debug() {
    return DEBUG;
  },
  log: function log() {
    var _console;
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }
    return (_console = console).log.apply(_console, STYTCH_BADGE.concat(args));
  },
  warn: function warn() {
    var _console2;
    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }
    return (_console2 = console).warn.apply(_console2, STYTCH_BADGE.concat(args));
  },
  error: function error() {
    var _console3;
    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      args[_key3] = arguments[_key3];
    }
    return (_console3 = console).error.apply(_console3, STYTCH_BADGE.concat(args));
  }
};
var getLiveApiURL = function getLiveApiURL(opts) {
  var _a, _b, _c, _d;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.apiDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) ? 'customBaseUrl' : 'apiDomain';
      logger.warn("Unable to use custom API domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return (_d = (_c = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _c === void 0 ? void 0 : _c.liveAPIURL) !== null && _d !== void 0 ? _d : LIVE_API_URL;
};
var getTestApiURL = function getTestApiURL(opts) {
  var _a, _b, _c, _d;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.testApiDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) ? 'customBaseUrl' : 'testApiDomain';
      logger.warn("Unable to use custom API domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return (_d = (_c = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _c === void 0 ? void 0 : _c.testAPIURL) !== null && _d !== void 0 ? _d : TEST_API_URL;
};
var trailer = "\nYou can find your public token at https://stytch.com/dashboard/api-keys.";
var checkPublicToken = function checkPublicToken(publicToken) {
  if (typeof publicToken !== 'string') {
    logger.warn("Public token is malformed. Expected a string, got ".concat(_typeof(publicToken), ".").concat(trailer));
  } else if (publicToken === '') {
    logger.warn("Public token is malformed. Expected \"public-token-...\", got an empty string.".concat(trailer));
  } else if (!publicToken.startsWith('public-token-')) {
    logger.warn("Public token is malformed. Expected \"public-token-...\", got ".concat(publicToken, ".").concat(trailer));
  }
};
var checkB2BNotSSR = function checkB2BNotSSR(clientName) {
  var factoryFunctionName = clientName === 'StytchB2BUIClient' ? 'createStytchB2BUIClient' : 'createStytchB2BHeadlessClient';
  if (typeof window === 'undefined') {
    throw new Error("`new ".concat(clientName, "()` is not supported in server environments. If using @stytch/react or @stytch/nextjs, use `").concat(factoryFunctionName, "()` instead."));
  }
};
var COUNTRIES_LIST = {
  US: '1',
  AX: '358',
  AS: '1684',
  AG: '1268',
  AI: '1264',
  AR: '54',
  AT: '43',
  AU: '61',
  BE: '32',
  BJ: '229',
  BO: '591',
  BR: '55',
  IO: '246',
  BN: '673',
  BG: '359',
  BF: '226',
  CM: '237',
  CA: '1',
  BQ: '599',
  CF: '236',
  CL: '56',
  CX: '61',
  CC: '61',
  CO: '57',
  CD: '243',
  CK: '682',
  CR: '506',
  HR: '385',
  CZ: '420',
  DK: '45',
  DO: '1829',
  EC: '593',
  SV: '503',
  EE: '372',
  SZ: '268',
  FK: '500',
  FI: '358',
  FR: '33',
  GF: '594',
  DE: '49',
  GH: '233',
  GR: '30',
  GD: '1473',
  GT: '502',
  GG: '44',
  GW: '245',
  GY: '592',
  HU: '36',
  IS: '354',
  IN: '91',
  IE: '353',
  IM: '44',
  IT: '39',
  JM: '1876',
  JP: '81',
  KZ: '7',
  KE: '254',
  KI: '686',
  KR: '82',
  LV: '371',
  LT: '370',
  LU: '352',
  MO: '853',
  MT: '356',
  MH: '692',
  MR: '222',
  MU: '230',
  YT: '262',
  MX: '52',
  MC: '377',
  ME: '382',
  NR: '674',
  NL: '31',
  NZ: '64',
  NI: '505',
  NF: '672',
  NO: '47',
  PA: '507',
  PY: '595',
  PE: '51',
  PN: '870',
  PL: '48',
  PT: '351',
  PR: '1',
  RO: '40',
  BL: '590',
  SH: '290',
  KN: '1869',
  LC: '1758',
  MF: '590',
  PM: '508',
  SM: '378',
  ST: '239',
  SC: '248',
  SX: '599',
  SK: '421',
  SI: '386',
  ZA: '27',
  SS: '211',
  ES: '34',
  SR: '597',
  SJ: '47',
  SE: '46',
  CH: '41',
  TW: '886',
  TZ: '255',
  TK: '690',
  TO: '676',
  TT: '1868',
  TR: '90',
  UA: '380',
  GB: '44',
  UM: '1',
  UY: '598',
  VA: '379',
  EH: '212'
};
var getDFPBackendURL = function getDFPBackendURL(opts) {
  var _a, _b, _c, _d;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.dfppaUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.dfppaDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.dfppaUrl) ? 'dfppaUrl' : 'dfppaDomain';
      logger.warn("Unable to use custom DFPPA domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return (_d = (_c = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _c === void 0 ? void 0 : _c.dfpBackendURL) !== null && _d !== void 0 ? _d : STYTCH_DFP_BACKEND_URL;
};
var getDFPCdnURL = function getDFPCdnURL(opts) {
  var _a, _b;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.dfpCdnUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.dfpCdnDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.dfpCdnUrl) ? 'dfpCdnUrl' : 'dfpCdnDomain';
      logger.warn("Unable to use custom DFP CDN domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return STYTCH_DFP_CDN_URL;
};
function moveToFront(array, predicate) {
  if (array.length <= 1) {
    return [array, false];
  }
  var matchingIndex = array.findIndex(predicate);
  if (matchingIndex === -1) {
    return [array, false];
  }
  var reordered = _toConsumableArray(array);
  reordered.unshift.apply(reordered, _toConsumableArray(reordered.splice(matchingIndex, 1)));
  return [reordered, true];
}
var arrayUtils = {
  moveToFront: moveToFront
};
var isTestPublicToken = function isTestPublicToken(token) {
  return token.includes('public-token-test');
};
var createEventId = function createEventId() {
  return "event-id-".concat(v4());
};
var createAppSessionId = function createAppSessionId() {
  return "app-session-id-".concat(v4());
};
var createPersistentId = function createPersistentId() {
  return "persistent-id-".concat(v4());
};
var validate = function validate(methodName) {
  var validator = {
    isObject: function isObject(fieldName, value) {
      var isObject = _typeof(value) === 'object' && !Array.isArray(value) && value !== null;
      if (!isObject) {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be an object.');
      }
      return validator;
    },
    isOptionalObject: function isOptionalObject(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isObject(fieldName, value);
    },
    isString: function isString(fieldName, value) {
      if (typeof value !== 'string') {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be a string.');
      }
      return validator;
    },
    isOptionalString: function isOptionalString(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isString(fieldName, value);
    },
    isStringArray: function isStringArray(fieldName, value) {
      if (!Array.isArray(value)) {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be an array of strings.');
      }
      var _iterator = _createForOfIteratorHelper(value),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var str = _step.value;
          if (typeof str !== 'string') {
            throw new StytchSDKUsageError(methodName, fieldName + ' must be an array of strings.');
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return validator;
    },
    isOptionalStringArray: function isOptionalStringArray(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isStringArray(fieldName, value);
    },
    isNumber: function isNumber(fieldName, value) {
      if (typeof value !== 'number') {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be a number.');
      }
      return validator;
    },
    isOptionalNumber: function isOptionalNumber(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isNumber(fieldName, value);
    },
    isBoolean: function isBoolean(fieldName, value) {
      if (typeof value !== 'boolean') {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be a boolean.');
      }
      return validator;
    },
    isOptionalBoolean: function isOptionalBoolean(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isBoolean(fieldName, value);
    }
  };
  return validator;
};
var loadTelemetryJS = function loadTelemetryJS(domain) {
  return loadESModule("".concat(domain, "/telemetry.js"), function () {
    return window.GetTelemetryID;
  });
};
var DFPProtectedAuthProvider = /*#__PURE__*/_createClass(function DFPProtectedAuthProvider(publicToken, dfpBackendURL, dfpCdnDomain, bootstrapPromise) {
  var _this2 = this;
  var executeRecaptcha = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : function () {
    return Promise.resolve(undefined);
  };
  _classCallCheck(this, DFPProtectedAuthProvider);
  this.bootstrapPromise = bootstrapPromise;
  this.isEnabled = function () {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee5() {
      return _regenerator().w(function (_context5) {
        while (1) switch (_context5.n) {
          case 0:
            return _context5.a(2, this.state.then(function (state) {
              return state.enabled;
            }));
        }
      }, _callee5, this);
    }));
  };
  this.getTelemetryID = function () {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee6() {
      var _yield$this$state, publicToken, enabled, dfpBackendURL;
      return _regenerator().w(function (_context6) {
        while (1) switch (_context6.n) {
          case 0:
            _context6.n = 1;
            return this.state;
          case 1:
            _yield$this$state = _context6.v;
            publicToken = _yield$this$state.publicToken;
            enabled = _yield$this$state.enabled;
            dfpBackendURL = _yield$this$state.dfpBackendURL;
            if (enabled) {
              _context6.n = 2;
              break;
            }
            return _context6.a(2, undefined);
          case 2:
            _context6.n = 3;
            return window.GetTelemetryID(publicToken, "".concat(dfpBackendURL, "/submit"));
          case 3:
            return _context6.a(2, _context6.v);
        }
      }, _callee6, this);
    }));
  };
  this.getDFPTelemetryIDAndCaptcha = function () {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee7() {
      var _yield$this$state2, enabled, executeRecaptcha, mode, dfp_telemetry_id, captcha_token;
      return _regenerator().w(function (_context7) {
        while (1) switch (_context7.n) {
          case 0:
            _context7.n = 1;
            return this.state;
          case 1:
            _yield$this$state2 = _context7.v;
            enabled = _yield$this$state2.enabled;
            executeRecaptcha = _yield$this$state2.executeRecaptcha;
            mode = _yield$this$state2.mode;
            dfp_telemetry_id = undefined;
            captcha_token = undefined;
            if (enabled) {
              _context7.n = 3;
              break;
            }
            _context7.n = 2;
            return executeRecaptcha();
          case 2:
            captcha_token = _context7.v;
          case 3:
            if (!(mode === 'DECISIONING')) {
              _context7.n = 5;
              break;
            }
            _context7.n = 4;
            return this.getTelemetryID();
          case 4:
            dfp_telemetry_id = _context7.v;
            _context7.n = 8;
            break;
          case 5:
            if (!(mode === 'OBSERVATION')) {
              _context7.n = 8;
              break;
            }
            _context7.n = 6;
            return this.getTelemetryID();
          case 6:
            dfp_telemetry_id = _context7.v;
            _context7.n = 7;
            return executeRecaptcha();
          case 7:
            captcha_token = _context7.v;
          case 8:
            return _context7.a(2, {
              dfp_telemetry_id: dfp_telemetry_id,
              captcha_token: captcha_token
            });
        }
      }, _callee7, this);
    }));
  };
  this.retryWithCaptchaAndDFP = function (e, req) {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee8() {
      var _yield$this$state3, enabled, executeRecaptcha;
      return _regenerator().w(function (_context8) {
        while (1) switch (_context8.n) {
          case 0:
            _context8.n = 1;
            return this.state;
          case 1:
            _yield$this$state3 = _context8.v;
            enabled = _yield$this$state3.enabled;
            executeRecaptcha = _yield$this$state3.executeRecaptcha;
            if (!(e.type === RetriableErrorType.RequiredCaptcha && enabled)) {
              _context8.n = 5;
              break;
            }
            if (!req.body) {
              _context8.n = 4;
              break;
            }
            _context8.n = 2;
            return this.getTelemetryID();
          case 2:
            req.body.dfp_telemetry_id = _context8.v;
            _context8.n = 3;
            return executeRecaptcha();
          case 3:
            req.body.captcha_token = _context8.v;
          case 4:
            return _context8.a(2, req);
          case 5:
            throw new Error('Unable to query captcha and/or dfp telemetry ID');
          case 6:
            return _context8.a(2);
        }
      }, _callee8, this);
    }));
  };
  this.state = bootstrapPromise.then(function (bootstrapData) {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee9() {
      return _regenerator().w(function (_context9) {
        while (1) switch (_context9.n) {
          case 0:
            if (bootstrapData.runDFPProtectedAuth) {
              _context9.n = 1;
              break;
            }
            return _context9.a(2, {
              publicToken: publicToken,
              dfpBackendURL: dfpBackendURL,
              enabled: false,
              loaded: false,
              executeRecaptcha: executeRecaptcha
            });
          case 1:
            _context9.n = 2;
            return loadTelemetryJS(dfpCdnDomain);
          case 2:
            return _context9.a(2, {
              publicToken: publicToken,
              dfpBackendURL: dfpBackendURL,
              enabled: true,
              mode: bootstrapData.dfpProtectedAuthMode || 'OBSERVATION',
              loaded: true,
              executeRecaptcha: executeRecaptcha
            });
        }
      }, _callee9);
    }));
  });
});
var DisabledDFPProtectedAuthProvider = function DisabledDFPProtectedAuthProvider() {
  return {
    isEnabled: function isEnabled() {
      return __awaiter$1(void 0, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee0() {
        return _regenerator().w(function (_context0) {
          while (1) switch (_context0.n) {
            case 0:
              return _context0.a(2, false);
          }
        }, _callee0);
      }));
    },
    getTelemetryID: function getTelemetryID() {
      return __awaiter$1(void 0, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee1() {
        return _regenerator().w(function (_context1) {
          while (1) switch (_context1.n) {
            case 0:
              return _context1.a(2, undefined);
          }
        }, _callee1);
      }));
    },
    getDFPTelemetryIDAndCaptcha: function getDFPTelemetryIDAndCaptcha() {
      return __awaiter$1(void 0, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee10() {
        return _regenerator().w(function (_context10) {
          while (1) switch (_context10.n) {
            case 0:
              return _context10.a(2, {
                dfp_telemetry_id: undefined,
                captcha_token: undefined
              });
          }
        }, _callee10);
      }));
    },
    retryWithCaptchaAndDFP: function retryWithCaptchaAndDFP() {
      return __awaiter$1(void 0, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee11() {
        return _regenerator().w(function (_context11) {
          while (1) switch (_context11.n) {
            case 0:
              throw new Error('DFP protected auth is disabled');
            case 1:
              return _context11.a(2);
          }
        }, _callee11);
      }));
    }
  };
};
var ErrorMarshaller = /*#__PURE__*/function () {
  function ErrorMarshaller() {
    _classCallCheck(this, ErrorMarshaller);
  }
  return _createClass(ErrorMarshaller, null, [{
    key: "inflate",
    value: function inflate(ErrorClass, ErrorData) {
      var err = new ErrorClass(ErrorData);
      Object.assign(err, ErrorData);
      Object.setPrototypeOf(err, ErrorClass.prototype);
      return err;
    }
  }, {
    key: "unmarshall",
    value: function unmarshall(error) {
      if ('name' in error) {
        switch (error.name) {
          case 'SDKAPIUnreachableError':
            return ErrorMarshaller.inflate(SDKAPIUnreachableError, error);
          case 'StytchSDKSchemaError':
            return ErrorMarshaller.inflate(StytchSDKSchemaError, error);
          case 'StytchAPIUnreachableError':
            return ErrorMarshaller.inflate(StytchAPIUnreachableError, error);
          case 'StytchAPISchemaError':
            return ErrorMarshaller.inflate(StytchAPISchemaError, error);
          case 'StytchSDKAPIError':
            return ErrorMarshaller.inflate(StytchSDKAPIError, error);
          case 'StytchAPIError':
            return ErrorMarshaller.inflate(StytchAPIError, error);
          case 'TypeError':
            return ErrorMarshaller.inflate(TypeError, error);
          case 'SyntaxError':
            return ErrorMarshaller.inflate(SyntaxError, error);
          case 'ReferenceError':
            return ErrorMarshaller.inflate(ReferenceError, error);
          case 'RangeError':
            return ErrorMarshaller.inflate(RangeError, error);
          case 'EvalError':
            return ErrorMarshaller.inflate(EvalError, error);
          case 'URIError':
            return ErrorMarshaller.inflate(URIError, error);
        }
      }
      return ErrorMarshaller.inflate(Error, error);
    }
  }]);
}();
var DEFAULT_MAX_BATCH_SIZE = 15;
var DEFAULT_INTERVAL_DURATION_MS = 800;
var EventLogger = /*#__PURE__*/function () {
  function EventLogger(args) {
    _classCallCheck(this, EventLogger);
    this.maxBatchSize = args.maxBatchSize;
    this.logEventURL = args.logEventURL;
    setInterval(this.flush.bind(this), args.intervalDurationMs);
    this.batch = [];
  }
  return _createClass(EventLogger, [{
    key: "logEvent",
    value: function logEvent(telemetry, event) {
      this.batch.push({
        telemetry: telemetry,
        event: event
      });
      if (this.batch.length >= this.maxBatchSize) {
        this.flush();
      }
    }
  }, {
    key: "flush",
    value: function flush() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee12() {
        var batchToSubmit;
        return _regenerator().w(function (_context12) {
          while (1) switch (_context12.p = _context12.n) {
            case 0:
              if (this.batch.length) {
                _context12.n = 1;
                break;
              }
              return _context12.a(2);
            case 1:
              batchToSubmit = this.batch;
              this.batch = [];
              _context12.p = 2;
              _context12.n = 3;
              return fetch(this.logEventURL, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(batchToSubmit)
              });
            case 3:
              _context12.n = 5;
              break;
            case 4:
              _context12.p = 4;
              _context12.v;
            case 5:
              return _context12.a(2);
          }
        }, _callee12, this, [[2, 4]]);
      }));
    }
  }]);
}();
var EmailSentType;
(function (EmailSentType) {
  EmailSentType["LoginOrCreateEML"] = "login_or_create_eml";
  EmailSentType["LoginOrCreateOTP"] = "login_or_create_otp";
  EmailSentType["ResetPassword"] = "reset_password";
})(EmailSentType || (EmailSentType = {}));
Promise.resolve({
  pkceRequiredForEmailMagicLinks: false
});
Promise.resolve({
  siweRequiredForCryptoWallets: false
});
Promise.resolve({
  pkceRequiredForPasswordResets: false
});
var WILDCARD_ACTION = '*';
var RBACPolicy = /*#__PURE__*/function () {
  function RBACPolicy(roles, resources) {
    var _this13 = this;
    _classCallCheck(this, RBACPolicy);
    this.roles = roles;
    this.resources = resources;
    this.rolesByID = {};
    roles.forEach(function (role) {
      return _this13.rolesByID[role.role_id] = role;
    });
  }
  return _createClass(RBACPolicy, [{
    key: "mergeWithCustomRoles",
    value: function mergeWithCustomRoles(customRoles) {
      var mergedRoles = [].concat(_toConsumableArray(this.roles), _toConsumableArray(customRoles));
      return new RBACPolicy(mergedRoles, this.resources);
    }
  }, {
    key: "callerIsAuthorized",
    value: function callerIsAuthorized(memberRoles, resourceId, action) {
      var _this14 = this;
      return !!memberRoles.map(function (roleId) {
        return _this14.rolesByID[roleId];
      }).filter(function (v) {
        return v;
      }).flatMap(function (role) {
        return role.permissions;
      }).filter(function (permission) {
        return permission.resource_id === resourceId;
      }).find(function (permission) {
        return permission.actions.includes(action) || permission.actions.includes(WILDCARD_ACTION);
      });
    }
  }, {
    key: "allPermissionsForCaller",
    value: function allPermissionsForCaller(memberRoles) {
      var _this15 = this;
      var allPermsMap = Object.create(null);
      this.resources.forEach(function (resource) {
        allPermsMap[resource.resource_id] = {};
        resource.actions.forEach(function (action) {
          allPermsMap[resource.resource_id][action] = _this15.callerIsAuthorized(memberRoles, resource.resource_id, action);
        });
      });
      return allPermsMap;
    }
  }], [{
    key: "fromJSON",
    value: function fromJSON(input) {
      return new RBACPolicy(input.roles, input.resources);
    }
  }]);
}();
var DefaultDynamicConfig$1 = Promise.resolve({
  pkceRequiredForEmailMagicLinks: false
});
var HeadlessB2BMagicLinksClient = /*#__PURE__*/function () {
  function HeadlessB2BMagicLinksClient(_networkClient, _subscriptionService, _pkceManager, _passwordResetPKCEManager) {
    var _this19 = this;
    var _config = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : DefaultDynamicConfig$1;
    var dfpProtectedAuth = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : DisabledDFPProtectedAuthProvider();
    _classCallCheck(this, HeadlessB2BMagicLinksClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._passwordResetPKCEManager = _passwordResetPKCEManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.email = {
      invite: function invite(data) {
        return __awaiter$1(_this19, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee68() {
          return _regenerator().w(function (_context68) {
            while (1) switch (_context68.n) {
              case 0:
                validate('stytch.magicLinks.email.invite').isString('email_address', data.email_address).isOptionalString('invite_redirect_url', data.invite_redirect_url).isOptionalString('invite_template_id', data.invite_template_id).isOptionalString('name', data.name).isOptionalString('locale', data.locale).isOptionalStringArray('roles', data.roles).isOptionalNumber('invite_expiration_minutes', data.invite_expiration_minutes);
                return _context68.a(2, this._networkClient.fetchSDK({
                  url: '/b2b/magic_links/email/invite',
                  body: data,
                  method: 'POST'
                }));
            }
          }, _callee68, this);
        }));
      },
      loginOrSignup: function loginOrSignup(data) {
        return __awaiter$1(_this19, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee69() {
          var pkce_code_challenge, requestBody;
          return _regenerator().w(function (_context69) {
            while (1) switch (_context69.n) {
              case 0:
                validate('stytch.magicLinks.email.loginOrSignup').isString('email_address', data.email_address).isString('organization_id', data.organization_id).isOptionalString('login_redirect_url', data.login_redirect_url).isOptionalString('login_template_id', data.login_template_id).isOptionalString('signup_redirect_url', data.signup_redirect_url).isOptionalString('signup_template_id', data.signup_template_id).isOptionalString('locale', data.locale).isOptionalNumber('login_expiration_minutes', data.login_expiration_minutes).isOptionalNumber('signup_expiration_minutes', data.signup_expiration_minutes);
                _context69.n = 1;
                return this.getCodeChallenge();
              case 1:
                pkce_code_challenge = _context69.v;
                requestBody = Object.assign(Object.assign({}, data), {
                  pkce_code_challenge: pkce_code_challenge
                });
                return _context69.a(2, this._networkClient.fetchSDK({
                  url: '/b2b/magic_links/email/login_or_signup',
                  body: requestBody,
                  method: 'POST'
                }));
            }
          }, _callee69, this);
        }));
      },
      discovery: {
        send: function send(data) {
          return __awaiter$1(_this19, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee70() {
            var _yield$this$dfpProtec18, dfp_telemetry_id, captcha_token, pkce_code_challenge, requestBody;
            return _regenerator().w(function (_context70) {
              while (1) switch (_context70.n) {
                case 0:
                  validate('stytch.magicLinks.email.discovery.send').isString('email_address', data.email_address).isOptionalString('discovery_redirect_url', data.discovery_redirect_url).isOptionalString('login_template_id', data.login_template_id).isOptionalString('locale', data.locale).isOptionalNumber('discovery_expiration_minutes', data.discovery_expiration_minutes);
                  _context70.n = 1;
                  return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
                case 1:
                  _yield$this$dfpProtec18 = _context70.v;
                  dfp_telemetry_id = _yield$this$dfpProtec18.dfp_telemetry_id;
                  captcha_token = _yield$this$dfpProtec18.captcha_token;
                  _context70.n = 2;
                  return this.getCodeChallenge();
                case 2:
                  pkce_code_challenge = _context70.v;
                  requestBody = Object.assign(Object.assign({}, data), {
                    pkce_code_challenge: pkce_code_challenge,
                    dfp_telemetry_id: dfp_telemetry_id,
                    captcha_token: captcha_token
                  });
                  return _context70.a(2, this._networkClient.retriableFetchSDK({
                    url: '/b2b/magic_links/email/discovery/send',
                    body: requestBody,
                    method: 'POST',
                    retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                  }));
              }
            }, _callee70, this);
          }));
        }
      }
    };
    this.authenticate = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this19, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee71() {
        var passwordResetPKPair, resp, _t11;
        return _regenerator().w(function (_context71) {
          while (1) switch (_context71.p = _context71.n) {
            case 0:
              validate('stytch.magicLinks.authenticate').isString('magic_links_token', data.magic_links_token).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              _context71.n = 1;
              return this._passwordResetPKCEManager.getPKPair();
            case 1:
              passwordResetPKPair = _context71.v;
              resp = null;
              if (!(passwordResetPKPair === null || passwordResetPKPair === void 0 ? void 0 : passwordResetPKPair.code_verifier)) {
                _context71.n = 6;
                break;
              }
              _context71.p = 2;
              _context71.n = 3;
              return this.handlePKCEForAuthenticate(this._passwordResetPKCEManager, data);
            case 3:
              resp = _context71.v;
              _context71.n = 6;
              break;
            case 4:
              _context71.p = 4;
              _t11 = _context71.v;
              if (!_t11.message.includes('pkce')) {
                _context71.n = 5;
                break;
              }
              console.log('Authenticate with passwords pkce namespace failed. Falling back to authenticate with magic_links namespace.');
              _context71.n = 6;
              break;
            case 5:
              throw _t11;
            case 6:
              if (resp) {
                _context71.n = 8;
                break;
              }
              _context71.n = 7;
              return this.handlePKCEForAuthenticate(this._pkceManager, data);
            case 7:
              resp = _context71.v;
            case 8:
              return _context71.a(2, resp);
          }
        }, _callee71, this, [[2, 4]]);
      }));
    });
    this.discovery = {
      authenticate: this._subscriptionService.withUpdateSession(function (data) {
        return __awaiter$1(_this19, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee72() {
          var pkPair, _yield$this$dfpProtec19, dfp_telemetry_id, captcha_token, requestBody, resp;
          return _regenerator().w(function (_context72) {
            while (1) switch (_context72.n) {
              case 0:
                validate('stytch.magicLinks.discovery.authenticate').isString('discovery_magic_links_token', data.discovery_magic_links_token);
                _context72.n = 1;
                return this._pkceManager.getPKPair();
              case 1:
                pkPair = _context72.v;
                _context72.n = 2;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 2:
                _yield$this$dfpProtec19 = _context72.v;
                dfp_telemetry_id = _yield$this$dfpProtec19.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec19.captcha_token;
                requestBody = Object.assign({
                  pkce_code_verifier: pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }, data);
                _context72.n = 3;
                return this._networkClient.retriableFetchSDK({
                  url: '/b2b/magic_links/discovery/authenticate',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                });
              case 3:
                resp = _context72.v;
                this._pkceManager.clearPKPair();
                return _context72.a(2, resp);
            }
          }, _callee72, this);
        }));
      })
    };
  }
  return _createClass(HeadlessB2BMagicLinksClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee73() {
        var _yield$this$_config5, pkceRequiredForEmailMagicLinks, keyPair;
        return _regenerator().w(function (_context73) {
          while (1) switch (_context73.n) {
            case 0:
              _context73.n = 1;
              return this._config;
            case 1:
              _yield$this$_config5 = _context73.v;
              pkceRequiredForEmailMagicLinks = _yield$this$_config5.pkceRequiredForEmailMagicLinks;
              if (pkceRequiredForEmailMagicLinks) {
                _context73.n = 2;
                break;
              }
              return _context73.a(2, undefined);
            case 2:
              _context73.n = 3;
              return this._pkceManager.getPKPair();
            case 3:
              keyPair = _context73.v;
              if (!keyPair) {
                _context73.n = 4;
                break;
              }
              return _context73.a(2, keyPair.code_challenge);
            case 4:
              _context73.n = 5;
              return this._pkceManager.startPKCETransaction();
            case 5:
              keyPair = _context73.v;
              return _context73.a(2, keyPair.code_challenge);
          }
        }, _callee73, this);
      }));
    }
  }, {
    key: "handlePKCEForAuthenticate",
    value: function handlePKCEForAuthenticate(pkceManager, data) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee74() {
        var pkPair, _yield$this$dfpProtec20, dfp_telemetry_id, captcha_token, requestBody, resp, _t12, _t13, _t14, _t15, _t16, _t17;
        return _regenerator().w(function (_context74) {
          while (1) switch (_context74.n) {
            case 0:
              _context74.n = 1;
              return pkceManager.getPKPair();
            case 1:
              pkPair = _context74.v;
              _context74.n = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec20 = _context74.v;
              dfp_telemetry_id = _yield$this$dfpProtec20.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec20.captcha_token;
              _t12 = Object;
              _t13 = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _t14 = dfp_telemetry_id;
              _t15 = captcha_token;
              _context74.n = 3;
              return this._subscriptionService.getIntermediateSessionToken();
            case 3:
              _t16 = _context74.v;
              if (_t16) {
                _context74.n = 4;
                break;
              }
              _t16 = undefined;
            case 4:
              _t17 = _t16;
              requestBody = _t12.assign.call(_t12, {
                pkce_code_verifier: _t13,
                dfp_telemetry_id: _t14,
                captcha_token: _t15,
                intermediate_session_token: _t17
              }, data);
              _context74.n = 5;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/magic_links/authenticate',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 5:
              resp = _context74.v;
              pkceManager.clearPKPair();
              return _context74.a(2, resp);
          }
        }, _callee74, this);
      }));
    }
  }]);
}();
var HeadlessB2BSelfClient = /*#__PURE__*/_createClass(function HeadlessB2BSelfClient(_networkClient, _apiNetworkClient, _subscriptionService) {
  var _this20 = this;
  _classCallCheck(this, HeadlessB2BSelfClient);
  this._networkClient = _networkClient;
  this._apiNetworkClient = _apiNetworkClient;
  this._subscriptionService = _subscriptionService;
  this.get = function () {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee75() {
      var resp;
      return _regenerator().w(function (_context75) {
        while (1) switch (_context75.n) {
          case 0:
            _context75.n = 1;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/members/me",
              method: 'GET'
            });
          case 1:
            resp = _context75.v;
            this._subscriptionService.updateMember(resp.member);
            return _context75.a(2, resp.member);
        }
      }, _callee75, this);
    }));
  };
  this.getSync = function () {
    return _this20._subscriptionService.getMember();
  };
  this.getInfo = function () {
    return {
      member: _this20.getSync(),
      fromCache: _this20._subscriptionService.getFromCache()
    };
  };
  this.onChange = function (callback) {
    return _this20._subscriptionService.subscribeToState(function (state) {
      var _a;
      return callback((_a = state === null || state === void 0 ? void 0 : state.member) !== null && _a !== void 0 ? _a : null);
    });
  };
  this.update = function (data) {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee76() {
      var resp;
      return _regenerator().w(function (_context76) {
        while (1) switch (_context76.n) {
          case 0:
            validate('stytch.self.update').isOptionalString('name', data.name).isOptionalObject('untrusted_metadata', data.untrusted_metadata).isOptionalBoolean('mfa_enrolled', data.mfa_enrolled).isOptionalString('mfa_phone_number', data.mfa_phone_number).isOptionalString('default_mfa_method', data.default_mfa_method);
            _context76.n = 1;
            return this._networkClient.fetchSDK({
              url: '/b2b/organizations/members/update',
              body: data,
              method: 'PUT'
            });
          case 1:
            resp = _context76.v;
            this._subscriptionService.updateMember(resp.member);
            return _context76.a(2, resp);
        }
      }, _callee76, this);
    }));
  };
  this.deleteMFAPhoneNumber = function () {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee77() {
      var resp;
      return _regenerator().w(function (_context77) {
        while (1) switch (_context77.n) {
          case 0:
            _context77.n = 1;
            return this._networkClient.fetchSDK({
              url: '/b2b/organizations/members/deletePhoneNumber',
              method: 'DELETE'
            });
          case 1:
            resp = _context77.v;
            this._subscriptionService.updateMember(resp.member);
            return _context77.a(2, resp);
        }
      }, _callee77, this);
    }));
  };
  this.deleteMFATOTP = function () {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee78() {
      var resp;
      return _regenerator().w(function (_context78) {
        while (1) switch (_context78.n) {
          case 0:
            _context78.n = 1;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/members/deleteTOTP",
              method: 'DELETE'
            });
          case 1:
            resp = _context78.v;
            this._subscriptionService.updateMember(resp.member);
            return _context78.a(2, resp);
        }
      }, _callee78, this);
    }));
  };
  this.deletePassword = function (passwordId) {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee79() {
      var resp;
      return _regenerator().w(function (_context79) {
        while (1) switch (_context79.n) {
          case 0:
            _context79.n = 1;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/members/passwords/".concat(passwordId),
              method: 'DELETE'
            });
          case 1:
            resp = _context79.v;
            this._subscriptionService.updateMember(resp.member);
            return _context79.a(2, resp);
        }
      }, _callee79, this);
    }));
  };
  this.unlinkRetiredEmail = function (data) {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee80() {
      var resp;
      return _regenerator().w(function (_context80) {
        while (1) switch (_context80.n) {
          case 0:
            _context80.n = 1;
            return this._apiNetworkClient.fetchSDK({
              url: '/b2b/organizations/members/unlink_retired_email',
              method: 'POST',
              body: data
            });
          case 1:
            resp = _context80.v;
            this._subscriptionService.updateMember(resp.member);
            return _context80.a(2, resp);
        }
      }, _callee80, this);
    }));
  };
  this.startEmailUpdate = function (data) {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee81() {
      var resp;
      return _regenerator().w(function (_context81) {
        while (1) switch (_context81.n) {
          case 0:
            _context81.n = 1;
            return this._apiNetworkClient.fetchSDK({
              url: '/b2b/organizations/members/start_email_update',
              method: 'POST',
              body: data
            });
          case 1:
            resp = _context81.v;
            this._subscriptionService.updateMember(resp.member);
            return _context81.a(2, resp);
        }
      }, _callee81, this);
    }));
  };
  this.getConnectedApps = function () {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee82() {
      return _regenerator().w(function (_context82) {
        while (1) switch (_context82.n) {
          case 0:
            return _context82.a(2, this._networkClient.fetchSDK({
              url: '/b2b/organizations/members/connected_apps',
              method: 'GET'
            }));
        }
      }, _callee82, this);
    }));
  };
  this.revokeConnectedApp = function (data) {
    return __awaiter$1(_this20, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee83() {
      return _regenerator().w(function (_context83) {
        while (1) switch (_context83.n) {
          case 0:
            return _context83.a(2, this._networkClient.fetchSDK({
              url: "/b2b/organizations/members/connected_apps/".concat(data.connected_app_id, "/revoke"),
              method: 'POST'
            }));
        }
      }, _callee83, this);
    }));
  };
});
var HeadlessB2BSSOClient = /*#__PURE__*/function () {
  function HeadlessB2BSSOClient(_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config, dfpProtectedAuth) {
    var _this21 = this;
    _classCallCheck(this, HeadlessB2BSSOClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._dynamicConfig = _dynamicConfig;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.authenticate = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee84() {
        var keyPair, _yield$this$dfpProtec21, dfp_telemetry_id, captcha_token, resp;
        return _regenerator().w(function (_context84) {
          while (1) switch (_context84.n) {
            case 0:
              validate('stytch.sso.authenticate').isString('sso_token', options.sso_token).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context84.n = 1;
              return this._pkceManager.getPKPair();
            case 1:
              keyPair = _context84.v;
              if (!keyPair) {
                logger.warn('No code verifier found in local storage for SSO flow.\n' + 'Consider using stytch.sso.start() to add PKCE to your SSO flows for added security.\n' + 'See https://stytch.com/docs/oauth#guides_pkce for more information.');
              }
              _context84.n = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec21 = _context84.v;
              dfp_telemetry_id = _yield$this$dfpProtec21.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec21.captcha_token;
              _context84.n = 3;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/sso/authenticate',
                method: 'POST',
                body: Object.assign(Object.assign({
                  pkce_code_verifier: keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier
                }, options), {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token,
                  intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
                }),
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 3:
              resp = _context84.v;
              this._pkceManager.clearPKPair();
              return _context84.a(2, resp);
          }
        }, _callee84, this);
      }));
    });
    this.saml = {
      createConnection: function createConnection(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee85() {
          return _regenerator().w(function (_context85) {
            while (1) switch (_context85.n) {
              case 0:
                _context85.n = 1;
                return this._networkClient.fetchSDK({
                  url: '/b2b/sso/saml',
                  method: 'POST',
                  body: data
                });
              case 1:
                return _context85.a(2, _context85.v);
            }
          }, _callee85, this);
        }));
      },
      updateConnection: function updateConnection(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee86() {
          return _regenerator().w(function (_context86) {
            while (1) switch (_context86.n) {
              case 0:
                _context86.n = 1;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/saml/".concat(data.connection_id),
                  method: 'PUT',
                  body: data
                });
              case 1:
                return _context86.a(2, _context86.v);
            }
          }, _callee86, this);
        }));
      },
      updateConnectionByURL: function updateConnectionByURL(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee87() {
          return _regenerator().w(function (_context87) {
            while (1) switch (_context87.n) {
              case 0:
                _context87.n = 1;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/saml/".concat(data.connection_id, "/url"),
                  method: 'PUT',
                  body: data
                });
              case 1:
                return _context87.a(2, _context87.v);
            }
          }, _callee87, this);
        }));
      },
      deleteVerificationCertificate: function deleteVerificationCertificate(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee88() {
          return _regenerator().w(function (_context88) {
            while (1) switch (_context88.n) {
              case 0:
                _context88.n = 1;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/saml/".concat(data.connection_id, "/verification_certificates/").concat(data.certificate_id),
                  method: 'DELETE'
                });
              case 1:
                return _context88.a(2, _context88.v);
            }
          }, _callee88, this);
        }));
      },
      deleteEncryptionPrivateKey: function deleteEncryptionPrivateKey(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee89() {
          return _regenerator().w(function (_context89) {
            while (1) switch (_context89.n) {
              case 0:
                _context89.n = 1;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/saml/".concat(data.connection_id, "/encryption_private_key/").concat(data.private_key_id),
                  method: 'DELETE'
                });
              case 1:
                return _context89.a(2, _context89.v);
            }
          }, _callee89, this);
        }));
      }
    };
    this.oidc = {
      createConnection: function createConnection(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee90() {
          return _regenerator().w(function (_context90) {
            while (1) switch (_context90.n) {
              case 0:
                _context90.n = 1;
                return this._networkClient.fetchSDK({
                  url: '/b2b/sso/oidc',
                  method: 'POST',
                  body: data
                });
              case 1:
                return _context90.a(2, _context90.v);
            }
          }, _callee90, this);
        }));
      },
      updateConnection: function updateConnection(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee91() {
          return _regenerator().w(function (_context91) {
            while (1) switch (_context91.n) {
              case 0:
                _context91.n = 1;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/oidc/".concat(data.connection_id),
                  method: 'PUT',
                  body: data
                });
              case 1:
                return _context91.a(2, _context91.v);
            }
          }, _callee91, this);
        }));
      }
    };
    this.external = {
      createConnection: function createConnection(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee92() {
          return _regenerator().w(function (_context92) {
            while (1) switch (_context92.n) {
              case 0:
                _context92.n = 1;
                return this._networkClient.fetchSDK({
                  url: '/b2b/sso/external',
                  method: 'POST',
                  body: data
                });
              case 1:
                return _context92.a(2, _context92.v);
            }
          }, _callee92, this);
        }));
      },
      updateConnection: function updateConnection(data) {
        return __awaiter$1(_this21, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee93() {
          return _regenerator().w(function (_context93) {
            while (1) switch (_context93.n) {
              case 0:
                _context93.n = 1;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/external/".concat(data.connection_id),
                  method: 'PUT',
                  body: data
                });
              case 1:
                return _context93.a(2, _context93.v);
            }
          }, _callee93, this);
        }));
      }
    };
  }
  return _createClass(HeadlessB2BSSOClient, [{
    key: "getBaseApiUrl",
    value: function getBaseApiUrl() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee94() {
        return _regenerator().w(function (_context94) {
          while (1) switch (_context94.n) {
            case 0:
              if (!isTestPublicToken(this._config.publicToken)) {
                _context94.n = 1;
                break;
              }
              return _context94.a(2, this._config.testAPIURL);
            case 1:
              return _context94.a(2, this._config.liveAPIURL);
          }
        }, _callee94, this);
      }));
    }
  }, {
    key: "start",
    value: function start(_ref7) {
      var connection_id = _ref7.connection_id,
        login_redirect_url = _ref7.login_redirect_url,
        signup_redirect_url = _ref7.signup_redirect_url;
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee95() {
        var _yield$this$_dynamicC3, pkceRequiredForSso, baseURL, startUrl, keyPair;
        return _regenerator().w(function (_context95) {
          while (1) switch (_context95.n) {
            case 0:
              _context95.n = 1;
              return this._dynamicConfig;
            case 1:
              _yield$this$_dynamicC3 = _context95.v;
              pkceRequiredForSso = _yield$this$_dynamicC3.pkceRequiredForSso;
              _context95.n = 2;
              return this.getBaseApiUrl();
            case 2:
              baseURL = _context95.v;
              startUrl = new URL("".concat(baseURL, "/v1/public/sso/start"));
              startUrl.searchParams.set('public_token', this._config.publicToken);
              startUrl.searchParams.set('connection_id', connection_id);
              if (!pkceRequiredForSso) {
                _context95.n = 4;
                break;
              }
              _context95.n = 3;
              return this._pkceManager.startPKCETransaction();
            case 3:
              keyPair = _context95.v;
              startUrl.searchParams.set('pkce_code_challenge', keyPair.code_challenge);
              _context95.n = 5;
              break;
            case 4:
              this._pkceManager.clearPKPair();
            case 5:
              if (login_redirect_url) startUrl.searchParams.set('login_redirect_url', login_redirect_url);
              if (signup_redirect_url) startUrl.searchParams.set('signup_redirect_url', signup_redirect_url);
              window.location.href = startUrl.toString();
            case 6:
              return _context95.a(2);
          }
        }, _callee95, this);
      }));
    }
  }, {
    key: "getConnections",
    value: function getConnections() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee96() {
        return _regenerator().w(function (_context96) {
          while (1) switch (_context96.n) {
            case 0:
              _context96.n = 1;
              return this._networkClient.fetchSDK({
                url: '/b2b/sso',
                method: 'GET'
              });
            case 1:
              return _context96.a(2, _context96.v);
          }
        }, _callee96, this);
      }));
    }
  }, {
    key: "discoverConnections",
    value: function discoverConnections(emailAddress) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee97() {
        return _regenerator().w(function (_context97) {
          while (1) switch (_context97.n) {
            case 0:
              _context97.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/sso/discovery/connections?email_address=".concat(encodeURIComponent(emailAddress)),
                method: 'GET'
              });
            case 1:
              return _context97.a(2, _context97.v);
          }
        }, _callee97, this);
      }));
    }
  }, {
    key: "deleteConnection",
    value: function deleteConnection(connectionId) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee98() {
        return _regenerator().w(function (_context98) {
          while (1) switch (_context98.n) {
            case 0:
              return _context98.a(2, this._networkClient.fetchSDK({
                url: "/b2b/sso/".concat(connectionId),
                method: 'DELETE'
              }));
          }
        }, _callee98, this);
      }));
    }
  }]);
}();
var HeadlessB2BSCIMClient = /*#__PURE__*/function () {
  function HeadlessB2BSCIMClient(_networkClient, _subscriptionService) {
    _classCallCheck(this, HeadlessB2BSCIMClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
  }
  return _createClass(HeadlessB2BSCIMClient, [{
    key: "createConnection",
    value: function createConnection(data) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee99() {
        return _regenerator().w(function (_context99) {
          while (1) switch (_context99.n) {
            case 0:
              validate('stytch.scim.createConnection').isOptionalString('display_name', data.display_name).isOptionalString('identity_provider', data.identity_provider);
              _context99.n = 1;
              return this._networkClient.fetchSDK({
                url: '/b2b/scim',
                method: 'POST',
                body: data
              });
            case 1:
              return _context99.a(2, _context99.v);
          }
        }, _callee99, this);
      }));
    }
  }, {
    key: "updateConnection",
    value: function updateConnection(data) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee100() {
        return _regenerator().w(function (_context100) {
          while (1) switch (_context100.n) {
            case 0:
              validate('stytch.scim.updateConnection').isString('connection_id', data.connection_id).isOptionalString('display_name', data.display_name).isOptionalString('identity_provider', data.identity_provider);
              _context100.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/".concat(data.connection_id),
                method: 'PUT',
                body: data
              });
            case 1:
              return _context100.a(2, _context100.v);
          }
        }, _callee100, this);
      }));
    }
  }, {
    key: "deleteConnection",
    value: function deleteConnection(connectionId) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee101() {
        return _regenerator().w(function (_context101) {
          while (1) switch (_context101.n) {
            case 0:
              validate('stytch.scim.deleteConnection').isString('connection_id', connectionId);
              _context101.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/".concat(connectionId),
                method: 'DELETE'
              });
            case 1:
              return _context101.a(2, _context101.v);
          }
        }, _callee101, this);
      }));
    }
  }, {
    key: "getConnection",
    value: function getConnection() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee102() {
        return _regenerator().w(function (_context102) {
          while (1) switch (_context102.n) {
            case 0:
              _context102.n = 1;
              return this._networkClient.fetchSDK({
                url: '/b2b/scim',
                method: 'GET'
              });
            case 1:
              return _context102.a(2, _context102.v);
          }
        }, _callee102, this);
      }));
    }
  }, {
    key: "getConnectionGroups",
    value: function getConnectionGroups(data) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee103() {
        return _regenerator().w(function (_context103) {
          while (1) switch (_context103.n) {
            case 0:
              validate('stytch.scim.getConnectionGroups').isOptionalNumber('limit', data.limit).isOptionalString('cursor', data.cursor);
              _context103.n = 1;
              return this._networkClient.fetchSDK({
                url: '/b2b/scim/groups',
                method: 'POST',
                body: data
              });
            case 1:
              return _context103.a(2, _context103.v);
          }
        }, _callee103, this);
      }));
    }
  }, {
    key: "rotateStart",
    value: function rotateStart(connectionId) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee104() {
        return _regenerator().w(function (_context104) {
          while (1) switch (_context104.n) {
            case 0:
              validate('stytch.scim.rotateStart').isString('connectionId', connectionId);
              _context104.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/rotate/start",
                method: 'POST',
                body: {
                  connection_id: connectionId
                }
              });
            case 1:
              return _context104.a(2, _context104.v);
          }
        }, _callee104, this);
      }));
    }
  }, {
    key: "rotateComplete",
    value: function rotateComplete(connectionId) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee105() {
        return _regenerator().w(function (_context105) {
          while (1) switch (_context105.n) {
            case 0:
              validate('stytch.scim.rotateComplete').isString('connectionId', connectionId);
              _context105.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/rotate/complete",
                method: 'POST',
                body: {
                  connection_id: connectionId
                }
              });
            case 1:
              return _context105.a(2, _context105.v);
          }
        }, _callee105, this);
      }));
    }
  }, {
    key: "rotateCancel",
    value: function rotateCancel(connectionId) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee106() {
        return _regenerator().w(function (_context106) {
          while (1) switch (_context106.n) {
            case 0:
              validate('stytch.scim.rotateCancel').isString('connectionId', connectionId);
              _context106.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/rotate/cancel",
                method: 'POST',
                body: {
                  connection_id: connectionId
                }
              });
            case 1:
              return _context106.a(2, _context106.v);
          }
        }, _callee106, this);
      }));
    }
  }]);
}();
var HeadlessB2BOrganizationClient = /*#__PURE__*/_createClass(function HeadlessB2BOrganizationClient(_networkClient, _apiNetworkClient, _subscriptionService) {
  var _this22 = this;
  _classCallCheck(this, HeadlessB2BOrganizationClient);
  this._networkClient = _networkClient;
  this._apiNetworkClient = _apiNetworkClient;
  this._subscriptionService = _subscriptionService;
  this.get = function () {
    return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee107() {
      var resp;
      return _regenerator().w(function (_context107) {
        while (1) switch (_context107.n) {
          case 0:
            _context107.n = 1;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/me",
              method: 'GET'
            });
          case 1:
            resp = _context107.v;
            this._subscriptionService.updateOrganization(resp.organization);
            return _context107.a(2, resp.organization);
        }
      }, _callee107, this);
    }));
  };
  this.getSync = function () {
    return _this22._subscriptionService.getOrganization();
  };
  this.getInfo = function () {
    return {
      organization: _this22.getSync(),
      fromCache: _this22._subscriptionService.getFromCache()
    };
  };
  this.onChange = function (callback) {
    return _this22._subscriptionService.subscribeToState(function (state) {
      var _a;
      return callback((_a = state === null || state === void 0 ? void 0 : state.organization) !== null && _a !== void 0 ? _a : null);
    });
  };
  this.update = function (data) {
    return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee108() {
      var resp;
      return _regenerator().w(function (_context108) {
        while (1) switch (_context108.n) {
          case 0:
            _context108.n = 1;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/me",
              method: 'PUT',
              body: data
            });
          case 1:
            resp = _context108.v;
            this._subscriptionService.updateOrganization(resp.organization);
            return _context108.a(2, resp);
        }
      }, _callee108, this);
    }));
  };
  this["delete"] = function () {
    return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee109() {
      var resp;
      return _regenerator().w(function (_context109) {
        while (1) switch (_context109.n) {
          case 0:
            _context109.n = 1;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/me",
              method: 'DELETE'
            });
          case 1:
            resp = _context109.v;
            this._subscriptionService.destroyState();
            return _context109.a(2, resp);
        }
      }, _callee109, this);
    }));
  };
  this.getBySlug = function (data) {
    return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee110() {
      return _regenerator().w(function (_context110) {
        while (1) switch (_context110.n) {
          case 0:
            validate('stytch.organization.getBySlug').isString('organization_slug', data.organization_slug);
            return _context110.a(2, this._networkClient.fetchSDK({
              url: "/b2b/organizations/search",
              method: 'POST',
              body: data
            }));
        }
      }, _callee110, this);
    }));
  };
  this.getConnectedApps = function () {
    return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee111() {
      return _regenerator().w(function (_context111) {
        while (1) switch (_context111.n) {
          case 0:
            return _context111.a(2, this._networkClient.fetchSDK({
              url: '/b2b/organizations/connected_apps',
              method: 'GET'
            }));
        }
      }, _callee111, this);
    }));
  };
  this.getConnectedApp = function (data) {
    return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee112() {
      return _regenerator().w(function (_context112) {
        while (1) switch (_context112.n) {
          case 0:
            return _context112.a(2, this._networkClient.fetchSDK({
              url: "/b2b/organizations/connected_apps/".concat(data.connected_app_id),
              method: 'GET'
            }));
        }
      }, _callee112, this);
    }));
  };
  this.members = {
    create: function create(data) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee113() {
        return _regenerator().w(function (_context113) {
          while (1) switch (_context113.n) {
            case 0:
              return _context113.a(2, this._networkClient.fetchSDK({
                url: "/b2b/organizations/members",
                method: 'POST',
                body: data
              }));
          }
        }, _callee113, this);
      }));
    },
    search: function search(data) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee114() {
        return _regenerator().w(function (_context114) {
          while (1) switch (_context114.n) {
            case 0:
              return _context114.a(2, this._networkClient.fetchSDK({
                url: "/b2b/organizations/me/members/search",
                method: 'POST',
                body: data
              }));
          }
        }, _callee114, this);
      }));
    },
    update: function update(data) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee115() {
        var response;
        return _regenerator().w(function (_context115) {
          while (1) switch (_context115.n) {
            case 0:
              _context115.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(data.member_id),
                method: 'PUT',
                body: data
              });
            case 1:
              response = _context115.v;
              this.updateMemberIfSelf(response);
              return _context115.a(2, response);
          }
        }, _callee115, this);
      }));
    },
    deletePassword: function deletePassword(passwordId) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee116() {
        var response;
        return _regenerator().w(function (_context116) {
          while (1) switch (_context116.n) {
            case 0:
              _context116.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/passwords/".concat(passwordId),
                method: 'DELETE'
              });
            case 1:
              response = _context116.v;
              this.updateMemberIfSelf(response);
              return _context116.a(2, response);
          }
        }, _callee116, this);
      }));
    },
    deleteMFAPhoneNumber: function deleteMFAPhoneNumber(memberId) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee117() {
        var response;
        return _regenerator().w(function (_context117) {
          while (1) switch (_context117.n) {
            case 0:
              _context117.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/mfa_phone_numbers/".concat(memberId),
                method: 'DELETE'
              });
            case 1:
              response = _context117.v;
              this.updateMemberIfSelf(response);
              return _context117.a(2, response);
          }
        }, _callee117, this);
      }));
    },
    deleteMFATOTP: function deleteMFATOTP(memberId) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee118() {
        var response;
        return _regenerator().w(function (_context118) {
          while (1) switch (_context118.n) {
            case 0:
              _context118.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/totp/".concat(memberId),
                method: 'DELETE'
              });
            case 1:
              response = _context118.v;
              this.updateMemberIfSelf(response);
              return _context118.a(2, response);
          }
        }, _callee118, this);
      }));
    },
    "delete": function _delete(memberId) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee119() {
        var _a, response;
        return _regenerator().w(function (_context119) {
          while (1) switch (_context119.n) {
            case 0:
              _context119.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(memberId),
                method: 'DELETE'
              });
            case 1:
              response = _context119.v;
              if (memberId === ((_a = this._subscriptionService.getMember()) === null || _a === void 0 ? void 0 : _a.member_id)) {
                this._subscriptionService.destroyState();
              }
              return _context119.a(2, response);
          }
        }, _callee119, this);
      }));
    },
    reactivate: function reactivate(memberId) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee120() {
        return _regenerator().w(function (_context120) {
          while (1) switch (_context120.n) {
            case 0:
              return _context120.a(2, this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(memberId, "/reactivate"),
                method: 'PUT'
              }));
          }
        }, _callee120, this);
      }));
    },
    unlinkRetiredEmail: function unlinkRetiredEmail(data) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee121() {
        var member_id, body, response;
        return _regenerator().w(function (_context121) {
          while (1) switch (_context121.n) {
            case 0:
              member_id = data.member_id, body = __rest$1(data, ["member_id"]);
              _context121.n = 1;
              return this._apiNetworkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(member_id, "/unlink_retired_email"),
                method: 'POST',
                body: body
              });
            case 1:
              response = _context121.v;
              this.updateMemberIfSelf(response);
              return _context121.a(2, response);
          }
        }, _callee121, this);
      }));
    },
    startEmailUpdate: function startEmailUpdate(data) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee122() {
        var member_id, body, response;
        return _regenerator().w(function (_context122) {
          while (1) switch (_context122.n) {
            case 0:
              member_id = data.member_id, body = __rest$1(data, ["member_id"]);
              _context122.n = 1;
              return this._apiNetworkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(member_id, "/start_email_update"),
                method: 'POST',
                body: body
              });
            case 1:
              response = _context122.v;
              this.updateMemberIfSelf(response);
              return _context122.a(2, response);
          }
        }, _callee122, this);
      }));
    },
    getConnectedApps: function getConnectedApps(data) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee123() {
        return _regenerator().w(function (_context123) {
          while (1) switch (_context123.n) {
            case 0:
              return _context123.a(2, this._networkClient.fetchSDK({
                url: "b2b/organizations/members/".concat(data.member_id, "/connected_apps"),
                method: 'GET'
              }));
          }
        }, _callee123, this);
      }));
    },
    revokeConnectedApp: function revokeConnectedApp(data) {
      return __awaiter$1(_this22, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee124() {
        return _regenerator().w(function (_context124) {
          while (1) switch (_context124.n) {
            case 0:
              return _context124.a(2, this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(data.member_id, "/connected_apps/").concat(data.connected_app_id, "/revoke"),
                method: 'POST'
              }));
          }
        }, _callee124, this);
      }));
    }
  };
  this.updateMemberIfSelf = function (response) {
    var _a;
    if (response.member_id === ((_a = _this22._subscriptionService.getMember()) === null || _a === void 0 ? void 0 : _a.member_id)) {
      _this22._subscriptionService.updateMember(response.member);
    }
  };
});
var HeadlessB2BOAuthClient$1 = /*#__PURE__*/function () {
  function HeadlessB2BOAuthClient(_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config, dfpProtectedAuth) {
    var _this23 = this;
    _classCallCheck(this, HeadlessB2BOAuthClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._dynamicConfig = _dynamicConfig;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.authenticate = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this23, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee125() {
        var keyPair, _yield$this$dfpProtec22, dfp_telemetry_id, captcha_token, resp, _t18, _t19, _t20, _t21, _t22, _t23, _t24, _t25, _t26;
        return _regenerator().w(function (_context125) {
          while (1) switch (_context125.n) {
            case 0:
              validate('stytch.oauth.authenticate').isString('oauth_token', options.oauth_token).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context125.n = 1;
              return this._pkceManager.getPKPair();
            case 1:
              keyPair = _context125.v;
              if (!keyPair) {
                logger.warn('No code verifier found in local storage for OAuth flow.\n' + 'Consider using stytch.oauth.$provider.start() to add PKCE to your OAuth flows for added security.\n' + 'See https://stytch.com/docs/oauth#guides_pkce for more information.');
              }
              _context125.n = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec22 = _context125.v;
              dfp_telemetry_id = _yield$this$dfpProtec22.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec22.captcha_token;
              _t18 = this._networkClient;
              _t19 = Object;
              _t20 = keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier;
              _t21 = dfp_telemetry_id;
              _t22 = captcha_token;
              _context125.n = 3;
              return this._subscriptionService.getIntermediateSessionToken();
            case 3:
              _t23 = _context125.v;
              if (_t23) {
                _context125.n = 4;
                break;
              }
              _t23 = undefined;
            case 4:
              _t24 = _t23;
              _t25 = _t19.assign.call(_t19, {
                pkce_code_verifier: _t20,
                dfp_telemetry_id: _t21,
                captcha_token: _t22,
                intermediate_session_token: _t24
              }, options);
              _t26 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context125.n = 5;
              return _t18.retriableFetchSDK.call(_t18, {
                url: '/b2b/oauth/authenticate',
                method: 'POST',
                body: _t25,
                retryCallback: _t26
              });
            case 5:
              resp = _context125.v;
              this._pkceManager.clearPKPair();
              return _context125.a(2, resp);
          }
        }, _callee125, this);
      }));
    });
    this.discovery = {
      authenticate: this._subscriptionService.withUpdateSession(function (data) {
        return __awaiter$1(_this23, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee126() {
          var pkPair, _yield$this$dfpProtec23, dfp_telemetry_id, captcha_token, requestBody, resp;
          return _regenerator().w(function (_context126) {
            while (1) switch (_context126.n) {
              case 0:
                validate('stytch.oauth.discovery.authenticate').isString('discovery_oauth_token', data.discovery_oauth_token);
                _context126.n = 1;
                return this._pkceManager.getPKPair();
              case 1:
                pkPair = _context126.v;
                _context126.n = 2;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 2:
                _yield$this$dfpProtec23 = _context126.v;
                dfp_telemetry_id = _yield$this$dfpProtec23.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec23.captcha_token;
                requestBody = Object.assign({
                  pkce_code_verifier: pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }, data);
                _context126.n = 3;
                return this._networkClient.retriableFetchSDK({
                  url: '/b2b/oauth/discovery/authenticate',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                });
              case 3:
                resp = _context126.v;
                this._pkceManager.clearPKPair();
                return _context126.a(2, resp);
            }
          }, _callee126, this);
        }));
      })
    };
    this.google = {
      start: this.startOAuthFlow(B2BOAuthProviders.Google),
      discovery: {
        start: this.startDiscoveryOAuthFlow(B2BOAuthProviders.Google)
      }
    };
    this.microsoft = {
      start: this.startOAuthFlow(B2BOAuthProviders.Microsoft),
      discovery: {
        start: this.startDiscoveryOAuthFlow(B2BOAuthProviders.Microsoft)
      }
    };
    this.hubspot = {
      start: this.startOAuthFlow(B2BOAuthProviders.HubSpot),
      discovery: {
        start: this.startDiscoveryOAuthFlow(B2BOAuthProviders.HubSpot)
      }
    };
    this.slack = {
      start: this.startOAuthFlow(B2BOAuthProviders.Slack),
      discovery: {
        start: this.startDiscoveryOAuthFlow(B2BOAuthProviders.Slack)
      }
    };
    this.github = {
      start: this.startOAuthFlow(B2BOAuthProviders.GitHub),
      discovery: {
        start: this.startDiscoveryOAuthFlow(B2BOAuthProviders.GitHub)
      }
    };
  }
  return _createClass(HeadlessB2BOAuthClient, [{
    key: "getBaseApiUrl",
    value: function getBaseApiUrl() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee127() {
        var _yield$this$_dynamicC4, cnameDomain;
        return _regenerator().w(function (_context127) {
          while (1) switch (_context127.n) {
            case 0:
              _context127.n = 1;
              return this._dynamicConfig;
            case 1:
              _yield$this$_dynamicC4 = _context127.v;
              cnameDomain = _yield$this$_dynamicC4.cnameDomain;
              if (!cnameDomain) {
                _context127.n = 2;
                break;
              }
              return _context127.a(2, "https://".concat(cnameDomain));
            case 2:
              if (!isTestPublicToken(this._config.publicToken)) {
                _context127.n = 3;
                break;
              }
              return _context127.a(2, this._config.testAPIURL);
            case 3:
              return _context127.a(2, this._config.liveAPIURL);
          }
        }, _callee127, this);
      }));
    }
  }, {
    key: "startOAuthFlow",
    value: function startOAuthFlow(providerType) {
      var _this24 = this;
      return function (_ref8) {
        var organization_id = _ref8.organization_id,
          organization_slug = _ref8.organization_slug,
          login_redirect_url = _ref8.login_redirect_url,
          signup_redirect_url = _ref8.signup_redirect_url,
          custom_scopes = _ref8.custom_scopes,
          provider_params = _ref8.provider_params;
        return __awaiter$1(_this24, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee128() {
          var _yield$this$_dynamicC5, pkceRequiredForOAuth, baseURL, startUrl, key, keyPair;
          return _regenerator().w(function (_context128) {
            while (1) switch (_context128.n) {
              case 0:
                _context128.n = 1;
                return this._dynamicConfig;
              case 1:
                _yield$this$_dynamicC5 = _context128.v;
                pkceRequiredForOAuth = _yield$this$_dynamicC5.pkceRequiredForOAuth;
                _context128.n = 2;
                return this.getBaseApiUrl();
              case 2:
                baseURL = _context128.v;
                startUrl = new URL("".concat(baseURL, "/v1/b2b/public/oauth/").concat(providerType, "/start"));
                startUrl.searchParams.set('public_token', this._config.publicToken);
                if (organization_id && organization_id != '') {
                  startUrl.searchParams.set('organization_id', organization_id);
                }
                if (organization_slug && organization_slug != '') {
                  startUrl.searchParams.set('slug', organization_slug);
                }
                if (custom_scopes) {
                  validate('startOAuthFlow').isStringArray('custom_scopes', custom_scopes);
                  startUrl.searchParams.set('custom_scopes', custom_scopes.join(' '));
                }
                if (provider_params) {
                  validate('startOAuthFlow').isOptionalObject('provider_params', provider_params);
                  for (key in provider_params) {
                    startUrl.searchParams.set('provider_' + key, provider_params[key]);
                  }
                }
                if (!pkceRequiredForOAuth) {
                  _context128.n = 4;
                  break;
                }
                _context128.n = 3;
                return this._pkceManager.startPKCETransaction();
              case 3:
                keyPair = _context128.v;
                startUrl.searchParams.set('pkce_code_challenge', keyPair.code_challenge);
                _context128.n = 5;
                break;
              case 4:
                this._pkceManager.clearPKPair();
              case 5:
                if (login_redirect_url) startUrl.searchParams.set('login_redirect_url', login_redirect_url);
                if (signup_redirect_url) startUrl.searchParams.set('signup_redirect_url', signup_redirect_url);
                window.location.href = startUrl.toString();
              case 6:
                return _context128.a(2);
            }
          }, _callee128, this);
        }));
      };
    }
  }, {
    key: "startDiscoveryOAuthFlow",
    value: function startDiscoveryOAuthFlow(providerType) {
      var _this25 = this;
      return function (_ref9) {
        var discovery_redirect_url = _ref9.discovery_redirect_url,
          custom_scopes = _ref9.custom_scopes,
          provider_params = _ref9.provider_params;
        return __awaiter$1(_this25, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee129() {
          var _yield$this$_dynamicC6, pkceRequiredForOAuth, baseURL, startUrl, key, keyPair;
          return _regenerator().w(function (_context129) {
            while (1) switch (_context129.n) {
              case 0:
                _context129.n = 1;
                return this._dynamicConfig;
              case 1:
                _yield$this$_dynamicC6 = _context129.v;
                pkceRequiredForOAuth = _yield$this$_dynamicC6.pkceRequiredForOAuth;
                _context129.n = 2;
                return this.getBaseApiUrl();
              case 2:
                baseURL = _context129.v;
                startUrl = new URL("".concat(baseURL, "/v1/b2b/public/oauth/").concat(providerType, "/discovery/start"));
                startUrl.searchParams.set('public_token', this._config.publicToken);
                if (custom_scopes) {
                  validate('startOAuthFlow').isStringArray('custom_scopes', custom_scopes);
                  startUrl.searchParams.set('custom_scopes', custom_scopes.join(' '));
                }
                if (provider_params) {
                  validate('startOAuthFlow').isOptionalObject('provider_params', provider_params);
                  for (key in provider_params) {
                    startUrl.searchParams.set('provider_' + key, provider_params[key]);
                  }
                }
                if (!pkceRequiredForOAuth) {
                  _context129.n = 4;
                  break;
                }
                _context129.n = 3;
                return this._pkceManager.startPKCETransaction();
              case 3:
                keyPair = _context129.v;
                startUrl.searchParams.set('pkce_code_challenge', keyPair.code_challenge);
                _context129.n = 5;
                break;
              case 4:
                this._pkceManager.clearPKPair();
              case 5:
                if (discovery_redirect_url) {
                  startUrl.searchParams.set('discovery_redirect_url', discovery_redirect_url);
                }
                window.location.href = startUrl.toString();
              case 6:
                return _context129.a(2);
            }
          }, _callee129, this);
        }));
      };
    }
  }]);
}();
var HeadlessB2BSessionClient = /*#__PURE__*/function () {
  function HeadlessB2BSessionClient(_networkClient, _subscriptionService) {
    var _this26 = this;
    _classCallCheck(this, HeadlessB2BSessionClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.getSync = function () {
      return _this26._subscriptionService.getSession();
    };
    this.getInfo = function () {
      return {
        session: _this26.getSync(),
        fromCache: _this26._subscriptionService.getFromCache()
      };
    };
    this.onChange = function (callback) {
      return _this26._subscriptionService.subscribeToState(function (state) {
        var _a;
        return callback((_a = state === null || state === void 0 ? void 0 : state.session) !== null && _a !== void 0 ? _a : null);
      });
    };
    this.revoke = function (options) {
      return __awaiter$1(_this26, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee130() {
        var resp, _t27;
        return _regenerator().w(function (_context130) {
          while (1) switch (_context130.p = _context130.n) {
            case 0:
              _context130.p = 0;
              _context130.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/sessions/revoke",
                method: 'POST'
              });
            case 1:
              resp = _context130.v;
              this._subscriptionService.destroyState();
              return _context130.a(2, resp);
            case 2:
              _context130.p = 2;
              _t27 = _context130.v;
              if (options === null || options === void 0 ? void 0 : options.forceClear) {
                this._subscriptionService.destroyState();
              } else if (UNRECOVERABLE_ERROR_TYPES.includes(_t27.error_type)) {
                this._subscriptionService.destroyState();
              }
              throw _t27;
            case 3:
              return _context130.a(2);
          }
        }, _callee130, this, [[0, 2]]);
      }));
    };
    this.revokeForMember = function (options) {
      return __awaiter$1(_this26, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee131() {
        return _regenerator().w(function (_context131) {
          while (1) switch (_context131.n) {
            case 0:
              validate('stytch.session.revokeForMember').isString('member_id', options.member_id);
              _context131.n = 1;
              return this._networkClient.fetchSDK({
                url: "/b2b/sessions/revoke/".concat(options.member_id),
                method: 'POST'
              });
            case 1:
              return _context131.a(2, _context131.v);
          }
        }, _callee131, this);
      }));
    };
    this._authenticate = function (options) {
      return __awaiter$1(_this26, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee132() {
        var _this27 = this;
        var initialSession, isSessionStale, requestBody, resp, _t28;
        return _regenerator().w(function (_context132) {
          while (1) switch (_context132.p = _context132.n) {
            case 0:
              initialSession = this._subscriptionService.getSession();
              isSessionStale = function isSessionStale() {
                var _a;
                return (initialSession === null || initialSession === void 0 ? void 0 : initialSession.member_session_id) !== ((_a = _this27._subscriptionService.getSession()) === null || _a === void 0 ? void 0 : _a.member_session_id);
              };
              _context132.p = 1;
              requestBody = {
                session_duration_minutes: options === null || options === void 0 ? void 0 : options.session_duration_minutes
              };
              _context132.n = 2;
              return this._networkClient.fetchSDK({
                url: '/b2b/sessions/authenticate',
                body: requestBody,
                method: 'POST'
              });
            case 2:
              resp = _context132.v;
              if (!isSessionStale()) {
                _context132.n = 3;
                break;
              }
              return _context132.a(2, this._authenticate(options));
            case 3:
              return _context132.a(2, resp);
            case 4:
              _context132.p = 4;
              _t28 = _context132.v;
              if (!isSessionStale()) {
                _context132.n = 5;
                break;
              }
              return _context132.a(2, this._authenticate(options));
            case 5:
              if (UNRECOVERABLE_ERROR_TYPES.includes(_t28.error_type)) {
                this._subscriptionService.destroySession();
              }
              throw _t28;
            case 6:
              return _context132.a(2);
          }
        }, _callee132, this, [[1, 4]]);
      }));
    };
    this.authenticate = this._subscriptionService.withUpdateSession(this._authenticate);
    this.exchange = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this26, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee133() {
        return _regenerator().w(function (_context133) {
          while (1) switch (_context133.n) {
            case 0:
              validate('stytch.session.exchange').isString('organization_id', data.organization_id).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              return _context133.a(2, this._networkClient.fetchSDK({
                url: '/b2b/sessions/exchange',
                body: data,
                method: 'POST'
              }));
          }
        }, _callee133, this);
      }));
    });
    this.exchangeAccessToken = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this26, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee134() {
        return _regenerator().w(function (_context134) {
          while (1) switch (_context134.n) {
            case 0:
              validate('stytch.session.exchange').isString('organization_id', data.access_token).isNumber('session_duration_minutes', data.session_duration_minutes);
              return _context134.a(2, this._networkClient.fetchSDK({
                url: '/b2b/sessions/exchange_access_token',
                body: data,
                method: 'POST'
              }));
          }
        }, _callee134, this);
      }));
    });
    this.attest = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this26, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee135() {
        return _regenerator().w(function (_context135) {
          while (1) switch (_context135.n) {
            case 0:
              validate('stytch.session.attest').isOptionalString('organization_id', data.organization_id).isString('profile_id', data.profile_id).isString('token', data.token).isOptionalNumber('session_duration_minutes', data.session_duration_minutes);
              return _context135.a(2, this._networkClient.fetchSDK({
                url: '/b2b/sessions/attest',
                body: data,
                method: 'POST'
              }));
          }
        }, _callee135, this);
      }));
    });
  }
  return _createClass(HeadlessB2BSessionClient, [{
    key: "getTokens",
    value: function getTokens() {
      return this._subscriptionService.getTokens();
    }
  }, {
    key: "updateSession",
    value: function updateSession(tokens) {
      var _a;
      validate('stytch.session.updateSession').isString('session_token', tokens.session_token).isOptionalString('session_jwt', (_a = tokens.session_jwt) !== null && _a !== void 0 ? _a : undefined);
      this._subscriptionService.updateTokens(tokens);
    }
  }]);
}();
var HeadlessB2BDiscoveryClient = /*#__PURE__*/_createClass(function HeadlessB2BDiscoveryClient(_networkClient, _subscriptionService) {
  var _this28 = this;
  _classCallCheck(this, HeadlessB2BDiscoveryClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.organizations = {
    list: function list() {
      return __awaiter$1(_this28, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee136() {
        var _t29, _t30, _t31, _t32;
        return _regenerator().w(function (_context136) {
          while (1) switch (_context136.n) {
            case 0:
              _t29 = this._networkClient;
              _context136.n = 1;
              return this._subscriptionService.getIntermediateSessionToken();
            case 1:
              _t30 = _context136.v;
              if (_t30) {
                _context136.n = 2;
                break;
              }
              _t30 = undefined;
            case 2:
              _t31 = _t30;
              _t32 = {
                intermediate_session_token: _t31
              };
              return _context136.a(2, _t29.fetchSDK.call(_t29, {
                url: '/b2b/discovery/organizations',
                body: _t32,
                method: 'POST'
              }));
          }
        }, _callee136, this);
      }));
    },
    create: this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this28, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee137() {
        var requestBody, _t33, _t34, _t35, _t36;
        return _regenerator().w(function (_context137) {
          while (1) switch (_context137.n) {
            case 0:
              validate('stytch.discovery.organizations.create').isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('organization_name', data.organization_name).isOptionalString('organization_slug', data.organization_slug).isOptionalString('organization_logo_url', data.organization_logo_url).isOptionalString('sso_jit_provisioning', data.sso_jit_provisioning).isOptionalStringArray('email_allowed_domains', data.email_allowed_domains).isOptionalString('email_invites', data.email_invites).isOptionalString('auth_methods', data.auth_methods).isOptionalStringArray('allowed_auth_methods', data.allowed_auth_methods).isOptionalString('mfa_policy', data.mfa_policy);
              _t33 = Object;
              _t34 = Object.assign({}, data);
              _context137.n = 1;
              return this._subscriptionService.getIntermediateSessionToken();
            case 1:
              _t35 = _context137.v;
              if (_t35) {
                _context137.n = 2;
                break;
              }
              _t35 = undefined;
            case 2:
              _t36 = _t35;
              requestBody = _t33.assign.call(_t33, _t34, {
                intermediate_session_token: _t36
              });
              return _context137.a(2, this._networkClient.fetchSDK({
                url: '/b2b/discovery/organizations/create',
                body: requestBody,
                method: 'POST'
              }));
          }
        }, _callee137, this);
      }));
    })
  };
  this.intermediateSessions = {
    exchange: this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this28, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee138() {
        var requestBody;
        return _regenerator().w(function (_context138) {
          while (1) switch (_context138.n) {
            case 0:
              validate('stytch.discovery.intermediateSessions.exchange').isString('organization_id', data.organization_id).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              requestBody = Object.assign(Object.assign({}, data), {
                intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
              });
              return _context138.a(2, this._networkClient.fetchSDK({
                url: '/b2b/discovery/intermediate_sessions/exchange',
                body: requestBody,
                method: 'POST'
              }));
          }
        }, _callee138, this);
      }));
    })
  };
});
var DefaultDynamicConfig = Promise.resolve({
  pkceRequiredForPasswordResets: false
});
var HeadlessB2BPasswordsClient = /*#__PURE__*/function () {
  function HeadlessB2BPasswordsClient(_networkClient, _subscriptionService, _pkceManager) {
    var _this29 = this;
    var _config = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : DefaultDynamicConfig;
    var dfpProtectedAuth = arguments.length > 4 ? arguments[4] : undefined;
    _classCallCheck(this, HeadlessB2BPasswordsClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.authenticate = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this29, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee139() {
        var pkPair, code_verifier, _yield$this$dfpProtec24, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context139) {
          while (1) switch (_context139.n) {
            case 0:
              validate('stytch.passwords.authenticate').isString('org_id', options.organization_id).isString('password', options.password).isString('email_address', options.email_address).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context139.n = 1;
              return this._pkceManager.getPKPair();
            case 1:
              pkPair = _context139.v;
              code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _context139.n = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec24 = _context139.v;
              dfp_telemetry_id = _yield$this$dfpProtec24.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec24.captcha_token;
              return _context139.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/authenticate',
                method: 'POST',
                body: {
                  organization_id: options.organization_id,
                  email_address: options.email_address,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  locale: options.locale,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id,
                  code_verifier: code_verifier,
                  intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee139, this);
      }));
    });
    this.discovery = {
      resetByEmailStart: function resetByEmailStart(options) {
        return __awaiter$1(_this29, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee140() {
          var pkce_code_challenge, _yield$this$dfpProtec25, dfp_telemetry_id, captcha_token;
          return _regenerator().w(function (_context140) {
            while (1) switch (_context140.n) {
              case 0:
                validate('stytch.passwords.discovery.resetByEmailStart').isString('email', options.email_address).isOptionalString('login_redirect_url', options.discovery_redirect_url).isOptionalString('reset_password_redirect_url', options.reset_password_redirect_url).isOptionalString('reset_password_template_id', options.reset_password_template_id).isOptionalNumber('reset_password_expiration_minutes', options.reset_password_expiration_minutes).isOptionalString('verify_email_template_id', options.verify_email_template_id).isOptionalString('locale', options.locale);
                _context140.n = 1;
                return this.getCodeChallenge();
              case 1:
                pkce_code_challenge = _context140.v;
                _context140.n = 2;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 2:
                _yield$this$dfpProtec25 = _context140.v;
                dfp_telemetry_id = _yield$this$dfpProtec25.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec25.captcha_token;
                return _context140.a(2, this._networkClient.retriableFetchSDK({
                  url: '/b2b/passwords/discovery/reset/start',
                  method: 'POST',
                  body: {
                    email_address: options.email_address,
                    discovery_redirect_url: options.discovery_redirect_url,
                    reset_password_redirect_url: options.reset_password_redirect_url,
                    reset_password_expiration_minutes: options.reset_password_expiration_minutes,
                    reset_password_template_id: options.reset_password_template_id,
                    verify_email_template_id: options.verify_email_template_id,
                    locale: options.locale,
                    pkce_code_challenge: pkce_code_challenge,
                    captcha_token: captcha_token,
                    dfp_telemetry_id: dfp_telemetry_id
                  },
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
            }
          }, _callee140, this);
        }));
      },
      resetByEmail: this._subscriptionService.withUpdateSession(function (options) {
        return __awaiter$1(_this29, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee141() {
          var _yield$this$dfpProtec26, dfp_telemetry_id, captcha_token, pkPair, pkce_code_verifier, resp, _t37, _t38, _t39, _t40, _t41, _t42, _t43, _t44, _t45, _t46;
          return _regenerator().w(function (_context141) {
            while (1) switch (_context141.n) {
              case 0:
                validate('stytch.passwords.discovery.resetByEmail').isString('password_reset_token', options.password_reset_token).isString('password', options.password);
                _context141.n = 1;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 1:
                _yield$this$dfpProtec26 = _context141.v;
                dfp_telemetry_id = _yield$this$dfpProtec26.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec26.captcha_token;
                _context141.n = 2;
                return this._pkceManager.getPKPair();
              case 2:
                pkPair = _context141.v;
                pkce_code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
                _t37 = this._networkClient;
                _t38 = options.password_reset_token;
                _t39 = options.password;
                _t40 = captcha_token;
                _t41 = dfp_telemetry_id;
                _t42 = pkce_code_verifier;
                _context141.n = 3;
                return this._subscriptionService.getIntermediateSessionToken();
              case 3:
                _t43 = _context141.v;
                if (_t43) {
                  _context141.n = 4;
                  break;
                }
                _t43 = undefined;
              case 4:
                _t44 = _t43;
                _t45 = {
                  password_reset_token: _t38,
                  password: _t39,
                  captcha_token: _t40,
                  dfp_telemetry_id: _t41,
                  pkce_code_verifier: _t42,
                  intermediate_session_token: _t44
                };
                _t46 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
                _context141.n = 5;
                return _t37.retriableFetchSDK.call(_t37, {
                  url: '/b2b/passwords/discovery/reset',
                  method: 'POST',
                  body: _t45,
                  retryCallback: _t46
                });
              case 5:
                resp = _context141.v;
                this._pkceManager.clearPKPair();
                return _context141.a(2, resp);
            }
          }, _callee141, this);
        }));
      }),
      authenticate: this._subscriptionService.withUpdateSession(function (options) {
        return __awaiter$1(_this29, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee142() {
          var pkPair, code_verifier, _yield$this$dfpProtec27, dfp_telemetry_id, captcha_token;
          return _regenerator().w(function (_context142) {
            while (1) switch (_context142.n) {
              case 0:
                validate('stytch.passwords.discovery.authenticate').isString('password', options.password).isString('email_address', options.email_address);
                _context142.n = 1;
                return this._pkceManager.getPKPair();
              case 1:
                pkPair = _context142.v;
                code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
                _context142.n = 2;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 2:
                _yield$this$dfpProtec27 = _context142.v;
                dfp_telemetry_id = _yield$this$dfpProtec27.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec27.captcha_token;
                return _context142.a(2, this._networkClient.retriableFetchSDK({
                  url: '/b2b/passwords/discovery/authenticate',
                  method: 'POST',
                  body: {
                    email_address: options.email_address,
                    password: options.password,
                    captcha_token: captcha_token,
                    dfp_telemetry_id: dfp_telemetry_id,
                    code_verifier: code_verifier
                  },
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
            }
          }, _callee142, this);
        }));
      })
    };
    this.resetByEmail = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this29, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee143() {
        var _yield$this$dfpProtec28, dfp_telemetry_id, captcha_token, pkPair, code_verifier, resp;
        return _regenerator().w(function (_context143) {
          while (1) switch (_context143.n) {
            case 0:
              validate('stytch.passwords.resetByEmail').isString('password_reset_token', options.password_reset_token).isString('password', options.password).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context143.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec28 = _context143.v;
              dfp_telemetry_id = _yield$this$dfpProtec28.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec28.captcha_token;
              _context143.n = 2;
              return this._pkceManager.getPKPair();
            case 2:
              pkPair = _context143.v;
              code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _context143.n = 3;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/email/reset',
                method: 'POST',
                body: {
                  password_reset_token: options.password_reset_token,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  locale: options.locale,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id,
                  code_verifier: code_verifier,
                  intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 3:
              resp = _context143.v;
              this._pkceManager.clearPKPair();
              return _context143.a(2, resp);
          }
        }, _callee143, this);
      }));
    });
    this.resetByExistingPassword = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this29, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee144() {
        var _yield$this$dfpProtec29, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context144) {
          while (1) switch (_context144.n) {
            case 0:
              validate('stytch.passwords.resetByExistingPassword').isString('email', options.email_address).isString('existing_password', options.existing_password).isString('new_password', options.new_password).isOptionalString('locale', options.locale).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context144.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec29 = _context144.v;
              dfp_telemetry_id = _yield$this$dfpProtec29.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec29.captcha_token;
              return _context144.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/existing_password/reset',
                method: 'POST',
                body: {
                  organization_id: options.organization_id,
                  email_address: options.email_address,
                  existing_password: options.existing_password,
                  new_password: options.new_password,
                  locale: options.locale,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee144, this);
      }));
    });
    this.resetBySession = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this29, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee145() {
        var _yield$this$dfpProtec30, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context145) {
          while (1) switch (_context145.n) {
            case 0:
              validate('stytch.passwords.resetBySession').isString('password', options.password);
              _context145.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec30 = _context145.v;
              dfp_telemetry_id = _yield$this$dfpProtec30.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec30.captcha_token;
              return _context145.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/session/reset',
                method: 'POST',
                body: {
                  password: options.password,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee145, this);
      }));
    });
  }
  return _createClass(HeadlessB2BPasswordsClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee146() {
        var _yield$this$_config6, pkceRequiredForPasswordResets, keyPair;
        return _regenerator().w(function (_context146) {
          while (1) switch (_context146.n) {
            case 0:
              _context146.n = 1;
              return this._config;
            case 1:
              _yield$this$_config6 = _context146.v;
              pkceRequiredForPasswordResets = _yield$this$_config6.pkceRequiredForPasswordResets;
              if (pkceRequiredForPasswordResets) {
                _context146.n = 2;
                break;
              }
              return _context146.a(2, undefined);
            case 2:
              _context146.n = 3;
              return this._pkceManager.getPKPair();
            case 3:
              keyPair = _context146.v;
              if (!keyPair) {
                _context146.n = 4;
                break;
              }
              return _context146.a(2, keyPair.code_challenge);
            case 4:
              _context146.n = 5;
              return this._pkceManager.startPKCETransaction();
            case 5:
              keyPair = _context146.v;
              return _context146.a(2, keyPair.code_challenge);
          }
        }, _callee146, this);
      }));
    }
  }, {
    key: "resetByEmailStart",
    value: function resetByEmailStart(options) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee147() {
        var code_challenge, _yield$this$dfpProtec31, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context147) {
          while (1) switch (_context147.n) {
            case 0:
              validate('stytch.passwords.resetByEmailStart').isString('email', options.email_address).isOptionalString('login_redirect_url', options.login_redirect_url).isOptionalString('reset_password_redirect_url', options.reset_password_redirect_url).isOptionalString('reset_password_template_id', options.reset_password_template_id).isOptionalNumber('reset_password_expiration_minutes', options.reset_password_expiration_minutes).isOptionalString('verify_email_template_id', options.verify_email_template_id).isOptionalString('locale', options.locale);
              _context147.n = 1;
              return this.getCodeChallenge();
            case 1:
              code_challenge = _context147.v;
              _context147.n = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec31 = _context147.v;
              dfp_telemetry_id = _yield$this$dfpProtec31.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec31.captcha_token;
              return _context147.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/email/reset/start',
                method: 'POST',
                body: {
                  organization_id: options.organization_id,
                  email_address: options.email_address,
                  login_redirect_url: options.login_redirect_url,
                  reset_password_redirect_url: options.reset_password_redirect_url,
                  reset_password_expiration_minutes: options.reset_password_expiration_minutes,
                  reset_password_template_id: options.reset_password_template_id,
                  verify_email_template_id: options.verify_email_template_id,
                  locale: options.locale,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee147, this);
      }));
    }
  }, {
    key: "strengthCheck",
    value: function strengthCheck(options) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee148() {
        return _regenerator().w(function (_context148) {
          while (1) switch (_context148.n) {
            case 0:
              validate('stytch.passwords.strengthCheck').isOptionalString('email', options.email_address).isString('password', options.password);
              return _context148.a(2, this._networkClient.fetchSDK({
                url: '/b2b/passwords/strength_check',
                method: 'POST',
                body: {
                  email_address: options.email_address,
                  password: options.password
                }
              }));
          }
        }, _callee148, this);
      }));
    }
  }]);
}();
var HeadlessB2BOTPsClient = /*#__PURE__*/_createClass(function HeadlessB2BOTPsClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
  var _this30 = this;
  _classCallCheck(this, HeadlessB2BOTPsClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.sms = {
    send: function send(data) {
      return __awaiter$1(_this30, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee149() {
        var _yield$this$dfpProtec32, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context149) {
          while (1) switch (_context149.n) {
            case 0:
              validate('stytch.otps.sms.send').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isOptionalString('mfa_phone_number', data.mfa_phone_number).isOptionalString('locale', data.locale);
              _context149.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec32 = _context149.v;
              dfp_telemetry_id = _yield$this$dfpProtec32.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec32.captcha_token;
              return _context149.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/otps/sms/send',
                body: Object.assign(Object.assign({}, data), {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token,
                  intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
                }),
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee149, this);
      }));
    },
    authenticate: this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this30, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee150() {
        var _yield$this$dfpProtec33, dfp_telemetry_id, captcha_token, requestBody;
        return _regenerator().w(function (_context150) {
          while (1) switch (_context150.n) {
            case 0:
              validate('stytch.otps.sms.authenticate').isNumber('session_duration_minutes', data.session_duration_minutes).isString('organization_id', data.organization_id).isString('member_id', data.member_id).isString('code', data.code).isOptionalString('set_mfa_enrollment', data.set_mfa_enrollment);
              _context150.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec33 = _context150.v;
              dfp_telemetry_id = _yield$this$dfpProtec33.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec33.captcha_token;
              requestBody = Object.assign(Object.assign({}, data), {
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token,
                intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
              });
              return _context150.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/otps/sms/authenticate',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee150, this);
      }));
    })
  };
  this.email = {
    loginOrSignup: function loginOrSignup(data) {
      return __awaiter$1(_this30, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee151() {
        var _yield$this$dfpProtec34, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context151) {
          while (1) switch (_context151.n) {
            case 0:
              validate('stytch.otps.email.loginOrSignup').isString('organization_id', data.organization_id).isString('email_address', data.email_address).isOptionalString('login_template_id', data.login_template_id).isOptionalString('signup_template_id', data.signup_template_id).isOptionalString('locale', data.locale).isOptionalNumber('login_expiration_minutes', data.login_expiration_minutes).isOptionalNumber('signup_expiration_minutes', data.signup_expiration_minutes);
              _context151.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec34 = _context151.v;
              dfp_telemetry_id = _yield$this$dfpProtec34.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec34.captcha_token;
              return _context151.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/otps/email/login_or_signup',
                body: Object.assign(Object.assign({}, data), {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }),
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee151, this);
      }));
    },
    authenticate: this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this30, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee152() {
        var _yield$this$dfpProtec35, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context152) {
          while (1) switch (_context152.n) {
            case 0:
              validate('stytch.otps.email.authenticate').isString('code', data.code).isString('email_address', data.email_address).isString('organization_id', data.organization_id).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              _context152.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec35 = _context152.v;
              dfp_telemetry_id = _yield$this$dfpProtec35.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec35.captcha_token;
              return _context152.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/otps/email/authenticate',
                body: Object.assign(Object.assign({}, data), {
                  intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }),
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee152, this);
      }));
    }),
    discovery: {
      send: function send(data) {
        return __awaiter$1(_this30, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee153() {
          var _yield$this$dfpProtec36, dfp_telemetry_id, captcha_token, requestBody;
          return _regenerator().w(function (_context153) {
            while (1) switch (_context153.n) {
              case 0:
                validate('stytch.otps.email.discovery.send').isString('email_address', data.email_address).isOptionalString('login_template_id', data.login_template_id).isOptionalString('locale', data.locale).isOptionalNumber('discovery_expiration_minutes', data.discovery_expiration_minutes);
                _context153.n = 1;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 1:
                _yield$this$dfpProtec36 = _context153.v;
                dfp_telemetry_id = _yield$this$dfpProtec36.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec36.captcha_token;
                requestBody = Object.assign(Object.assign({}, data), {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                });
                return _context153.a(2, this._networkClient.retriableFetchSDK({
                  url: '/b2b/otps/email/discovery/send',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
            }
          }, _callee153, this);
        }));
      },
      authenticate: this._subscriptionService.withUpdateSession(function (data) {
        return __awaiter$1(_this30, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee154() {
          var _yield$this$dfpProtec37, dfp_telemetry_id, captcha_token, requestBody;
          return _regenerator().w(function (_context154) {
            while (1) switch (_context154.n) {
              case 0:
                validate('stytch.otps.email.discovery.authenticate').isString('code', data.code).isString('email_address', data.email_address);
                _context154.n = 1;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 1:
                _yield$this$dfpProtec37 = _context154.v;
                dfp_telemetry_id = _yield$this$dfpProtec37.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec37.captcha_token;
                requestBody = Object.assign({
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }, data);
                return _context154.a(2, this._networkClient.retriableFetchSDK({
                  url: '/b2b/otps/email/discovery/authenticate',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
            }
          }, _callee154, this);
        }));
      })
    }
  };
});
var HeadlessB2BTOTPsClient = /*#__PURE__*/function () {
  function HeadlessB2BTOTPsClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    var _this31 = this;
    _classCallCheck(this, HeadlessB2BTOTPsClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.authenticate = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this31, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee155() {
        var _yield$this$dfpProtec38, dfp_telemetry_id, captcha_token, requestBody;
        return _regenerator().w(function (_context155) {
          while (1) switch (_context155.n) {
            case 0:
              validate('stytch.totp.authenticate').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isString('code', data.code).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('set_mfa_enrollment', data.set_mfa_enrollment).isOptionalBoolean('set_default_mfa', data.set_default_mfa);
              _context155.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec38 = _context155.v;
              dfp_telemetry_id = _yield$this$dfpProtec38.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec38.captcha_token;
              requestBody = Object.assign(Object.assign({}, data), {
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token,
                intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
              });
              return _context155.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/totp/authenticate',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee155, this);
      }));
    });
  }
  return _createClass(HeadlessB2BTOTPsClient, [{
    key: "create",
    value: function create(data) {
      var _a;
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee156() {
        var _yield$this$dfpProtec39, dfp_telemetry_id, captcha_token, response, _t47, _t48, _t49, _t50, _t51, _t52, _t53, _t54, _t55;
        return _regenerator().w(function (_context156) {
          while (1) switch (_context156.n) {
            case 0:
              validate('stytch.totp.create').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isOptionalNumber('expiration_minutes', data.expiration_minutes);
              _context156.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec39 = _context156.v;
              dfp_telemetry_id = _yield$this$dfpProtec39.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec39.captcha_token;
              _t47 = this._networkClient;
              _t48 = Object;
              _t49 = Object.assign({}, data);
              _t50 = dfp_telemetry_id;
              _t51 = captcha_token;
              _context156.n = 2;
              return this._subscriptionService.getIntermediateSessionToken();
            case 2:
              _t52 = _context156.v;
              if (_t52) {
                _context156.n = 3;
                break;
              }
              _t52 = undefined;
            case 3:
              _t53 = _t52;
              _t54 = _t48.assign.call(_t48, _t49, {
                dfp_telemetry_id: _t50,
                captcha_token: _t51,
                intermediate_session_token: _t53
              });
              _t55 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context156.n = 4;
              return _t47.retriableFetchSDK.call(_t47, {
                url: '/b2b/totp',
                body: _t54,
                method: 'POST',
                retryCallback: _t55
              });
            case 4:
              response = _context156.v;
              if (response.member_id === ((_a = this._subscriptionService.getMember()) === null || _a === void 0 ? void 0 : _a.member_id)) {
                this._subscriptionService.updateMember(response.member);
              }
              return _context156.a(2, response);
          }
        }, _callee156, this);
      }));
    }
  }]);
}();
var HeadlessB2BRecoveryCodesClient = /*#__PURE__*/function () {
  function HeadlessB2BRecoveryCodesClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    var _this32 = this;
    _classCallCheck(this, HeadlessB2BRecoveryCodesClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.recover = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this32, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee157() {
        var _yield$this$dfpProtec40, dfp_telemetry_id, captcha_token, requestBody;
        return _regenerator().w(function (_context157) {
          while (1) switch (_context157.n) {
            case 0:
              validate('stytch.recoveryCodes.recover').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isString('recovery_code', data.recovery_code).isNumber('session_duration_minutes', data.session_duration_minutes);
              _context157.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec40 = _context157.v;
              dfp_telemetry_id = _yield$this$dfpProtec40.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec40.captcha_token;
              requestBody = Object.assign(Object.assign({}, data), {
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token,
                intermediate_session_token: this._subscriptionService.getIntermediateSessionToken() || undefined
              });
              return _context157.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/recovery_codes/recover',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee157, this);
      }));
    });
  }
  return _createClass(HeadlessB2BRecoveryCodesClient, [{
    key: "rotate",
    value: function rotate() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee158() {
        var _yield$this$dfpProtec41, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context158) {
          while (1) switch (_context158.n) {
            case 0:
              _context158.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec41 = _context158.v;
              dfp_telemetry_id = _yield$this$dfpProtec41.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec41.captcha_token;
              return _context158.a(2, this._networkClient.retriableFetchSDK({
                url: '/b2b/recovery_codes/rotate',
                body: {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee158, this);
      }));
    }
  }, {
    key: "get",
    value: function get() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee159() {
        return _regenerator().w(function (_context159) {
          while (1) switch (_context159.n) {
            case 0:
              return _context159.a(2, this._networkClient.fetchSDK({
                url: '/b2b/recovery_codes',
                method: 'GET'
              }));
          }
        }, _callee159, this);
      }));
    }
  }]);
}();
var HeadlessB2BRBACClient = /*#__PURE__*/function () {
  function HeadlessB2BRBACClient(cachedConfig, dynamicConfig, _subscriptionService) {
    var _this33 = this;
    _classCallCheck(this, HeadlessB2BRBACClient);
    this._subscriptionService = _subscriptionService;
    this.isAuthorizedSync = function (resourceId, action) {
      var effectivePolicy = _this33.getEffectivePolicySync();
      return !!(effectivePolicy === null || effectivePolicy === void 0 ? void 0 : effectivePolicy.callerIsAuthorized(_this33.roleIds(), resourceId, action));
    };
    this.isAuthorized = function (resourceId, action) {
      return _this33.getEffectivePolicy().then(function (policy) {
        return policy.callerIsAuthorized(_this33.roleIds(), resourceId, action);
      });
    };
    this.cachedPolicy = cachedConfig.rbacPolicy ? RBACPolicy.fromJSON(cachedConfig.rbacPolicy) : null;
    this.policyPromise = dynamicConfig.then(function (data) {
      if (!data.rbacPolicy) {
        logger.error('Unable to retrieve RBAC policy from servers. Assuming caller has no permissions.');
        return new RBACPolicy([], []);
      }
      _this33.cachedPolicy = RBACPolicy.fromJSON(data.rbacPolicy);
      return _this33.cachedPolicy;
    });
  }
  return _createClass(HeadlessB2BRBACClient, [{
    key: "getEffectivePolicy",
    value: function getEffectivePolicy() {
      var _a;
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee160() {
        var projectPolicy, organization;
        return _regenerator().w(function (_context160) {
          while (1) switch (_context160.n) {
            case 0:
              _context160.n = 1;
              return this.policyPromise;
            case 1:
              projectPolicy = _context160.v;
              organization = this._subscriptionService.getOrganization();
              if ((_a = organization === null || organization === void 0 ? void 0 : organization.custom_roles) === null || _a === void 0 ? void 0 : _a.length) {
                _context160.n = 2;
                break;
              }
              return _context160.a(2, projectPolicy);
            case 2:
              return _context160.a(2, projectPolicy.mergeWithCustomRoles(organization.custom_roles));
          }
        }, _callee160, this);
      }));
    }
  }, {
    key: "getEffectivePolicySync",
    value: function getEffectivePolicySync() {
      var _a;
      if (!this.cachedPolicy) {
        return null;
      }
      var organization = this._subscriptionService.getOrganization();
      if (!((_a = organization === null || organization === void 0 ? void 0 : organization.custom_roles) === null || _a === void 0 ? void 0 : _a.length)) {
        return this.cachedPolicy;
      }
      return this.cachedPolicy.mergeWithCustomRoles(organization.custom_roles);
    }
  }, {
    key: "allPermissions",
    value: function allPermissions() {
      var _this34 = this;
      return this.getEffectivePolicy().then(function (policy) {
        return policy.allPermissionsForCaller(_this34.roleIds());
      });
    }
  }, {
    key: "roleIds",
    value: function roleIds() {
      var _a;
      var session = this._subscriptionService.getSession();
      if (!session) {
        return [];
      }
      return (_a = session.roles) !== null && _a !== void 0 ? _a : [];
    }
  }]);
}();
var HeadlessB2BImpersonationClient = /*#__PURE__*/_createClass(function HeadlessB2BImpersonationClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
  var _this35 = this;
  _classCallCheck(this, HeadlessB2BImpersonationClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.authenticate = this._subscriptionService.withUpdateSession(function (data) {
    return __awaiter$1(_this35, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee161() {
      var _yield$this$dfpProtec42, dfp_telemetry_id, captcha_token;
      return _regenerator().w(function (_context161) {
        while (1) switch (_context161.n) {
          case 0:
            validate('stytch.impersonation.authenticate').isString('impersonation_token', data.impersonation_token);
            _context161.n = 1;
            return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
          case 1:
            _yield$this$dfpProtec42 = _context161.v;
            dfp_telemetry_id = _yield$this$dfpProtec42.dfp_telemetry_id;
            captcha_token = _yield$this$dfpProtec42.captcha_token;
            return _context161.a(2, this._networkClient.retriableFetchSDK({
              url: '/b2b/impersonation/authenticate',
              body: Object.assign(Object.assign({}, data), {
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token
              }),
              method: 'POST',
              retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
            }));
        }
      }, _callee161, this);
    }));
  });
});
var HeadlessB2BIDPClient = /*#__PURE__*/_createClass(function HeadlessB2BIDPClient(_networkClient) {
  var _this36 = this;
  _classCallCheck(this, HeadlessB2BIDPClient);
  this._networkClient = _networkClient;
  this.oauthAuthorizeStart = function (data) {
    return __awaiter$1(_this36, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee162() {
      return _regenerator().w(function (_context162) {
        while (1) switch (_context162.n) {
          case 0:
            return _context162.a(2, this._networkClient.fetchSDK({
              url: '/idp/b2b/oauth/authorize/start',
              method: 'POST',
              body: data
            }));
        }
      }, _callee162, this);
    }));
  };
  this.oauthAuthorizeSubmit = function (data) {
    return __awaiter$1(_this36, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee163() {
      return _regenerator().w(function (_context163) {
        while (1) switch (_context163.n) {
          case 0:
            return _context163.a(2, this._networkClient.fetchSDK({
              url: '/idp/b2b/oauth/authorize/submit',
              method: 'POST',
              body: data
            }));
        }
      }, _callee163, this);
    }));
  };
  this.oauthLogoutStart = function (data) {
    return __awaiter$1(_this36, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee164() {
      return _regenerator().w(function (_context164) {
        while (1) switch (_context164.n) {
          case 0:
            return _context164.a(2, this._networkClient.fetchSDK({
              url: "/b2b/oauth/logout/start",
              method: 'POST',
              body: data
            }));
        }
      }, _callee164, this);
    }));
  };
});
var IframeHostClient = /*#__PURE__*/function () {
  function IframeHostClient(iframeURL) {
    _classCallCheck(this, IframeHostClient);
    this.iframeURL = iframeURL;
    this.createIframe();
  }
  return _createClass(IframeHostClient, [{
    key: "createIframe",
    value: function createIframe() {
      var existingIframe = document.querySelector("[src~=\"".concat(this.iframeURL, "\"]"));
      if (!existingIframe) {
        existingIframe = document.createElement('iframe');
        existingIframe.src = this.iframeURL;
        existingIframe.style.position = 'absolute';
        existingIframe.style.width = '0';
        existingIframe.style.height = '0';
        existingIframe.style.border = '0';
        document.body.appendChild(existingIframe);
      } else {
        logger.warn(MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING);
      }
      if (existingIframe.dataset.loaded === 'true') {
        this.frame = Promise.resolve(existingIframe);
        return;
      }
      this.frame = new Promise(function (resolve) {
        existingIframe.addEventListener('load', function () {
          existingIframe.dataset.loaded = 'true';
          resolve(existingIframe);
        }, {
          once: true
        });
      });
    }
  }, {
    key: "call",
    value: function call(method, args) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee165() {
        var _this37 = this;
        var frame, channel;
        return _regenerator().w(function (_context165) {
          while (1) switch (_context165.n) {
            case 0:
              _context165.n = 1;
              return this.frame;
            case 1:
              frame = _context165.v;
              channel = new MessageChannel();
              return _context165.a(2, new Promise(function (resolve, reject) {
                var _a;
                channel.port1.onmessage = function (event) {
                  var resp = event.data;
                  channel.port1.close();
                  if (resp.success) {
                    resolve(resp.payload);
                  } else {
                    reject(ErrorMarshaller.unmarshall(resp.error));
                  }
                };
                var message = {
                  method: method,
                  args: args
                };
                (_a = frame.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(message, _this37.iframeURL, [channel.port2]);
              }));
          }
        }, _callee165, this);
      }));
    }
  }]);
}();
var SearchDataManager = /*#__PURE__*/function () {
  function SearchDataManager(_networkClient, dfpProtectedAuth) {
    _classCallCheck(this, SearchDataManager);
    this._networkClient = _networkClient;
    this.dfpProtectedAuth = dfpProtectedAuth;
  }
  return _createClass(SearchDataManager, [{
    key: "searchUser",
    value: function searchUser(email) {
      var _this38 = this;
      return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha().then(function (_ref0) {
        var dfp_telemetry_id = _ref0.dfp_telemetry_id,
          captcha_token = _ref0.captcha_token;
        return _this38._networkClient.fetchSDK({
          url: "/users/search",
          method: 'POST',
          body: {
            email: email,
            dfp_telemetry_id: dfp_telemetry_id,
            captcha_token: captcha_token
          }
        });
      });
    }
  }, {
    key: "searchMember",
    value: function searchMember(email, organization_id) {
      return this._networkClient.fetchSDK({
        url: "/b2b/organizations/members/search",
        method: 'POST',
        body: {
          email_address: email,
          organization_id: organization_id
        }
      });
    }
  }]);
}();
var shouldTryRefresh = function shouldTryRefresh(state) {
  return !!(state === null || state === void 0 ? void 0 : state.session);
};
var SessionManagerRegistry = /*#__PURE__*/function () {
  function SessionManagerRegistry() {
    _classCallCheck(this, SessionManagerRegistry);
    this.hasWarned = false;
    this.registry = new Map();
  }
  return _createClass(SessionManagerRegistry, [{
    key: "register",
    value: function register(key, sessionManager) {
      var otherManager = this.registry.get(key);
      if (otherManager && otherManager !== sessionManager) {
        if (!this.hasWarned) {
          logger.warn(MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING);
          this.hasWarned = true;
        }
        otherManager.cancelBackgroundRefresh();
      }
      this.registry.set(key, sessionManager);
    }
  }, {
    key: "unregister",
    value: function unregister(publicToken, sessionManager) {
      var otherManager = this.registry.get(publicToken);
      if (otherManager && otherManager === sessionManager) {
        this.registry["delete"](publicToken);
      }
    }
  }]);
}();
var SessionManager = /*#__PURE__*/function () {
  function SessionManager(_subscriptionService, _headlessSessionClient, _publicToken, _options) {
    var _this39 = this;
    _classCallCheck(this, SessionManager);
    this._subscriptionService = _subscriptionService;
    this._headlessSessionClient = _headlessSessionClient;
    this._publicToken = _publicToken;
    this._options = _options;
    this.timeout = null;
    this._onDataChange = function (state) {
      if (state != null && state.sessionDurationMinutes) {
        _this39.lastAuthenticationSessionDuration = state.sessionDurationMinutes;
      }
      if (shouldTryRefresh(state)) {
        _this39.scheduleBackgroundRefresh();
      } else {
        _this39.cancelBackgroundRefresh();
      }
    };
    this._reauthenticateWithBackoff = function () {
      return __awaiter$1(_this39, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee166() {
        var count, options, _t56;
        return _regenerator().w(function (_context166) {
          while (1) switch (_context166.p = _context166.n) {
            case 0:
              count = 0;
            case 1:
              _context166.p = 2;
              options = {
                session_duration_minutes: this._options.keepSessionAlive ? this.lastAuthenticationSessionDuration : undefined
              };
              _context166.n = 3;
              return this._headlessSessionClient.authenticate(options);
            case 3:
              return _context166.a(2, _context166.v);
            case 4:
              _context166.p = 4;
              _t56 = _context166.v;
              if (!SessionManager.isUnrecoverableError(_t56)) {
                _context166.n = 5;
                break;
              }
              return _context166.a(2, Promise.reject(_t56));
            case 5:
              count++;
              _context166.n = 6;
              return new Promise(function (done) {
                return setTimeout(done, SessionManager.timeoutForAttempt(count));
              });
            case 6:
              _context166.n = 1;
              break;
            case 7:
              return _context166.a(2);
          }
        }, _callee166, this, [[2, 4]]);
      }));
    };
    this._subscriptionService.subscribeToState(this._onDataChange);
  }
  return _createClass(SessionManager, [{
    key: "register",
    value: function register() {
      SessionManager.registry.register(this._publicToken, this);
    }
  }, {
    key: "unregister",
    value: function unregister() {
      SessionManager.registry.unregister(this._publicToken, this);
    }
  }, {
    key: "performBackgroundRefresh",
    value: function performBackgroundRefresh() {
      var _this40 = this;
      this._reauthenticateWithBackoff().then(function () {
        _this40.scheduleBackgroundRefresh();
      })["catch"](function (error) {
        logger.warn('Session background refresh failed. Signalling to app that user is logged out.', {
          error: error
        });
        _this40._subscriptionService.destroySession();
      });
    }
  }, {
    key: "scheduleBackgroundRefresh",
    value: function scheduleBackgroundRefresh() {
      var _this41 = this;
      this.cancelBackgroundRefresh();
      this.register();
      this.timeout = setTimeout(function () {
        _this41.performBackgroundRefresh();
      }, SessionManager.REFRESH_INTERVAL_MS);
    }
  }, {
    key: "cancelBackgroundRefresh",
    value: function cancelBackgroundRefresh() {
      if (this.timeout !== null) {
        this.unregister();
        clearTimeout(this.timeout);
        this.timeout = null;
      }
    }
  }], [{
    key: "timeoutForAttempt",
    value: function timeoutForAttempt(count) {
      count = Math.min(count, 7);
      var jitter = Math.floor(Math.random() * 350) - 175;
      var delayMS = 2000 * Math.pow(2, count);
      return jitter + delayMS;
    }
  }, {
    key: "isUnrecoverableError",
    value: function isUnrecoverableError(error) {
      return UNRECOVERABLE_ERROR_TYPES.includes(error.error_type);
    }
  }]);
}();
SessionManager.REFRESH_INTERVAL_MS = 1000 * 60 * 3;
SessionManager.registry = new SessionManagerRegistry();
var StateChangeClient = /*#__PURE__*/_createClass(function StateChangeClient(_subscriptionService, emptyState) {
  var _this42 = this;
  _classCallCheck(this, StateChangeClient);
  this._subscriptionService = _subscriptionService;
  this.emptyState = emptyState;
  this.onStateChange = function (callback) {
    return _this42._subscriptionService.subscribeToState(function (state) {
      callback(state !== null && state !== void 0 ? state : _this42.emptyState);
    });
  };
});
var VERTICAL_CONSUMER = 'CONSUMER';
var createDeepEqual = function createDeepEqual() {
  var _ref1 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
    _ref1$KEYS_TO_EXCLUDE = _ref1.KEYS_TO_EXCLUDE,
    KEYS_TO_EXCLUDE = _ref1$KEYS_TO_EXCLUDE === void 0 ? [] : _ref1$KEYS_TO_EXCLUDE;
  var _deepEqual = function deepEqual(a, b) {
    if (_typeof(a) !== _typeof(b)) return false;
    if (a === null || b === null) return a === b;
    if (_typeof(a) === 'object') {
      if (Object.keys(a).length !== Object.keys(b).length || Object.keys(a).some(function (k) {
        return !(k in b);
      })) return false;
      return Object.entries(a).filter(function (_ref10) {
        var _ref11 = _slicedToArray(_ref10, 1),
          k = _ref11[0];
        return !KEYS_TO_EXCLUDE.includes(k);
      }).every(function (_ref12) {
        var _ref13 = _slicedToArray(_ref12, 2),
          k = _ref13[0],
          v = _ref13[1];
        return _deepEqual(v, b[k]);
      });
    }
    return a === b;
  };
  return _deepEqual;
};
function __rest(s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}
function __awaiter(thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
  var e = new Error(message);
  return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};
var EMAIL_REGEX = /^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
var debounce = function debounce(func) {
  var waitFor = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;
  var timeout;
  var debounced = function debounced() {
    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      args[_key4] = arguments[_key4];
    }
    clearTimeout(timeout);
    timeout = setTimeout(function () {
      return func.apply(void 0, args);
    }, waitFor);
  };
  return debounced;
};
var isLocalhost = function isLocalhost() {
  return Boolean(window.location.hostname === 'localhost' || window.location.hostname === '[::1]' || window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));
};
var hasMultipleCookies = function hasMultipleCookies(cookieName) {
  var cookiePairs = document.cookie ? document.cookie.split('; ') : [];
  var matchedCookies = cookiePairs.filter(function (pair) {
    var _pair$split = pair.split('='),
      _pair$split2 = _slicedToArray2(_pair$split, 1),
      name = _pair$split2[0];
    return cookieName === name;
  });
  return matchedCookies.length > 1;
};
var PERSISTENT_STORAGE_KEY_PREFIX = 'stytch_sdk_state_';
var getPersistentStorageKey = function getPersistentStorageKey(publicToken, key) {
  return "".concat(PERSISTENT_STORAGE_KEY_PREFIX).concat(publicToken).concat(key ? "::".concat(key) : '');
};
function makeSafeStorage(storage) {
  if (storage == null) {
    return {
      getItem: function getItem() {
        return null;
      },
      removeItem: function removeItem() {},
      setItem: function setItem() {}
    };
  }
  return {
    getItem: function getItem(publicKey, key) {
      var persistentStorageKey = getPersistentStorageKey(publicKey, key);
      try {
        return storage.getItem(persistentStorageKey);
      } catch (_a) {
        return null;
      }
    },
    setItem: function setItem(publicKey, key, value) {
      var persistentStorageKey = getPersistentStorageKey(publicKey, key);
      try {
        if (value) storage.setItem(persistentStorageKey, value);
      } catch (_a) {}
    },
    removeItem: function removeItem(publicKey, key) {
      var persistentStorageKey = getPersistentStorageKey(publicKey, key);
      try {
        storage.removeItem(persistentStorageKey);
      } catch (_a) {}
    }
  };
}
var safeLocalStorage = makeSafeStorage(globalThis.localStorage);
var safeSessionStorage = makeSafeStorage(globalThis.sessionStorage);
function getKeyBoundStorage(storage, publicToken) {
  return {
    getItem: function getItem(key) {
      return storage.getItem(publicToken, key);
    },
    setItem: function setItem(key, value) {
      storage.setItem(publicToken, key, value);
    },
    removeItem: function removeItem(key) {
      storage.removeItem(publicToken, key);
    }
  };
}
var internalSymB2B = Symbol["for"]('stytch__internal_b2b');
var writeB2BInternals = function writeB2BInternals(obj, internals) {
  Object.assign(obj, _defineProperty({}, internalSymB2B, internals));
};
var readB2BInternals = function readB2BInternals(obj) {
  var casted = obj;
  if (!casted[internalSymB2B]) {
    throw Error('Internals not found!');
  }
  return casted[internalSymB2B];
};
export { NoBiometricsRegistrationError as $, AuthFlowType as A, B2BMFAProducts as B, COUNTRIES_LIST as C, DEFAULT_SESSION_DURATION_MINUTES as D, EMAIL_REGEX as E, FailedCodeChallengeError as F, InvalidRedirectSchemeError as G, InvalidStartUrlError as H, IDPOAuthFlowMissingParamError as I, JSONDataNotConvertibleToStringError as J, KeyInvalidatedError as K, KeystoreUnavailableError as L, MissingAttestationObjectError as M, NoCurrentSessionError as N, OAuthProviders as O, Products as P, MissingAuthorizationCredentialIDTokenError as Q, RedirectURLType as R, StytchEventType as S, MissingCipherIv as T, MissingGoogleClientIDError as U, MissingPKCEError as V, Wallets as W, MissingPublicKeyError as X, MissingUrlError as Y, NoBiometricsEnrolledError as Z, __rest as _, B2BProducts as a, SessionManager as a$, NoCredentialsPresentError as a0, PasskeysInvalidEncoding as a1, PasskeysMisconfigured as a2, PasskeysUnsupportedError as a3, RNUIProducts as a4, RandomNumberGenerationFailed as a5, SDKAPIUnreachableError as a6, SDKNotConfiguredError as a7, SignInWithAppleMisconfigured as a8, StytchAPISchemaError as a9, HeadlessB2BOAuthClient$1 as aA, DisabledDFPProtectedAuthProvider as aB, GOOGLE_ONE_TAP_HOST as aC, GOOGLE_ONE_TAP_SCRIPT_URL as aD, getTestApiURL as aE, getLiveApiURL as aF, getDFPBackendURL as aG, getDFPCdnURL as aH, CLIENTSIDE_SERVICES_IFRAME_URL as aI, validate as aJ, checkPublicToken as aK, StateChangeClient as aL, DFPProtectedAuthProvider as aM, HeadlessB2BOrganizationClient as aN, HeadlessB2BSelfClient as aO, HeadlessB2BSessionClient as aP, HeadlessB2BMagicLinksClient as aQ, HeadlessB2BSSOClient as aR, HeadlessB2BDiscoveryClient as aS, HeadlessB2BPasswordsClient as aT, HeadlessB2BOTPsClient as aU, HeadlessB2BTOTPsClient as aV, HeadlessB2BRecoveryCodesClient as aW, HeadlessB2BRBACClient as aX, HeadlessB2BSCIMClient as aY, HeadlessB2BImpersonationClient as aZ, HeadlessB2BIDPClient as a_, StytchAPIUnreachableError as aa, StytchError as ab, StytchSDKAPIError as ac, StytchSDKSchemaError as ad, StytchSDKUsageError as ae, UNRECOVERABLE_ERROR_TYPES as af, UserCancellationError as ag, UserLockedOutError as ah, errorToStytchError as ai, createDeepEqual as aj, loadESModule as ak, IframeHostClient as al, EventLogger as am, DEFAULT_MAX_BATCH_SIZE as an, DEFAULT_INTERVAL_DURATION_MS as ao, createEventId as ap, createAppSessionId as aq, createPersistentId as ar, baseFetchSDK as as, baseSubmitFormSDK as at, retriableFetchSDK as au, getPersistentStorageKey as av, getKeyBoundStorage as aw, hasMultipleCookies as ax, isLocalhost as ay, safeSessionStorage as az, OTPMethods as b, SearchDataManager as b0, VERTICAL_CONSUMER as b1, writeB2BInternals as b2, B2BOAuthProviders as c, __awaiter as d, OneTapPositions as e, arrayUtils as f, debounce as g, StytchSDKError as h, isTestPublicToken as i, StytchAPIError as j, checkB2BNotSSR as k, logger as l, BiometricRegistrationIdIsNullOrBlank as m, BiometricsAlreadyEnrolledError as n, BiometricsFailedError as o, BiometricsUnavailableError as p, ChallengeSigningFailedError as q, readB2BInternals as r, safeLocalStorage as s, DFPNotConfigured as t, DeviceCredentialsNotAllowedError as u, FailedToDecryptDataError as v, InternalError as w, InvalidAuthorizationCredentialError as x, InvalidCredentialTypeError as y, InvalidPrivateKeyLength as z };
//# sourceMappingURL=internal-xYwHZs2R.js.map
