'use strict';
function _defineProperty(e, r, t) { return (r = _toPropertyKey2(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _slicedToArray2(r, e) { return _arrayWithHoles2(r) || _iterableToArrayLimit2(r, e) || _unsupportedIterableToArray2(r, e) || _nonIterableRest2(); }
function _nonIterableRest2() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArrayLimit2(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles2(r) { if (Array.isArray(r)) return r; }
function _toConsumableArray2(r) { return _arrayWithoutHoles2(r) || _iterableToArray2(r) || _unsupportedIterableToArray2(r) || _nonIterableSpread2(); }
function _nonIterableSpread2() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray2(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray2(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray2(r, a) : void 0; } }
function _iterableToArray2(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function _arrayWithoutHoles2(r) { if (Array.isArray(r)) return _arrayLikeToArray2(r); }
function _arrayLikeToArray2(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _callSuper2(t, o, e) { return o = _getPrototypeOf2(o), _possibleConstructorReturn2(t, _isNativeReflectConstruct2() ? Reflect.construct(o, e || [], _getPrototypeOf2(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn2(t, e) { if (e && ("object" == _typeof2(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized2(t); }
function _assertThisInitialized2(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _isNativeReflectConstruct2() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct2 = function _isNativeReflectConstruct2() { return !!t; })(); }
function _getPrototypeOf2(t) { return _getPrototypeOf2 = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf2(t); }
function _inherits2(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf2(t, e); }
function _setPrototypeOf2(t, e) { return _setPrototypeOf2 = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf2(t, e); }
function _regenerator2() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine4(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine4(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine4(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine4(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine4(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine4(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine4(u), _regeneratorDefine4(u, o, "Generator"), _regeneratorDefine4(u, n, function () { return this; }), _regeneratorDefine4(u, "toString", function () { return "[object Generator]"; }), (_regenerator2 = function _regenerator2() { return { w: i, m: f }; })(); }
function _regeneratorDefine4(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine4 = function _regeneratorDefine3(e, r, n, t) { function o(r, n) { _regeneratorDefine4(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine4(e, r, n, t); }
function _typeof2(o) { "@babel/helpers - typeof"; return _typeof2 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof2(o); }
function _classCallCheck2(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function __defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey2(o.key), o); } }
function _createClass2(e, r, t) { return r && __defineProperties(e.prototype, r), t && __defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey2(t) { var i = _toPrimitive2(t, "string"); return "symbol" == _typeof2(i) ? i : i + ""; }
function _toPrimitive2(t, r) { if ("object" != _typeof2(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof2(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function __rest$1(s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}
function __awaiter$1(thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, [])).next());
  });
}
typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
  var e = new Error(message);
  return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};
function _typeof$1(o) {
  "@babel/helpers - typeof";

  return _typeof$1 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
    return typeof o;
  } : function (o) {
    return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
  }, _typeof$1(o);
}
function _defineProperties$1(e, r) {
  for (var t = 0; t < r.length; t++) {
    var o = r[t];
    o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey$1(o.key), o);
  }
}
function _createClass$1(e, r, t) {
  return r && _defineProperties$1(e.prototype, r), t && _defineProperties$1(e, t), Object.defineProperty(e, "prototype", {
    writable: !1
  }), e;
}
function _toPropertyKey$1(t) {
  var i = _toPrimitive$1(t, "string");
  return "symbol" == _typeof$1(i) ? i : i + "";
}
function _toPrimitive$1(t, r) {
  if ("object" != _typeof$1(t) || !t) return t;
  var e = t[Symbol.toPrimitive];
  if (void 0 !== e) {
    var i = e.call(t, r);
    if ("object" != _typeof$1(i)) return i;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return String(t);
}
function _classCallCheck$1(a, n) {
  if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function");
}
function _callSuper$1(t, o, e) {
  return o = _getPrototypeOf$1(o), _possibleConstructorReturn$1(t, _isNativeReflectConstruct$1() ? Reflect.construct(o, e || [], _getPrototypeOf$1(t).constructor) : o.apply(t, e));
}
function _possibleConstructorReturn$1(t, e) {
  if (e && ("object" == _typeof$1(e) || "function" == typeof e)) return e;
  if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined");
  return _assertThisInitialized$1(t);
}
function _assertThisInitialized$1(e) {
  if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  return e;
}
function _inherits$1(t, e) {
  if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function");
  t.prototype = Object.create(e && e.prototype, {
    constructor: {
      value: t,
      writable: !0,
      configurable: !0
    }
  }), Object.defineProperty(t, "prototype", {
    writable: !1
  }), e && _setPrototypeOf$1(t, e);
}
function _wrapNativeSuper$1(t) {
  var r = "function" == typeof Map ? new Map() : void 0;
  return _wrapNativeSuper$1 = function _wrapNativeSuper(t) {
    if (null === t || !_isNativeFunction$1(t)) return t;
    if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function");
    if (void 0 !== r) {
      if (r.has(t)) return r.get(t);
      r.set(t, Wrapper);
    }
    function Wrapper() {
      return _construct$1(t, arguments, _getPrototypeOf$1(this).constructor);
    }
    return Wrapper.prototype = Object.create(t.prototype, {
      constructor: {
        value: Wrapper,
        enumerable: !1,
        writable: !0,
        configurable: !0
      }
    }), _setPrototypeOf$1(Wrapper, t);
  }, _wrapNativeSuper$1(t);
}
function _construct$1(t, e, r) {
  if (_isNativeReflectConstruct$1()) return Reflect.construct.apply(null, arguments);
  var o = [null];
  o.push.apply(o, e);
  var p = new (t.bind.apply(t, o))();
  return r && _setPrototypeOf$1(p, r.prototype), p;
}
function _isNativeReflectConstruct$1() {
  try {
    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
  } catch (t) {}
  return (_isNativeReflectConstruct$1 = function _isNativeReflectConstruct() {
    return !!t;
  })();
}
function _isNativeFunction$1(t) {
  try {
    return -1 !== Function.toString.call(t).indexOf("[native code]");
  } catch (n) {
    return "function" == typeof t;
  }
}
function _setPrototypeOf$1(t, e) {
  return _setPrototypeOf$1 = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {
    return t.__proto__ = e, t;
  }, _setPrototypeOf$1(t, e);
}
function _getPrototypeOf$1(t) {
  return _getPrototypeOf$1 = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {
    return t.__proto__ || Object.getPrototypeOf(t);
  }, _getPrototypeOf$1(t);
}
exports.Products = void 0;
(function (Products) {
  Products["emailMagicLinks"] = "emailMagicLinks";
  Products["oauth"] = "oauth";
  Products["otp"] = "otp";
  Products["crypto"] = "crypto";
  Products["passwords"] = "passwords";
  Products["passkeys"] = "passkeys";
})(exports.Products || (exports.Products = {}));
exports.OAuthProviders = void 0;
(function (OAuthProviders) {
  OAuthProviders["Google"] = "google";
  OAuthProviders["Microsoft"] = "microsoft";
  OAuthProviders["Apple"] = "apple";
  OAuthProviders["Github"] = "github";
  OAuthProviders["GitLab"] = "gitlab";
  OAuthProviders["Facebook"] = "facebook";
  OAuthProviders["Discord"] = "discord";
  OAuthProviders["Salesforce"] = "salesforce";
  OAuthProviders["Slack"] = "slack";
  OAuthProviders["Amazon"] = "amazon";
  OAuthProviders["Bitbucket"] = "bitbucket";
  OAuthProviders["LinkedIn"] = "linkedin";
  OAuthProviders["Coinbase"] = "coinbase";
  OAuthProviders["Twitch"] = "twitch";
  OAuthProviders["Twitter"] = "twitter";
  OAuthProviders["TikTok"] = "tiktok";
  OAuthProviders["Snapchat"] = "snapchat";
  OAuthProviders["Figma"] = "figma";
  OAuthProviders["Yahoo"] = "yahoo";
})(exports.OAuthProviders || (exports.OAuthProviders = {}));
exports.Wallets = void 0;
(function (Wallets) {
  Wallets["Vessel"] = "Vessel";
  Wallets["Phantom"] = "Phantom";
  Wallets["Metamask"] = "Metamask";
  Wallets["Coinbase"] = "Coinbase";
  Wallets["Binance"] = "Binance";
  Wallets["GenericEthereumWallet"] = "Other Ethereum Wallet";
  Wallets["GenericSolanaWallet"] = "Other Solana Wallet";
})(exports.Wallets || (exports.Wallets = {}));
exports.OneTapPositions = void 0;
(function (OneTapPositions) {
  OneTapPositions["embedded"] = "embedded";
  OneTapPositions["floating"] = "floating";
  OneTapPositions["embeddedOnly"] = "embeddedOnly";
  OneTapPositions["floatingOrEmbedded"] = "floatingOrEmbedded";
  OneTapPositions["forceLegacyEmbedded"] = "forceLegacyEmbedded";
})(exports.OneTapPositions || (exports.OneTapPositions = {}));
exports.OTPMethods = void 0;
(function (OTPMethods) {
  OTPMethods["SMS"] = "sms";
  OTPMethods["WhatsApp"] = "whatsapp";
  OTPMethods["Email"] = "email";
})(exports.OTPMethods || (exports.OTPMethods = {}));
exports.StytchEventType = void 0;
(function (StytchEventType) {
  StytchEventType["MagicLinkLoginOrCreateEvent"] = "MAGIC_LINK_LOGIN_OR_CREATE";
  StytchEventType["OTPsLoginOrCreateEvent"] = "OTP_LOGIN_OR_CREATE";
  StytchEventType["OTPsAuthenticate"] = "OTP_AUTHENTICATE";
  StytchEventType["CryptoWalletAuthenticateStart"] = "CRYPTO_WALLET_AUTHENTICATE_START";
  StytchEventType["CryptoWalletAuthenticate"] = "CRYPTO_WALLET_AUTHENTICATE";
  StytchEventType["PasswordCreate"] = "PASSWORD_CREATE";
  StytchEventType["PasswordAuthenticate"] = "PASSWORD_AUTHENTICATE";
  StytchEventType["PasswordResetByEmailStart"] = "PASSWORD_RESET_BY_EMAIL_START";
  StytchEventType["PasswordResetByEmail"] = "PASSWORD_RESET_BY_EMAIL";
  StytchEventType["PasskeyRegister"] = "PASSKEY_REGISTER";
  StytchEventType["PasskeyAuthenticate"] = "PASSKEY_AUTHENTICATE";
  StytchEventType["PasskeySkip"] = "PASSKEY_SKIP";
  StytchEventType["PasskeyDone"] = "PASSKEY_DONE";
  StytchEventType["AuthenticateFlowComplete"] = "AUTHENTICATE_FLOW_COMPLETE";
  StytchEventType["OAuthAuthorizeFlowStart"] = "OAUTH_AUTHORIZE_FLOW_START";
  StytchEventType["OAuthAuthorizeFlowComplete"] = "OAUTH_AUTHORIZE_FLOW_COMPLETE";
  StytchEventType["OAuthAuthorizeFlowConsentDenied"] = "OAUTH_AUTHORIZE_FLOW_CONSENT_DENIED";
  StytchEventType["B2BMagicLinkEmailLoginOrSignup"] = "B2B_MAGIC_LINK_EMAIL_LOGIN_OR_SIGNUP";
  StytchEventType["B2BMagicLinkAuthenticate"] = "B2B_MAGIC_LINK_AUTHENTICATE";
  StytchEventType["B2BMagicLinkEmailDiscoverySend"] = "B2B_MAGIC_LINK_EMAIL_DISCOVERY_SEND";
  StytchEventType["B2BMagicLinkDiscoveryAuthenticate"] = "B2B_MAGIC_LINK_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BSSOStart"] = "B2B_SSO_START";
  StytchEventType["B2BSSOAuthenticate"] = "B2B_SSO_AUTHENTICATE";
  StytchEventType["B2BSSODiscoverConnections"] = "B2B_SSO_DISCOVER_CONNECTIONS";
  StytchEventType["B2BOAuthAuthenticate"] = "B2B_OAUTH_AUTHENTICATE";
  StytchEventType["B2BOAuthDiscoveryAuthenticate"] = "B2B_OAUTH_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BDiscoveryOrganizationsCreate"] = "B2B_DISCOVERY_ORGANIZATIONS_CREATE";
  StytchEventType["B2BDiscoveryIntermediateSessionExchange"] = "B2B_DISCOVERY_INTERMEDIATE_SESSION_EXCHANGE";
  StytchEventType["B2BPasswordAuthenticate"] = "B2B_PASSWORD_AUTHENTICATE";
  StytchEventType["B2BPasswordDiscoveryAuthenticate"] = "B2B_PASSWORD_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BPasswordResetByEmailStart"] = "B2B_PASSWORD_RESET_BY_EMAIL_START";
  StytchEventType["B2BPasswordResetByEmail"] = "B2B_PASSWORD_RESET_BY_EMAIL";
  StytchEventType["B2BPasswordResetBySession"] = "B2B_PASSWORD_RESET_BY_SESSION";
  StytchEventType["B2BSMSOTPSend"] = "B2B_SMS_OTP_SEND";
  StytchEventType["B2BSMSOTPAuthenticate"] = "B2B_SMS_OTP_AUTHENTICATE";
  StytchEventType["B2BTOTPCreate"] = "B2B_TOTP_CREATE";
  StytchEventType["B2BTOTPAuthenticate"] = "B2B_TOTP_AUTHENTICATE";
  StytchEventType["B2BRecoveryCodesRecover"] = "B2B_RECOVERY_CODES_RECOVER";
  StytchEventType["B2BPasswordDiscoveryResetStart"] = "B2B_PASSWORD_DISCOVERY_RESET_BY_EMAIL_START";
  StytchEventType["B2BDiscoveryPasswordReset"] = "B2B_PASSWORD_DISCOVERY_RESET_BY_EMAIL";
  StytchEventType["B2BImpersonationAuthenticate"] = "B2B_IMPERSONATION_AUTHENTICATE";
  StytchEventType["B2BOTPsEmailAuthenticate"] = "B2B_OTPS_EMAIL_AUTHENTICATE";
  StytchEventType["B2BOTPsEmailDiscoveryAuthenticate"] = "B2B_OTPS_EMAIL_DISCOVERY_AUTHENTICATE";
  StytchEventType["B2BOTPsEmailDiscoverySend"] = "B2B_OTPS_EMAIL_DISCOVERY_SEND";
  StytchEventType["B2BOTPsEmailLoginOrSignup"] = "B2B_OTPS_EMAIL_LOGIN_OR_SIGNUP";
  StytchEventType["B2BOrganizationsGetBySlug"] = "B2B_ORGANIZATIONS_GET_BY_SLUG";
})(exports.StytchEventType || (exports.StytchEventType = {}));
exports.RNUIProducts = void 0;
(function (RNUIProducts) {
  RNUIProducts[RNUIProducts["emailMagicLinks"] = 0] = "emailMagicLinks";
  RNUIProducts[RNUIProducts["oauth"] = 1] = "oauth";
  RNUIProducts[RNUIProducts["otp"] = 2] = "otp";
  RNUIProducts[RNUIProducts["passwords"] = 3] = "passwords";
})(exports.RNUIProducts || (exports.RNUIProducts = {}));
var SDKAPIUnreachableError = /*#__PURE__*/function (_Error) {
  function SDKAPIUnreachableError(message, details) {
    var _this;
    _classCallCheck$1(this, SDKAPIUnreachableError);
    _this = _callSuper$1(this, SDKAPIUnreachableError, [message + '\n' + details]);
    _this.message = message + '\n' + details;
    _this.name = 'SDKAPIUnreachableError';
    _this.details = details;
    Object.setPrototypeOf(_this, SDKAPIUnreachableError.prototype);
    return _this;
  }
  _inherits$1(SDKAPIUnreachableError, _Error);
  return _createClass$1(SDKAPIUnreachableError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchSDKUsageError = /*#__PURE__*/function (_Error2) {
  function StytchSDKUsageError(methodName, message) {
    var _this2;
    _classCallCheck$1(this, StytchSDKUsageError);
    _this2 = _callSuper$1(this, StytchSDKUsageError);
    _this2.name = 'StytchSDKUsageError';
    _this2.message = "Invalid call to ".concat(methodName, "\n") + message;
    return _this2;
  }
  _inherits$1(StytchSDKUsageError, _Error2);
  return _createClass$1(StytchSDKUsageError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchSDKSchemaError = /*#__PURE__*/function (_Error3) {
  function StytchSDKSchemaError(schemaError) {
    var _this3;
    _classCallCheck$1(this, StytchSDKSchemaError);
    var _a;
    _this3 = _callSuper$1(this, StytchSDKSchemaError);
    _this3.name = 'StytchSDKSchemaError';
    var messages = (_a = schemaError.body) === null || _a === void 0 ? void 0 : _a.map(function (err) {
      return "".concat(err.dataPath, ": ").concat(err.message);
    }).join('\n');
    _this3.message = "[400] Request does not match expected schema\n".concat(messages);
    return _this3;
  }
  _inherits$1(StytchSDKSchemaError, _Error3);
  return _createClass$1(StytchSDKSchemaError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchSDKAPIError = /*#__PURE__*/function (_Error4) {
  function StytchSDKAPIError(details) {
    var _this4;
    _classCallCheck$1(this, StytchSDKAPIError);
    _this4 = _callSuper$1(this, StytchSDKAPIError);
    _this4.name = 'StytchSDKAPIError';
    var status_code = details.status_code,
      error_type = details.error_type,
      error_message = details.error_message,
      error_url = details.error_url,
      request_id = details.request_id,
      error_details = details.error_details;
    _this4.error_type = error_type;
    _this4.error_message = error_message;
    _this4.error_url = error_url;
    _this4.request_id = request_id;
    _this4.status_code = status_code;
    _this4.error_details = error_details;
    _this4.message = "[".concat(status_code, "] ").concat(error_type, "\n") + "".concat(error_message, "\n") + "See ".concat(error_url, " for more information.\n") + (request_id ? "request_id: ".concat(request_id, "\n") : '') + (_this4.error_details ? "Details: \n" + JSON.stringify(_this4.error_details) + '\n' : '');
    return _this4;
  }
  _inherits$1(StytchSDKAPIError, _Error4);
  return _createClass$1(StytchSDKAPIError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var UNRECOVERABLE_ERROR_TYPES = ['unauthorized_credentials', 'user_unauthenticated', 'invalid_secret_authentication', 'session_not_found'];
var StytchError = /*#__PURE__*/function (_Error5) {
  function StytchError(name, message) {
    var _this5;
    _classCallCheck$1(this, StytchError);
    _this5 = _callSuper$1(this, StytchError, [message]);
    _this5.name = name;
    return _this5;
  }
  _inherits$1(StytchError, _Error5);
  return _createClass$1(StytchError);
}(/*#__PURE__*/_wrapNativeSuper$1(Error));
var StytchAPIUnreachableError = /*#__PURE__*/function (_StytchError) {
  function StytchAPIUnreachableError(details) {
    var _this6;
    _classCallCheck$1(this, StytchAPIUnreachableError);
    _this6 = _callSuper$1(this, StytchAPIUnreachableError, ['StytchAPIUnreachableError', details]);
    Object.setPrototypeOf(_this6, StytchAPIUnreachableError.prototype);
    return _this6;
  }
  _inherits$1(StytchAPIUnreachableError, _StytchError);
  return _createClass$1(StytchAPIUnreachableError);
}(StytchError);
var StytchAPISchemaError = /*#__PURE__*/function (_StytchError2) {
  function StytchAPISchemaError(schemaError) {
    _classCallCheck$1(this, StytchAPISchemaError);
    var _a;
    var messages = (_a = schemaError.body) === null || _a === void 0 ? void 0 : _a.map(function (err) {
      return "".concat(err.dataPath, ": ").concat(err.message);
    }).join('\n');
    return _callSuper$1(this, StytchAPISchemaError, ['StytchAPISchemaError', "Request does not match expected schema\n".concat(messages)]);
  }
  _inherits$1(StytchAPISchemaError, _StytchError2);
  return _createClass$1(StytchAPISchemaError);
}(StytchError);
var StytchAPIError = /*#__PURE__*/function (_StytchError3) {
  function StytchAPIError(details) {
    var _this7;
    _classCallCheck$1(this, StytchAPIError);
    var status_code = details.status_code,
      error_type = details.error_type,
      error_message = details.error_message,
      error_url = details.error_url,
      request_id = details.request_id,
      error_details = details.error_details;
    _this7 = _callSuper$1(this, StytchAPIError, ['StytchAPIError', "[".concat(status_code, "] ").concat(error_type, "\n") + "".concat(error_message, "\n") + "See ".concat(error_url, " for more information.\n") + (request_id ? "request_id: ".concat(request_id, "\n") : '') + (error_details ? "Details: \n" + JSON.stringify(error_details) + '\n' : '')]);
    _this7.error_type = error_type;
    _this7.error_message = error_message;
    _this7.error_url = error_url;
    _this7.request_id = request_id;
    _this7.status_code = status_code;
    _this7.error_details = error_details;
    return _this7;
  }
  _inherits$1(StytchAPIError, _StytchError3);
  return _createClass$1(StytchAPIError, null, [{
    key: "from",
    value: function from(err) {
      if (err instanceof StytchAPIError) {
        return err;
      }
      if (err && _typeof$1(err) === 'object') {
        var maybe = err;
        if (typeof maybe.status_code === 'number' && typeof maybe.error_type === 'string' && typeof maybe.error_message === 'string' && typeof maybe.error_url === 'string') {
          return new StytchAPIError({
            status_code: maybe.status_code,
            error_type: maybe.error_type,
            error_message: maybe.error_message,
            error_url: maybe.error_url,
            request_id: typeof maybe.request_id === 'string' ? maybe.request_id : undefined,
            error_details: _typeof$1(maybe.error_details) === 'object' ? maybe.error_details : undefined
          });
        }
      }
      var message = err instanceof Error ? err.message : 'Unknown error: ' + String(err);
      return new StytchAPIError({
        status_code: 400,
        error_type: 'unknown_error',
        error_message: message,
        error_url: '',
        request_id: undefined,
        error_details: undefined
      });
    }
  }]);
}(StytchError);
var StytchSDKError = /*#__PURE__*/function (_StytchError4) {
  function StytchSDKError(name, description, options) {
    var _this8;
    _classCallCheck$1(this, StytchSDKError);
    _this8 = _callSuper$1(this, StytchSDKError, [name, description]);
    _this8.options = options;
    return _this8;
  }
  _inherits$1(StytchSDKError, _StytchError4);
  return _createClass$1(StytchSDKError);
}(StytchError);
var NoCurrentSessionError = /*#__PURE__*/function (_StytchSDKError) {
  function NoCurrentSessionError() {
    _classCallCheck$1(this, NoCurrentSessionError);
    return _callSuper$1(this, NoCurrentSessionError, ['NoCurrentSessionError', 'There is no session currently available. Make sure the user is authenticated with a valid session.']);
  }
  _inherits$1(NoCurrentSessionError, _StytchSDKError);
  return _createClass$1(NoCurrentSessionError);
}(StytchSDKError);
var InternalError = /*#__PURE__*/function (_StytchSDKError2) {
  function InternalError(error) {
    var _this9;
    _classCallCheck$1(this, InternalError);
    _this9 = _callSuper$1(this, InternalError, [error.name ? error.name : 'Internal Error', error.message ? error.message : 'An internal error has occurred. Please contact Stytch if this occurs.']);
    _this9.nativeStack = error.nativeStackAndroid || error.nativeStackIOS;
    return _this9;
  }
  _inherits$1(InternalError, _StytchSDKError2);
  return _createClass$1(InternalError);
}(StytchSDKError);
var NoBiometricsRegistrationError = /*#__PURE__*/function (_StytchSDKError3) {
  function NoBiometricsRegistrationError() {
    _classCallCheck$1(this, NoBiometricsRegistrationError);
    return _callSuper$1(this, NoBiometricsRegistrationError, ['NoBiometricsRegistrationError', 'There is no biometric registration available. Authenticate with another method and add a new biometric registration first.']);
  }
  _inherits$1(NoBiometricsRegistrationError, _StytchSDKError3);
  return _createClass$1(NoBiometricsRegistrationError);
}(StytchSDKError);
var BiometricsUnavailableError = /*#__PURE__*/function (_StytchSDKError4) {
  function BiometricsUnavailableError() {
    _classCallCheck$1(this, BiometricsUnavailableError);
    return _callSuper$1(this, BiometricsUnavailableError, ['BiometricsUnavailableError', 'Biometrics is not available on the device.']);
  }
  _inherits$1(BiometricsUnavailableError, _StytchSDKError4);
  return _createClass$1(BiometricsUnavailableError);
}(StytchSDKError);
var KeyInvalidatedError = /*#__PURE__*/function (_StytchSDKError5) {
  function KeyInvalidatedError() {
    _classCallCheck$1(this, KeyInvalidatedError);
    return _callSuper$1(this, KeyInvalidatedError, ['KeyInvalidatedError', 'The biometrics enrollment on the device has changed.']);
  }
  _inherits$1(KeyInvalidatedError, _StytchSDKError5);
  return _createClass$1(KeyInvalidatedError);
}(StytchSDKError);
var KeystoreUnavailableError = /*#__PURE__*/function (_StytchSDKError6) {
  function KeystoreUnavailableError() {
    _classCallCheck$1(this, KeystoreUnavailableError);
    return _callSuper$1(this, KeystoreUnavailableError, ['KeystoreUnavailableError', 'The Android keystore is unavailable on the device. Consider setting allowFallbackToCleartext to true.']);
  }
  _inherits$1(KeystoreUnavailableError, _StytchSDKError6);
  return _createClass$1(KeystoreUnavailableError);
}(StytchSDKError);
var NoBiometricsEnrolledError = /*#__PURE__*/function (_StytchSDKError7) {
  function NoBiometricsEnrolledError() {
    _classCallCheck$1(this, NoBiometricsEnrolledError);
    return _callSuper$1(this, NoBiometricsEnrolledError, ['NoBiometricsEnrolledError', 'There is no biometric factor enrolled on the device. Add a biometric factor in the device settings.']);
  }
  _inherits$1(NoBiometricsEnrolledError, _StytchSDKError7);
  return _createClass$1(NoBiometricsEnrolledError);
}(StytchSDKError);
var BiometricsAlreadyEnrolledError = /*#__PURE__*/function (_StytchSDKError8) {
  function BiometricsAlreadyEnrolledError() {
    _classCallCheck$1(this, BiometricsAlreadyEnrolledError);
    return _callSuper$1(this, BiometricsAlreadyEnrolledError, ['BiometricsAlreadyEnrolledError', 'There is already a biometric factor enrolled on this device. Fully authenticate with all factors and remove the existing registration before attempting to register again.']);
  }
  _inherits$1(BiometricsAlreadyEnrolledError, _StytchSDKError8);
  return _createClass$1(BiometricsAlreadyEnrolledError);
}(StytchSDKError);
var UserCancellationError = /*#__PURE__*/function (_StytchSDKError9) {
  function UserCancellationError() {
    _classCallCheck$1(this, UserCancellationError);
    return _callSuper$1(this, UserCancellationError, ['UserCancellationError', 'The user canceled the prompt. Ask the user to try again.']);
  }
  _inherits$1(UserCancellationError, _StytchSDKError9);
  return _createClass$1(UserCancellationError);
}(StytchSDKError);
var UserLockedOutError = /*#__PURE__*/function (_StytchSDKError0) {
  function UserLockedOutError() {
    _classCallCheck$1(this, UserLockedOutError);
    return _callSuper$1(this, UserLockedOutError, ['UserLockedOutError', 'The user has been locked out due to too many failed attempts. Ask the user to try again later.']);
  }
  _inherits$1(UserLockedOutError, _StytchSDKError0);
  return _createClass$1(UserLockedOutError);
}(StytchSDKError);
var DeviceCredentialsNotAllowedError = /*#__PURE__*/function (_StytchSDKError1) {
  function DeviceCredentialsNotAllowedError() {
    _classCallCheck$1(this, DeviceCredentialsNotAllowedError);
    return _callSuper$1(this, DeviceCredentialsNotAllowedError, ['DeviceCredentialsNotAllowedError', 'The device credentials allowment is mismatched. Change the allowDeviceCredentials parameter to be the same in both the register and authenticate methods.']);
  }
  _inherits$1(DeviceCredentialsNotAllowedError, _StytchSDKError1);
  return _createClass$1(DeviceCredentialsNotAllowedError);
}(StytchSDKError);
var MissingGoogleClientIDError = /*#__PURE__*/function (_StytchSDKError10) {
  function MissingGoogleClientIDError() {
    _classCallCheck$1(this, MissingGoogleClientIDError);
    return _callSuper$1(this, MissingGoogleClientIDError, ['MissingGoogleClientIDError', 'No Google client ID was found in the project.']);
  }
  _inherits$1(MissingGoogleClientIDError, _StytchSDKError10);
  return _createClass$1(MissingGoogleClientIDError);
}(StytchSDKError);
var MissingPKCEError = /*#__PURE__*/function (_StytchSDKError11) {
  function MissingPKCEError() {
    _classCallCheck$1(this, MissingPKCEError);
    return _callSuper$1(this, MissingPKCEError, ['MissingPKCEError', 'Make sure this flow is completed on the same device on which it was started.']);
  }
  _inherits$1(MissingPKCEError, _StytchSDKError11);
  return _createClass$1(MissingPKCEError);
}(StytchSDKError);
var MissingAuthorizationCredentialIDTokenError = /*#__PURE__*/function (_StytchSDKError12) {
  function MissingAuthorizationCredentialIDTokenError() {
    _classCallCheck$1(this, MissingAuthorizationCredentialIDTokenError);
    return _callSuper$1(this, MissingAuthorizationCredentialIDTokenError, ['MissingAuthorizationCredentialIDTokenError', 'The authorization credential is missing an ID token.']);
  }
  _inherits$1(MissingAuthorizationCredentialIDTokenError, _StytchSDKError12);
  return _createClass$1(MissingAuthorizationCredentialIDTokenError);
}(StytchSDKError);
var InvalidAuthorizationCredentialError = /*#__PURE__*/function (_StytchSDKError13) {
  function InvalidAuthorizationCredentialError() {
    _classCallCheck$1(this, InvalidAuthorizationCredentialError);
    return _callSuper$1(this, InvalidAuthorizationCredentialError, ['InvalidAuthorizationCredentialError', 'The authorization credential is invalid. Verify that OAuth is set up correctly in the developer console, and call the start flow method.']);
  }
  _inherits$1(InvalidAuthorizationCredentialError, _StytchSDKError13);
  return _createClass$1(InvalidAuthorizationCredentialError);
}(StytchSDKError);
var NoCredentialsPresentError = /*#__PURE__*/function (_StytchSDKError14) {
  function NoCredentialsPresentError() {
    _classCallCheck$1(this, NoCredentialsPresentError);
    return _callSuper$1(this, NoCredentialsPresentError, ['NoCredentialsPresentError', 'The user did not provide credentials for a Google OneTap attempt']);
  }
  _inherits$1(NoCredentialsPresentError, _StytchSDKError14);
  return _createClass$1(NoCredentialsPresentError);
}(StytchSDKError);
var MissingPublicKeyError = /*#__PURE__*/function (_StytchSDKError15) {
  function MissingPublicKeyError() {
    _classCallCheck$1(this, MissingPublicKeyError);
    return _callSuper$1(this, MissingPublicKeyError, ['MissingPublicKeyError', 'Failed to retrieve the public key. Add a new biometric registration.']);
  }
  _inherits$1(MissingPublicKeyError, _StytchSDKError15);
  return _createClass$1(MissingPublicKeyError);
}(StytchSDKError);
var ChallengeSigningFailedError = /*#__PURE__*/function (_StytchSDKError16) {
  function ChallengeSigningFailedError() {
    _classCallCheck$1(this, ChallengeSigningFailedError);
    return _callSuper$1(this, ChallengeSigningFailedError, ['ChallengeSigningFailedError', 'Failed to sign the challenge with the key.']);
  }
  _inherits$1(ChallengeSigningFailedError, _StytchSDKError16);
  return _createClass$1(ChallengeSigningFailedError);
}(StytchSDKError);
var SDKNotConfiguredError = /*#__PURE__*/function (_StytchSDKError17) {
  function SDKNotConfiguredError() {
    _classCallCheck$1(this, SDKNotConfiguredError);
    return _callSuper$1(this, SDKNotConfiguredError, ['SDKNotConfiguredError', 'Stytch client is not confiured. You must call the configure method before using the SDK']);
  }
  _inherits$1(SDKNotConfiguredError, _StytchSDKError17);
  return _createClass$1(SDKNotConfiguredError);
}(StytchSDKError);
var FailedCodeChallengeError = /*#__PURE__*/function (_StytchSDKError18) {
  function FailedCodeChallengeError() {
    _classCallCheck$1(this, FailedCodeChallengeError);
    return _callSuper$1(this, FailedCodeChallengeError, ['FailedCodeChallengeError', 'Failed to create a code challenge']);
  }
  _inherits$1(FailedCodeChallengeError, _StytchSDKError18);
  return _createClass$1(FailedCodeChallengeError);
}(StytchSDKError);
var PasskeysUnsupportedError = /*#__PURE__*/function (_StytchSDKError19) {
  function PasskeysUnsupportedError() {
    _classCallCheck$1(this, PasskeysUnsupportedError);
    return _callSuper$1(this, PasskeysUnsupportedError, ['PasskeysUnsupportedError', 'Passkeys are not supported on this device']);
  }
  _inherits$1(PasskeysUnsupportedError, _StytchSDKError19);
  return _createClass$1(PasskeysUnsupportedError);
}(StytchSDKError);
var FailedToDecryptDataError = /*#__PURE__*/function (_StytchSDKError20) {
  function FailedToDecryptDataError() {
    _classCallCheck$1(this, FailedToDecryptDataError);
    return _callSuper$1(this, FailedToDecryptDataError, ['FailedToDecryptDataError', 'Failed to decrypt user data']);
  }
  _inherits$1(FailedToDecryptDataError, _StytchSDKError20);
  return _createClass$1(FailedToDecryptDataError);
}(StytchSDKError);
var BiometricsFailedError = /*#__PURE__*/function (_StytchSDKError21) {
  function BiometricsFailedError() {
    _classCallCheck$1(this, BiometricsFailedError);
    return _callSuper$1(this, BiometricsFailedError, ['BiometricsFailedError', 'Biometric authentication failed']);
  }
  _inherits$1(BiometricsFailedError, _StytchSDKError21);
  return _createClass$1(BiometricsFailedError);
}(StytchSDKError);
var InvalidStartUrlError = /*#__PURE__*/function (_StytchSDKError22) {
  function InvalidStartUrlError() {
    _classCallCheck$1(this, InvalidStartUrlError);
    return _callSuper$1(this, InvalidStartUrlError, ['InvalidStartUrlError', 'The start URL was invalid or improperly formatted.']);
  }
  _inherits$1(InvalidStartUrlError, _StytchSDKError22);
  return _createClass$1(InvalidStartUrlError);
}(StytchSDKError);
var InvalidRedirectSchemeError = /*#__PURE__*/function (_StytchSDKError23) {
  function InvalidRedirectSchemeError() {
    _classCallCheck$1(this, InvalidRedirectSchemeError);
    return _callSuper$1(this, InvalidRedirectSchemeError, ['InvalidRedirectSchemeError', 'The scheme from the given redirect urls was invalid. Possible reasons include: nil scheme, non-custom scheme (using http or https), or differing schemes for login/signup urls.']);
  }
  _inherits$1(InvalidRedirectSchemeError, _StytchSDKError23);
  return _createClass$1(InvalidRedirectSchemeError);
}(StytchSDKError);
var MissingUrlError = /*#__PURE__*/function (_StytchSDKError24) {
  function MissingUrlError() {
    _classCallCheck$1(this, MissingUrlError);
    return _callSuper$1(this, MissingUrlError, ['MissingUrlError', 'The underlying web authentication service failed to return a URL.']);
  }
  _inherits$1(MissingUrlError, _StytchSDKError24);
  return _createClass$1(MissingUrlError);
}(StytchSDKError);
var InvalidCredentialTypeError = /*#__PURE__*/function (_StytchSDKError25) {
  function InvalidCredentialTypeError() {
    _classCallCheck$1(this, InvalidCredentialTypeError);
    return _callSuper$1(this, InvalidCredentialTypeError, ['InvalidCredentialTypeError', 'The public key credential type was not of the expected type.']);
  }
  _inherits$1(InvalidCredentialTypeError, _StytchSDKError25);
  return _createClass$1(InvalidCredentialTypeError);
}(StytchSDKError);
var MissingAttestationObjectError = /*#__PURE__*/function (_StytchSDKError26) {
  function MissingAttestationObjectError() {
    _classCallCheck$1(this, MissingAttestationObjectError);
    return _callSuper$1(this, MissingAttestationObjectError, ['MissingAttestationObjectError', 'The public key credential is missing the attestation object.']);
  }
  _inherits$1(MissingAttestationObjectError, _StytchSDKError26);
  return _createClass$1(MissingAttestationObjectError);
}(StytchSDKError);
var JSONDataNotConvertibleToStringError = /*#__PURE__*/function (_StytchSDKError27) {
  function JSONDataNotConvertibleToStringError() {
    _classCallCheck$1(this, JSONDataNotConvertibleToStringError);
    return _callSuper$1(this, JSONDataNotConvertibleToStringError, ['JSONDataNotConvertibleToStringError', 'JSON data unable to be converted to String type.']);
  }
  _inherits$1(JSONDataNotConvertibleToStringError, _StytchSDKError27);
  return _createClass$1(JSONDataNotConvertibleToStringError);
}(StytchSDKError);
var RandomNumberGenerationFailed = /*#__PURE__*/function (_StytchSDKError28) {
  function RandomNumberGenerationFailed() {
    _classCallCheck$1(this, RandomNumberGenerationFailed);
    return _callSuper$1(this, RandomNumberGenerationFailed, ['RandomNumberGenerationFailed', 'Random number generation failed']);
  }
  _inherits$1(RandomNumberGenerationFailed, _StytchSDKError28);
  return _createClass$1(RandomNumberGenerationFailed);
}(StytchSDKError);
var PasskeysInvalidEncoding = /*#__PURE__*/function (_StytchSDKError29) {
  function PasskeysInvalidEncoding() {
    _classCallCheck$1(this, PasskeysInvalidEncoding);
    return _callSuper$1(this, PasskeysInvalidEncoding, ['PasskeysInvalidEncoding', 'Invalid passkey encoding']);
  }
  _inherits$1(PasskeysInvalidEncoding, _StytchSDKError29);
  return _createClass$1(PasskeysInvalidEncoding);
}(StytchSDKError);
var PasskeysMisconfigured = /*#__PURE__*/function (_StytchSDKError30) {
  function PasskeysMisconfigured() {
    _classCallCheck$1(this, PasskeysMisconfigured);
    return _callSuper$1(this, PasskeysMisconfigured, ['PasskeysMisconfigured', 'Passkeys are misconfigured. Verify that you have added the correct associated domain for your application, and that the signing information is correct.']);
  }
  _inherits$1(PasskeysMisconfigured, _StytchSDKError30);
  return _createClass$1(PasskeysMisconfigured);
}(StytchSDKError);
var SignInWithAppleMisconfigured = /*#__PURE__*/function (_StytchSDKError31) {
  function SignInWithAppleMisconfigured() {
    _classCallCheck$1(this, SignInWithAppleMisconfigured);
    return _callSuper$1(this, SignInWithAppleMisconfigured, ['SignInWithAppleMisconfigured', 'Sign In With Apple is misconfigured. Verify that you have correctly configured Apple OAuth in the Stytch Dashboard and added the Sign In With Apple capability to your project.']);
  }
  _inherits$1(SignInWithAppleMisconfigured, _StytchSDKError31);
  return _createClass$1(SignInWithAppleMisconfigured);
}(StytchSDKError);
var MissingCipherIv = /*#__PURE__*/function (_StytchSDKError32) {
  function MissingCipherIv() {
    _classCallCheck$1(this, MissingCipherIv);
    return _callSuper$1(this, MissingCipherIv, ['MissingCipherIv', 'The expected cipher Iv was not found when attempting to decrypt an existing biometric key.']);
  }
  _inherits$1(MissingCipherIv, _StytchSDKError32);
  return _createClass$1(MissingCipherIv);
}(StytchSDKError);
var InvalidPrivateKeyLength = /*#__PURE__*/function (_StytchSDKError33) {
  function InvalidPrivateKeyLength() {
    _classCallCheck$1(this, InvalidPrivateKeyLength);
    return _callSuper$1(this, InvalidPrivateKeyLength, ['InvalidPrivateKeyLength', "The private key was of an incorrect length."]);
  }
  _inherits$1(InvalidPrivateKeyLength, _StytchSDKError33);
  return _createClass$1(InvalidPrivateKeyLength);
}(StytchSDKError);
var BiometricRegistrationIdIsNullOrBlank = /*#__PURE__*/function (_StytchSDKError34) {
  function BiometricRegistrationIdIsNullOrBlank() {
    _classCallCheck$1(this, BiometricRegistrationIdIsNullOrBlank);
    return _callSuper$1(this, BiometricRegistrationIdIsNullOrBlank, ['BiometricRegistrationIdIsNullOrBlank', 'Attempted to set a blank or null biometric registration ID. This is not allowed, and indicates no registration was created on the server. Consider deleting any local keys that may have been generated.']);
  }
  _inherits$1(BiometricRegistrationIdIsNullOrBlank, _StytchSDKError34);
  return _createClass$1(BiometricRegistrationIdIsNullOrBlank);
}(StytchSDKError);
var DFPNotConfigured = /*#__PURE__*/function (_StytchSDKError35) {
  function DFPNotConfigured() {
    _classCallCheck$1(this, DFPNotConfigured);
    return _callSuper$1(this, DFPNotConfigured, ['DFPNotConfigured', 'You have attempted to retrieve a telemetry ID before the DFP client has been configured.']);
  }
  _inherits$1(DFPNotConfigured, _StytchSDKError35);
  return _createClass$1(DFPNotConfigured);
}(StytchSDKError);
var IDPOAuthFlowMissingParamError = /*#__PURE__*/function (_StytchSDKError36) {
  function IDPOAuthFlowMissingParamError(details) {
    _classCallCheck$1(this, IDPOAuthFlowMissingParamError);
    return _callSuper$1(this, IDPOAuthFlowMissingParamError, ['IDPOAuthFlowMissingParamError', details]);
  }
  _inherits$1(IDPOAuthFlowMissingParamError, _StytchSDKError36);
  return _createClass$1(IDPOAuthFlowMissingParamError);
}(StytchSDKError);
function errorToStytchError(error) {
  switch (error.message) {
    case 'no_current_session':
      return new NoCurrentSessionError();
    case 'no_biometrics_registration':
      return new NoBiometricsRegistrationError();
    case 'biometrics_unavailable':
      return new BiometricsUnavailableError();
    case 'key_invalidated':
      return new KeyInvalidatedError();
    case 'device_hardware_error':
      return new BiometricsUnavailableError();
    case 'biometrics_not_available':
      return new BiometricsUnavailableError();
    case 'no_biometrics_enrolled':
      return new NoBiometricsEnrolledError();
    case 'keystore_unavailable':
      return new KeystoreUnavailableError();
    case 'no_biometric_key':
      return new KeyInvalidatedError();
    case 'device_credentials_not_allowed':
      return new DeviceCredentialsNotAllowedError();
    case 'user_cancellation':
      return new UserCancellationError();
    case 'user_locked_out':
      return new UserLockedOutError();
    case 'google_onetap_missing_id_token':
      return new MissingAuthorizationCredentialIDTokenError();
    case 'google_onetap_missing_member':
      return new InvalidAuthorizationCredentialError();
    case 'oauth_apple_missing_id_token':
      return new MissingAuthorizationCredentialIDTokenError();
    case 'oauth_apple_credential_invalid':
      return new InvalidAuthorizationCredentialError();
    case 'missing_public_key':
      return new MissingPublicKeyError();
    case 'challenge_signing_failed':
      return new ChallengeSigningFailedError();
    case 'missing_authorization_credential_id_token':
      return new MissingAuthorizationCredentialIDTokenError();
    case 'invalid_authorization_credential':
      return new InvalidAuthorizationCredentialError();
    case 'no_credentials_present':
      return new NoCredentialsPresentError();
    case 'sdk_not_configured':
      return new SDKNotConfiguredError();
    case 'failed_code_challenge':
      return new FailedCodeChallengeError();
    case 'passkeys_unsupported':
      return new PasskeysUnsupportedError();
    case 'failed_to_decrypt_data':
      return new FailedToDecryptDataError();
    case 'biometrics_failed':
      return new BiometricsFailedError();
    case 'invalid_start_url':
      return new InvalidStartUrlError();
    case 'invalid_redirect_scheme':
      return new InvalidRedirectSchemeError();
    case 'missing_url':
      return new MissingUrlError();
    case 'invalid_credential_type':
      return new InvalidCredentialTypeError();
    case 'missing_attestation_object':
      return new MissingAttestationObjectError();
    case 'json_data_not_convertible_to_string':
      return new JSONDataNotConvertibleToStringError();
    case 'random_number_generation_failed':
      return new RandomNumberGenerationFailed();
    case 'passkeys_invalid_encoding':
      return new PasskeysInvalidEncoding();
    case 'passkeys_misconfigured':
      return new PasskeysMisconfigured();
    case 'signinwithapple_misconfigured':
      return new SignInWithAppleMisconfigured();
    case 'missing_cipher_iv':
      return new MissingCipherIv();
    case 'invalid_private_key_length':
      return new InvalidPrivateKeyLength();
    case 'biometric_registration_id_is_null_or_blank':
      return new BiometricRegistrationIdIsNullOrBlank();
    case 'dfp_not_configured':
      return new DFPNotConfigured();
    default:
      return new InternalError(error);
  }
}
exports.B2BProducts = void 0;
(function (B2BProducts) {
  B2BProducts["emailMagicLinks"] = "emailMagicLinks";
  B2BProducts["emailOtp"] = "emailOtp";
  B2BProducts["sso"] = "sso";
  B2BProducts["passwords"] = "passwords";
  B2BProducts["oauth"] = "oauth";
})(exports.B2BProducts || (exports.B2BProducts = {}));
exports.AuthFlowType = void 0;
(function (AuthFlowType) {
  AuthFlowType["Discovery"] = "Discovery";
  AuthFlowType["Organization"] = "Organization";
  AuthFlowType["PasswordReset"] = "PasswordReset";
})(exports.AuthFlowType || (exports.AuthFlowType = {}));
exports.RedirectURLType = void 0;
(function (RedirectURLType) {
  RedirectURLType["ResetPassword"] = "reset_password";
})(exports.RedirectURLType || (exports.RedirectURLType = {}));
exports.B2BMFAProducts = void 0;
(function (B2BMFAProducts) {
  B2BMFAProducts["smsOtp"] = "smsOtp";
  B2BMFAProducts["totp"] = "totp";
})(exports.B2BMFAProducts || (exports.B2BMFAProducts = {}));
exports.B2BOAuthProviders = void 0;
(function (B2BOAuthProviders) {
  B2BOAuthProviders["Google"] = "google";
  B2BOAuthProviders["Microsoft"] = "microsoft";
  B2BOAuthProviders["HubSpot"] = "hubspot";
  B2BOAuthProviders["Slack"] = "slack";
  B2BOAuthProviders["GitHub"] = "github";
})(exports.B2BOAuthProviders || (exports.B2BOAuthProviders = {}));
function _createForOfIteratorHelper(r, e) {
  var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"];
  if (!t) {
    if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e) {
      t && (r = t);
      var _n = 0,
        F = function F() {};
      return {
        s: F,
        n: function n() {
          return _n >= r.length ? {
            done: !0
          } : {
            done: !1,
            value: r[_n++]
          };
        },
        e: function e(r) {
          throw r;
        },
        f: F
      };
    }
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  var o,
    a = !0,
    u = !1;
  return {
    s: function s() {
      t = t.call(r);
    },
    n: function n() {
      var r = t.next();
      return a = r.done, r;
    },
    e: function e(r) {
      u = !0, o = r;
    },
    f: function f() {
      try {
        a || null == t["return"] || t["return"]();
      } finally {
        if (u) throw o;
      }
    }
  };
}
function _typeof(o) {
  "@babel/helpers - typeof";

  return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
    return typeof o;
  } : function (o) {
    return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
  }, _typeof(o);
}
function _toConsumableArray(r) {
  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();
}
function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _iterableToArray(r) {
  if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r);
}
function _arrayWithoutHoles(r) {
  if (Array.isArray(r)) return _arrayLikeToArray(r);
}
function _slicedToArray(r, e) {
  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();
}
function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _unsupportedIterableToArray(r, a) {
  if (r) {
    if ("string" == typeof r) return _arrayLikeToArray(r, a);
    var t = {}.toString.call(r).slice(8, -1);
    return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;
  }
}
function _arrayLikeToArray(r, a) {
  (null == a || a > r.length) && (a = r.length);
  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];
  return n;
}
function _iterableToArrayLimit(r, l) {
  var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"];
  if (null != t) {
    var e,
      n,
      i,
      u,
      a = [],
      f = !0,
      o = !1;
    try {
      if (i = (t = t.call(r)).next, 0 === l) ;else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);
    } catch (r) {
      o = !0, n = r;
    } finally {
      try {
        if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return;
      } finally {
        if (o) throw n;
      }
    }
    return a;
  }
}
function _arrayWithHoles(r) {
  if (Array.isArray(r)) return r;
}
function _regenerator() {
  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,
    t,
    r = "function" == typeof Symbol ? Symbol : {},
    n = r.iterator || "@@iterator",
    o = r.toStringTag || "@@toStringTag";
  function i(r, n, o, i) {
    var c = n && n.prototype instanceof Generator ? n : Generator,
      u = Object.create(c.prototype);
    return _regeneratorDefine2(u, "_invoke", function (r, n, o) {
      var i,
        c,
        u,
        f = 0,
        p = o || [],
        y = !1,
        G = {
          p: 0,
          n: 0,
          v: e,
          a: d,
          f: d.bind(e, 4),
          d: function d(t, r) {
            return i = t, c = 0, u = e, G.n = r, a;
          }
        };
      function d(r, n) {
        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {
          var o,
            i = p[t],
            d = G.p,
            l = i[2];
          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));
        }
        if (o || r > 1) return a;
        throw y = !0, n;
      }
      return function (o, p, l) {
        if (f > 1) throw TypeError("Generator is already running");
        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {
          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);
          try {
            if (f = 2, i) {
              if (c || (o = "next"), t = i[o]) {
                if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object");
                if (!t.done) return t;
                u = t.value, c < 2 && (c = 0);
              } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1);
              i = e;
            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;
          } catch (t) {
            i = e, c = 1, u = t;
          } finally {
            f = 1;
          }
        }
        return {
          value: t,
          done: y
        };
      };
    }(r, o, i), !0), u;
  }
  var a = {};
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}
  t = Object.getPrototypeOf;
  var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () {
      return this;
    }), t),
    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);
  function f(e) {
    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e;
  }
  return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () {
    return this;
  }), _regeneratorDefine2(u, "toString", function () {
    return "[object Generator]";
  }), (_regenerator = function _regenerator() {
    return {
      w: i,
      m: f
    };
  })();
}
function _regeneratorDefine2(e, r, n, t) {
  var i = Object.defineProperty;
  try {
    i({}, "", {});
  } catch (e) {
    i = 0;
  }
  _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) {
    function o(r, n) {
      _regeneratorDefine2(e, r, function (e) {
        return this._invoke(r, n, e);
      });
    }
    r ? i ? i(e, r, {
      value: n,
      enumerable: !t,
      configurable: !t,
      writable: !t
    }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2));
  }, _regeneratorDefine2(e, r, n, t);
}
function _defineProperties(e, r) {
  for (var t = 0; t < r.length; t++) {
    var o = r[t];
    o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);
  }
}
function _createClass(e, r, t) {
  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", {
    writable: !1
  }), e;
}
function _toPropertyKey(t) {
  var i = _toPrimitive(t, "string");
  return "symbol" == _typeof(i) ? i : i + "";
}
function _toPrimitive(t, r) {
  if ("object" != _typeof(t) || !t) return t;
  var e = t[Symbol.toPrimitive];
  if (void 0 !== e) {
    var i = e.call(t, r);
    if ("object" != _typeof(i)) return i;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return String(t);
}
function _classCallCheck(a, n) {
  if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function");
}
function _callSuper(t, o, e) {
  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));
}
function _possibleConstructorReturn(t, e) {
  if (e && ("object" == _typeof(e) || "function" == typeof e)) return e;
  if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined");
  return _assertThisInitialized(t);
}
function _assertThisInitialized(e) {
  if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  return e;
}
function _inherits(t, e) {
  if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function");
  t.prototype = Object.create(e && e.prototype, {
    constructor: {
      value: t,
      writable: !0,
      configurable: !0
    }
  }), Object.defineProperty(t, "prototype", {
    writable: !1
  }), e && _setPrototypeOf(t, e);
}
function _wrapNativeSuper(t) {
  var r = "function" == typeof Map ? new Map() : void 0;
  return _wrapNativeSuper = function _wrapNativeSuper(t) {
    if (null === t || !_isNativeFunction(t)) return t;
    if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function");
    if (void 0 !== r) {
      if (r.has(t)) return r.get(t);
      r.set(t, Wrapper);
    }
    function Wrapper() {
      return _construct(t, arguments, _getPrototypeOf(this).constructor);
    }
    return Wrapper.prototype = Object.create(t.prototype, {
      constructor: {
        value: Wrapper,
        enumerable: !1,
        writable: !0,
        configurable: !0
      }
    }), _setPrototypeOf(Wrapper, t);
  }, _wrapNativeSuper(t);
}
function _construct(t, e, r) {
  if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments);
  var o = [null];
  o.push.apply(o, e);
  var p = new (t.bind.apply(t, o))();
  return r && _setPrototypeOf(p, r.prototype), p;
}
function _isNativeReflectConstruct() {
  try {
    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
  } catch (t) {}
  return (_isNativeReflectConstruct = function _isNativeReflectConstruct() {
    return !!t;
  })();
}
function _isNativeFunction(t) {
  try {
    return -1 !== Function.toString.call(t).indexOf("[native code]");
  } catch (n) {
    return "function" == typeof t;
  }
}
function _setPrototypeOf(t, e) {
  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {
    return t.__proto__ = e, t;
  }, _setPrototypeOf(t, e);
}
function _getPrototypeOf(t) {
  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {
    return t.__proto__ || Object.getPrototypeOf(t);
  }, _getPrototypeOf(t);
}
var TEST_API_URL = 'https://test.stytch.com';
var LIVE_API_URL = 'https://api.stytch.com';
var CLIENTSIDE_SERVICES_IFRAME_URL = 'https://js.stytch.com/clientside-services/index.html';
var STYTCH_DFP_BACKEND_URL = "https://telemetry.stytch.com";
var STYTCH_DFP_CDN_URL = "https://elements.stytch.com";
var GOOGLE_ONE_TAP_HOST = 'https://accounts.google.com/gsi';
var GOOGLE_ONE_TAP_SCRIPT_URL = "".concat(GOOGLE_ONE_TAP_HOST, "/client");
var MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING = "It looks like you're creating multiple copies of the Stytch client." + ' This behavior is unsupported, and unintended side effects may occur. ' + "Make sure you are creating the Stytch client at the global level, and not inside a component's render function.";
var RetriableErrorType;
(function (RetriableErrorType) {
  RetriableErrorType["RequiredCaptcha"] = "CAPTCHA required";
})(RetriableErrorType || (RetriableErrorType = {}));
var RetriableError = /*#__PURE__*/function (_Error) {
  function RetriableError(type) {
    var _this;
    _classCallCheck(this, RetriableError);
    _this = _callSuper(this, RetriableError, [type]);
    _this.type = type;
    return _this;
  }
  _inherits(RetriableError, _Error);
  return _createClass(RetriableError);
}(/*#__PURE__*/_wrapNativeSuper(Error));
function _retriableFetchSDK(_ref) {
  var method = _ref.method,
    finalURL = _ref.finalURL,
    basicAuthHeader = _ref.basicAuthHeader,
    xSDKClientHeader = _ref.xSDKClientHeader,
    xSDKParentHostHeader = _ref.xSDKParentHostHeader,
    body = _ref.body,
    retryCallback = _ref.retryCallback;
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee() {
    var req, _t;
    return _regenerator().w(function (_context) {
      while (1) switch (_context.p = _context.n) {
        case 0:
          req = {
            method: method,
            finalURL: finalURL,
            basicAuthHeader: basicAuthHeader,
            xSDKClientHeader: xSDKClientHeader,
            xSDKParentHostHeader: xSDKParentHostHeader,
            body: body
          };
          _context.p = 1;
          _context.n = 2;
          return baseFetchSDK(req);
        case 2:
          return _context.a(2, _context.v);
        case 3:
          _context.p = 3;
          _t = _context.v;
          if (!(_t instanceof RetriableError)) {
            _context.n = 6;
            break;
          }
          _context.n = 4;
          return retryCallback(_t, req);
        case 4:
          req = _context.v;
          _context.n = 5;
          return baseFetchSDK(req);
        case 5:
          return _context.a(2, _context.v);
        case 6:
          throw _t;
        case 7:
          return _context.a(2);
      }
    }, _callee, null, [[1, 3]]);
  }));
}
function baseFetchSDK(_ref2) {
  var method = _ref2.method,
    finalURL = _ref2.finalURL,
    basicAuthHeader = _ref2.basicAuthHeader,
    xSDKClientHeader = _ref2.xSDKClientHeader,
    xSDKParentHostHeader = _ref2.xSDKParentHostHeader,
    body = _ref2.body;
  var _a;
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee2() {
    var headers, fetchOpts, resp, _respData, respError, respData, _t2;
    return _regenerator().w(function (_context2) {
      while (1) switch (_context2.p = _context2.n) {
        case 0:
          headers = {
            Authorization: basicAuthHeader,
            'Content-Type': 'application/json',
            'X-SDK-Client': xSDKClientHeader
          };
          if (xSDKParentHostHeader) {
            headers['X-SDK-Parent-Host'] = xSDKParentHostHeader;
          }
          fetchOpts = {
            method: method,
            headers: headers,
            body: body && JSON.stringify(body),
            credentials: 'include'
          };
          _context2.p = 1;
          _context2.n = 2;
          return fetch(finalURL, fetchOpts);
        case 2:
          resp = _context2.v;
          _context2.n = 5;
          break;
        case 3:
          _context2.p = 3;
          _t2 = _context2.v;
          if (!(_t2.message === 'Failed to fetch')) {
            _context2.n = 4;
            break;
          }
          throw new StytchAPIUnreachableError('Unable to contact our servers.');
        case 4:
          throw _t2;
        case 5:
          if (!(resp.status <= 299)) {
            _context2.n = 9;
            break;
          }
          _context2.p = 6;
          _context2.n = 7;
          return resp.json();
        case 7:
          _respData = _context2.v;
          return _context2.a(2, _respData.data);
        case 8:
          _context2.p = 8;
          _context2.v;
          throw new StytchAPIUnreachableError('Invalid JSON response from our servers.');
        case 9:
          if (!(resp.status !== 200 && ((_a = resp.headers.get('content-type')) === null || _a === void 0 ? void 0 : _a.includes('application/json')))) {
            _context2.n = 15;
            break;
          }
          _context2.p = 10;
          _context2.n = 11;
          return resp.json();
        case 11:
          respError = _context2.v;
          _context2.n = 13;
          break;
        case 12:
          _context2.p = 12;
          _context2.v;
          throw new StytchAPIUnreachableError('Invalid or no response from server');
        case 13:
          if (!('body' in respError || 'params' in respError || 'query' in respError)) {
            _context2.n = 14;
            break;
          }
          throw new StytchAPISchemaError(respError);
        case 14:
          throw new StytchAPIError(respError);
        case 15:
          _context2.p = 15;
          _context2.n = 16;
          return resp.text();
        case 16:
          respData = _context2.v;
          _context2.n = 18;
          break;
        case 17:
          _context2.p = 17;
          _context2.v;
          throw new StytchAPIUnreachableError('Invalid response from our servers.');
        case 18:
          if (!respData.includes('Captcha required')) {
            _context2.n = 19;
            break;
          }
          throw new RetriableError(RetriableErrorType.RequiredCaptcha);
        case 19:
          throw new StytchAPIUnreachableError('Invalid response from our servers.');
        case 20:
          return _context2.a(2);
      }
    }, _callee2, null, [[15, 17], [10, 12], [6, 8], [1, 3]]);
  }));
}
function baseSubmitFormSDK(_ref3) {
  var method = _ref3.method,
    finalURL = _ref3.finalURL,
    basicAuthHeader = _ref3.basicAuthHeader,
    xSDKClientHeader = _ref3.xSDKClientHeader,
    xSDKParentHostHeader = _ref3.xSDKParentHostHeader,
    body = _ref3.body;
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee3() {
    var bodyParams, finalBody, children, form;
    return _regenerator().w(function (_context3) {
      while (1) switch (_context3.n) {
        case 0:
          bodyParams = body || {};
          finalBody = Object.assign(Object.assign({}, bodyParams), {
            __Authorization: basicAuthHeader,
            '__X-SDK-Client': xSDKClientHeader
          });
          if (xSDKParentHostHeader) {
            finalBody['__X-SDK-Parent-Host'] = xSDKParentHostHeader;
          }
          children = Object.entries(finalBody).map(function (_ref4) {
            var _ref5 = _slicedToArray(_ref4, 2),
              key = _ref5[0],
              value = _ref5[1];
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = value;
            return input;
          });
          form = document.createElement('form');
          form.method = method;
          form.action = finalURL;
          form.append.apply(form, _toConsumableArray(children));
          document.body.appendChild(form);
          form.submit();
        case 1:
          return _context3.a(2);
      }
    }, _callee3);
  }));
}
var getRandomValues;
var rnds8 = new Uint8Array(16);
function rng() {
  if (!getRandomValues) {
    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);
    if (!getRandomValues) {
      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');
    }
  }
  return getRandomValues(rnds8);
}
var REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;
function validate$1(uuid) {
  return typeof uuid === 'string' && REGEX.test(uuid);
}
var byteToHex = [];
for (var i = 0; i < 256; ++i) {
  byteToHex.push((i + 0x100).toString(16).substr(1));
}
function stringify(arr) {
  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase();
  if (!validate$1(uuid)) {
    throw TypeError('Stringified UUID is invalid');
  }
  return uuid;
}
function v4(options, buf, offset) {
  options = options || {};
  var rnds = options.random || (options.rng || rng)();
  rnds[6] = rnds[6] & 0x0f | 0x40;
  rnds[8] = rnds[8] & 0x3f | 0x80;
  return stringify(rnds);
}
var ModulePromiseCache = {};
function loadESModule(url, moduleFromGlobalScope) {
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee4() {
    return _regenerator().w(function (_context4) {
      while (1) switch (_context4.n) {
        case 0:
          if (!(ModulePromiseCache[url] !== undefined)) {
            _context4.n = 1;
            break;
          }
          return _context4.a(2, ModulePromiseCache[url]);
        case 1:
          ModulePromiseCache[url] = loadESModuleFromNetwork(url, moduleFromGlobalScope);
          return _context4.a(2, ModulePromiseCache[url]);
      }
    }, _callee4);
  }));
}
function loadESModuleFromNetwork(url, moduleFromGlobalScope) {
  return new Promise(function (resolve, reject) {
    var maybeScript = findScript(url);
    if (maybeScript && maybeScript.dataset.loaded === 'true') {
      try {
        resolve(moduleFromGlobalScope());
      } catch (err) {
        return reject(new Error("".concat(url, " already loaded, but module was not found in global scope: ").concat(err)));
      }
    }
    var script = createScript(url);
    script.addEventListener('load', function () {
      script.dataset.loaded = 'true';
      try {
        resolve(moduleFromGlobalScope());
      } catch (err) {
        reject(new Error("".concat(url, " was loaded, but module was not found in global scope: ").concat(err)));
      }
    });
    script.addEventListener('error', function (err) {
      reject(new Error("".concat(url, " could not be loaded: ").concat(err)));
    });
  });
}
var findScriptsInDom = function findScriptsInDom(url) {
  return document.querySelectorAll("script[src=\"".concat(url, "\"]"));
};
function findScript(url) {
  var scripts = findScriptsInDom(url);
  if (scripts[0]) {
    return scripts[0];
  }
}
function createScript(url) {
  var script = document.createElement('script');
  script.setAttribute('src', url);
  script.setAttribute('async', 'true');
  script.setAttribute('defer', 'true');
  document.head.appendChild(script);
  return script;
}
var getHttpsUrl = function getHttpsUrl(urlOrDomain) {
  try {
    var url = new URL(urlOrDomain);
    return "https://".concat(url.hostname);
  } catch (_a) {}
  try {
    var _url = new URL("https://".concat(urlOrDomain));
    return "https://".concat(_url.hostname);
  } catch (_b) {}
  return undefined;
};
var STYTCH_BADGE = ['[Stytch]'];
var DEBUG = false;
var logger = {
  debug: function debug() {
    return DEBUG;
  },
  log: function log() {
    var _console;
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }
    return (_console = console).log.apply(_console, STYTCH_BADGE.concat(args));
  },
  warn: function warn() {
    var _console2;
    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }
    return (_console2 = console).warn.apply(_console2, STYTCH_BADGE.concat(args));
  },
  error: function error() {
    var _console3;
    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      args[_key3] = arguments[_key3];
    }
    return (_console3 = console).error.apply(_console3, STYTCH_BADGE.concat(args));
  }
};
var getLiveApiURL = function getLiveApiURL(opts) {
  var _a, _b, _c, _d;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.apiDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) ? 'customBaseUrl' : 'apiDomain';
      logger.warn("Unable to use custom API domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return (_d = (_c = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _c === void 0 ? void 0 : _c.liveAPIURL) !== null && _d !== void 0 ? _d : LIVE_API_URL;
};
var getTestApiURL = function getTestApiURL(opts) {
  var _a, _b, _c, _d;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.testApiDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.customBaseUrl) ? 'customBaseUrl' : 'testApiDomain';
      logger.warn("Unable to use custom API domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return (_d = (_c = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _c === void 0 ? void 0 : _c.testAPIURL) !== null && _d !== void 0 ? _d : TEST_API_URL;
};
var trailer = "\nYou can find your public token at https://stytch.com/dashboard/api-keys.";
var checkPublicToken = function checkPublicToken(publicToken) {
  if (typeof publicToken !== 'string') {
    logger.warn("Public token is malformed. Expected a string, got ".concat(_typeof(publicToken), ".").concat(trailer));
  } else if (publicToken === '') {
    logger.warn("Public token is malformed. Expected \"public-token-...\", got an empty string.".concat(trailer));
  } else if (!publicToken.startsWith('public-token-')) {
    logger.warn("Public token is malformed. Expected \"public-token-...\", got ".concat(publicToken, ".").concat(trailer));
  }
};
var checkNotSSR = function checkNotSSR(clientName) {
  var factoryFunctionName = 'createStytchHeadlessClient';
  if (typeof window === 'undefined') {
    throw new Error("`new ".concat(clientName, "()` is not supported in server environments. If using @stytch/react or @stytch/nextjs, use `").concat(factoryFunctionName, "()` instead."));
  }
};
var getDFPBackendURL = function getDFPBackendURL(opts) {
  var _a, _b, _c, _d;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.dfppaUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.dfppaDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.dfppaUrl) ? 'dfppaUrl' : 'dfppaDomain';
      logger.warn("Unable to use custom DFPPA domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return (_d = (_c = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _c === void 0 ? void 0 : _c.dfpBackendURL) !== null && _d !== void 0 ? _d : STYTCH_DFP_BACKEND_URL;
};
var getDFPCdnURL = function getDFPCdnURL(opts) {
  var _a, _b;
  var domain = (_a = opts === null || opts === void 0 ? void 0 : opts.dfpCdnUrl) !== null && _a !== void 0 ? _a : (_b = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _b === void 0 ? void 0 : _b.dfpCdnDomain;
  if (domain) {
    var httpsUrl = getHttpsUrl(domain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      var key = (opts === null || opts === void 0 ? void 0 : opts.dfpCdnUrl) ? 'dfpCdnUrl' : 'dfpCdnDomain';
      logger.warn("Unable to use custom DFP CDN domain `".concat(domain, "`. ").concat(key, " should be a valid domain."));
    }
  }
  return STYTCH_DFP_CDN_URL;
};
var isTestPublicToken = function isTestPublicToken(token) {
  return token.includes('public-token-test');
};
var createEventId = function createEventId() {
  return "event-id-".concat(v4());
};
var createAppSessionId = function createAppSessionId() {
  return "app-session-id-".concat(v4());
};
var createPersistentId = function createPersistentId() {
  return "persistent-id-".concat(v4());
};
var validate = function validate(methodName) {
  var validator = {
    isObject: function isObject(fieldName, value) {
      var isObject = _typeof(value) === 'object' && !Array.isArray(value) && value !== null;
      if (!isObject) {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be an object.');
      }
      return validator;
    },
    isOptionalObject: function isOptionalObject(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isObject(fieldName, value);
    },
    isString: function isString(fieldName, value) {
      if (typeof value !== 'string') {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be a string.');
      }
      return validator;
    },
    isOptionalString: function isOptionalString(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isString(fieldName, value);
    },
    isStringArray: function isStringArray(fieldName, value) {
      if (!Array.isArray(value)) {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be an array of strings.');
      }
      var _iterator = _createForOfIteratorHelper(value),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var str = _step.value;
          if (typeof str !== 'string') {
            throw new StytchSDKUsageError(methodName, fieldName + ' must be an array of strings.');
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return validator;
    },
    isOptionalStringArray: function isOptionalStringArray(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isStringArray(fieldName, value);
    },
    isNumber: function isNumber(fieldName, value) {
      if (typeof value !== 'number') {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be a number.');
      }
      return validator;
    },
    isOptionalNumber: function isOptionalNumber(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isNumber(fieldName, value);
    },
    isBoolean: function isBoolean(fieldName, value) {
      if (typeof value !== 'boolean') {
        throw new StytchSDKUsageError(methodName, fieldName + ' must be a boolean.');
      }
      return validator;
    },
    isOptionalBoolean: function isOptionalBoolean(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isBoolean(fieldName, value);
    }
  };
  return validator;
};
var removeResponseCommon = function removeResponseCommon(_a) {
  var rest = __rest$1(_a, ["request_id", "status_code"]);
  return rest;
};
var omitUser = function omitUser(resp) {
  var rest = __rest$1(resp, ["__user"]);
  return rest;
};
var loadTelemetryJS = function loadTelemetryJS(domain) {
  return loadESModule("".concat(domain, "/telemetry.js"), function () {
    return window.GetTelemetryID;
  });
};
var DFPProtectedAuthProvider = /*#__PURE__*/_createClass(function DFPProtectedAuthProvider(publicToken, dfpBackendURL, dfpCdnDomain, bootstrapPromise) {
  var _this2 = this;
  var executeRecaptcha = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : function () {
    return Promise.resolve(undefined);
  };
  _classCallCheck(this, DFPProtectedAuthProvider);
  this.bootstrapPromise = bootstrapPromise;
  this.isEnabled = function () {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee5() {
      return _regenerator().w(function (_context5) {
        while (1) switch (_context5.n) {
          case 0:
            return _context5.a(2, this.state.then(function (state) {
              return state.enabled;
            }));
        }
      }, _callee5, this);
    }));
  };
  this.getTelemetryID = function () {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee6() {
      var _yield$this$state, publicToken, enabled, dfpBackendURL;
      return _regenerator().w(function (_context6) {
        while (1) switch (_context6.n) {
          case 0:
            _context6.n = 1;
            return this.state;
          case 1:
            _yield$this$state = _context6.v;
            publicToken = _yield$this$state.publicToken;
            enabled = _yield$this$state.enabled;
            dfpBackendURL = _yield$this$state.dfpBackendURL;
            if (enabled) {
              _context6.n = 2;
              break;
            }
            return _context6.a(2, undefined);
          case 2:
            _context6.n = 3;
            return window.GetTelemetryID(publicToken, "".concat(dfpBackendURL, "/submit"));
          case 3:
            return _context6.a(2, _context6.v);
        }
      }, _callee6, this);
    }));
  };
  this.getDFPTelemetryIDAndCaptcha = function () {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee7() {
      var _yield$this$state2, enabled, executeRecaptcha, mode, dfp_telemetry_id, captcha_token;
      return _regenerator().w(function (_context7) {
        while (1) switch (_context7.n) {
          case 0:
            _context7.n = 1;
            return this.state;
          case 1:
            _yield$this$state2 = _context7.v;
            enabled = _yield$this$state2.enabled;
            executeRecaptcha = _yield$this$state2.executeRecaptcha;
            mode = _yield$this$state2.mode;
            dfp_telemetry_id = undefined;
            captcha_token = undefined;
            if (enabled) {
              _context7.n = 3;
              break;
            }
            _context7.n = 2;
            return executeRecaptcha();
          case 2:
            captcha_token = _context7.v;
          case 3:
            if (!(mode === 'DECISIONING')) {
              _context7.n = 5;
              break;
            }
            _context7.n = 4;
            return this.getTelemetryID();
          case 4:
            dfp_telemetry_id = _context7.v;
            _context7.n = 8;
            break;
          case 5:
            if (!(mode === 'OBSERVATION')) {
              _context7.n = 8;
              break;
            }
            _context7.n = 6;
            return this.getTelemetryID();
          case 6:
            dfp_telemetry_id = _context7.v;
            _context7.n = 7;
            return executeRecaptcha();
          case 7:
            captcha_token = _context7.v;
          case 8:
            return _context7.a(2, {
              dfp_telemetry_id: dfp_telemetry_id,
              captcha_token: captcha_token
            });
        }
      }, _callee7, this);
    }));
  };
  this.retryWithCaptchaAndDFP = function (e, req) {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee8() {
      var _yield$this$state3, enabled, executeRecaptcha;
      return _regenerator().w(function (_context8) {
        while (1) switch (_context8.n) {
          case 0:
            _context8.n = 1;
            return this.state;
          case 1:
            _yield$this$state3 = _context8.v;
            enabled = _yield$this$state3.enabled;
            executeRecaptcha = _yield$this$state3.executeRecaptcha;
            if (!(e.type === RetriableErrorType.RequiredCaptcha && enabled)) {
              _context8.n = 5;
              break;
            }
            if (!req.body) {
              _context8.n = 4;
              break;
            }
            _context8.n = 2;
            return this.getTelemetryID();
          case 2:
            req.body.dfp_telemetry_id = _context8.v;
            _context8.n = 3;
            return executeRecaptcha();
          case 3:
            req.body.captcha_token = _context8.v;
          case 4:
            return _context8.a(2, req);
          case 5:
            throw new Error('Unable to query captcha and/or dfp telemetry ID');
          case 6:
            return _context8.a(2);
        }
      }, _callee8, this);
    }));
  };
  this.state = bootstrapPromise.then(function (bootstrapData) {
    return __awaiter$1(_this2, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee9() {
      return _regenerator().w(function (_context9) {
        while (1) switch (_context9.n) {
          case 0:
            if (bootstrapData.runDFPProtectedAuth) {
              _context9.n = 1;
              break;
            }
            return _context9.a(2, {
              publicToken: publicToken,
              dfpBackendURL: dfpBackendURL,
              enabled: false,
              loaded: false,
              executeRecaptcha: executeRecaptcha
            });
          case 1:
            _context9.n = 2;
            return loadTelemetryJS(dfpCdnDomain);
          case 2:
            return _context9.a(2, {
              publicToken: publicToken,
              dfpBackendURL: dfpBackendURL,
              enabled: true,
              mode: bootstrapData.dfpProtectedAuthMode || 'OBSERVATION',
              loaded: true,
              executeRecaptcha: executeRecaptcha
            });
        }
      }, _callee9);
    }));
  });
});
var ErrorMarshaller = /*#__PURE__*/function () {
  function ErrorMarshaller() {
    _classCallCheck(this, ErrorMarshaller);
  }
  return _createClass(ErrorMarshaller, null, [{
    key: "inflate",
    value: function inflate(ErrorClass, ErrorData) {
      var err = new ErrorClass(ErrorData);
      Object.assign(err, ErrorData);
      Object.setPrototypeOf(err, ErrorClass.prototype);
      return err;
    }
  }, {
    key: "unmarshall",
    value: function unmarshall(error) {
      if ('name' in error) {
        switch (error.name) {
          case 'SDKAPIUnreachableError':
            return ErrorMarshaller.inflate(SDKAPIUnreachableError, error);
          case 'StytchSDKSchemaError':
            return ErrorMarshaller.inflate(StytchSDKSchemaError, error);
          case 'StytchAPIUnreachableError':
            return ErrorMarshaller.inflate(StytchAPIUnreachableError, error);
          case 'StytchAPISchemaError':
            return ErrorMarshaller.inflate(StytchAPISchemaError, error);
          case 'StytchSDKAPIError':
            return ErrorMarshaller.inflate(StytchSDKAPIError, error);
          case 'StytchAPIError':
            return ErrorMarshaller.inflate(StytchAPIError, error);
          case 'TypeError':
            return ErrorMarshaller.inflate(TypeError, error);
          case 'SyntaxError':
            return ErrorMarshaller.inflate(SyntaxError, error);
          case 'ReferenceError':
            return ErrorMarshaller.inflate(ReferenceError, error);
          case 'RangeError':
            return ErrorMarshaller.inflate(RangeError, error);
          case 'EvalError':
            return ErrorMarshaller.inflate(EvalError, error);
          case 'URIError':
            return ErrorMarshaller.inflate(URIError, error);
        }
      }
      return ErrorMarshaller.inflate(Error, error);
    }
  }]);
}();
var DEFAULT_MAX_BATCH_SIZE = 15;
var DEFAULT_INTERVAL_DURATION_MS = 800;
var EventLogger = /*#__PURE__*/function () {
  function EventLogger(args) {
    _classCallCheck(this, EventLogger);
    this.maxBatchSize = args.maxBatchSize;
    this.logEventURL = args.logEventURL;
    setInterval(this.flush.bind(this), args.intervalDurationMs);
    this.batch = [];
  }
  return _createClass(EventLogger, [{
    key: "logEvent",
    value: function logEvent(telemetry, event) {
      this.batch.push({
        telemetry: telemetry,
        event: event
      });
      if (this.batch.length >= this.maxBatchSize) {
        this.flush();
      }
    }
  }, {
    key: "flush",
    value: function flush() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee12() {
        var batchToSubmit;
        return _regenerator().w(function (_context12) {
          while (1) switch (_context12.p = _context12.n) {
            case 0:
              if (this.batch.length) {
                _context12.n = 1;
                break;
              }
              return _context12.a(2);
            case 1:
              batchToSubmit = this.batch;
              this.batch = [];
              _context12.p = 2;
              _context12.n = 3;
              return fetch(this.logEventURL, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(batchToSubmit)
              });
            case 3:
              _context12.n = 5;
              break;
            case 4:
              _context12.p = 4;
              _context12.v;
            case 5:
              return _context12.a(2);
          }
        }, _callee12, this, [[2, 4]]);
      }));
    }
  }]);
}();
var EmailSentType;
(function (EmailSentType) {
  EmailSentType["LoginOrCreateEML"] = "login_or_create_eml";
  EmailSentType["LoginOrCreateOTP"] = "login_or_create_otp";
  EmailSentType["ResetPassword"] = "reset_password";
})(EmailSentType || (EmailSentType = {}));
var HeadlessUserClient = /*#__PURE__*/_createClass(function HeadlessUserClient(_networkClient, _subscriptionService) {
  var _this3 = this;
  _classCallCheck(this, HeadlessUserClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.get = function () {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee13() {
      var resp, user;
      return _regenerator().w(function (_context13) {
        while (1) switch (_context13.n) {
          case 0:
            _context13.n = 1;
            return this._networkClient.fetchSDK({
              url: '/users/me',
              method: 'GET'
            });
          case 1:
            resp = _context13.v;
            user = removeResponseCommon(resp);
            this._subscriptionService.updateUser(user);
            return _context13.a(2, user);
        }
      }, _callee13, this);
    }));
  };
  this.getSync = function () {
    return _this3._subscriptionService.getUser();
  };
  this.getInfo = function () {
    return {
      user: _this3.getSync(),
      fromCache: _this3._subscriptionService.getFromCache()
    };
  };
  this.update = function (options) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee14() {
      var resp, user;
      return _regenerator().w(function (_context14) {
        while (1) switch (_context14.n) {
          case 0:
            validate('stytch.user.update').isOptionalObject('untrusted_metadata', options.untrusted_metadata);
            _context14.n = 1;
            return this._networkClient.fetchSDK({
              url: '/users/me',
              body: options,
              method: 'PUT'
            });
          case 1:
            resp = _context14.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context14.a(2, omitUser(resp));
        }
      }, _callee14, this);
    }));
  };
  this.deleteEmail = function (emailId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee15() {
      var resp, user;
      return _regenerator().w(function (_context15) {
        while (1) switch (_context15.n) {
          case 0:
            _context15.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/emails/".concat(emailId),
              method: 'DELETE'
            });
          case 1:
            resp = _context15.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context15.a(2, omitUser(resp));
        }
      }, _callee15, this);
    }));
  };
  this.deletePhoneNumber = function (phoneId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee16() {
      var resp, user;
      return _regenerator().w(function (_context16) {
        while (1) switch (_context16.n) {
          case 0:
            _context16.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/phone_numbers/".concat(phoneId),
              method: 'DELETE'
            });
          case 1:
            resp = _context16.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context16.a(2, omitUser(resp));
        }
      }, _callee16, this);
    }));
  };
  this.deleteTOTP = function (totpId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee17() {
      var resp, user;
      return _regenerator().w(function (_context17) {
        while (1) switch (_context17.n) {
          case 0:
            _context17.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/totps/".concat(totpId),
              method: 'DELETE'
            });
          case 1:
            resp = _context17.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context17.a(2, omitUser(resp));
        }
      }, _callee17, this);
    }));
  };
  this.deleteCryptoWallet = function (cryptoWalletId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee18() {
      var resp, user;
      return _regenerator().w(function (_context18) {
        while (1) switch (_context18.n) {
          case 0:
            _context18.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/crypto_wallets/".concat(cryptoWalletId),
              method: 'DELETE'
            });
          case 1:
            resp = _context18.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context18.a(2, omitUser(resp));
        }
      }, _callee18, this);
    }));
  };
  this.deleteOAuthRegistration = function (oauthUserRegistrationId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee19() {
      var resp, user;
      return _regenerator().w(function (_context19) {
        while (1) switch (_context19.n) {
          case 0:
            _context19.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/oauth/".concat(oauthUserRegistrationId),
              method: 'DELETE'
            });
          case 1:
            resp = _context19.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context19.a(2, omitUser(resp));
        }
      }, _callee19, this);
    }));
  };
  this.deleteWebauthnRegistration = function (webAuthnId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee20() {
      var resp, user;
      return _regenerator().w(function (_context20) {
        while (1) switch (_context20.n) {
          case 0:
            _context20.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/webauthn_registrations/".concat(webAuthnId),
              method: 'DELETE'
            });
          case 1:
            resp = _context20.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context20.a(2, omitUser(resp));
        }
      }, _callee20, this);
    }));
  };
  this.deleteBiometricRegistration = function (biometricRegistrationId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee21() {
      var resp, user;
      return _regenerator().w(function (_context21) {
        while (1) switch (_context21.n) {
          case 0:
            _context21.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/biometric_registrations/".concat(biometricRegistrationId),
              method: 'DELETE'
            });
          case 1:
            resp = _context21.v;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context21.a(2, omitUser(resp));
        }
      }, _callee21, this);
    }));
  };
  this.onChange = function (callback) {
    var lastVal = _this3._subscriptionService.getUser();
    var listener = function listener(state) {
      var _a;
      if ((state === null || state === void 0 ? void 0 : state.user) !== lastVal) {
        lastVal = (_a = state === null || state === void 0 ? void 0 : state.user) !== null && _a !== void 0 ? _a : null;
        callback(lastVal);
      }
    };
    return _this3._subscriptionService.subscribeToState(listener);
  };
  this.getConnectedApps = function () {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee22() {
      return _regenerator().w(function (_context22) {
        while (1) switch (_context22.n) {
          case 0:
            _context22.n = 1;
            return this._networkClient.fetchSDK({
              url: '/users/connected_apps',
              method: 'GET'
            });
          case 1:
            return _context22.a(2, _context22.v);
        }
      }, _callee22, this);
    }));
  };
  this.revokedConnectedApp = function (connectedAppId) {
    return __awaiter$1(_this3, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee23() {
      return _regenerator().w(function (_context23) {
        while (1) switch (_context23.n) {
          case 0:
            _context23.n = 1;
            return this._networkClient.fetchSDK({
              url: "/users/connected_apps/".concat(connectedAppId, "/revoke"),
              method: 'POST'
            });
          case 1:
            return _context23.a(2, _context23.v);
        }
      }, _callee23, this);
    }));
  };
});
var HeadlessSessionClient = /*#__PURE__*/function () {
  function HeadlessSessionClient(_networkClient, _subscriptionService) {
    var _this4 = this;
    _classCallCheck(this, HeadlessSessionClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.getSync = function () {
      return _this4._subscriptionService.getSession();
    };
    this.getInfo = function () {
      var session = _this4.getSync();
      var fromCache = _this4._subscriptionService.getFromCache();
      return {
        session: session,
        fromCache: fromCache
      };
    };
    this.onChange = function (callback) {
      var lastVal = _this4._subscriptionService.getSession();
      var listener = function listener(state) {
        var _a;
        if ((state === null || state === void 0 ? void 0 : state.session) !== lastVal) {
          lastVal = (_a = state === null || state === void 0 ? void 0 : state.session) !== null && _a !== void 0 ? _a : null;
          callback(lastVal);
        }
      };
      return _this4._subscriptionService.subscribeToState(listener);
    };
    this.revoke = function (options) {
      return __awaiter$1(_this4, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee24() {
        var resp, _t7;
        return _regenerator().w(function (_context24) {
          while (1) switch (_context24.p = _context24.n) {
            case 0:
              _context24.p = 0;
              _context24.n = 1;
              return this._networkClient.fetchSDK({
                url: "/sessions/revoke",
                method: 'POST'
              });
            case 1:
              resp = _context24.v;
              this._subscriptionService.destroyState();
              return _context24.a(2, resp);
            case 2:
              _context24.p = 2;
              _t7 = _context24.v;
              if (options === null || options === void 0 ? void 0 : options.forceClear) {
                this._subscriptionService.destroyState();
              } else if (UNRECOVERABLE_ERROR_TYPES.includes(_t7.error_type)) {
                this._subscriptionService.destroyState();
              }
              throw _t7;
            case 3:
              return _context24.a(2);
          }
        }, _callee24, this, [[0, 2]]);
      }));
    };
    this._authenticate = function (options) {
      return __awaiter$1(_this4, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee25() {
        var _this5 = this;
        var initialSession, isSessionStale, requestBody, resp, _t8;
        return _regenerator().w(function (_context25) {
          while (1) switch (_context25.p = _context25.n) {
            case 0:
              initialSession = this._subscriptionService.getSession();
              isSessionStale = function isSessionStale() {
                var _a;
                return (initialSession === null || initialSession === void 0 ? void 0 : initialSession.session_id) !== ((_a = _this5._subscriptionService.getSession()) === null || _a === void 0 ? void 0 : _a.session_id);
              };
              _context25.p = 1;
              requestBody = {
                session_duration_minutes: options === null || options === void 0 ? void 0 : options.session_duration_minutes
              };
              _context25.n = 2;
              return this._networkClient.fetchSDK({
                url: '/sessions/authenticate',
                body: requestBody,
                method: 'POST'
              });
            case 2:
              resp = _context25.v;
              if (!isSessionStale()) {
                _context25.n = 3;
                break;
              }
              return _context25.a(2, this._authenticate(options));
            case 3:
              return _context25.a(2, omitUser(resp));
            case 4:
              _context25.p = 4;
              _t8 = _context25.v;
              if (!isSessionStale()) {
                _context25.n = 5;
                break;
              }
              return _context25.a(2, this._authenticate(options));
            case 5:
              if (UNRECOVERABLE_ERROR_TYPES.includes(_t8.error_type)) {
                this._subscriptionService.destroySession();
              }
              throw _t8;
            case 6:
              return _context25.a(2);
          }
        }, _callee25, this, [[1, 4]]);
      }));
    };
    this.authenticate = this._subscriptionService.withUpdateSession(this._authenticate);
    this.exchangeAccessToken = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this4, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee26() {
        var resp;
        return _regenerator().w(function (_context26) {
          while (1) switch (_context26.n) {
            case 0:
              validate('stytch.session.exchangeAccessToken').isString('access_token', data.access_token).isNumber('session_duration_minutes', data.session_duration_minutes);
              _context26.n = 1;
              return this._networkClient.fetchSDK({
                url: '/sessions/exchange_access_token',
                body: data,
                method: 'POST'
              });
            case 1:
              resp = _context26.v;
              return _context26.a(2, omitUser(resp));
          }
        }, _callee26, this);
      }));
    });
    this.attest = this._subscriptionService.withUpdateSession(function (data) {
      return __awaiter$1(_this4, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee27() {
        return _regenerator().w(function (_context27) {
          while (1) switch (_context27.n) {
            case 0:
              validate('stytch.session.attest').isString('profile_id', data.profile_id).isString('token', data.token).isOptionalNumber('session_duration_minutes', data.session_duration_minutes);
              return _context27.a(2, this._networkClient.fetchSDK({
                url: '/sessions/attest',
                body: data,
                method: 'POST'
              }));
          }
        }, _callee27, this);
      }));
    });
  }
  return _createClass(HeadlessSessionClient, [{
    key: "getTokens",
    value: function getTokens() {
      return this._subscriptionService.getTokens();
    }
  }, {
    key: "updateSession",
    value: function updateSession(tokens) {
      var _a;
      validate('stytch.session.updateSession').isString('session_token', tokens.session_token).isOptionalString('session_jwt', (_a = tokens.session_jwt) !== null && _a !== void 0 ? _a : undefined);
      this._subscriptionService.updateTokens(tokens);
    }
  }]);
}();
var DefaultDynamicConfig$4 = Promise.resolve({
  pkceRequiredForEmailMagicLinks: false
});
var HeadlessMagicLinksClient = /*#__PURE__*/function () {
  function HeadlessMagicLinksClient(_networkClient, _subscriptionService, _pkceManager, _passwordResetPKCEManager) {
    var _this6 = this;
    var _config = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : DefaultDynamicConfig$4;
    var dfpProtectedAuth = arguments.length > 5 ? arguments[5] : undefined;
    _classCallCheck(this, HeadlessMagicLinksClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._passwordResetPKCEManager = _passwordResetPKCEManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.email = {
      loginOrCreate: function loginOrCreate(email) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        return __awaiter$1(_this6, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee28() {
          var _yield$this$_config, pkceRequiredForEmailMagicLinks, code_challenge, _yield$this$dfpProtec, dfp_telemetry_id, captcha_token, requestBody;
          return _regenerator().w(function (_context28) {
            while (1) switch (_context28.n) {
              case 0:
                _context28.n = 1;
                return this._config;
              case 1:
                _yield$this$_config = _context28.v;
                pkceRequiredForEmailMagicLinks = _yield$this$_config.pkceRequiredForEmailMagicLinks;
                code_challenge = undefined;
                if (!pkceRequiredForEmailMagicLinks) {
                  _context28.n = 3;
                  break;
                }
                _context28.n = 2;
                return this.getCodeChallenge();
              case 2:
                code_challenge = _context28.v;
              case 3:
                _context28.n = 4;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 4:
                _yield$this$dfpProtec = _context28.v;
                dfp_telemetry_id = _yield$this$dfpProtec.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec.captcha_token;
                requestBody = Object.assign(Object.assign({}, options), {
                  email: email,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                });
                return _context28.a(2, this._networkClient.retriableFetchSDK({
                  url: '/magic_links/email/login_or_create',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
            }
          }, _callee28, this);
        }));
      },
      send: function send(email) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        return __awaiter$1(_this6, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee29() {
          var _yield$this$_config2, pkceRequiredForEmailMagicLinks, code_challenge, _yield$this$dfpProtec2, dfp_telemetry_id, captcha_token, requestBody, isLoggedIn, endpoint;
          return _regenerator().w(function (_context29) {
            while (1) switch (_context29.n) {
              case 0:
                _context29.n = 1;
                return this._config;
              case 1:
                _yield$this$_config2 = _context29.v;
                pkceRequiredForEmailMagicLinks = _yield$this$_config2.pkceRequiredForEmailMagicLinks;
                code_challenge = undefined;
                if (!pkceRequiredForEmailMagicLinks) {
                  _context29.n = 3;
                  break;
                }
                _context29.n = 2;
                return this.getCodeChallenge();
              case 2:
                code_challenge = _context29.v;
              case 3:
                _context29.n = 4;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 4:
                _yield$this$dfpProtec2 = _context29.v;
                dfp_telemetry_id = _yield$this$dfpProtec2.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec2.captcha_token;
                requestBody = Object.assign(Object.assign({}, options), {
                  email: email,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                });
                isLoggedIn = !!this._subscriptionService.getSession();
                endpoint = isLoggedIn ? '/magic_links/email/send/secondary' : '/magic_links/email/send/primary';
                return _context29.a(2, this._networkClient.retriableFetchSDK({
                  url: endpoint,
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
            }
          }, _callee29, this);
        }));
      }
    };
    this.authenticate = this._subscriptionService.withUpdateSession(function (token, options) {
      return __awaiter$1(_this6, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee30() {
        var passwordResetPKPair, resp, _t9;
        return _regenerator().w(function (_context30) {
          while (1) switch (_context30.p = _context30.n) {
            case 0:
              validate('stytch.magicLinks.authenticate').isString('Token', token).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context30.n = 1;
              return this._passwordResetPKCEManager.getPKPair();
            case 1:
              passwordResetPKPair = _context30.v;
              resp = null;
              if (!(passwordResetPKPair === null || passwordResetPKPair === void 0 ? void 0 : passwordResetPKPair.code_verifier)) {
                _context30.n = 6;
                break;
              }
              _context30.p = 2;
              _context30.n = 3;
              return this.handlePKCEForAuthenticate(this._passwordResetPKCEManager, Object.assign(Object.assign({}, options), {
                token: token
              }));
            case 3:
              resp = _context30.v;
              _context30.n = 6;
              break;
            case 4:
              _context30.p = 4;
              _t9 = _context30.v;
              if (!_t9.message.includes('pkce')) {
                _context30.n = 5;
                break;
              }
              console.log('Authenticate with passwords pkce namespace failed. Falling back to authenticate with magic_links namespace.');
              _context30.n = 6;
              break;
            case 5:
              throw _t9;
            case 6:
              if (resp) {
                _context30.n = 8;
                break;
              }
              _context30.n = 7;
              return this.handlePKCEForAuthenticate(this._pkceManager, Object.assign(Object.assign({}, options), {
                token: token
              }));
            case 7:
              resp = _context30.v;
            case 8:
              return _context30.a(2, omitUser(resp));
          }
        }, _callee30, this, [[2, 4]]);
      }));
    });
  }
  return _createClass(HeadlessMagicLinksClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee31() {
        var keyPair;
        return _regenerator().w(function (_context31) {
          while (1) switch (_context31.n) {
            case 0:
              _context31.n = 1;
              return this._pkceManager.getPKPair();
            case 1:
              keyPair = _context31.v;
              if (!keyPair) {
                _context31.n = 2;
                break;
              }
              return _context31.a(2, keyPair.code_challenge);
            case 2:
              _context31.n = 3;
              return this._pkceManager.startPKCETransaction();
            case 3:
              keyPair = _context31.v;
              return _context31.a(2, keyPair.code_challenge);
          }
        }, _callee31, this);
      }));
    }
  }, {
    key: "handlePKCEForAuthenticate",
    value: function handlePKCEForAuthenticate(pkceManager, data) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee32() {
        var pkPair, requestBody, resp;
        return _regenerator().w(function (_context32) {
          while (1) switch (_context32.n) {
            case 0:
              _context32.n = 1;
              return pkceManager.getPKPair();
            case 1:
              pkPair = _context32.v;
              requestBody = Object.assign({
                code_verifier: pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier
              }, data);
              _context32.n = 2;
              return this._networkClient.fetchSDK({
                url: '/magic_links/authenticate',
                body: requestBody,
                method: 'POST'
              });
            case 2:
              resp = _context32.v;
              pkceManager.clearPKPair();
              return _context32.a(2, resp);
          }
        }, _callee32, this);
      }));
    }
  }]);
}();
var HeadlessOTPClient = /*#__PURE__*/_createClass(function HeadlessOTPClient(_networkClient, _subscriptionService) {
  var _this7 = this;
  var executeRecaptcha = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {
    return Promise.resolve(undefined);
  };
  var dfpProtectedAuth = arguments.length > 3 ? arguments[3] : undefined;
  _classCallCheck(this, HeadlessOTPClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.executeRecaptcha = executeRecaptcha;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.sms = {
    loginOrCreate: function loginOrCreate(phone_number, options) {
      return __awaiter$1(_this7, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee33() {
        var _yield$this$dfpProtec3, dfp_telemetry_id, captcha_token, requestBody;
        return _regenerator().w(function (_context33) {
          while (1) switch (_context33.n) {
            case 0:
              _context33.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec3 = _context33.v;
              dfp_telemetry_id = _yield$this$dfpProtec3.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec3.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              return _context33.a(2, this._networkClient.retriableFetchSDK({
                url: '/otps/sms/login_or_create',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee33, this);
      }));
    },
    send: function send(phone_number, options) {
      return __awaiter$1(_this7, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee34() {
        var _yield$this$dfpProtec4, dfp_telemetry_id, captcha_token, requestBody, isLoggedIn, endpoint;
        return _regenerator().w(function (_context34) {
          while (1) switch (_context34.n) {
            case 0:
              _context34.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec4 = _context34.v;
              dfp_telemetry_id = _yield$this$dfpProtec4.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec4.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/otps/sms/send/secondary' : '/otps/sms/send/primary';
              return _context34.a(2, this._networkClient.retriableFetchSDK({
                url: endpoint,
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee34, this);
      }));
    }
  };
  this.whatsapp = {
    loginOrCreate: function loginOrCreate(phone_number, options) {
      return __awaiter$1(_this7, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee35() {
        var _yield$this$dfpProtec5, dfp_telemetry_id, captcha_token, requestBody;
        return _regenerator().w(function (_context35) {
          while (1) switch (_context35.n) {
            case 0:
              _context35.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec5 = _context35.v;
              dfp_telemetry_id = _yield$this$dfpProtec5.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec5.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token
              });
              return _context35.a(2, this._networkClient.retriableFetchSDK({
                url: '/otps/whatsapp/login_or_create',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee35, this);
      }));
    },
    send: function send(phone_number, options) {
      return __awaiter$1(_this7, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee36() {
        var _yield$this$dfpProtec6, dfp_telemetry_id, captcha_token, requestBody, isLoggedIn, endpoint;
        return _regenerator().w(function (_context36) {
          while (1) switch (_context36.n) {
            case 0:
              _context36.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec6 = _context36.v;
              dfp_telemetry_id = _yield$this$dfpProtec6.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec6.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/otps/whatsapp/send/secondary' : '/otps/whatsapp/send/primary';
              return _context36.a(2, this._networkClient.retriableFetchSDK({
                url: endpoint,
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee36, this);
      }));
    }
  };
  this.email = {
    loginOrCreate: function loginOrCreate(email, options) {
      return __awaiter$1(_this7, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee37() {
        var _yield$this$dfpProtec7, dfp_telemetry_id, captcha_token, requestBody;
        return _regenerator().w(function (_context37) {
          while (1) switch (_context37.n) {
            case 0:
              _context37.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec7 = _context37.v;
              dfp_telemetry_id = _yield$this$dfpProtec7.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec7.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                email: email,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              return _context37.a(2, this._networkClient.retriableFetchSDK({
                url: '/otps/email/login_or_create',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee37, this);
      }));
    },
    send: function send(email, options) {
      return __awaiter$1(_this7, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee38() {
        var captcha_token, requestBody, isLoggedIn, endpoint;
        return _regenerator().w(function (_context38) {
          while (1) switch (_context38.n) {
            case 0:
              _context38.n = 1;
              return this.executeRecaptcha();
            case 1:
              captcha_token = _context38.v;
              requestBody = Object.assign(Object.assign({}, options), {
                email: email,
                captcha_token: captcha_token
              });
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/otps/email/send/secondary' : '/otps/email/send/primary';
              return _context38.a(2, this._networkClient.fetchSDK({
                url: endpoint,
                body: requestBody,
                method: 'POST'
              }));
          }
        }, _callee38, this);
      }));
    }
  };
  this.authenticate = this._subscriptionService.withUpdateSession(function (code, method_id, options) {
    return __awaiter$1(_this7, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee39() {
      var _yield$this$dfpProtec8, dfp_telemetry_id, captcha_token, requestBody, resp;
      return _regenerator().w(function (_context39) {
        while (1) switch (_context39.n) {
          case 0:
            validate('stytch.otps.authenticate').isString('Code', code).isNumber('session_duration_minutes', options.session_duration_minutes);
            _context39.n = 1;
            return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
          case 1:
            _yield$this$dfpProtec8 = _context39.v;
            dfp_telemetry_id = _yield$this$dfpProtec8.dfp_telemetry_id;
            captcha_token = _yield$this$dfpProtec8.captcha_token;
            requestBody = Object.assign({
              token: code,
              method_id: method_id,
              dfp_telemetry_id: dfp_telemetry_id,
              captcha_token: captcha_token
            }, options);
            _context39.n = 2;
            return this._networkClient.retriableFetchSDK({
              url: '/otps/authenticate',
              body: requestBody,
              method: 'POST',
              retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
            });
          case 2:
            resp = _context39.v;
            return _context39.a(2, omitUser(resp));
        }
      }, _callee39, this);
    }));
  });
});
var HeadlessOAuthClient$1 = /*#__PURE__*/function () {
  function HeadlessOAuthClient(_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config) {
    var _this8 = this;
    _classCallCheck(this, HeadlessOAuthClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._dynamicConfig = _dynamicConfig;
    this._config = _config;
    this.google = {
      start: this.startOAuthFlow(exports.OAuthProviders.Google)
    };
    this.apple = {
      start: this.startOAuthFlow(exports.OAuthProviders.Apple)
    };
    this.microsoft = {
      start: this.startOAuthFlow(exports.OAuthProviders.Microsoft)
    };
    this.github = {
      start: this.startOAuthFlow(exports.OAuthProviders.Github)
    };
    this.gitlab = {
      start: this.startOAuthFlow(exports.OAuthProviders.GitLab)
    };
    this.facebook = {
      start: this.startOAuthFlow(exports.OAuthProviders.Facebook)
    };
    this.discord = {
      start: this.startOAuthFlow(exports.OAuthProviders.Discord)
    };
    this.salesforce = {
      start: this.startOAuthFlow(exports.OAuthProviders.Salesforce)
    };
    this.slack = {
      start: this.startOAuthFlow(exports.OAuthProviders.Slack)
    };
    this.amazon = {
      start: this.startOAuthFlow(exports.OAuthProviders.Amazon)
    };
    this.bitbucket = {
      start: this.startOAuthFlow(exports.OAuthProviders.Bitbucket)
    };
    this.linkedin = {
      start: this.startOAuthFlow(exports.OAuthProviders.LinkedIn)
    };
    this.coinbase = {
      start: this.startOAuthFlow(exports.OAuthProviders.Coinbase)
    };
    this.twitch = {
      start: this.startOAuthFlow(exports.OAuthProviders.Twitch)
    };
    this.twitter = {
      start: this.startOAuthFlow(exports.OAuthProviders.Twitter)
    };
    this.tiktok = {
      start: this.startOAuthFlow(exports.OAuthProviders.TikTok)
    };
    this.snapchat = {
      start: this.startOAuthFlow(exports.OAuthProviders.Snapchat)
    };
    this.figma = {
      start: this.startOAuthFlow(exports.OAuthProviders.Figma)
    };
    this.yahoo = {
      start: this.startOAuthFlow(exports.OAuthProviders.Yahoo)
    };
    this.authenticate = this._subscriptionService.withUpdateSession(function (token, options) {
      return __awaiter$1(_this8, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee40() {
        var keyPair, resp;
        return _regenerator().w(function (_context40) {
          while (1) switch (_context40.n) {
            case 0:
              validate('stytch.oauth.authenticate').isString('Token', token).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context40.n = 1;
              return this._pkceManager.getPKPair();
            case 1:
              keyPair = _context40.v;
              if (!keyPair) {
                logger.warn('No code verifier found in local storage for OAuth flow.\n' + 'Consider using stytch.oauth.$provider.start() to add PKCE to your OAuth flows for added security.\n' + 'See https://stytch.com/docs/oauth#guides_pkce for more information.');
              }
              _context40.n = 2;
              return this._networkClient.fetchSDK({
                url: '/oauth/authenticate',
                method: 'POST',
                body: Object.assign({
                  token: token,
                  code_verifier: keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier
                }, options)
              });
            case 2:
              resp = _context40.v;
              this._pkceManager.clearPKPair();
              return _context40.a(2, omitUser(resp));
          }
        }, _callee40, this);
      }));
    });
  }
  return _createClass(HeadlessOAuthClient, [{
    key: "attach",
    value: function attach(provider) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee41() {
        return _regenerator().w(function (_context41) {
          while (1) switch (_context41.n) {
            case 0:
              validate('stytch.oauth.attach').isString('Provider', provider);
              _context41.n = 1;
              return this._networkClient.fetchSDK({
                url: '/oauth/attach',
                method: 'POST',
                body: {
                  provider: provider
                }
              });
            case 1:
              return _context41.a(2, _context41.v);
          }
        }, _callee41, this);
      }));
    }
  }, {
    key: "getBaseApiUrl",
    value: function getBaseApiUrl() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee42() {
        var _yield$this$_dynamicC, cnameDomain;
        return _regenerator().w(function (_context42) {
          while (1) switch (_context42.n) {
            case 0:
              _context42.n = 1;
              return this._dynamicConfig;
            case 1:
              _yield$this$_dynamicC = _context42.v;
              cnameDomain = _yield$this$_dynamicC.cnameDomain;
              if (!cnameDomain) {
                _context42.n = 2;
                break;
              }
              return _context42.a(2, "https://".concat(cnameDomain));
            case 2:
              if (!isTestPublicToken(this._config.publicToken)) {
                _context42.n = 3;
                break;
              }
              return _context42.a(2, this._config.testAPIURL);
            case 3:
              return _context42.a(2, this._config.liveAPIURL);
          }
        }, _callee42, this);
      }));
    }
  }, {
    key: "startOAuthFlow",
    value: function startOAuthFlow(providerType) {
      var _this9 = this;
      return function () {
        var _ref6 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          login_redirect_url = _ref6.login_redirect_url,
          signup_redirect_url = _ref6.signup_redirect_url,
          custom_scopes = _ref6.custom_scopes,
          provider_params = _ref6.provider_params,
          oauth_attach_token = _ref6.oauth_attach_token;
        return __awaiter$1(_this9, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee43() {
          var _yield$this$_dynamicC2, cnameDomain, pkceRequiredForOAuth, baseURL, oauthUrl, keyPair, key;
          return _regenerator().w(function (_context43) {
            while (1) switch (_context43.n) {
              case 0:
                _context43.n = 1;
                return this._dynamicConfig;
              case 1:
                _yield$this$_dynamicC2 = _context43.v;
                cnameDomain = _yield$this$_dynamicC2.cnameDomain;
                pkceRequiredForOAuth = _yield$this$_dynamicC2.pkceRequiredForOAuth;
                _context43.n = 2;
                return this.getBaseApiUrl();
              case 2:
                baseURL = _context43.v;
                this._networkClient.logEvent({
                  name: 'start_oauth_flow',
                  details: {
                    provider_type: providerType,
                    custom_scopes: custom_scopes,
                    cname_domain: cnameDomain,
                    pkce: pkceRequiredForOAuth,
                    provider_params: provider_params
                  }
                });
                oauthUrl = new URL("".concat(baseURL, "/v1/public/oauth/").concat(providerType, "/start"));
                oauthUrl.searchParams.set('public_token', this._config.publicToken);
                if (!pkceRequiredForOAuth) {
                  _context43.n = 4;
                  break;
                }
                _context43.n = 3;
                return this._pkceManager.startPKCETransaction();
              case 3:
                keyPair = _context43.v;
                oauthUrl.searchParams.set('code_challenge', keyPair.code_challenge);
                _context43.n = 5;
                break;
              case 4:
                this._pkceManager.clearPKPair();
              case 5:
                if (custom_scopes) {
                  validate('startOAuthFlow').isStringArray('custom_scopes', custom_scopes);
                  oauthUrl.searchParams.set('custom_scopes', custom_scopes.join(' '));
                }
                if (provider_params) {
                  validate('startOAuthFlow').isOptionalObject('provider_params', provider_params);
                  for (key in provider_params) {
                    oauthUrl.searchParams.set('provider_' + key, provider_params[key]);
                  }
                }
                if (login_redirect_url) oauthUrl.searchParams.set('login_redirect_url', login_redirect_url);
                if (signup_redirect_url) oauthUrl.searchParams.set('signup_redirect_url', signup_redirect_url);
                if (oauth_attach_token) oauthUrl.searchParams.set('oauth_attach_token', oauth_attach_token);
                window.location.href = oauthUrl.toString();
              case 6:
                return _context43.a(2);
            }
          }, _callee43, this);
        }));
      };
    }
  }]);
}();
var DefaultDynamicConfig$3 = Promise.resolve({
  siweRequiredForCryptoWallets: false
});
var HeadlessCryptoWalletClient = /*#__PURE__*/function () {
  function HeadlessCryptoWalletClient(_networkClient, _apiNetworkClient, _subscriptionService) {
    var _this0 = this;
    var executeRecaptcha = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function () {
      return Promise.resolve(undefined);
    };
    var dfpProtectedAuth = arguments.length > 4 ? arguments[4] : undefined;
    var _config = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : DefaultDynamicConfig$3;
    _classCallCheck(this, HeadlessCryptoWalletClient);
    this._networkClient = _networkClient;
    this._apiNetworkClient = _apiNetworkClient;
    this._subscriptionService = _subscriptionService;
    this.executeRecaptcha = executeRecaptcha;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this._config = _config;
    this.authenticate = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this0, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee44() {
        var _yield$this$dfpProtec9, dfp_telemetry_id, captcha_token, resp;
        return _regenerator().w(function (_context44) {
          while (1) switch (_context44.n) {
            case 0:
              validate('stytch.cryptoWallets.authenticate').isString('signature', options.signature).isString('crypto_wallet_address', options.crypto_wallet_address).isString('crypto_wallet_type', options.crypto_wallet_type).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context44.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec9 = _context44.v;
              dfp_telemetry_id = _yield$this$dfpProtec9.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec9.captcha_token;
              _context44.n = 2;
              return this._apiNetworkClient.retriableFetchSDK({
                url: '/crypto_wallets/authenticate',
                method: 'POST',
                body: {
                  session_duration_minutes: options.session_duration_minutes,
                  crypto_wallet_address: options.crypto_wallet_address,
                  crypto_wallet_type: options.crypto_wallet_type,
                  signature: options.signature,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 2:
              resp = _context44.v;
              return _context44.a(2, omitUser(resp));
          }
        }, _callee44, this);
      }));
    });
  }
  return _createClass(HeadlessCryptoWalletClient, [{
    key: "authenticateStart",
    value: function authenticateStart(options) {
      var _a;
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee45() {
        var isLoggedIn, captcha_token, _yield$this$_config3, siweRequiredForCryptoWallets, body, endpoint, requestBody;
        return _regenerator().w(function (_context45) {
          while (1) switch (_context45.n) {
            case 0:
              validate('stytch.cryptoWallets.authenticateStart').isString('crypto_wallet_address', options.crypto_wallet_address).isString('crypto_wallet_type', options.crypto_wallet_type);
              if (options.siwe_params) {
                validate('stytch.cryptoWallets.authenticateStart').isOptionalString('uri', options.siwe_params.uri).isOptionalString('chain_id', options.siwe_params.chain_id).isOptionalString('issued_at', options.siwe_params.issued_at).isOptionalString('statement', options.siwe_params.statement).isOptionalString('not_before', options.siwe_params.not_before).isOptionalString('message_request_id', options.siwe_params.message_request_id).isOptionalStringArray('resources', options.siwe_params.resources);
              }
              isLoggedIn = !!this._subscriptionService.getSession();
              _context45.n = 1;
              return this.executeRecaptcha();
            case 1:
              captcha_token = _context45.v;
              _context45.n = 2;
              return this._config;
            case 2:
              _yield$this$_config3 = _context45.v;
              siweRequiredForCryptoWallets = _yield$this$_config3.siweRequiredForCryptoWallets;
              body = {
                crypto_wallet_address: options.crypto_wallet_address,
                crypto_wallet_type: options.crypto_wallet_type
              };
              if (siweRequiredForCryptoWallets && options.crypto_wallet_type == 'ethereum') {
                body.siwe_params = Object.assign(Object.assign({}, options.siwe_params), {
                  uri: ((_a = options.siwe_params) === null || _a === void 0 ? void 0 : _a.uri) || window.location.origin
                });
              }
              endpoint = isLoggedIn ? '/crypto_wallets/authenticate/start/secondary' : '/crypto_wallets/authenticate/start/primary';
              requestBody = Object.assign(Object.assign({}, body), {
                captcha_token: captcha_token
              });
              return _context45.a(2, this._apiNetworkClient.fetchSDK({
                url: endpoint,
                method: 'POST',
                body: requestBody
              }));
          }
        }, _callee45, this);
      }));
    }
  }]);
}();
var HeadlessTOTPClient = /*#__PURE__*/function () {
  function HeadlessTOTPClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    var _this1 = this;
    _classCallCheck(this, HeadlessTOTPClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.authenticate = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this1, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee46() {
        var _yield$this$dfpProtec0, dfp_telemetry_id, captcha_token, resp;
        return _regenerator().w(function (_context46) {
          while (1) switch (_context46.n) {
            case 0:
              validate('stytch.totps.authenticate').isNumber('session_duration_minutes', options.session_duration_minutes).isString('totp_code', options.totp_code);
              _context46.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec0 = _context46.v;
              dfp_telemetry_id = _yield$this$dfpProtec0.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec0.captcha_token;
              _context46.n = 2;
              return this._networkClient.retriableFetchSDK({
                url: '/totps/authenticate',
                method: 'POST',
                body: {
                  session_duration_minutes: options.session_duration_minutes,
                  totp_code: options.totp_code,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 2:
              resp = _context46.v;
              return _context46.a(2, omitUser(resp));
          }
        }, _callee46, this);
      }));
    });
    this.recover = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this1, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee47() {
        var _yield$this$dfpProtec1, dfp_telemetry_id, captcha_token, resp;
        return _regenerator().w(function (_context47) {
          while (1) switch (_context47.n) {
            case 0:
              validate('stytch.totps.recover').isNumber('session_duration_minutes', options.session_duration_minutes).isString('recovery_code', options.recovery_code);
              _context47.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec1 = _context47.v;
              dfp_telemetry_id = _yield$this$dfpProtec1.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec1.captcha_token;
              _context47.n = 2;
              return this._networkClient.retriableFetchSDK({
                url: '/totps/recover',
                method: 'POST',
                body: {
                  session_duration_minutes: options.session_duration_minutes,
                  recovery_code: options.recovery_code,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 2:
              resp = _context47.v;
              return _context47.a(2, omitUser(resp));
          }
        }, _callee47, this);
      }));
    });
  }
  return _createClass(HeadlessTOTPClient, [{
    key: "create",
    value: function create(options) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee48() {
        var resp;
        return _regenerator().w(function (_context48) {
          while (1) switch (_context48.n) {
            case 0:
              validate('stytch.totps.create').isNumber('expiration_minutes', options.expiration_minutes);
              _context48.n = 1;
              return this._networkClient.fetchSDK({
                url: '/totps',
                method: 'POST',
                body: {
                  expiration_minutes: options.expiration_minutes
                }
              });
            case 1:
              resp = _context48.v;
              this._subscriptionService.updateUser(resp.__user);
              return _context48.a(2, omitUser(resp));
          }
        }, _callee48, this);
      }));
    }
  }, {
    key: "recoveryCodes",
    value: function recoveryCodes() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee49() {
        return _regenerator().w(function (_context49) {
          while (1) switch (_context49.n) {
            case 0:
              return _context49.a(2, this._networkClient.fetchSDK({
                url: '/totps/recovery_codes',
                method: 'POST'
              }));
          }
        }, _callee49, this);
      }));
    }
  }]);
}();
function base64urlToBuffer(baseurl64String) {
  var padding = "==".slice(0, (4 - baseurl64String.length % 4) % 4);
  var base64String = baseurl64String.replace(/-/g, "+").replace(/_/g, "/") + padding;
  var str = atob(base64String);
  var buffer = new ArrayBuffer(str.length);
  var byteView = new Uint8Array(buffer);
  for (var _i = 0; _i < str.length; _i++) {
    byteView[_i] = str.charCodeAt(_i);
  }
  return buffer;
}
function bufferToBase64url(buffer) {
  var byteView = new Uint8Array(buffer);
  var str = "";
  var _iterator2 = _createForOfIteratorHelper(byteView),
    _step2;
  try {
    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
      var charCode = _step2.value;
      str += String.fromCharCode(charCode);
    }
  } catch (err) {
    _iterator2.e(err);
  } finally {
    _iterator2.f();
  }
  var base64String = btoa(str);
  var base64urlString = base64String.replace(/\+/g, "-").replace(/\//g, "_").replace(/=/g, "");
  return base64urlString;
}
var copyValue = "copy";
var convertValue = "convert";
function convert(conversionFn, schema2, input) {
  if (schema2 === copyValue) {
    return input;
  }
  if (schema2 === convertValue) {
    return conversionFn(input);
  }
  if (schema2 instanceof Array) {
    return input.map(function (v) {
      return convert(conversionFn, schema2[0], v);
    });
  }
  if (schema2 instanceof Object) {
    var output = {};
    for (var _i2 = 0, _Object$entries = Object.entries(schema2); _i2 < _Object$entries.length; _i2++) {
      var _Object$entries$_i = _slicedToArray(_Object$entries[_i2], 2),
        key = _Object$entries$_i[0],
        schemaField = _Object$entries$_i[1];
      if (schemaField.derive) {
        var v = schemaField.derive(input);
        if (v !== void 0) {
          input[key] = v;
        }
      }
      if (!(key in input)) {
        if (schemaField.required) {
          throw new Error("Missing key: ".concat(key));
        }
        continue;
      }
      if (input[key] == null) {
        output[key] = null;
        continue;
      }
      output[key] = convert(conversionFn, schemaField.schema, input[key]);
    }
    return output;
  }
}
function derived(schema2, derive) {
  return {
    required: true,
    schema: schema2,
    derive: derive
  };
}
function required(schema2) {
  return {
    required: true,
    schema: schema2
  };
}
function optional(schema2) {
  return {
    required: false,
    schema: schema2
  };
}
var publicKeyCredentialDescriptorSchema = {
  type: required(copyValue),
  id: required(convertValue),
  transports: optional(copyValue)
};
var simplifiedExtensionsSchema = {
  appid: optional(copyValue),
  appidExclude: optional(copyValue),
  credProps: optional(copyValue)
};
var simplifiedClientExtensionResultsSchema = {
  appid: optional(copyValue),
  appidExclude: optional(copyValue),
  credProps: optional(copyValue)
};
var credentialCreationOptions = {
  publicKey: required({
    rp: required(copyValue),
    user: required({
      id: required(convertValue),
      name: required(copyValue),
      displayName: required(copyValue)
    }),
    challenge: required(convertValue),
    pubKeyCredParams: required(copyValue),
    timeout: optional(copyValue),
    excludeCredentials: optional([publicKeyCredentialDescriptorSchema]),
    authenticatorSelection: optional(copyValue),
    attestation: optional(copyValue),
    extensions: optional(simplifiedExtensionsSchema)
  }),
  signal: optional(copyValue)
};
var publicKeyCredentialWithAttestation = {
  type: required(copyValue),
  id: required(copyValue),
  rawId: required(convertValue),
  authenticatorAttachment: optional(copyValue),
  response: required({
    clientDataJSON: required(convertValue),
    attestationObject: required(convertValue),
    transports: derived(copyValue, function (response) {
      var _a;
      return ((_a = response.getTransports) == null ? void 0 : _a.call(response)) || [];
    })
  }),
  clientExtensionResults: derived(simplifiedClientExtensionResultsSchema, function (pkc) {
    return pkc.getClientExtensionResults();
  })
};
var credentialRequestOptions = {
  mediation: optional(copyValue),
  publicKey: required({
    challenge: required(convertValue),
    timeout: optional(copyValue),
    rpId: optional(copyValue),
    allowCredentials: optional([publicKeyCredentialDescriptorSchema]),
    userVerification: optional(copyValue),
    extensions: optional(simplifiedExtensionsSchema)
  }),
  signal: optional(copyValue)
};
var publicKeyCredentialWithAssertion = {
  type: required(copyValue),
  id: required(copyValue),
  rawId: required(convertValue),
  authenticatorAttachment: optional(copyValue),
  response: required({
    clientDataJSON: required(convertValue),
    authenticatorData: required(convertValue),
    signature: required(convertValue),
    userHandle: required(convertValue)
  }),
  clientExtensionResults: derived(simplifiedClientExtensionResultsSchema, function (pkc) {
    return pkc.getClientExtensionResults();
  })
};
function createRequestFromJSON(requestJSON) {
  return convert(base64urlToBuffer, credentialCreationOptions, requestJSON);
}
function createResponseToJSON(credential) {
  return convert(bufferToBase64url, publicKeyCredentialWithAttestation, credential);
}
function create(requestJSON) {
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee50() {
    var credential;
    return _regenerator().w(function (_context50) {
      while (1) switch (_context50.n) {
        case 0:
          _context50.n = 1;
          return navigator.credentials.create(createRequestFromJSON(requestJSON));
        case 1:
          credential = _context50.v;
          return _context50.a(2, createResponseToJSON(credential));
      }
    }, _callee50);
  }));
}
function getRequestFromJSON(requestJSON) {
  return convert(base64urlToBuffer, credentialRequestOptions, requestJSON);
}
function getResponseToJSON(credential) {
  return convert(bufferToBase64url, publicKeyCredentialWithAssertion, credential);
}
function get(requestJSON) {
  return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee51() {
    var credential;
    return _regenerator().w(function (_context51) {
      while (1) switch (_context51.n) {
        case 0:
          _context51.n = 1;
          return navigator.credentials.get(getRequestFromJSON(requestJSON));
        case 1:
          credential = _context51.v;
          return _context51.a(2, getResponseToJSON(credential));
      }
    }, _callee51);
  }));
}
var HeadlessWebAuthnClient = /*#__PURE__*/function () {
  function HeadlessWebAuthnClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    var _this10 = this;
    _classCallCheck(this, HeadlessWebAuthnClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.register = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this10, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee52() {
        var _a, _b, startResp, publicKeyCredentialCreationOptions, publicKey, credential, resp;
        return _regenerator().w(function (_context52) {
          while (1) switch (_context52.n) {
            case 0:
              validate('stytch.webauthn.register').isOptionalString('domain', options === null || options === void 0 ? void 0 : options.domain).isOptionalString('authenticator_type', options === null || options === void 0 ? void 0 : options.authenticator_type).isOptionalBoolean('is_passkey', options === null || options === void 0 ? void 0 : options.is_passkey).isOptionalNumber('session_duration_minutes', options === null || options === void 0 ? void 0 : options.session_duration_minutes).isOptionalString('override_id', options === null || options === void 0 ? void 0 : options.override_id).isOptionalString('override_name', options === null || options === void 0 ? void 0 : options.override_name).isOptionalString('override_display_name', options === null || options === void 0 ? void 0 : options.override_display_name).isOptionalBoolean('use_base64_url_encoding', options === null || options === void 0 ? void 0 : options.use_base64_url_encoding);
              _context52.n = 1;
              return this._networkClient.fetchSDK({
                url: '/webauthn/register/start',
                method: 'POST',
                body: {
                  domain: (_a = options === null || options === void 0 ? void 0 : options.domain) !== null && _a !== void 0 ? _a : window.location.hostname,
                  authenticator_type: (_b = options === null || options === void 0 ? void 0 : options.authenticator_type) !== null && _b !== void 0 ? _b : undefined,
                  return_passkey_credential_options: options === null || options === void 0 ? void 0 : options.is_passkey,
                  override_id: options === null || options === void 0 ? void 0 : options.override_id,
                  override_name: options === null || options === void 0 ? void 0 : options.override_name,
                  override_display_name: options === null || options === void 0 ? void 0 : options.override_display_name,
                  user_agent: navigator.userAgent,
                  use_base64_url_encoding: options === null || options === void 0 ? void 0 : options.use_base64_url_encoding
                }
              });
            case 1:
              startResp = _context52.v;
              publicKeyCredentialCreationOptions = startResp.public_key_credential_creation_options;
              publicKey = JSON.parse(publicKeyCredentialCreationOptions);
              _context52.n = 2;
              return create({
                publicKey: publicKey
              });
            case 2:
              credential = _context52.v;
              _context52.n = 3;
              return this._networkClient.fetchSDK({
                url: '/webauthn/register',
                method: 'POST',
                body: {
                  public_key_credential: JSON.stringify(credential),
                  session_duration_minutes: options === null || options === void 0 ? void 0 : options.session_duration_minutes
                }
              });
            case 3:
              resp = _context52.v;
              return _context52.a(2, omitUser(resp));
          }
        }, _callee52, this);
      }));
    });
    this.authenticate = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this10, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee53() {
        var _c, _d, _yield$this$dfpProtec10, dfp_telemetry_id, captcha_token, isLoggedIn, endpoint, startResp, publicKeyCredentialRequestOptions, abortController, credReqOptions, conditionalMediationCredReqOption, credential, authenticationData;
        return _regenerator().w(function (_context53) {
          while (1) switch (_context53.n) {
            case 0:
              validate('stytch.webauthn.authenticate').isOptionalString('domain', options.domain).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalBoolean('is_passkey', options.is_passkey).isOptionalObject('signal', options.signal);
              _context53.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec10 = _context53.v;
              dfp_telemetry_id = _yield$this$dfpProtec10.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec10.captcha_token;
              if (!options.conditional_mediation) {
                _context53.n = 4;
                break;
              }
              _context53.n = 2;
              return this.browserSupportsAutofill();
            case 2:
              if (_context53.v) {
                _context53.n = 3;
                break;
              }
              logger.error('Browser does not support WebAuthn autofill');
              return _context53.a(2, null);
            case 3:
              if (this.checkEligibleInputs()) {
                _context53.n = 4;
                break;
              }
              return _context53.a(2, null);
            case 4:
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/webauthn/authenticate/start/secondary' : '/webauthn/authenticate/start/primary';
              _context53.n = 5;
              return this._networkClient.fetchSDK({
                url: endpoint,
                method: 'POST',
                body: {
                  domain: (_c = options.domain) !== null && _c !== void 0 ? _c : window.location.hostname,
                  return_passkey_credential_options: options === null || options === void 0 ? void 0 : options.is_passkey
                }
              });
            case 5:
              startResp = _context53.v;
              publicKeyCredentialRequestOptions = startResp.public_key_credential_request_options;
              abortController = new AbortController();
              credReqOptions = {
                publicKey: JSON.parse(publicKeyCredentialRequestOptions),
                signal: (_d = options.signal) !== null && _d !== void 0 ? _d : abortController.signal
              };
              conditionalMediationCredReqOption = Object.assign(Object.assign({}, credReqOptions), {
                mediation: 'conditional'
              });
              _context53.n = 6;
              return get(options.conditional_mediation ? conditionalMediationCredReqOption : credReqOptions);
            case 6:
              credential = _context53.v;
              _context53.n = 7;
              return this._networkClient.retriableFetchSDK({
                url: '/webauthn/authenticate',
                method: 'POST',
                body: {
                  public_key_credential: JSON.stringify(credential),
                  session_duration_minutes: options.session_duration_minutes,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 7:
              authenticationData = _context53.v;
              return _context53.a(2, omitUser(authenticationData));
          }
        }, _callee53, this);
      }));
    });
    this.checkEligibleInputs = function () {
      var eligibleInputs = document.querySelectorAll("input[autocomplete*='webauthn']");
      if (eligibleInputs.length < 1) {
        logger.error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');
        return false;
      }
      return true;
    };
  }
  return _createClass(HeadlessWebAuthnClient, [{
    key: "update",
    value: function update(options) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee54() {
        var url;
        return _regenerator().w(function (_context54) {
          while (1) switch (_context54.n) {
            case 0:
              validate('stytch.webauthn.update').isString('webauthn_registration_id', options.webauthn_registration_id).isString('name', options.name);
              url = '/webauthn/update/' + options.webauthn_registration_id;
              _context54.n = 1;
              return this._networkClient.fetchSDK({
                url: url,
                method: 'PUT',
                body: {
                  name: options.name
                }
              });
            case 1:
              return _context54.a(2, _context54.v);
          }
        }, _callee54, this);
      }));
    }
  }, {
    key: "browserSupportsAutofill",
    value: function browserSupportsAutofill() {
      var _a, _b, _c;
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee55() {
        var _t0, _t1, _t10;
        return _regenerator().w(function (_context55) {
          while (1) switch (_context55.n) {
            case 0:
              _context55.n = 1;
              return (_b = (_a = window.PublicKeyCredential) === null || _a === void 0 ? void 0 : _a.isConditionalMediationAvailable) === null || _b === void 0 ? void 0 : _b.call(_a);
            case 1:
              _t1 = _c = _context55.v;
              _t0 = _t1 !== null;
              if (!_t0) {
                _context55.n = 2;
                break;
              }
              _t0 = _c !== void 0;
            case 2:
              if (!_t0) {
                _context55.n = 3;
                break;
              }
              _t10 = _c;
              _context55.n = 4;
              break;
            case 3:
              _t10 = false;
            case 4:
              return _context55.a(2, _t10);
          }
        }, _callee55);
      }));
    }
  }]);
}();
var DefaultDynamicConfig$2 = Promise.resolve({
  pkceRequiredForPasswordResets: false
});
var HeadlessPasswordClient = /*#__PURE__*/function () {
  function HeadlessPasswordClient(_networkClient, _subscriptionService, _pkceManager) {
    var _this11 = this;
    var _config = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : DefaultDynamicConfig$2;
    var dfpProtectedAuth = arguments.length > 4 ? arguments[4] : undefined;
    _classCallCheck(this, HeadlessPasswordClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.create = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this11, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee56() {
        var _yield$this$dfpProtec11, dfp_telemetry_id, captcha_token, resp;
        return _regenerator().w(function (_context56) {
          while (1) switch (_context56.n) {
            case 0:
              validate('stytch.passwords.create').isString('password', options.password).isString('email', options.email).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context56.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec11 = _context56.v;
              dfp_telemetry_id = _yield$this$dfpProtec11.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec11.captcha_token;
              _context56.n = 2;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords',
                method: 'POST',
                body: {
                  email: options.email,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 2:
              resp = _context56.v;
              return _context56.a(2, omitUser(resp));
          }
        }, _callee56, this);
      }));
    });
    this.authenticate = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this11, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee57() {
        var _yield$this$dfpProtec12, dfp_telemetry_id, captcha_token, resp;
        return _regenerator().w(function (_context57) {
          while (1) switch (_context57.n) {
            case 0:
              validate('stytch.passwords.authenticate').isString('password', options.password).isString('email', options.email).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context57.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec12 = _context57.v;
              dfp_telemetry_id = _yield$this$dfpProtec12.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec12.captcha_token;
              _context57.n = 2;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords/authenticate',
                method: 'POST',
                body: {
                  email: options.email,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 2:
              resp = _context57.v;
              return _context57.a(2, omitUser(resp));
          }
        }, _callee57, this);
      }));
    });
    this.resetByEmail = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this11, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee58() {
        var _yield$this$dfpProtec13, dfp_telemetry_id, captcha_token, pkPair, code_verifier, resp;
        return _regenerator().w(function (_context58) {
          while (1) switch (_context58.n) {
            case 0:
              validate('stytch.passwords.resetByEmail').isString('token', options.token).isString('password', options.password).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context58.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec13 = _context58.v;
              dfp_telemetry_id = _yield$this$dfpProtec13.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec13.captcha_token;
              _context58.n = 2;
              return this._pkceManager.getPKPair();
            case 2:
              pkPair = _context58.v;
              code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _context58.n = 3;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords/email/reset',
                method: 'POST',
                body: {
                  token: options.token,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  code_verifier: code_verifier,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 3:
              resp = _context58.v;
              this._pkceManager.clearPKPair();
              return _context58.a(2, omitUser(resp));
          }
        }, _callee58, this);
      }));
    });
    this.resetByExistingPassword = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this11, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee59() {
        var _yield$this$dfpProtec14, dfp_telemetry_id, captcha_token, resp;
        return _regenerator().w(function (_context59) {
          while (1) switch (_context59.n) {
            case 0:
              validate('stytch.passwords.resetByExistingPassword').isString('email', options.email).isString('existing_password', options.existing_password).isString('new_password', options.new_password).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context59.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec14 = _context59.v;
              dfp_telemetry_id = _yield$this$dfpProtec14.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec14.captcha_token;
              _context59.n = 2;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords/existing_password/reset',
                method: 'POST',
                body: {
                  email: options.email,
                  existing_password: options.existing_password,
                  new_password: options.new_password,
                  session_duration_minutes: options.session_duration_minutes,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 2:
              resp = _context59.v;
              return _context59.a(2, omitUser(resp));
          }
        }, _callee59, this);
      }));
    });
    this.resetBySession = this._subscriptionService.withUpdateSession(function (options) {
      return __awaiter$1(_this11, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee60() {
        var _yield$this$dfpProtec15, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context60) {
          while (1) switch (_context60.n) {
            case 0:
              validate('stytch.passwords.resetBySession').isString('password', options.password);
              _context60.n = 1;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 1:
              _yield$this$dfpProtec15 = _context60.v;
              dfp_telemetry_id = _yield$this$dfpProtec15.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec15.captcha_token;
              return _context60.a(2, this._networkClient.retriableFetchSDK({
                url: '/passwords/session/reset',
                method: 'POST',
                body: {
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee60, this);
      }));
    });
  }
  return _createClass(HeadlessPasswordClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee61() {
        var _yield$this$_config4, pkceRequiredForPasswordResets, keyPair;
        return _regenerator().w(function (_context61) {
          while (1) switch (_context61.n) {
            case 0:
              _context61.n = 1;
              return this._config;
            case 1:
              _yield$this$_config4 = _context61.v;
              pkceRequiredForPasswordResets = _yield$this$_config4.pkceRequiredForPasswordResets;
              if (pkceRequiredForPasswordResets) {
                _context61.n = 2;
                break;
              }
              return _context61.a(2, undefined);
            case 2:
              _context61.n = 3;
              return this._pkceManager.getPKPair();
            case 3:
              keyPair = _context61.v;
              if (!keyPair) {
                _context61.n = 4;
                break;
              }
              return _context61.a(2, keyPair.code_challenge);
            case 4:
              _context61.n = 5;
              return this._pkceManager.startPKCETransaction();
            case 5:
              keyPair = _context61.v;
              return _context61.a(2, keyPair.code_challenge);
          }
        }, _callee61, this);
      }));
    }
  }, {
    key: "resetByEmailStart",
    value: function resetByEmailStart(options) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee62() {
        var code_challenge, _yield$this$dfpProtec16, dfp_telemetry_id, captcha_token;
        return _regenerator().w(function (_context62) {
          while (1) switch (_context62.n) {
            case 0:
              validate('stytch.passwords.resetByEmailStart').isString('email', options.email).isOptionalString('login_redirect_url', options.login_redirect_url).isOptionalString('reset_password_redirect_url', options.reset_password_redirect_url).isOptionalString('reset_password_template_id', options.reset_password_template_id).isOptionalNumber('reset_password_expiration_minutes', options.reset_password_expiration_minutes).isOptionalString('locale', options.locale);
              _context62.n = 1;
              return this.getCodeChallenge();
            case 1:
              code_challenge = _context62.v;
              _context62.n = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec16 = _context62.v;
              dfp_telemetry_id = _yield$this$dfpProtec16.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec16.captcha_token;
              return _context62.a(2, this._networkClient.retriableFetchSDK({
                url: '/passwords/email/reset/start',
                method: 'POST',
                body: {
                  email: options.email,
                  login_redirect_url: options.login_redirect_url,
                  reset_password_redirect_url: options.reset_password_redirect_url,
                  reset_password_expiration_minutes: options.reset_password_expiration_minutes,
                  reset_password_template_id: options.reset_password_template_id,
                  locale: options.locale,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
          }
        }, _callee62, this);
      }));
    }
  }, {
    key: "strengthCheck",
    value: function strengthCheck(options) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee63() {
        return _regenerator().w(function (_context63) {
          while (1) switch (_context63.n) {
            case 0:
              validate('stytch.passwords.strengthCheck').isOptionalString('email', options.email).isString('password', options.password);
              return _context63.a(2, this._networkClient.fetchSDK({
                url: '/passwords/strength_check',
                method: 'POST',
                body: {
                  email: options.email,
                  password: options.password
                }
              }));
          }
        }, _callee63, this);
      }));
    }
  }]);
}();
var HeadlessImpersonationClient = /*#__PURE__*/_createClass(function HeadlessImpersonationClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
  var _this12 = this;
  _classCallCheck(this, HeadlessImpersonationClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.authenticate = this._subscriptionService.withUpdateSession(function (data) {
    return __awaiter$1(_this12, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee64() {
      var _yield$this$dfpProtec17, dfp_telemetry_id, captcha_token;
      return _regenerator().w(function (_context64) {
        while (1) switch (_context64.n) {
          case 0:
            validate('stytch.impersonation.authenticate').isString('impersonation_token', data.impersonation_token);
            _context64.n = 1;
            return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
          case 1:
            _yield$this$dfpProtec17 = _context64.v;
            dfp_telemetry_id = _yield$this$dfpProtec17.dfp_telemetry_id;
            captcha_token = _yield$this$dfpProtec17.captcha_token;
            return _context64.a(2, this._networkClient.retriableFetchSDK({
              url: '/impersonation/authenticate',
              body: Object.assign(Object.assign({}, data), {
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token
              }),
              method: 'POST',
              retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
            }));
        }
      }, _callee64, this);
    }));
  });
});
var WILDCARD_ACTION = '*';
var RBACPolicy = /*#__PURE__*/function () {
  function RBACPolicy(roles, resources) {
    var _this13 = this;
    _classCallCheck(this, RBACPolicy);
    this.roles = roles;
    this.resources = resources;
    this.rolesByID = {};
    roles.forEach(function (role) {
      return _this13.rolesByID[role.role_id] = role;
    });
  }
  return _createClass(RBACPolicy, [{
    key: "mergeWithCustomRoles",
    value: function mergeWithCustomRoles(customRoles) {
      var mergedRoles = [].concat(_toConsumableArray(this.roles), _toConsumableArray(customRoles));
      return new RBACPolicy(mergedRoles, this.resources);
    }
  }, {
    key: "callerIsAuthorized",
    value: function callerIsAuthorized(memberRoles, resourceId, action) {
      var _this14 = this;
      return !!memberRoles.map(function (roleId) {
        return _this14.rolesByID[roleId];
      }).filter(function (v) {
        return v;
      }).flatMap(function (role) {
        return role.permissions;
      }).filter(function (permission) {
        return permission.resource_id === resourceId;
      }).find(function (permission) {
        return permission.actions.includes(action) || permission.actions.includes(WILDCARD_ACTION);
      });
    }
  }, {
    key: "allPermissionsForCaller",
    value: function allPermissionsForCaller(memberRoles) {
      var _this15 = this;
      var allPermsMap = Object.create(null);
      this.resources.forEach(function (resource) {
        allPermsMap[resource.resource_id] = {};
        resource.actions.forEach(function (action) {
          allPermsMap[resource.resource_id][action] = _this15.callerIsAuthorized(memberRoles, resource.resource_id, action);
        });
      });
      return allPermsMap;
    }
  }], [{
    key: "fromJSON",
    value: function fromJSON(input) {
      return new RBACPolicy(input.roles, input.resources);
    }
  }]);
}();
var HeadlessRBACClient = /*#__PURE__*/function () {
  function HeadlessRBACClient(cachedConfig, dynamicConfig, _subscriptionService) {
    var _this16 = this;
    _classCallCheck(this, HeadlessRBACClient);
    this._subscriptionService = _subscriptionService;
    this.isAuthorizedSync = function (resourceId, action) {
      var _a;
      return !!((_a = _this16.cachedPolicy) === null || _a === void 0 ? void 0 : _a.callerIsAuthorized(_this16.roleIds(), resourceId, action));
    };
    this.isAuthorized = function (resourceId, action) {
      return _this16.policyPromise.then(function (policy) {
        return policy.callerIsAuthorized(_this16.roleIds(), resourceId, action);
      });
    };
    this.cachedPolicy = cachedConfig.rbacPolicy ? RBACPolicy.fromJSON(cachedConfig.rbacPolicy) : null;
    this.policyPromise = dynamicConfig.then(function (data) {
      if (!data.rbacPolicy) {
        logger.error('Unable to retrieve RBAC policy from servers. Assuming caller has no permissions.');
        return new RBACPolicy([], []);
      }
      _this16.cachedPolicy = RBACPolicy.fromJSON(data.rbacPolicy);
      return _this16.cachedPolicy;
    });
  }
  return _createClass(HeadlessRBACClient, [{
    key: "allPermissions",
    value: function allPermissions() {
      var _this17 = this;
      return this.policyPromise.then(function (policy) {
        return policy.allPermissionsForCaller(_this17.roleIds());
      });
    }
  }, {
    key: "roleIds",
    value: function roleIds() {
      var _a;
      var user = this._subscriptionService.getUser();
      if (!user) {
        return [];
      }
      return (_a = user.roles) !== null && _a !== void 0 ? _a : [];
    }
  }]);
}();
var HeadlessIDPClient = /*#__PURE__*/_createClass(function HeadlessIDPClient(_networkClient) {
  var _this18 = this;
  _classCallCheck(this, HeadlessIDPClient);
  this._networkClient = _networkClient;
  this.oauthAuthorizeStart = function (data) {
    return __awaiter$1(_this18, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee65() {
      return _regenerator().w(function (_context65) {
        while (1) switch (_context65.n) {
          case 0:
            return _context65.a(2, this._networkClient.fetchSDK({
              url: '/idp/oauth/authorize/start',
              method: 'POST',
              body: data
            }));
        }
      }, _callee65, this);
    }));
  };
  this.oauthAuthorizeSubmit = function (data) {
    return __awaiter$1(_this18, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee66() {
      return _regenerator().w(function (_context66) {
        while (1) switch (_context66.n) {
          case 0:
            return _context66.a(2, this._networkClient.fetchSDK({
              url: '/idp/oauth/authorize/submit',
              method: 'POST',
              body: data
            }));
        }
      }, _callee66, this);
    }));
  };
  this.oauthLogoutStart = function (data) {
    return __awaiter$1(_this18, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee67() {
      return _regenerator().w(function (_context67) {
        while (1) switch (_context67.n) {
          case 0:
            return _context67.a(2, this._networkClient.fetchSDK({
              url: "/oauth/logout/start",
              method: 'POST',
              body: data
            }));
        }
      }, _callee67, this);
    }));
  };
});
Promise.resolve({
  pkceRequiredForEmailMagicLinks: false
});
Promise.resolve({
  pkceRequiredForPasswordResets: false
});
var IframeHostClient = /*#__PURE__*/function () {
  function IframeHostClient(iframeURL) {
    _classCallCheck(this, IframeHostClient);
    this.iframeURL = iframeURL;
    this.createIframe();
  }
  return _createClass(IframeHostClient, [{
    key: "createIframe",
    value: function createIframe() {
      var existingIframe = document.querySelector("[src~=\"".concat(this.iframeURL, "\"]"));
      if (!existingIframe) {
        existingIframe = document.createElement('iframe');
        existingIframe.src = this.iframeURL;
        existingIframe.style.position = 'absolute';
        existingIframe.style.width = '0';
        existingIframe.style.height = '0';
        existingIframe.style.border = '0';
        document.body.appendChild(existingIframe);
      } else {
        logger.warn(MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING);
      }
      if (existingIframe.dataset.loaded === 'true') {
        this.frame = Promise.resolve(existingIframe);
        return;
      }
      this.frame = new Promise(function (resolve) {
        existingIframe.addEventListener('load', function () {
          existingIframe.dataset.loaded = 'true';
          resolve(existingIframe);
        }, {
          once: true
        });
      });
    }
  }, {
    key: "call",
    value: function call(method, args) {
      return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee165() {
        var _this37 = this;
        var frame, channel;
        return _regenerator().w(function (_context165) {
          while (1) switch (_context165.n) {
            case 0:
              _context165.n = 1;
              return this.frame;
            case 1:
              frame = _context165.v;
              channel = new MessageChannel();
              return _context165.a(2, new Promise(function (resolve, reject) {
                var _a;
                channel.port1.onmessage = function (event) {
                  var resp = event.data;
                  channel.port1.close();
                  if (resp.success) {
                    resolve(resp.payload);
                  } else {
                    reject(ErrorMarshaller.unmarshall(resp.error));
                  }
                };
                var message = {
                  method: method,
                  args: args
                };
                (_a = frame.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(message, _this37.iframeURL, [channel.port2]);
              }));
          }
        }, _callee165, this);
      }));
    }
  }]);
}();
var SearchDataManager = /*#__PURE__*/function () {
  function SearchDataManager(_networkClient, dfpProtectedAuth) {
    _classCallCheck(this, SearchDataManager);
    this._networkClient = _networkClient;
    this.dfpProtectedAuth = dfpProtectedAuth;
  }
  return _createClass(SearchDataManager, [{
    key: "searchUser",
    value: function searchUser(email) {
      var _this38 = this;
      return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha().then(function (_ref0) {
        var dfp_telemetry_id = _ref0.dfp_telemetry_id,
          captcha_token = _ref0.captcha_token;
        return _this38._networkClient.fetchSDK({
          url: "/users/search",
          method: 'POST',
          body: {
            email: email,
            dfp_telemetry_id: dfp_telemetry_id,
            captcha_token: captcha_token
          }
        });
      });
    }
  }, {
    key: "searchMember",
    value: function searchMember(email, organization_id) {
      return this._networkClient.fetchSDK({
        url: "/b2b/organizations/members/search",
        method: 'POST',
        body: {
          email_address: email,
          organization_id: organization_id
        }
      });
    }
  }]);
}();
var shouldTryRefresh = function shouldTryRefresh(state) {
  return !!(state === null || state === void 0 ? void 0 : state.session);
};
var SessionManagerRegistry = /*#__PURE__*/function () {
  function SessionManagerRegistry() {
    _classCallCheck(this, SessionManagerRegistry);
    this.hasWarned = false;
    this.registry = new Map();
  }
  return _createClass(SessionManagerRegistry, [{
    key: "register",
    value: function register(key, sessionManager) {
      var otherManager = this.registry.get(key);
      if (otherManager && otherManager !== sessionManager) {
        if (!this.hasWarned) {
          logger.warn(MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING);
          this.hasWarned = true;
        }
        otherManager.cancelBackgroundRefresh();
      }
      this.registry.set(key, sessionManager);
    }
  }, {
    key: "unregister",
    value: function unregister(publicToken, sessionManager) {
      var otherManager = this.registry.get(publicToken);
      if (otherManager && otherManager === sessionManager) {
        this.registry["delete"](publicToken);
      }
    }
  }]);
}();
var SessionManager = /*#__PURE__*/function () {
  function SessionManager(_subscriptionService, _headlessSessionClient, _publicToken, _options) {
    var _this39 = this;
    _classCallCheck(this, SessionManager);
    this._subscriptionService = _subscriptionService;
    this._headlessSessionClient = _headlessSessionClient;
    this._publicToken = _publicToken;
    this._options = _options;
    this.timeout = null;
    this._onDataChange = function (state) {
      if (state != null && state.sessionDurationMinutes) {
        _this39.lastAuthenticationSessionDuration = state.sessionDurationMinutes;
      }
      if (shouldTryRefresh(state)) {
        _this39.scheduleBackgroundRefresh();
      } else {
        _this39.cancelBackgroundRefresh();
      }
    };
    this._reauthenticateWithBackoff = function () {
      return __awaiter$1(_this39, void 0, void 0, /*#__PURE__*/_regenerator().m(function _callee166() {
        var count, options, _t56;
        return _regenerator().w(function (_context166) {
          while (1) switch (_context166.p = _context166.n) {
            case 0:
              count = 0;
            case 1:
              _context166.p = 2;
              options = {
                session_duration_minutes: this._options.keepSessionAlive ? this.lastAuthenticationSessionDuration : undefined
              };
              _context166.n = 3;
              return this._headlessSessionClient.authenticate(options);
            case 3:
              return _context166.a(2, _context166.v);
            case 4:
              _context166.p = 4;
              _t56 = _context166.v;
              if (!SessionManager.isUnrecoverableError(_t56)) {
                _context166.n = 5;
                break;
              }
              return _context166.a(2, Promise.reject(_t56));
            case 5:
              count++;
              _context166.n = 6;
              return new Promise(function (done) {
                return setTimeout(done, SessionManager.timeoutForAttempt(count));
              });
            case 6:
              _context166.n = 1;
              break;
            case 7:
              return _context166.a(2);
          }
        }, _callee166, this, [[2, 4]]);
      }));
    };
    this._subscriptionService.subscribeToState(this._onDataChange);
  }
  return _createClass(SessionManager, [{
    key: "register",
    value: function register() {
      SessionManager.registry.register(this._publicToken, this);
    }
  }, {
    key: "unregister",
    value: function unregister() {
      SessionManager.registry.unregister(this._publicToken, this);
    }
  }, {
    key: "performBackgroundRefresh",
    value: function performBackgroundRefresh() {
      var _this40 = this;
      this._reauthenticateWithBackoff().then(function () {
        _this40.scheduleBackgroundRefresh();
      })["catch"](function (error) {
        logger.warn('Session background refresh failed. Signalling to app that user is logged out.', {
          error: error
        });
        _this40._subscriptionService.destroySession();
      });
    }
  }, {
    key: "scheduleBackgroundRefresh",
    value: function scheduleBackgroundRefresh() {
      var _this41 = this;
      this.cancelBackgroundRefresh();
      this.register();
      this.timeout = setTimeout(function () {
        _this41.performBackgroundRefresh();
      }, SessionManager.REFRESH_INTERVAL_MS);
    }
  }, {
    key: "cancelBackgroundRefresh",
    value: function cancelBackgroundRefresh() {
      if (this.timeout !== null) {
        this.unregister();
        clearTimeout(this.timeout);
        this.timeout = null;
      }
    }
  }], [{
    key: "timeoutForAttempt",
    value: function timeoutForAttempt(count) {
      count = Math.min(count, 7);
      var jitter = Math.floor(Math.random() * 350) - 175;
      var delayMS = 2000 * Math.pow(2, count);
      return jitter + delayMS;
    }
  }, {
    key: "isUnrecoverableError",
    value: function isUnrecoverableError(error) {
      return UNRECOVERABLE_ERROR_TYPES.includes(error.error_type);
    }
  }]);
}();
SessionManager.REFRESH_INTERVAL_MS = 1000 * 60 * 3;
SessionManager.registry = new SessionManagerRegistry();
var StateChangeClient = /*#__PURE__*/_createClass(function StateChangeClient(_subscriptionService, emptyState) {
  var _this42 = this;
  _classCallCheck(this, StateChangeClient);
  this._subscriptionService = _subscriptionService;
  this.emptyState = emptyState;
  this.onStateChange = function (callback) {
    return _this42._subscriptionService.subscribeToState(function (state) {
      callback(state !== null && state !== void 0 ? state : _this42.emptyState);
    });
  };
});
var VERTICAL_B2B = 'B2B';
var BOOTSTRAP_CACHE_KEY = 'bootstrap';
var DEFAULT_BOOTSTRAP = function DEFAULT_BOOTSTRAP() {
  return {
    displayWatermark: false,
    projectName: null,
    cnameDomain: null,
    emailDomains: ['stytch.com'],
    captchaSettings: {
      enabled: false
    },
    pkceRequiredForEmailMagicLinks: false,
    pkceRequiredForPasswordResets: false,
    pkceRequiredForOAuth: false,
    pkceRequiredForSso: false,
    slugPattern: null,
    createOrganizationEnabled: false,
    passwordConfig: null,
    runDFPProtectedAuth: false,
    rbacPolicy: null,
    siweRequiredForCryptoWallets: false,
    vertical: null
  };
};
var BootstrapDataManager = /*#__PURE__*/function () {
  function BootstrapDataManager(_publicToken, _networkClient, _dataLayer) {
    var _this19 = this;
    _classCallCheck2(this, BootstrapDataManager);
    this._publicToken = _publicToken;
    this._networkClient = _networkClient;
    this._dataLayer = _dataLayer;
    this._bootstrapDataPromise = this._networkClient.fetchSDK({
      url: "/projects/bootstrap/".concat(this._publicToken),
      method: 'GET'
    }).then(BootstrapDataManager.mapBootstrapData).then(function (data) {
      _this19._dataLayer.setItem(BOOTSTRAP_CACHE_KEY, JSON.stringify(data));
      return data;
    })["catch"](function (error) {
      logger.error(error);
      return DEFAULT_BOOTSTRAP();
    });
  }
  return _createClass2(BootstrapDataManager, [{
    key: "getSync",
    value: function getSync() {
      var cached = this._dataLayer.getItem(BOOTSTRAP_CACHE_KEY);
      if (cached === null) {
        return DEFAULT_BOOTSTRAP();
      }
      try {
        return JSON.parse(cached);
      } catch (_a) {
        return DEFAULT_BOOTSTRAP();
      }
    }
  }, {
    key: "getAsync",
    value: function getAsync() {
      return this._bootstrapDataPromise;
    }
  }], [{
    key: "mapBootstrapData",
    value: function mapBootstrapData(response) {
      var _a, _b;
      var passwordConfig = response.password_config !== null ? {
        ludsComplexity: response.password_config.luds_complexity,
        ludsMinimumCount: response.password_config.luds_minimum_count
      } : null;
      return {
        projectName: response.project_name,
        displayWatermark: !response.disable_sdk_watermark,
        captchaSettings: response.captcha_settings,
        cnameDomain: response.cname_domain,
        emailDomains: response.email_domains,
        pkceRequiredForEmailMagicLinks: response.pkce_required_for_email_magic_links,
        pkceRequiredForPasswordResets: response.pkce_required_for_password_resets,
        pkceRequiredForOAuth: response.pkce_required_for_oauth,
        pkceRequiredForSso: response.pkce_required_for_sso,
        slugPattern: response.slug_pattern,
        createOrganizationEnabled: response.create_organization_enabled,
        passwordConfig: passwordConfig,
        runDFPProtectedAuth: (_a = response.dfp_protected_auth_enabled) !== null && _a !== void 0 ? _a : false,
        dfpProtectedAuthMode: response.dfp_protected_auth_mode,
        rbacPolicy: (_b = response.rbac_policy) !== null && _b !== void 0 ? _b : null,
        siweRequiredForCryptoWallets: response.siwe_required_for_crypto_wallets,
        vertical: response.vertical
      };
    }
  }]);
}();
function __rest(s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}
function __awaiter(thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
  var e = new Error(message);
  return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};
var loadRecaptchaClient = function loadRecaptchaClient(siteKey) {
  return loadESModule("https://www.google.com/recaptcha/enterprise.js?render=".concat(siteKey), function () {
    return window.grecaptcha.enterprise;
  });
};
var CaptchaProvider = /*#__PURE__*/_createClass2(function CaptchaProvider(bootstrapPromise) {
  var _this20 = this;
  _classCallCheck2(this, CaptchaProvider);
  this.bootstrapPromise = bootstrapPromise;
  this.executeRecaptcha = function () {
    return __awaiter(_this20, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee0() {
      var _yield$this$state4, captchaClient, configured, siteKey;
      return _regenerator2().w(function (_context0) {
        while (1) switch (_context0.n) {
          case 0:
            _context0.n = 1;
            return this.state;
          case 1:
            _yield$this$state4 = _context0.v;
            captchaClient = _yield$this$state4.captchaClient;
            configured = _yield$this$state4.configured;
            siteKey = _yield$this$state4.siteKey;
            if (configured) {
              _context0.n = 2;
              break;
            }
            return _context0.a(2, undefined);
          case 2:
            _context0.n = 3;
            return new Promise(function (resolve) {
              return captchaClient.ready(resolve);
            });
          case 3:
            return _context0.a(2, captchaClient.execute(siteKey, {
              action: 'LOGIN'
            }));
        }
      }, _callee0, this);
    }));
  };
  this.state = bootstrapPromise.then(function (bootstrapData) {
    return __awaiter(_this20, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee1() {
      var _t3, _t4;
      return _regenerator2().w(function (_context1) {
        while (1) switch (_context1.n) {
          case 0:
            if (bootstrapData.captchaSettings.enabled) {
              _context1.n = 1;
              break;
            }
            return _context1.a(2, {
              configured: false
            });
          case 1:
            _context1.n = 2;
            return loadRecaptchaClient(bootstrapData.captchaSettings.siteKey);
          case 2:
            _t3 = _context1.v;
            _t4 = bootstrapData.captchaSettings.siteKey;
            return _context1.a(2, {
              configured: true,
              captchaClient: _t3,
              siteKey: _t4
            });
        }
      }, _callee1);
    }));
  });
});
var ClientsideServicesProvider = /*#__PURE__*/function () {
  function ClientsideServicesProvider(iframeURL) {
    var _this21 = this;
    _classCallCheck2(this, ClientsideServicesProvider);
    this.iframeURL = iframeURL;
    this.oneTapStart = function (req) {
      return _this21.call('oneTapStart', req);
    };
    this.oneTapSubmit = function (req) {
      return _this21.call('oneTapSubmit', req);
    };
    this.parsedPhoneNumber = function (req) {
      return _this21.call('parsedPhoneNumber', req);
    };
  }
  return _createClass2(ClientsideServicesProvider, [{
    key: "frameClient",
    get: function get() {
      var _a;
      this._frameClient = (_a = this._frameClient) !== null && _a !== void 0 ? _a : new IframeHostClient(this.iframeURL);
      return this._frameClient;
    }
  }, {
    key: "call",
    value: function call(handlerName, req) {
      return this.frameClient.call(handlerName, [req]);
    }
  }]);
}();
var HeadlessOAuthClient = /*#__PURE__*/function (_HeadlessOAuthClient$) {
  function HeadlessOAuthClient(_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config, _oneTap) {
    var _this22;
    _classCallCheck2(this, HeadlessOAuthClient);
    _this22 = _callSuper2(this, HeadlessOAuthClient, [_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config]);
    _this22._oneTap = _oneTap;
    _this22.startOneTap = function (options) {
      return __awaiter(_this22, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee10() {
        var clientResult, client, onSuccessCallback;
        return _regenerator2().w(function (_context10) {
          while (1) switch (_context10.n) {
            case 0:
              _context10.n = 1;
              return this._oneTap.createOneTapClient();
            case 1:
              clientResult = _context10.v;
              if (clientResult.success) {
                _context10.n = 2;
                break;
              }
              throw new Error("One Tap could not load: ".concat(clientResult.reason));
            case 2:
              client = clientResult.client;
              onSuccessCallback = this._oneTap.createOnSuccessHandler({
                signupRedirectUrl: options.signup_redirect_url,
                loginRedirectUrl: options.login_redirect_url,
                onSuccess: this._oneTap.redirectOnSuccess
              });
              return _context10.a(2, client.render({
                style: {
                  position: exports.OneTapPositions.floating
                },
                onOneTapCancelled: options.onOneTapCancelled,
                callback: onSuccessCallback,
                cancelOnTapOutside: options.cancel_on_tap_outside
              }));
          }
        }, _callee10, this);
      }));
    };
    _this22.googleOneTap = {
      start: _this22.startOneTap
    };
    return _this22;
  }
  _inherits2(HeadlessOAuthClient, _HeadlessOAuthClient$);
  return _createClass2(HeadlessOAuthClient);
}(HeadlessOAuthClient$1);
var version = "5.44.2";
var NetworkClient = /*#__PURE__*/function () {
  function NetworkClient(_publicToken, _subscriptionDataLayer, _liveAPIURL, _testAPIURL, additionalTelemetryDataFn) {
    _classCallCheck2(this, NetworkClient);
    this._publicToken = _publicToken;
    this._subscriptionDataLayer = _subscriptionDataLayer;
    this.additionalTelemetryDataFn = additionalTelemetryDataFn;
    this.updateSessionToken = function () {
      return null;
    };
    this.baseURL = _liveAPIURL;
    if (isTestPublicToken(_publicToken)) {
      this.baseURL = _testAPIURL;
    }
    this.eventLogger = new EventLogger({
      maxBatchSize: DEFAULT_MAX_BATCH_SIZE,
      intervalDurationMs: DEFAULT_INTERVAL_DURATION_MS,
      logEventURL: this.buildSDKUrl('/events')
    });
  }
  return _createClass2(NetworkClient, [{
    key: "logEvent",
    value: function logEvent(_ref7) {
      var name = _ref7.name,
        details = _ref7.details,
        _ref7$error = _ref7.error,
        error = _ref7$error === void 0 ? {} : _ref7$error;
      this.eventLogger.logEvent(this.createTelemetryBlob(), {
        public_token: this._publicToken,
        event_name: name,
        details: details,
        error_code: error.error_code,
        error_description: error.error_description,
        http_status_code: error.http_status_code
      });
    }
  }, {
    key: "createTelemetryBlob",
    value: function createTelemetryBlob() {
      return Object.assign(Object.assign({
        event_id: createEventId(),
        app_session_id: createAppSessionId(),
        persistent_id: createPersistentId(),
        client_sent_at: new Date().toISOString(),
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
      }, this.additionalTelemetryDataFn()), {
        app: {
          identifier: window.location.hostname
        },
        sdk: {
          identifier: 'Stytch.js Javascript SDK',
          version: version
        }
      });
    }
  }, {
    key: "fetchSDK",
    value: function fetchSDK(_ref8) {
      var url = _ref8.url,
        body = _ref8.body,
        method = _ref8.method;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee11() {
        var sessionToken, basicAuthHeader, xSDKClientHeader, xSDKParentHostHeader;
        return _regenerator2().w(function (_context11) {
          while (1) switch (_context11.n) {
            case 0:
              sessionToken = this._subscriptionDataLayer.readSessionCookie().session_token;
              basicAuthHeader = 'Basic ' + window.btoa(this._publicToken + ':' + (sessionToken || this._publicToken));
              xSDKClientHeader = window.btoa(JSON.stringify(this.createTelemetryBlob()));
              xSDKParentHostHeader = window.location.origin;
              return _context11.a(2, baseFetchSDK({
                basicAuthHeader: basicAuthHeader,
                body: body,
                finalURL: this.buildSDKUrl(url),
                method: method,
                xSDKClientHeader: xSDKClientHeader,
                xSDKParentHostHeader: xSDKParentHostHeader
              }));
          }
        }, _callee11, this);
      }));
    }
  }, {
    key: "submitFormSDK",
    value: function submitFormSDK(_ref9) {
      var url = _ref9.url,
        body = _ref9.body,
        method = _ref9.method;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee68() {
        var sessionToken, basicAuthHeader, xSDKClientHeader, xSDKParentHostHeader;
        return _regenerator2().w(function (_context68) {
          while (1) switch (_context68.n) {
            case 0:
              sessionToken = this._subscriptionDataLayer.readSessionCookie().session_token;
              basicAuthHeader = 'Basic ' + window.btoa(this._publicToken + ':' + (sessionToken || this._publicToken));
              xSDKClientHeader = window.btoa(JSON.stringify(this.createTelemetryBlob()));
              xSDKParentHostHeader = window.location.origin;
              return _context68.a(2, baseSubmitFormSDK({
                basicAuthHeader: basicAuthHeader,
                body: body,
                finalURL: this.buildSDKUrl(url),
                method: method,
                xSDKClientHeader: xSDKClientHeader,
                xSDKParentHostHeader: xSDKParentHostHeader
              }));
          }
        }, _callee68, this);
      }));
    }
  }, {
    key: "retriableFetchSDK",
    value: function retriableFetchSDK(_ref1) {
      var url = _ref1.url,
        body = _ref1.body,
        method = _ref1.method,
        retryCallback = _ref1.retryCallback;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee69() {
        var sessionToken, basicAuthHeader, xSDKClientHeader, xSDKParentHostHeader;
        return _regenerator2().w(function (_context69) {
          while (1) switch (_context69.n) {
            case 0:
              sessionToken = this._subscriptionDataLayer.readSessionCookie().session_token;
              basicAuthHeader = 'Basic ' + window.btoa(this._publicToken + ':' + (sessionToken || this._publicToken));
              xSDKClientHeader = window.btoa(JSON.stringify(this.createTelemetryBlob()));
              xSDKParentHostHeader = window.location.origin;
              return _context69.a(2, _retriableFetchSDK({
                basicAuthHeader: basicAuthHeader,
                body: body,
                finalURL: this.buildSDKUrl(url),
                method: method,
                xSDKClientHeader: xSDKClientHeader,
                xSDKParentHostHeader: xSDKParentHostHeader,
                retryCallback: retryCallback
              }));
          }
        }, _callee69, this);
      }));
    }
  }, {
    key: "buildSDKUrl",
    value: function buildSDKUrl(url) {
      return "".concat(this.baseURL, "/sdk/v1").concat(url);
    }
  }]);
}();
var navigatorSupportsFedCM = typeof window !== 'undefined' && 'IdentityCredential' in window;
var getConfiguredEmbeddedMode = function getConfiguredEmbeddedMode(position) {
  if (position === exports.OneTapPositions.forceLegacyEmbedded) {
    return 'force';
  }
  if (position === exports.OneTapPositions.embeddedOnly || position === exports.OneTapPositions.embedded || position === exports.OneTapPositions.floatingOrEmbedded) {
    return true;
  }
  return false;
};
var getShouldRenderEmbeddedOneTap = function getShouldRenderEmbeddedOneTap(position) {
  var embeddedMode = getConfiguredEmbeddedMode(position);
  return embeddedMode === 'force' || embeddedMode && !navigatorSupportsFedCM;
};
var GoogleOneTapClient = /*#__PURE__*/function () {
  function GoogleOneTapClient(_googleClient, _clientId) {
    _classCallCheck2(this, GoogleOneTapClient);
    this._googleClient = _googleClient;
    this._clientId = _clientId;
  }
  return _createClass2(GoogleOneTapClient, [{
    key: "cancel",
    value: function cancel() {
      this._googleClient.cancel();
    }
  }, {
    key: "render",
    value: function render(_ref10) {
      var callback = _ref10.callback,
        onOneTapCancelled = _ref10.onOneTapCancelled,
        style = _ref10.style,
        _ref10$cancelOnTapOut = _ref10.cancelOnTapOutside,
        cancelOnTapOutside = _ref10$cancelOnTapOut === void 0 ? true : _ref10$cancelOnTapOut;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee70() {
        var _this23 = this;
        var embeddedMode, shouldRenderEmbeddedOneTap, config;
        return _regenerator2().w(function (_context70) {
          while (1) switch (_context70.n) {
            case 0:
              embeddedMode = getConfiguredEmbeddedMode(style.position);
              shouldRenderEmbeddedOneTap = getShouldRenderEmbeddedOneTap(style.position);
              config = {
                client_id: this._clientId,
                callback: callback,
                auto_select: false,
                context: 'use',
                itp_support: true,
                use_fedcm_for_prompt: embeddedMode !== 'force',
                cancel_on_tap_outside: cancelOnTapOutside
              };
              if (shouldRenderEmbeddedOneTap) {
                config.prompt_parent_id = 'google-parent-prompt';
                config.cancel_on_tap_outside = false;
              }
              this._googleClient.initialize(config);
              return _context70.a(2, new Promise(function (resolve) {
                _this23._googleClient.prompt(function (notification) {
                  var _a, _b, _c, _d, _e;
                  if (notification.isSkippedMoment()) {
                    var reason = (_b = (_a = notification.getSkippedReason) === null || _a === void 0 ? void 0 : _a.call(notification)) !== null && _b !== void 0 ? _b : 'unknown_reason';
                    if (reason === 'user_cancel') {
                      onOneTapCancelled === null || onOneTapCancelled === void 0 ? void 0 : onOneTapCancelled();
                    }
                    return resolve({
                      success: false,
                      reason: reason
                    });
                  }
                  if (!notification.isNotDisplayed && shouldRenderEmbeddedOneTap || ((_c = notification.isNotDisplayed) === null || _c === void 0 ? void 0 : _c.call(notification))) {
                    return resolve({
                      success: false,
                      reason: (_e = (_d = notification.getNotDisplayedReason) === null || _d === void 0 ? void 0 : _d.call(notification)) !== null && _e !== void 0 ? _e : 'unknown_reason'
                    });
                  }
                  if (!notification.isDismissedMoment()) {
                    _this23.styleFrame(shouldRenderEmbeddedOneTap);
                    return resolve({
                      success: true
                    });
                  }
                });
              }));
          }
        }, _callee70, this);
      }));
    }
  }, {
    key: "styleFrame",
    value: function styleFrame(shouldRenderEmbeddedOneTap) {
      if (!shouldRenderEmbeddedOneTap) {
        return;
      }
      Array.from(document.getElementsByTagName('iframe')).forEach(function (frame) {
        if (frame.src.includes(GOOGLE_ONE_TAP_HOST)) {
          frame.style.width = '100%';
        }
      });
    }
  }]);
}();
var loadGoogleOneTapClient = function loadGoogleOneTapClient() {
  return loadESModule(GOOGLE_ONE_TAP_SCRIPT_URL, function () {
    return window.google.accounts.id;
  });
};
var OneTapProvider = /*#__PURE__*/function () {
  function OneTapProvider(_publicToken, clientsideServices) {
    var _this24 = this;
    _classCallCheck2(this, OneTapProvider);
    this._publicToken = _publicToken;
    this.clientsideServices = clientsideServices;
    this.createOnSuccessHandler = function (_ref11) {
      var loginRedirectUrl = _ref11.loginRedirectUrl,
        signupRedirectUrl = _ref11.signupRedirectUrl,
        onSuccess = _ref11.onSuccess;
      return function (response) {
        return __awaiter(_this24, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee71() {
          var credential, _yield$this$submitGoo, redirect_url;
          return _regenerator2().w(function (_context71) {
            while (1) switch (_context71.n) {
              case 0:
                credential = response.credential;
                _context71.n = 1;
                return this.submitGoogleOneTapToken({
                  credential: credential,
                  loginRedirectUrl: loginRedirectUrl,
                  signupRedirectUrl: signupRedirectUrl
                });
              case 1:
                _yield$this$submitGoo = _context71.v;
                redirect_url = _yield$this$submitGoo.redirect_url;
                onSuccess(redirect_url);
              case 2:
                return _context71.a(2);
            }
          }, _callee71, this);
        }));
      };
    };
    this.redirectOnSuccess = function (redirect_url) {
      window.location.href = redirect_url;
    };
  }
  return _createClass2(OneTapProvider, [{
    key: "createOneTapClient",
    value: function createOneTapClient() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee72() {
        var googleClientId, _yield$this$fetchGoog, err, client, _t5, _t6, _t11, _t12;
        return _regenerator2().w(function (_context72) {
          while (1) switch (_context72.p = _context72.n) {
            case 0:
              _context72.p = 0;
              _context72.n = 1;
              return this.fetchGoogleStart();
            case 1:
              _yield$this$fetchGoog = _context72.v;
              googleClientId = _yield$this$fetchGoog.googleClientId;
              _context72.n = 3;
              break;
            case 2:
              _context72.p = 2;
              _t5 = _context72.v;
              err = StytchAPIError.from(_t5);
              return _context72.a(2, {
                success: false,
                reason: err.error_type
              });
            case 3:
              if (!(googleClientId === '')) {
                _context72.n = 4;
                break;
              }
              return _context72.a(2, {
                success: false,
                reason: 'oauth_config_not_found'
              });
            case 4:
              _t6 = GoogleOneTapClient;
              _context72.n = 5;
              return loadGoogleOneTapClient();
            case 5:
              _t11 = _context72.v;
              _t12 = googleClientId;
              client = new _t6(_t11, _t12);
              return _context72.a(2, {
                success: true,
                client: client
              });
          }
        }, _callee72, this, [[0, 2]]);
      }));
    }
  }, {
    key: "fetchGoogleStart",
    value: function fetchGoogleStart() {
      if (this.googleConfig) {
        return this.googleConfig;
      }
      this.googleConfig = this.clientsideServices.oneTapStart({
        publicToken: this._publicToken
      });
      return this.googleConfig;
    }
  }, {
    key: "submitGoogleOneTapToken",
    value: function submitGoogleOneTapToken(_ref12) {
      var credential = _ref12.credential,
        loginRedirectUrl = _ref12.loginRedirectUrl,
        signupRedirectUrl = _ref12.signupRedirectUrl;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee73() {
        var _yield$this$fetchGoog2, oauthCallbackId;
        return _regenerator2().w(function (_context73) {
          while (1) switch (_context73.n) {
            case 0:
              _context73.n = 1;
              return this.fetchGoogleStart();
            case 1:
              _yield$this$fetchGoog2 = _context73.v;
              oauthCallbackId = _yield$this$fetchGoog2.oauthCallbackId;
              return _context73.a(2, this.clientsideServices.oneTapSubmit({
                publicToken: this._publicToken,
                idToken: credential,
                loginRedirectURL: loginRedirectUrl,
                oauthCallbackID: oauthCallbackId,
                signupRedirectURL: signupRedirectUrl
              }));
          }
        }, _callee73, this);
      }));
    }
  }], [{
    key: "willGoogleOneTapShowEmbedded",
    value: function willGoogleOneTapShowEmbedded() {
      var ua = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : navigator.userAgent;
      var uaContains = function uaContains(userAgent, searchString) {
        return userAgent.indexOf(searchString) !== -1;
      };
      var isTabletUA = uaContains(ua, 'iPad') || uaContains(ua, 'Android') && !uaContains(ua, 'Mobile') || uaContains(ua, 'Silk');
      var isMobileUA = uaContains(ua, 'iPod') || uaContains(ua, 'iPhone') || uaContains(ua, 'Android') || uaContains(ua, 'IEMobile');
      return !isTabletUA && isMobileUA;
    }
  }]);
}();
var PKCE_VERIFIER_STORAGE_KEY = 'PKCE_VERIFIER';
function toHex(n) {
  var str = n.toString(16);
  if (str.length === 1) {
    str = '0' + str;
  }
  return str;
}
function base64URLEncode(buf) {
  var _String$fromCharCode;
  return btoa((_String$fromCharCode = String.fromCharCode).call.apply(_String$fromCharCode, [null].concat(_toConsumableArray2(new Uint8Array(buf))))).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
}
var PKCEManager = /*#__PURE__*/function () {
  function PKCEManager(_dataLayer, namespace) {
    _classCallCheck2(this, PKCEManager);
    this._dataLayer = _dataLayer;
    this.namespace = namespace;
  }
  return _createClass2(PKCEManager, [{
    key: "key",
    value: function key() {
      return "".concat(PKCE_VERIFIER_STORAGE_KEY, ":").concat(this.namespace);
    }
  }, {
    key: "startPKCETransaction",
    value: function startPKCETransaction() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee74() {
        var keyPair;
        return _regenerator2().w(function (_context74) {
          while (1) switch (_context74.n) {
            case 0:
              _context74.n = 1;
              return PKCEManager.createProofkeyPair();
            case 1:
              keyPair = _context74.v;
              this._dataLayer.setItem(this.key(), JSON.stringify(keyPair));
              return _context74.a(2, keyPair);
          }
        }, _callee74, this);
      }));
    }
  }, {
    key: "getPKPair",
    value: function getPKPair() {
      var serialized = this._dataLayer.getItem(this.key());
      if (serialized === null) {
        return undefined;
      }
      try {
        return JSON.parse(serialized);
      } catch (_a) {
        logger.warn('Found malformed Proof Key pair in localstorage.');
        return undefined;
      }
    }
  }, {
    key: "clearPKPair",
    value: function clearPKPair() {
      return this._dataLayer.removeItem(this.key());
    }
  }], [{
    key: "createProofkeyPair",
    value: function createProofkeyPair() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee75() {
        var bytes, codeVerifier, digest;
        return _regenerator2().w(function (_context75) {
          while (1) switch (_context75.n) {
            case 0:
              bytes = new Uint32Array(16);
              window.crypto.getRandomValues(bytes);
              codeVerifier = Array.from(bytes).map(toHex).join('');
              _context75.n = 1;
              return window.crypto.subtle.digest('SHA-256', new TextEncoder().encode(codeVerifier));
            case 1:
              digest = _context75.v;
              return _context75.a(2, {
                code_challenge: base64URLEncode(digest),
                code_verifier: codeVerifier
              });
          }
        }, _callee75);
      }));
    }
  }]);
}();
/*! js-cookie v3.0.1 | MIT */
function assign(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];
    for (var key in source) {
      target[key] = source[key];
    }
  }
  return target;
}
var defaultConverter = {
  read: function read(value) {
    if (value[0] === '"') {
      value = value.slice(1, -1);
    }
    return value.replace(/(%[\dA-F]{2})+/gi, decodeURIComponent);
  },
  write: function write(value) {
    return encodeURIComponent(value).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g, decodeURIComponent);
  }
};
function init(converter, defaultAttributes) {
  function set(key, value, attributes) {
    if (typeof document === 'undefined') {
      return;
    }
    attributes = assign({}, defaultAttributes, attributes);
    if (typeof attributes.expires === 'number') {
      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);
    }
    if (attributes.expires) {
      attributes.expires = attributes.expires.toUTCString();
    }
    key = encodeURIComponent(key).replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent).replace(/[()]/g, escape);
    var stringifiedAttributes = '';
    for (var attributeName in attributes) {
      if (!attributes[attributeName]) {
        continue;
      }
      stringifiedAttributes += '; ' + attributeName;
      if (attributes[attributeName] === true) {
        continue;
      }
      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];
    }
    return document.cookie = key + '=' + converter.write(value, key) + stringifiedAttributes;
  }
  function get(key) {
    if (typeof document === 'undefined' || arguments.length && !key) {
      return;
    }
    var cookies = document.cookie ? document.cookie.split('; ') : [];
    var jar = {};
    for (var i = 0; i < cookies.length; i++) {
      var parts = cookies[i].split('=');
      var value = parts.slice(1).join('=');
      try {
        var foundKey = decodeURIComponent(parts[0]);
        jar[foundKey] = converter.read(value, foundKey);
        if (key === foundKey) {
          break;
        }
      } catch (e) {}
    }
    return key ? jar[key] : jar;
  }
  return Object.create({
    set: set,
    get: get,
    remove: function remove(key, attributes) {
      set(key, '', assign({}, attributes, {
        expires: -1
      }));
    },
    withAttributes: function withAttributes(attributes) {
      return init(this.converter, assign({}, this.attributes, attributes));
    },
    withConverter: function withConverter(converter) {
      return init(assign({}, this.converter, converter), this.attributes);
    }
  }, {
    attributes: {
      value: Object.freeze(defaultAttributes)
    },
    converter: {
      value: Object.freeze(converter)
    }
  });
}
var api = init(defaultConverter, {
  path: '/'
});
var createDeepEqual = function createDeepEqual() {
  var _ref13 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
    _ref13$KEYS_TO_EXCLUD = _ref13.KEYS_TO_EXCLUDE,
    KEYS_TO_EXCLUDE = _ref13$KEYS_TO_EXCLUD === void 0 ? [] : _ref13$KEYS_TO_EXCLUD;
  var _deepEqual = function deepEqual(a, b) {
    if (_typeof2(a) !== _typeof2(b)) return false;
    if (a === null || b === null) return a === b;
    if (_typeof2(a) === 'object') {
      if (Object.keys(a).length !== Object.keys(b).length || Object.keys(a).some(function (k) {
        return !(k in b);
      })) return false;
      return Object.entries(a).filter(function (_ref14) {
        var _ref15 = _slicedToArray2(_ref14, 1),
          k = _ref15[0];
        return !KEYS_TO_EXCLUDE.includes(k);
      }).every(function (_ref16) {
        var _ref17 = _slicedToArray2(_ref16, 2),
          k = _ref17[0],
          v = _ref17[1];
        return _deepEqual(v, b[k]);
      });
    }
    return a === b;
  };
  return _deepEqual;
};
var isLocalhost = function isLocalhost() {
  return Boolean(window.location.hostname === 'localhost' || window.location.hostname === '[::1]' || window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));
};
var hasMultipleCookies = function hasMultipleCookies(cookieName) {
  var cookiePairs = document.cookie ? document.cookie.split('; ') : [];
  var matchedCookies = cookiePairs.filter(function (pair) {
    var _pair$split = pair.split('='),
      _pair$split2 = _slicedToArray2(_pair$split, 1),
      name = _pair$split2[0];
    return cookieName === name;
  });
  return matchedCookies.length > 1;
};
var PERSISTENT_STORAGE_KEY_PREFIX = 'stytch_sdk_state_';
var getPersistentStorageKey = function getPersistentStorageKey(publicToken, key) {
  return "".concat(PERSISTENT_STORAGE_KEY_PREFIX).concat(publicToken).concat(key ? "::".concat(key) : '');
};
function makeSafeStorage(storage) {
  if (storage == null) {
    return {
      getItem: function getItem() {
        return null;
      },
      removeItem: function removeItem() {},
      setItem: function setItem() {}
    };
  }
  return {
    getItem: function getItem(publicKey, key) {
      var persistentStorageKey = getPersistentStorageKey(publicKey, key);
      try {
        return storage.getItem(persistentStorageKey);
      } catch (_a) {
        return null;
      }
    },
    setItem: function setItem(publicKey, key, value) {
      var persistentStorageKey = getPersistentStorageKey(publicKey, key);
      try {
        if (value) storage.setItem(persistentStorageKey, value);
      } catch (_a) {}
    },
    removeItem: function removeItem(publicKey, key) {
      var persistentStorageKey = getPersistentStorageKey(publicKey, key);
      try {
        storage.removeItem(persistentStorageKey);
      } catch (_a) {}
    }
  };
}
var safeLocalStorage = makeSafeStorage(globalThis.localStorage);
var safeSessionStorage = makeSafeStorage(globalThis.sessionStorage);
function getKeyBoundStorage(storage, publicToken) {
  return {
    getItem: function getItem(key) {
      return storage.getItem(publicToken, key);
    },
    setItem: function setItem(key, value) {
      storage.setItem(publicToken, key, value);
    },
    removeItem: function removeItem(key) {
      storage.removeItem(publicToken, key);
    }
  };
}
var STYTCH_SESSION_COOKIE = 'stytch_session';
var STYTCH_SESSION_JWT_COOKIE = 'stytch_session_jwt';
var STYTCH_INTERMEDIATE_SESSION_TOKEN_COOKIE = 'stytch_intermediate_session_token';
var SEEN_DOMAINS_KEY = 'seen_domains';
var SubscriptionDataLayer = /*#__PURE__*/function () {
  function SubscriptionDataLayer(publicToken, options) {
    _classCallCheck2(this, SubscriptionDataLayer);
    this._opaqueTokenCookieName = null;
    this._jwtCookieName = null;
    this._cookiePath = null;
    this._domain = null;
    this._cookieAvailableToSubdomains = false;
    this._istCookieName = null;
    this.publicToken = publicToken;
    this.state = null;
    this.stateKeysUpdated = new Set();
    this.subscriptions = {};
    this._localStorage = getKeyBoundStorage(safeLocalStorage, publicToken);
    this.browserSessionStorage = getKeyBoundStorage(safeSessionStorage, publicToken);
    if (options === null || options === void 0 ? void 0 : options.cookieOptions) {
      this._opaqueTokenCookieName = options.cookieOptions.opaqueTokenCookieName || null;
      this._jwtCookieName = options.cookieOptions.jwtCookieName || null;
      this._cookiePath = options.cookieOptions.path || null;
      this._domain = options.cookieOptions.domain || null;
      this._cookieAvailableToSubdomains = options.cookieOptions.availableToSubdomains || false;
      this._istCookieName = options.cookieOptions.istCookieName || null;
    }
    var localStorageState = this._localStorage.getItem('');
    if (!localStorageState) {
      return;
    }
    var parsedState;
    try {
      parsedState = JSON.parse(localStorageState);
    } catch (_a) {
      this.syncToLocalStorage();
      return;
    }
    this.state = parsedState;
  }
  return _createClass2(SubscriptionDataLayer, [{
    key: "opaqueTokenCookieName",
    get: function get() {
      var _a;
      return (_a = this._opaqueTokenCookieName) !== null && _a !== void 0 ? _a : STYTCH_SESSION_COOKIE;
    }
  }, {
    key: "jwtCookieName",
    get: function get() {
      var _a;
      return (_a = this._jwtCookieName) !== null && _a !== void 0 ? _a : STYTCH_SESSION_JWT_COOKIE;
    }
  }, {
    key: "istCookieName",
    get: function get() {
      var _a;
      return (_a = this._istCookieName) !== null && _a !== void 0 ? _a : STYTCH_INTERMEDIATE_SESSION_TOKEN_COOKIE;
    }
  }, {
    key: "readSessionCookie",
    value: function readSessionCookie() {
      return {
        session_token: api.get(this.opaqueTokenCookieName),
        session_jwt: api.get(this.jwtCookieName)
      };
    }
  }, {
    key: "readIntermediateSessionTokenCookie",
    value: function readIntermediateSessionTokenCookie() {
      return api.get(this.istCookieName);
    }
  }, {
    key: "writeSessionCookie",
    value: function writeSessionCookie(stateDiff) {
      var _a, _b, _c, _d;
      var state = stateDiff.state,
        session_token = stateDiff.session_token,
        session_jwt = stateDiff.session_jwt;
      var cookieOpts = SubscriptionDataLayer.generateCookieOpts({
        expiresAt: (_b = (_a = state === null || state === void 0 ? void 0 : state.session) === null || _a === void 0 ? void 0 : _a.expires_at) !== null && _b !== void 0 ? _b : '',
        availableToSubdomains: this._cookieAvailableToSubdomains,
        path: this._cookiePath,
        domain: this._domain
      });
      if (cookieOpts.domain) {
        this.addSeenDomain(cookieOpts.domain);
      }
      api.set(this.opaqueTokenCookieName, session_token, cookieOpts);
      api.set(this.jwtCookieName, session_jwt, cookieOpts);
      var alternateCookieOptions = SubscriptionDataLayer.generateCookieOpts({
        expiresAt: (_d = (_c = state === null || state === void 0 ? void 0 : state.session) === null || _c === void 0 ? void 0 : _c.expires_at) !== null && _d !== void 0 ? _d : '',
        availableToSubdomains: !this._cookieAvailableToSubdomains,
        path: this._cookiePath,
        domain: this._domain
      });
      if (alternateCookieOptions.domain) {
        this.addSeenDomain(alternateCookieOptions.domain);
      }
      if (hasMultipleCookies(this.jwtCookieName)) {
        api.remove(this.jwtCookieName, alternateCookieOptions);
      }
      if (hasMultipleCookies(this.opaqueTokenCookieName)) {
        api.remove(this.opaqueTokenCookieName, alternateCookieOptions);
      }
      if (hasMultipleCookies(this.jwtCookieName)) {
        logger.warn('Could not remove extraneous JWT cookie. This might happen if the cookie has been set using multiple `path` settings, and may produce unwanted behavior.');
      }
      if (hasMultipleCookies(this.opaqueTokenCookieName)) {
        logger.warn('Could not remove extraneous opaque token cookie.');
      }
    }
  }, {
    key: "writeIntermediateSessionTokenCookie",
    value: function writeIntermediateSessionTokenCookie(IST) {
      var expiresAtTime = new Date(Date.now() + 10 * 60000);
      var cookieOpts = SubscriptionDataLayer.generateCookieOpts({
        expiresAt: expiresAtTime.toString(),
        availableToSubdomains: this._cookieAvailableToSubdomains,
        path: this._cookiePath,
        domain: this._domain
      });
      api.set(this.istCookieName, IST, cookieOpts);
    }
  }, {
    key: "removeSessionCookie",
    value: function removeSessionCookie() {
      this.removeCookies([this.opaqueTokenCookieName, this.jwtCookieName]);
    }
  }, {
    key: "removeISTCookie",
    value: function removeISTCookie() {
      this.removeCookies([this.istCookieName]);
    }
  }, {
    key: "removeCookies",
    value: function removeCookies(cookiesToRemove) {
      var _this25 = this;
      var trackedDomains = this.getSeenDomains();
      var allDomains = [this._domain, null].concat(_toConsumableArray2(trackedDomains));
      var uniqueDomains = _toConsumableArray2(new Set(allDomains));
      [true, false].forEach(function (availableToSubdomains) {
        [_this25._cookiePath, null].forEach(function (path) {
          uniqueDomains.forEach(function (domain) {
            var cookieOpts = SubscriptionDataLayer.generateCookieOpts({
              expiresAt: new Date(0).toString(),
              availableToSubdomains: availableToSubdomains,
              path: path,
              domain: domain
            });
            cookiesToRemove.forEach(function (cookieName) {
              api.remove(cookieName, cookieOpts);
            });
          });
        });
      });
    }
  }, {
    key: "syncToLocalStorage",
    value: function syncToLocalStorage() {
      this._localStorage.setItem('', JSON.stringify(this.state));
    }
  }, {
    key: "getItem",
    value: function getItem(key) {
      return this._localStorage.getItem(key);
    }
  }, {
    key: "setItem",
    value: function setItem(key, value) {
      this._localStorage.setItem(key, value);
    }
  }, {
    key: "removeItem",
    value: function removeItem(key) {
      this._localStorage.removeItem(key);
    }
  }, {
    key: "getSeenDomains",
    value: function getSeenDomains() {
      var storedDomains = this.getItem(SEEN_DOMAINS_KEY);
      if (!storedDomains) {
        return [];
      }
      try {
        var parsed = JSON.parse(storedDomains);
        return Array.isArray(parsed) ? parsed : [];
      } catch (_a) {
        return [];
      }
    }
  }, {
    key: "addSeenDomain",
    value: function addSeenDomain(domain) {
      if (!domain) {
        return;
      }
      var storedDomains = this.getSeenDomains();
      if (!storedDomains.includes(domain)) {
        storedDomains.push(domain);
        this.setItem(SEEN_DOMAINS_KEY, JSON.stringify(storedDomains));
      }
    }
  }], [{
    key: "generateCookieOpts",
    value: function generateCookieOpts(_ref18) {
      var path = _ref18.path,
        domain = _ref18.domain,
        availableToSubdomains = _ref18.availableToSubdomains,
        expiresAt = _ref18.expiresAt;
      var cookieOpts = {
        expires: new Date(expiresAt),
        sameSite: 'lax'
      };
      if (path) {
        cookieOpts.path = path;
      }
      if (isLocalhost()) {
        cookieOpts.secure = false;
      } else {
        if (availableToSubdomains) {
          cookieOpts.domain = domain || window.location.host;
        }
        cookieOpts.secure = true;
      }
      return cookieOpts;
    }
  }]);
}();
var ConsumerSubscriptionDataLayer = /*#__PURE__*/function (_SubscriptionDataLaye) {
  function ConsumerSubscriptionDataLayer() {
    _classCallCheck2(this, ConsumerSubscriptionDataLayer);
    return _callSuper2(this, ConsumerSubscriptionDataLayer, arguments);
  }
  _inherits2(ConsumerSubscriptionDataLayer, _SubscriptionDataLaye);
  return _createClass2(ConsumerSubscriptionDataLayer);
}(SubscriptionDataLayer);
var consumerDataLayerCacheSymbol = Symbol["for"]('__stytch_DataLayer');
var getConsumerDataLayerCache = function getConsumerDataLayerCache() {
  var wdw = window;
  if (!wdw[consumerDataLayerCacheSymbol]) {
    wdw[consumerDataLayerCacheSymbol] = {};
  }
  return wdw[consumerDataLayerCacheSymbol];
};
var getConsumerDataLayer = function getConsumerDataLayer(publicToken, options) {
  var dataLayerCache = getConsumerDataLayerCache();
  if (!dataLayerCache[publicToken]) {
    dataLayerCache[publicToken] = new ConsumerSubscriptionDataLayer(publicToken, options);
  }
  return dataLayerCache[publicToken];
};
var addSubscriber = function addSubscriber(collection, subscriber) {
  var uniqueId = Math.random().toString(36).slice(-10);
  collection[uniqueId] = subscriber;
  return function () {
    return delete collection[uniqueId];
  };
};
var notifySubscribers = function notifySubscribers(collection, value) {
  Object.values(collection).forEach(function (cb) {
    return cb(value);
  });
};
var deepEqualData = createDeepEqual({
  KEYS_TO_EXCLUDE: ['last_accessed_at']
});
var BaseSubscriptionService = /*#__PURE__*/function () {
  function BaseSubscriptionService(_publicToken, _datalayer, _ref19) {
    var _this26 = this;
    var usingCustomApiEndpoint = _ref19.usingCustomApiEndpoint;
    _classCallCheck2(this, BaseSubscriptionService);
    this._publicToken = _publicToken;
    this._datalayer = _datalayer;
    this.fromCache = true;
    this._listen = function (e) {
      if (e.key !== getPersistentStorageKey(_this26._publicToken, '')) {
        return;
      }
      var parsedValue = e.newValue === null || e.newValue === 'null' ? null : JSON.parse(e.newValue);
      _this26.updateState(parsedValue, true);
    };
    window.addEventListener('storage', this._listen);
    if (!usingCustomApiEndpoint) {
      var _this$_datalayer$read = this._datalayer.readSessionCookie(),
        session_token = _this$_datalayer$read.session_token;
      if (!session_token) {
        this.destroySession();
        return;
      }
    }
  }
  return _createClass2(BaseSubscriptionService, [{
    key: "getTokens",
    value: function getTokens() {
      var _this$_datalayer$read2 = this._datalayer.readSessionCookie(),
        session_token = _this$_datalayer$read2.session_token,
        session_jwt = _this$_datalayer$read2.session_jwt;
      if (!(typeof session_token === 'string') || !(typeof session_jwt === 'string')) {
        return null;
      }
      return {
        session_token: session_token,
        session_jwt: session_jwt
      };
    }
  }, {
    key: "getIntermediateSessionToken",
    value: function getIntermediateSessionToken() {
      return this._datalayer.readIntermediateSessionTokenCookie() || null;
    }
  }, {
    key: "destroyState",
    value: function destroyState() {
      this.updateStateAndTokens({
        state: null,
        session_token: null,
        session_jwt: null,
        intermediate_session_token: null
      });
    }
  }, {
    key: "destroySession",
    value: function destroySession() {
      this._datalayer.removeSessionCookie();
      this.updateState(null);
    }
  }, {
    key: "_updateStateAndTokensInternal",
    value: function _updateStateAndTokensInternal(stateDiff, options) {
      var oldStateValue = this._datalayer.state;
      var newStateValue = stateDiff.state === null ? null : Object.assign(Object.assign({}, this._datalayer.state), stateDiff.state);
      this._datalayer.state = newStateValue;
      var wasCached = this.getFromCache();
      this.setCacheRefreshed();
      if (wasCached || !deepEqualData(oldStateValue, newStateValue)) {
        var notification;
        if (newStateValue == null || options.fromCache) {
          notification = newStateValue;
        } else {
          notification = Object.assign(Object.assign({}, newStateValue), {
            sessionDurationMinutes: options.sessionDurationMinutes
          });
        }
        notifySubscribers(this._datalayer.subscriptions, notification);
      }
    }
  }, {
    key: "updateStateAndTokens",
    value: function updateStateAndTokens(stateDiff) {
      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
        fromCache: false
      };
      if (stateDiff.state) {
        if (typeof stateDiff.session_token === 'string') {
          this._datalayer.writeSessionCookie(stateDiff);
        } else {
          this._datalayer.removeSessionCookie();
        }
        this._datalayer.removeISTCookie();
      } else if (stateDiff.intermediate_session_token) {
        if (typeof stateDiff.intermediate_session_token === 'string') {
          this._datalayer.writeIntermediateSessionTokenCookie(stateDiff.intermediate_session_token);
        } else {
          this._datalayer.removeISTCookie();
        }
        this._datalayer.removeSessionCookie();
      } else {
        this._datalayer.removeSessionCookie();
        this._datalayer.removeISTCookie();
      }
      this._updateStateAndTokensInternal(stateDiff, options);
      this._datalayer.syncToLocalStorage();
    }
  }, {
    key: "updateState",
    value: function updateState(state) {
      var fromExternalSource = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      var oldStateValue = this._datalayer.state;
      var newStateValue = state === null ? null : Object.assign(Object.assign({}, this._datalayer.state), state);
      this._datalayer.state = newStateValue;
      var wasCached = this.getFromCache();
      this.setCacheRefreshed();
      var hasStateChanged = !deepEqualData(oldStateValue, newStateValue);
      if (wasCached || hasStateChanged) {
        notifySubscribers(this._datalayer.subscriptions, newStateValue);
        if (hasStateChanged && !fromExternalSource) {
          this._datalayer.syncToLocalStorage();
        }
      }
    }
  }, {
    key: "updateTokens",
    value: function updateTokens(tokens) {
      var session_token = tokens.session_token,
        session_jwt = tokens.session_jwt;
      var cookie = this._datalayer.readSessionCookie();
      var diff = Object.assign(Object.assign({}, cookie), {
        session_token: session_token,
        session_jwt: session_jwt
      });
      if (typeof session_token === 'string' || typeof session_jwt === 'string') {
        this._datalayer.writeSessionCookie(diff);
        this._datalayer.removeISTCookie();
      } else {
        this._datalayer.removeSessionCookie();
      }
    }
  }, {
    key: "subscribeToState",
    value: function subscribeToState(callback) {
      return addSubscriber(this._datalayer.subscriptions, callback);
    }
  }, {
    key: "getState",
    value: function getState() {
      return this._datalayer.state;
    }
  }, {
    key: "destroy",
    value: function destroy() {
      window.removeEventListener('storage', this._listen);
    }
  }, {
    key: "syncFromDeviceStorage",
    value: function syncFromDeviceStorage() {
      return null;
    }
  }, {
    key: "getFromCache",
    value: function getFromCache() {
      return this.fromCache;
    }
  }, {
    key: "setCacheRefreshed",
    value: function setCacheRefreshed() {
      this.fromCache = false;
    }
  }]);
}();
var ConsumerSubscriptionService = /*#__PURE__*/function (_BaseSubscriptionServ) {
  function ConsumerSubscriptionService() {
    var _this27;
    _classCallCheck2(this, ConsumerSubscriptionService);
    _this27 = _callSuper2(this, ConsumerSubscriptionService, arguments);
    _this27.updateUser = function (user) {
      return _this27.updateState({
        user: user
      });
    };
    _this27.getUser = function () {
      var _a, _b;
      return (_b = (_a = _this27.getState()) === null || _a === void 0 ? void 0 : _a.user) !== null && _b !== void 0 ? _b : null;
    };
    _this27.getSession = function () {
      var _a, _b;
      return (_b = (_a = _this27.getState()) === null || _a === void 0 ? void 0 : _a.session) !== null && _b !== void 0 ? _b : null;
    };
    _this27.updateSession = function (resp, options) {
      var session = resp.session,
        user = resp.user,
        session_jwt = resp.session_jwt,
        session_token = resp.session_token;
      if (session_token && session_jwt) {
        _this27.updateStateAndTokens({
          state: {
            session: session,
            user: user
          },
          session_jwt: session_jwt,
          session_token: session_token,
          intermediate_session_token: null
        }, {
          fromCache: false,
          sessionDurationMinutes: options === null || options === void 0 ? void 0 : options.sessionDurationMinutes
        });
      } else {
        _this27.updateStateAndTokens({
          state: {
            session: session,
            user: user
          },
          session_token: true,
          session_jwt: true,
          intermediate_session_token: null
        }, {
          fromCache: false,
          sessionDurationMinutes: options === null || options === void 0 ? void 0 : options.sessionDurationMinutes
        });
      }
    };
    _this27.withUpdateSession = function (authenticate) {
      return function () {
        for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
          args[_key4] = arguments[_key4];
        }
        return __awaiter(_this27, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee76() {
          var resp, options;
          return _regenerator2().w(function (_context76) {
            while (1) switch (_context76.n) {
              case 0:
                _context76.n = 1;
                return authenticate.apply(void 0, args);
              case 1:
                resp = _context76.v;
                if (resp != null) {
                  options = args.find(function (a) {
                    return a != null && !(typeof a === 'string');
                  });
                  this.updateSession(resp, {
                    sessionDurationMinutes: options === null || options === void 0 ? void 0 : options.session_duration_minutes
                  });
                }
                return _context76.a(2, resp);
            }
          }, _callee76, this);
        }));
      };
    };
    return _this27;
  }
  _inherits2(ConsumerSubscriptionService, _BaseSubscriptionServ);
  return _createClass2(ConsumerSubscriptionService);
}(BaseSubscriptionService);
var internalSymB2C = Symbol["for"]('stytch__internal_b2c');
var writeB2CInternals = function writeB2CInternals(obj, internals) {
  Object.assign(obj, _defineProperty({}, internalSymB2C, internals));
};
var buildFinalConfig = function buildFinalConfig(clientName) {
  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var _a, _b;
  var cookieOptions = opts.cookieOptions,
    keepSessionAlive = opts.keepSessionAlive;
  var validator = validate(clientName);
  validator.isOptionalBoolean('keepSessionAlive', keepSessionAlive);
  if (cookieOptions) {
    validator.isOptionalString('cookieOptions.opaqueTokenCookieName', cookieOptions.opaqueTokenCookieName).isOptionalString('cookieOptions.jwtCookieName', cookieOptions.jwtCookieName).isOptionalString('cookieOptions.istCookieName', cookieOptions.istCookieName).isOptionalString('cookieOptions.path', cookieOptions.path).isOptionalString('cookieOptions.domain', cookieOptions.domain);
  }
  return {
    cookieOptions: cookieOptions,
    keepSessionAlive: keepSessionAlive,
    endpoints: {
      testAPIURL: getTestApiURL(opts),
      liveAPIURL: getLiveApiURL(opts),
      dfpBackendURL: getDFPBackendURL(opts),
      dfpCdnURL: getDFPCdnURL(opts),
      clientsideServicesIframeURL: (_b = (_a = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _a === void 0 ? void 0 : _a.clientsideServicesIframeURL) !== null && _b !== void 0 ? _b : CLIENTSIDE_SERVICES_IFRAME_URL
    }
  };
};
var hasCustomApiEndpoint = function hasCustomApiEndpoint(token) {
  var rawOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var customBaseUrl = rawOptions.customBaseUrl,
    endpointOptions = rawOptions.endpointOptions;
  return isTestPublicToken(token) ? !!(customBaseUrl || (endpointOptions === null || endpointOptions === void 0 ? void 0 : endpointOptions.testApiDomain)) : !!(customBaseUrl || (endpointOptions === null || endpointOptions === void 0 ? void 0 : endpointOptions.apiDomain));
};
function isHandledTokenType(handledTypes, tokenType) {
  return handledTypes.includes(tokenType);
}
var clearStytchTokenParams = function clearStytchTokenParams() {
  var url = removeStytchTokenParams(window.location.toString());
  window.history.replaceState(null, document.title, url);
};
var createAuthUrlHandler = function createAuthUrlHandler(handlers) {
  var handledTokenTypes = Object.keys(handlers);
  var parseAuthenticateUrl = function parseAuthenticateUrl() {
    var href = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.href;
    var url = new URL(href);
    var tokenType = url.searchParams.get('stytch_token_type');
    var token = url.searchParams.get('token');
    if (!token || !tokenType) {
      return null;
    }
    if (isHandledTokenType(handledTokenTypes, tokenType)) {
      return {
        handled: true,
        token: token,
        tokenType: tokenType
      };
    }
    return {
      handled: false,
      token: token,
      tokenType: tokenType
    };
  };
  var authenticateByUrl = function authenticateByUrl(_a, href) {
    return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regenerator2().m(function _callee77() {
      var clearParams, options, shouldClearParams, parsed, token, tokenType, handler, data;
      return _regenerator2().w(function (_context77) {
        while (1) switch (_context77.p = _context77.n) {
          case 0:
            clearParams = _a.clearParams, options = __rest(_a, ["clearParams"]);
            if (href === void 0) {
              href = window.location.href;
            }
            shouldClearParams = clearParams !== null && clearParams !== void 0 ? clearParams : href === window.location.href;
            parsed = parseAuthenticateUrl(href);
            if (!(parsed == null)) {
              _context77.n = 1;
              break;
            }
            return _context77.a(2, null);
          case 1:
            if (parsed.handled) {
              _context77.n = 2;
              break;
            }
            return _context77.a(2, parsed);
          case 2:
            token = parsed.token, tokenType = parsed.tokenType;
            handler = handlers[tokenType];
            _context77.p = 3;
            _context77.n = 4;
            return handler(token, options);
          case 4:
            data = _context77.v;
            return _context77.a(2, {
              handled: true,
              tokenType: tokenType,
              data: data
            });
          case 5:
            _context77.p = 5;
            if (shouldClearParams) {
              clearStytchTokenParams();
            }
            return _context77.f(5);
          case 6:
            return _context77.a(2);
        }
      }, _callee77, null, [[3,, 5, 6]]);
    }));
  };
  return {
    authenticateByUrl: authenticateByUrl,
    parseAuthenticateUrl: parseAuthenticateUrl
  };
};
function removeStytchTokenParams(href) {
  var url = new URL(href);
  var params = url.searchParams;
  params["delete"]('token');
  params["delete"]('stytch_token_type');
  return url;
}
var StytchHeadlessClient = /*#__PURE__*/_createClass2(function StytchHeadlessClient(publicTokenRaw, options) {
  var _this28 = this;
  _classCallCheck2(this, StytchHeadlessClient);
  checkNotSSR('StytchHeadlessClient');
  checkPublicToken(publicTokenRaw);
  var _PUBLIC_TOKEN = publicTokenRaw !== null && publicTokenRaw !== void 0 ? publicTokenRaw : '';
  var config = buildFinalConfig(this.constructor.name, options);
  var usingCustomApiEndpoint = hasCustomApiEndpoint(_PUBLIC_TOKEN, options);
  this._dataLayer = getConsumerDataLayer(_PUBLIC_TOKEN, config);
  this._subscriptionService = new ConsumerSubscriptionService(_PUBLIC_TOKEN, this._dataLayer, {
    usingCustomApiEndpoint: usingCustomApiEndpoint
  });
  this._stateChangeClient = new StateChangeClient(this._subscriptionService, {});
  this.onStateChange = function () {
    var _this28$_stateChangeC;
    return (_this28$_stateChangeC = _this28._stateChangeClient).onStateChange.apply(_this28$_stateChangeC, arguments);
  };
  var additionalTelemetryDataFn = function additionalTelemetryDataFn() {
    var _a, _b, _c, _d;
    return {
      stytch_user_id: (_b = (_a = _this28._dataLayer.state) === null || _a === void 0 ? void 0 : _a.user) === null || _b === void 0 ? void 0 : _b.user_id,
      stytch_session_id: (_d = (_c = _this28._dataLayer.state) === null || _c === void 0 ? void 0 : _c.session) === null || _d === void 0 ? void 0 : _d.session_id
    };
  };
  var passwordsPKCEManager = new PKCEManager(this._dataLayer, 'passwords');
  var networkClient = new NetworkClient(_PUBLIC_TOKEN, this._dataLayer, config.endpoints.liveAPIURL, config.endpoints.testAPIURL, additionalTelemetryDataFn);
  this._networkClient = networkClient;
  var bootstrap = new BootstrapDataManager(_PUBLIC_TOKEN, this._networkClient, this._dataLayer);
  var captcha = new CaptchaProvider(bootstrap.getAsync());
  var dfpProtectedAuth = new DFPProtectedAuthProvider(_PUBLIC_TOKEN, config.endpoints.dfpBackendURL, config.endpoints.dfpCdnURL, bootstrap.getAsync(), captcha.executeRecaptcha);
  var clientsideServices = new ClientsideServicesProvider(config.endpoints.clientsideServicesIframeURL);
  var oneTap = new OneTapProvider(_PUBLIC_TOKEN, clientsideServices);
  var searchManager = new SearchDataManager(this._networkClient, dfpProtectedAuth);
  this.user = new HeadlessUserClient(this._networkClient, this._subscriptionService);
  this.session = new HeadlessSessionClient(this._networkClient, this._subscriptionService);
  this.magicLinks = new HeadlessMagicLinksClient(this._networkClient, this._subscriptionService, new PKCEManager(this._dataLayer, 'magic_links'), passwordsPKCEManager, bootstrap.getAsync(), dfpProtectedAuth);
  this.otps = new HeadlessOTPClient(this._networkClient, this._subscriptionService, captcha.executeRecaptcha, dfpProtectedAuth);
  this.oauth = new HeadlessOAuthClient(this._networkClient, this._subscriptionService, new PKCEManager(this._dataLayer, 'oauth'), bootstrap.getAsync(), {
    publicToken: _PUBLIC_TOKEN,
    testAPIURL: config.endpoints.testAPIURL,
    liveAPIURL: config.endpoints.liveAPIURL
  }, oneTap);
  this.cryptoWallets = new HeadlessCryptoWalletClient(this._networkClient, this._networkClient, this._subscriptionService, captcha.executeRecaptcha, dfpProtectedAuth, bootstrap.getAsync());
  this.totps = new HeadlessTOTPClient(this._networkClient, this._subscriptionService, dfpProtectedAuth);
  this.webauthn = new HeadlessWebAuthnClient(this._networkClient, this._subscriptionService, dfpProtectedAuth);
  this.passwords = new HeadlessPasswordClient(this._networkClient, this._subscriptionService, passwordsPKCEManager, bootstrap.getAsync(), dfpProtectedAuth);
  this.impersonation = new HeadlessImpersonationClient(this._networkClient, this._subscriptionService, dfpProtectedAuth);
  this.rbac = new HeadlessRBACClient(bootstrap.getSync(), bootstrap.getAsync(), this._subscriptionService);
  this.idp = new HeadlessIDPClient(this._networkClient);
  this._sessionManager = new SessionManager(this._subscriptionService, this.session, _PUBLIC_TOKEN, {
    keepSessionAlive: config.keepSessionAlive
  });
  if (usingCustomApiEndpoint || this._dataLayer.readSessionCookie().session_token) {
    this._sessionManager.performBackgroundRefresh();
  }
  this._networkClient.logEvent({
    name: 'sdk_instance_instantiated',
    details: {
      event_callback_registered: false,
      error_callback_registered: false,
      success_callback_registered: false
    }
  });
  bootstrap.getAsync().then(function (bootstrapData) {
    if (bootstrapData.vertical === VERTICAL_B2B) {
      logger.error('This application is using a Stytch client for Consumer projects, but the public token is for a Stytch B2B project. Use a B2B Stytch client instead, or verify that the public token is correct.');
    }
  });
  var _createAuthUrlHandler = createAuthUrlHandler({
      magic_links: function magic_links(token, options) {
        return _this28.magicLinks.authenticate(token, options);
      },
      oauth: function oauth(token, options) {
        return _this28.oauth.authenticate(token, options);
      },
      impersonation: function impersonation(token) {
        return _this28.impersonation.authenticate({
          impersonation_token: token
        });
      }
    }),
    authenticateByUrl = _createAuthUrlHandler.authenticateByUrl,
    parseAuthenticateUrl = _createAuthUrlHandler.parseAuthenticateUrl;
  this.authenticateByUrl = authenticateByUrl;
  this.parseAuthenticateUrl = parseAuthenticateUrl;
  writeB2CInternals(this, {
    bootstrap: bootstrap,
    clientsideServices: clientsideServices,
    captcha: captcha,
    oneTap: oneTap,
    searchManager: searchManager,
    publicToken: _PUBLIC_TOKEN,
    dataLayer: this._dataLayer,
    networkClient: this._networkClient
  });
});
exports.BiometricRegistrationIdIsNullOrBlank = BiometricRegistrationIdIsNullOrBlank;
exports.BiometricsAlreadyEnrolledError = BiometricsAlreadyEnrolledError;
exports.BiometricsFailedError = BiometricsFailedError;
exports.BiometricsUnavailableError = BiometricsUnavailableError;
exports.ChallengeSigningFailedError = ChallengeSigningFailedError;
exports.DFPNotConfigured = DFPNotConfigured;
exports.DeviceCredentialsNotAllowedError = DeviceCredentialsNotAllowedError;
exports.FailedCodeChallengeError = FailedCodeChallengeError;
exports.FailedToDecryptDataError = FailedToDecryptDataError;
exports.IDPOAuthFlowMissingParamError = IDPOAuthFlowMissingParamError;
exports.InternalError = InternalError;
exports.InvalidAuthorizationCredentialError = InvalidAuthorizationCredentialError;
exports.InvalidCredentialTypeError = InvalidCredentialTypeError;
exports.InvalidPrivateKeyLength = InvalidPrivateKeyLength;
exports.InvalidRedirectSchemeError = InvalidRedirectSchemeError;
exports.InvalidStartUrlError = InvalidStartUrlError;
exports.JSONDataNotConvertibleToStringError = JSONDataNotConvertibleToStringError;
exports.KeyInvalidatedError = KeyInvalidatedError;
exports.KeystoreUnavailableError = KeystoreUnavailableError;
exports.MissingAttestationObjectError = MissingAttestationObjectError;
exports.MissingAuthorizationCredentialIDTokenError = MissingAuthorizationCredentialIDTokenError;
exports.MissingCipherIv = MissingCipherIv;
exports.MissingGoogleClientIDError = MissingGoogleClientIDError;
exports.MissingPKCEError = MissingPKCEError;
exports.MissingPublicKeyError = MissingPublicKeyError;
exports.MissingUrlError = MissingUrlError;
exports.NoBiometricsEnrolledError = NoBiometricsEnrolledError;
exports.NoBiometricsRegistrationError = NoBiometricsRegistrationError;
exports.NoCredentialsPresentError = NoCredentialsPresentError;
exports.NoCurrentSessionError = NoCurrentSessionError;
exports.PasskeysInvalidEncoding = PasskeysInvalidEncoding;
exports.PasskeysMisconfigured = PasskeysMisconfigured;
exports.PasskeysUnsupportedError = PasskeysUnsupportedError;
exports.RandomNumberGenerationFailed = RandomNumberGenerationFailed;
exports.SDKAPIUnreachableError = SDKAPIUnreachableError;
exports.SDKNotConfiguredError = SDKNotConfiguredError;
exports.SignInWithAppleMisconfigured = SignInWithAppleMisconfigured;
exports.StytchAPIError = StytchAPIError;
exports.StytchAPISchemaError = StytchAPISchemaError;
exports.StytchAPIUnreachableError = StytchAPIUnreachableError;
exports.StytchError = StytchError;
exports.StytchHeadlessClient = StytchHeadlessClient;
exports.StytchSDKAPIError = StytchSDKAPIError;
exports.StytchSDKError = StytchSDKError;
exports.StytchSDKSchemaError = StytchSDKSchemaError;
exports.StytchSDKUsageError = StytchSDKUsageError;
exports.UNRECOVERABLE_ERROR_TYPES = UNRECOVERABLE_ERROR_TYPES;
exports.UserCancellationError = UserCancellationError;
exports.UserLockedOutError = UserLockedOutError;
exports.errorToStytchError = errorToStytchError;
//# sourceMappingURL=index.headless.js.map
